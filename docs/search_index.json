[["mô-hình-tuyến-tính-tổng-quát..html", "Chương 1 Mô hình tuyến tính tổng quát. 1.1 Các nhược điểm của mô hình hồi quy tuyến tính. 1.2 Xây dựng mô hình tuyến tính tổng quát 1.3 Các thành phần của mô hình tuyến tính tổng quát. 1.4 Hàm hợp lý tối đa và ước lượng mô hình. 1.5 So sánh và lựa chọn mô hình tuyến tính tổng quát.", " Chương 1 Mô hình tuyến tính tổng quát. Mô hình tuyến tính tổng quát, Generalized Linear Model hay viết tắt là GLM, được sử dụng rộng rãi trong các doanh nghiệp, các cơ quan tổ chức hoạt động trong lĩnh vực tài chính, ngân hàng, và bảo hiểm. Các chuyên gia quản trị rủi ro trong các ngân hàng sử dụng GLM để chấm điểm tín dụng khách hàng và quyết định phê duyệt tín dụng. Các chuyên gia tính toán thường xuyên sử dụng mô hình GLM để xác định phí thuần của các sản phẩm bảo hiểm, để xác định dự phòng nghiệp vụ, hoặc để phân loại rủi ro mà công ty phải đối mặt. Khái niệm GLM lần đầu tiên được sử dụng trong nghiên cứu của Nelder và Wedderburn (1972) và từ đó đến nay đã có nhiều sách tham khảo tin cậy cho mô hình này như Alan Agresti (2015) hay Annette J. Dobson and Adrian G. Barnett (2018). Đa số các tài liệu tham khảo giới thiệu GLM dưới góc độ toán học và mang nhiều tính lý thuyết. Chương sách này sẽ cố gắng giải thích và tiếp cận GLM từ một góc nhìn mang tính thực hành nhiều hơn. Chúng tôi sẽ không quá đi sâu vào các khía cạnh như giả thiết hay phương pháp ước lượng của mô hình GLM, mà sẽ tập trung vào hướng dẫn bạn đọc ứng dụng GLM trên nhiều kiểu dữ liệu nhất có thể. Mô hình tuyến tính tổng quát được phát biểu dưới dạng công thức như sau: \\[\\begin{align} &amp; Y \\sim \\mathcal{F}_{\\boldsymbol{\\theta}} \\\\ &amp; \\mathbb{E}(Y|\\textbf{X} = \\textbf{x}_i) = \\mu_i \\\\ &amp; g(\\mu_i) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p} \\\\ &amp; \\mu_i = g^{-1}\\left(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p} \\right) \\tag{1.1} \\end{align}\\] với \\(Y\\) là biến mục tiêu, \\(\\mathcal{F}_{\\boldsymbol{\\theta}}\\) là một phân phối xác suất có tham số là một véc-tơ \\(\\boldsymbol{\\theta}\\). Giá trị trung bình của biến mục tiêu \\(Y\\) phụ thuộc vào giá trị của (các) biến độc lập như sau: với điều kiện véc-tơ biến độc lập \\(\\textbf{X} = (X_1, X_2, \\cdots, X_p)\\) nhận giá trị \\(\\textbf{x_i} = (x_{i,1}, x_{i,2}, \\cdots, x_{i,p})\\), giá trị trung bình của biến phụ thuộc với điều kiện \\(\\textbf{X} = x_i\\), ký hiệu \\(Y|\\textbf{X} = x_i\\) hoặc ngắn gọn hơn là \\(Y_i\\), được xác định bằng giá trị một hàm số ngược của một hàm số thực \\(g\\), ký hiệu là hàm \\(g^{-1}\\), tính tại một tổ hợp tuyến tính của các giá trị \\((x_{i,1}, x_{i,2}, \\cdots, x_{i,p})\\). Thay vì cố gắng hiểu các khái niệm toán học ở trên, chúng ta hãy thử áp dụng mô hình kể trên trong một trường hợp cụ thể. Chúng ta sẽ xây dựng một mô hình tuyến tính tổng quát mà trong đó biến mục tiêu \\(Y\\) cho biết người mua bảo hiểm xe ô tô có hay không lựa chọn đầy đủ các quyền lợi bảo hiểm khi ký hợp đồng mua bảo hiểm trách nhiệm dân sự. Dữ liệu được sử dụng có tên là \\(MotoInsurance.csv\\). Dữ liệu có 6 biến độc lập là: Độ tuổi của người lái xe, biến \\(age\\), nhận giá trị là các số nguyên dương từ 15 đến 92 tuổi. Kinh nghiệm lái xe, biến \\(seniority\\), cho biết số năm kinh nghiệm lái xe, giá trị là các số nguyên từ 2 đến 40 năm. Giới tính của người lái xe, biến \\(sex\\), nhận giá trị “M” nếu người lái xe là nam giới và “F” nếu người lái xe là nữ giới. Nơi xe được đăng ký, biến \\(urban\\), nhận giá trị là 1 nếu xe được đăng ký tại khu vực thành phố và nhận giá trị 0 trong các trường hợp còn lại. Loại hình đăng ký xe, biến \\(private\\), nhận giá trị là 1 nếu xe mua bảo hiểm là xe đăng ký theo cá nhân và nhận giá trị 0 trong các trường hợp còn lại. Tình trạng hôn nhân của người lái xe, biến \\(marital\\), nhận giá trị “C” nếu đã kết hôn, “S” tương ứng với chưa kết hôn, và “O” tương ứng với đã ly dị. Biến mục tiêu hay biến phụ thuộc là biến \\(Y\\) nhận một trong hai giá trị, “Yes” nếu người mua bảo hiểm trách nhiệm dân sự đồng ý lựa thêm quyền lợi bảo hiểm bổ sung và “No” nếu người mua bảo hiểm trách nhiệm dân sự không lựa chọn mua quyền lợi bổ sung. Để mô hình ở dạng đơn giản nhất có thể, chúng tôi lựa chọn hai biến độc lập để xây dựng mô hình là biến \\(age\\) và biến \\(sex\\). Chúng ta sẽ sử dụng biến \\(age\\) như một biến kiểu số, trong khi biến \\(sex\\) là một biến kiểu phân loại/rời rạc nhận một trong hai giá trị là “M” tương ứng với nam giới và “F” tương ứng với nữ giới. Đoạn lệnh R dưới đây được sử dụng để lấy dữ liệu và phân tích nhanh ảnh hưởng của các biến \\(age\\) và \\(sex\\) lên quyết định mua bảo hiểm bổ sung của người sở hữu xe ô tô. dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/MotoInsurance.csv&quot;) # Đổi các biến Y và sex sang kiểu factor dat$Y&lt;-as.factor(dat$Y) dat$sex&lt;-as.factor(dat$sex) # Thực hiện các phân tích khai phá p1&lt;-dat%&gt;%ggplot()+geom_boxplot(aes(x = Y, y = age))+ ggtitle(&quot;Mối liên hệ giữa biến age và biến Y&quot;)+ theme_minimal() p2&lt;-dat%&gt;%ggplot()+geom_bar(aes(x = sex, fill = Y),col = &quot;black&quot;)+ ggtitle(&quot;Mối liên hệ giữa biến sex và biến Y&quot;)+ theme_minimal()+ scale_fill_manual(values = c(&quot;white&quot;,&quot;grey&quot;)) grid.arrange(p1,p2, ncol = 2) Bạn đọc có thể thấy rằng: đồ thị bên trái cho thấy những người trẻ tuổi hơn có xu hướng đồng ý mua bảo hiểm bổ sung hơn những người nhiều tuổi; đồ thị bên phải cho thấy nữ giới có xu hướng mua bảo hiểm bổ sung cao hơn so với nam giới. Chúng ta sẽ xây dựng một mô hình tuyến tính tổng quát để xác nhận lại các phân tích ở trên và lượng hóa được ảnh hưởng của các biến \\(age\\) và \\(sex\\) lên quyết định mua bảo hiểm bổ sung. Hàm số dùng để xây dựng và ước lượng mô hình tuyến tính tổng quát trong R là hàm glm() của thư viện \\(stat\\): # Biến Y có phân phối nhị thức # Hàm g là hàm probit glm1&lt;-glm(Y ~ age + sex, data=dat, family = binomial(link = &quot;probit&quot;)) # khai báo hàm g summary(glm1) ## ## Call: ## glm(formula = Y ~ age + sex, family = binomial(link = &quot;probit&quot;), ## data = dat) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -1.4495 -0.9278 -0.7382 1.2584 2.0391 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) 0.678644 0.079138 8.575 &lt;2e-16 *** ## age -0.016257 0.001619 -10.041 &lt;2e-16 *** ## sexM -0.446783 0.047421 -9.422 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 5163.3 on 3999 degrees of freedom ## Residual deviance: 4933.9 on 3997 degrees of freedom ## AIC: 4939.9 ## ## Number of Fisher Scoring iterations: 4 Chúng ta có thể thấy rằng các hệ số của biến \\(age\\) và \\(sex\\) đều có ý nghĩa thống kê khi các giá trị \\(p-value\\) đều rất nhỏ. Đúng như chúng nhận định từ phần phân tích khai phá, hệ số tuyến tính của biến \\(age\\) là số âm, bằng -0.016, cho biết người trẻ tuổi hơn có khả năng đồng ý mua bảo hiểm bổ sung cao hơn. Hệ số ứng với biến giới tính nam là số âm, bằng -0.447, điều này cho biết khả năng nam giới đồng ý mua bảo hiểm bổ sung là thấp hơn so với nữ giới. Chúng ta có thể viết các thành phần của mô hình tuyến tính tổng quát đã xây dựng ở trên như sau \\[\\begin{align} &amp; Y \\sim \\mathcal{B}(\\rho) \\\\ &amp; \\mathbb{E}(Y_i) = \\mathbb{E}\\left(Y|(age_i, sex_i)\\right) = \\rho_i \\\\ &amp; \\Phi^{-1}\\left(\\rho_i\\right) = 0.678 - 0.016 \\times age_i - 0.447 \\times sex_i \\\\ &amp; \\rho_i = \\Phi\\left(0.678 - 0.016 \\times age_i - 0.447 \\times sex_i\\right) \\tag{1.2} \\end{align}\\] trong đó \\(\\rho_i\\) là xác suất hay khả năng người \\(i\\) mua đầy đủ các quyền lợi của bảo hiểm sau khi đã mua bảo hiểm trách nhiệm dân sự. Hàm \\(\\Phi\\) là hàm phân phối xác suất của biến ngẫu nhiên phân phối chuẩn có trung bình 0 va phương sai bằng 1. Đây là hàm số mà chúng ta lựa chọn để liên kết giữa xác suất mua bảo hiểm bổ sung đến tổ hợp tuyến tính của các biến độc lập. Từ kết quả của mô hình, chúng ta có thể kết luận rằng khả năng mua bảo hiểm bổ sung phụ thuộc một cách có ý nghĩa thống kê biến độ tuổi (\\(age\\)) và giới tính (\\(sex\\)) của người tham gia bảo hiểm trách nhiệm dân sự bắt buộc. Sự phụ thuộc này cụ thể như sau: Xác suất mà một người mua đầy đủ các quyền lợi bảo hiểm sau khi mua bảo hiểm bắt buộc sẽ GIẢM nếu tuổi của người tham gia bảo hiểm TĂNG, điều này có nghĩa là những người trẻ tuổi hơn thường có nhu cầu mua đầy đủ các quyền lợi bảo hiểm hơn những người lớn tuổi. Nam giới ít có khả năng mua đầy đủ quyền lợi bảo hiểm như nữ giới. Mối liên hệ giữa xác suất mua bảo hiểm đầy đủ và các thuộc tính của người được quan sát được mô tả một cách định lượng thông qua phương trình \\[\\begin{align} \\rho_i = \\Phi\\left(0.678 - 0.016 \\times age_i - 0.447 \\times sex_i\\right) \\tag{1.3} \\end{align}\\] trong đó \\(age_i\\) là tuổi của người tham gia bảo hiểm; \\(sex_i\\) nhận giá trị bằng 1 nếu người đó là nam giới và 0 nếu người đó là nữ giới; và \\(\\Phi\\) là hàm phân phối xác suất của biến ngẫu nhiên phân phối chuẩn \\(\\mathcal{N}(0,1)\\); miền giá trị của hàm số này đảm bảo cho giá trị xác suất \\(\\rho_i\\) được tính ra nằm trong khoảng (0,1). Bạn đọc có thể nhận thấy được sự khác biệt giữa mô hình tuyến tính tổng quát ở trên với mô hình tuyến tính thông thường ở hai điểm: Phân phối xác suất của biến mục tiêu \\(Y\\) là phân phối nhị thức chứ không phải là phân phối chuẩn. Mối liên kết giữa giá trị trung bình của biến mục tiêu \\(Y\\) và tổ hợp tuyến tính của các biến độc lập được thể hiện thông qua một hàm số, trong trường hợp này là hàm \\(\\Phi\\). Trong mô hình tuyến tính thông thường, giá trị trunh bình của biến mục tiêu được mô tả trực tiếp bằng tổ hợp tuyến tính của các biến độc lập. Hải điểm nêu trên cũng chính là hai cải tiến quan trọng của mô hình tuyến tính tổng so với mô hình hồi quy tuyến tính thông thường. Việc tổng quát hóa phân phối của biến phụ thuộc và thiết lập một hàm liên kết giữa giá trị trung bình của biến phụ thuộc và với các biến độc lập giúp cho mô hình tuyến tính tổng quát linh hoạt hơn rất nhiều khi làm việc với các dữ liệu cụ thể và vẫn giữ được khả năng suy diễn giống như mô hình hồi quy tuyến tính thông thường. Trong phần tiếp theo của chương chúng ta sẽ thảo luận kỹ hơn về các vấn đề này. 1.1 Các nhược điểm của mô hình hồi quy tuyến tính. Mô hình hồi quy tuyến tính là nền tảng quan trọng cho hầu hết các mô hình học máy và các mô hình trí tuệ nhân tạo hiện tại. Trước khi những mô hình học máy được nghiên cứu và phát triển mạnh mẽ như hiện nay, những người xây dựng mô hình luôn gặp khó khăn khi sử dụng mô hình hồi quy tuyến tính trong nhiều hoàn cảnh. Nguyên nhân là do giả thiết về phân phối xác suất của biến mục tiêu và miền giá trị trung bình của biến mục tiêu của mô hình hồi quy tuyến tính thông thường là không phù hợp với đa số dữ liệu thực tế. Thật vậy, mô hình hồi quy tuyến tính được thảo luận trong phần trước của cuốn sách có thể được tóm tắt như sau: người xây dựng mô hình cố gắng nghiên cứu mối quan hệ giữa một biến mục tiêu \\(Y\\) với véc-tơ biến độc lập \\(\\textbf{X} = (X_1, X_2, \\cdots, X_p)\\) bằng cách cho rằng mối liên hệ giữa \\(Y\\) và \\(\\textbf{X}\\) là một hàm tuyến tính. Mối liên hệ đó không đồng nhất nên sai số sẽ tồn tại và những người xây dựng mô hình cho rằng sai số có phân phối chuẩn với trung bình bằng 0 và độ lệch chuẩn là một hằng số \\(\\sigma &gt; 0\\). Chúng ta biểu diễn mô hình tuyến tính thông thương như sau \\[\\begin{align} &amp; Y = \\beta_0 + \\beta_1 \\cdot X_1 + \\beta_2 \\cdot X_2 + \\cdots + \\beta_p \\cdot X_p + \\epsilon \\\\ &amp; \\epsilon \\sim \\mathcal{N}(0, \\sigma^2) \\tag{1.4} \\end{align}\\] Bạn đọc có thể thấy rằng trong mô hình hồi quy tuyến tính, biến phụ thuộc \\(Y\\) là biến ngẫu nhiên có phân phối chuẩn có phương sai là \\(\\sigma^2\\) và giá trị trung bình phụ thuộc vào véc-tơ biến độc lập \\(\\textbf{X}_i\\). Với điều kiện biến độc lập nhận giá trị là \\(\\textbf{x}_i = (x_{i,1}, x_{i,2}, \\cdots, x_{i,p})\\); chúng ta có mô hình hồi quy tuyến tính như sau: \\[\\begin{align} &amp; Y_i \\sim \\mathcal{N}(\\mu_i, \\sigma^2) \\\\ &amp; \\mu_i = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p} \\tag{1.5} \\end{align}\\] Ngoài giả thiết về phân phối chuẩn của \\(Y\\), mô hình hồi quy tuyến tính thông thường còn cho rằng giá trị trung bình của biến ngẫu nhiên \\(Y\\) với điều kiện các biến độc lập nhận giá trị \\(\\textbf{x}_i\\), ký hiệu \\(\\mu_i\\), là một tổ hợp tuyến tính của các biến độc lập. Khi các biến độc lập nhận các giá trị bất kỳ, miền giá trị của \\(\\mu_i\\) sẽ là (toàn bộ) tập các số thực \\(\\mathbb{R}\\). Câu hỏi đặt ra là: làm như thế nào để áp dụng mô hình hồi quy tuyến tính trong các trường hợp như sau? Biến mục tiêu \\(Y\\) chỉ nhận hai giá trị là 0 hoặc 1. Đây là trường hợp rất thường gặp phải trong nhiều lĩnh vực khi thực hiện phân tích dữ liệu. Có thể kể đến như: khi biến \\(Y\\) đại diện cho sự kiện một người có hay không tham gia bảo hiểm xã hội; một người có hay không thực hiện rút bảo hiểm xã hội một lần trong thời gian một khoảng thời gian; một khách hàng có hay không gửi yêu cầu thanh toán bảo hiểm; hay tương tự như ví dụ trong phần đầu của cuốn sách, một khách hàng đã mua bảo hiểm bắt buộc có hay không mua thêm các quyền lợi bảo hiểm bổ sung. Ngoài lĩnh vực bảo hiểm, biến mục tiêu \\(Y\\) chỉ nhận giá trị 0 hoặc 1 còn xuất hiện trong lĩnh vực ngân hàng tài chính: biến mục tiêu cho biết một giao dịch trực tuyến có phải là một giao dịch gian lận hay không; một khách hàng có hay không tiếp nhận sản phẩm dịch vụ tài chính với mới; một khách hàng có hay không hoàn trả khoản nợ thẻ tín dụng trong thời gian tới,… Trong tất cả các trường hợp kể trên không thể giả thiết phân phối xác suất của biến mục tiêu là phân phối chuẩn. Hơn thế nữa, giá trị trung bình của biến mục tiêu sẽ luôn nằm trong khoảng 0 đến 1, chứ không phải toàn bộ trục số thực. Nếu sử dụng một tổ hợp tuyến tính của các biến độc lập để tính toán giá trị trung bình của biến mục tiêu, chúng ta sẽ có thể gặp các giá trị nhỏ hơn 0 hoặc các giá trị lớn hơn 1. Biến mục tiêu \\(Y\\) là biến dạng đếm. Chẳng hạn như \\(Y\\) cho biết một người tham gia bảo hiểm xã hội gửi yêu cầu bồi thường bao nhiêu lần trong một năm; biến \\(Y\\) cho biết một khách hàng mua bảo hiểm xe ô tô gây ra bao nhiêu tai nạn trong thời gian được bảo hiểm,… Trong trường hợp này, \\(Y\\) sẽ nhận giá trị kiểu số đếm: \\(0, 1, 2, \\cdots\\) tương ứng với số lần khách hàng gửi yêu cầu bảo hiểm. Không thể sử dụng mô hình hồi quy tuyến tính thông thường do biến \\(Y\\) là biến rời rạc đồng thời giá trị trung bình của \\(Y\\) là một số lớn hơn 0. Ngay cả khi trong các trường hợp biến phụ thuộc \\(Y\\) là biến liên tục, sử dụng mô hình tuyến tính thông thường cũng sẽ gặp phải vấn đề. Chẳng hạn như khi \\(Y\\) là số tiền khách hàng yêu cầu bồi thường cho xe ô tô trong trường hợp xảy ra tai nạn. Biến \\(Y\\) chỉ nhận giá trị là số dương và thường có phân phối xác suất lệch phải với đuôi lớn. Sử dụng giả thiết phân phối chuẩn cho biến \\(Y\\) sẽ làm cho mô hình không đánh giá đúng khả mức độ nghiêm trọng của yêu cầu bồi thường do phân phối chuẩn không có khả năng mô tả các rủi ro có đuôi lớn. Đồng thời, giá trị trung bình của số tiền yêu cầu bồi thường luôn là số dương, do đó cũng không thể sử dụng tổ hợp tuyến tính của các biến độc lập để trực tiếp mô tả giá trị trung bình của \\(Y\\). Có thể tổng kết rằng hai vấn đề thường gặp phải khi sử dụng mô hình hồi quy tuyến tính thông thường trên dữ liệu thực tế là Thứ nhất: sự không phù hợp của giả thiết phân phối chuẩn đối với biến mục tiêu \\(Y\\); và Thứ hai: miền giá trị trung bình của biến mục tiêu \\(Y\\) không phù hợp với miền giá trị của tổ hợp tuyến tính của biến độc lập. Giá trị \\(\\textbf{x}_i^{&#39;} \\boldsymbol{\\beta} = \\beta_0 + \\beta_1 \\ x_{i,1} + \\beta_2 \\ x_{i,2} + \\cdots + \\beta_p \\ x_{i,p}\\) có thể nhận bất kỳ giá trị nào trong \\(\\mathbb{R}\\), trong khi giá trị trung bình của biến mục tiêu \\(Y\\) trong các dữ liệu thực tế lại thường chỉ là một tập con của \\(\\mathbb{R}\\). Mô hình tuyến tính tổng quát được xây dựng trên cơ sở của mô hình hồi quy tuyến tính thông thường với mục đích khắc phục hai nhược điểm kể trên. - Trước hết, mô hình tuyến tính tổng quát giả thiết một phân phối phù hợp cho biến phụ thuộc \\(Y\\), tùy vào dữ liệu sử dụng để phân tích, tạm gọi là phân phối \\(F\\) với tham số \\(\\boldsymbol{\\theta}\\), ký hiệu là \\(F_\\boldsymbol{\\theta}\\). - Tiếp theo, để đảm bảo miền giá trị của giá trị trung bình của \\(Y\\) với điều kiện các biến độc lập bằng \\(\\textbf{x}_i\\), \\(\\mu_i = E(Y|\\textbf{X} = \\textbf{x}_i)\\), phù hợp với miền giá trị của \\(\\textbf{x}_i^{&#39;} \\boldsymbol{\\beta}\\), mô hình tuyển tính tổng quát sử dụng một hàm số đơn điệu \\(g\\), được gọi là hàm liên kết, để biến đổi miền giá trị của \\(\\mu_i\\). Chúng ta phát biểu mô hình tuyến tính tổng quát như sau \\[\\begin{align} &amp; Y \\sim F_\\theta \\\\ &amp; \\mathbb{E}(Y|\\textbf{X} = \\textbf{x}_i) = \\mu_i \\\\ &amp; g(\\mu_i) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p} \\tag{1.6} \\end{align}\\] Trước hết, có thể thấy rằng mô hình hồi quy tuyến tính thông thường là trường hợp đặc biệt của mô hình tuyến tính tổng quát khi tham số \\(\\boldsymbol{\\theta}\\) là \\(\\sigma^2\\); phân phối \\(F\\) là phân phối chuẩn; và hàm \\(g\\) là hàm số đồng nhất \\(g(x) = x\\). Giả thiết đơn điệu của hàm liên kết \\(g\\) đảm bảo sự tồn tại của hàm số ngược \\(g^{-1}\\). Mối liên hệ của \\(\\mu_i\\) và \\(\\textbf{x}_i^{&#39;} \\boldsymbol{\\beta}\\) có thể được viết lại dưới dạng hàm ngược của hàm liên kết như sau \\[\\begin{align} \\mu_i = g^{-1}(\\textbf{x}_i^{&#39;} \\boldsymbol{\\beta}) \\tag{1.7} \\end{align}\\] Quay trở lại ví dụ ở phần trước của chương sách, chúng ta phân tích về tác động của độ tuổi và giới tính lên quyết định có tham gia quyền lợi bảo hiểm bổ sung hay không. Mô hình tuyến tính tổng quát được xây dựng như sau: \\[\\begin{align} &amp; Y \\sim \\mathcal{B}(p) \\\\ &amp; \\mathbb{E}(Y|age_i, sex_i) = p_i \\\\ &amp; \\Phi^{-1}(p_i) = 0.678 - 0.016 \\times age_i - 0.446 \\times sex_i \\end{align}\\] Phân phối xác suất của biến \\(Y\\) là phân phối nhị thức do \\(Y\\) chỉ có thể nhận là 0 hoặc 1. Đồng thời, giá trị trung bình của \\(Y\\) nằm trong khoảng \\((0,1)\\) chúng ta có thể chọn hàm liên kết \\(g\\) là hàm \\(\\Phi^{-1}\\). Đây là hàm ngược của hàm phân phối xác suất của biến ngẫu nhiên phân phối chuẩn \\(\\mathcal{N}(0,1)\\) nên thỏa mãn các điều kiện của một hàm liên kết: hàm đơn điệu tăng; có miền xác định là \\((0,1)\\); và miền giá trị là tập số thực \\(\\mathbb{R}\\). Nếu không lựa chọn \\(\\Phi^{-1}\\), mọi hàm số đơn điệu, có miền xác định là khoảng \\((0,1)\\), và miền giá trị là tập số thực \\(\\mathbb{R}\\) đều có thể được lựa chọn làm hàm số kết nối. 1.2 Xây dựng mô hình tuyến tính tổng quát Phần tiếp theo của cuốn sách sẽ thảo luận về cách xây dựng mô hình tuyến tổng quát với các kiểu giá trị khác nhau của biến phụ thuộc \\(Y\\). Xin được nhắc lại rằng đây là cuốn sách dành cho cả các bạn đọc không có nền tảng toán học nâng cao. Do đó, những thảo luận phức tạp liên quan đến các giả thiết của mô hình hay phương pháp ước lượng tham số sẽ được trình bày ở phần sau của chương sách. Chúng ta sẽ hiểu về mô hình tuyến tính tổng quát thông qua việc ứng dụng mô hình cho các các dữ liệu thực tế trước khi đi sâu vào bản chất toán học của mô hình. 1.2.1 Biến phụ thuộc là biến dạng nhị phân. Đây là các trường hợp mà biến phụ thuộc chỉ nhận một trong hai giá trị. Ở phần trên chúng ta đã trình bày các ví dụ cho trường hợp này: khách hàng có hay không hoàn trả nợ thẻ tín dụng, khách hàng phản hồi tích cực hay tiêu cực về sản phầm, một yêu cầu bồi thường là trục lợi hay bình thường, một giao dịch rút tiền ngân hàng có hay không phải là giao dịch gian lận, … Mặc dù đây chỉ là một trường hợp đặc biệt của biến phụ thuộc nhận giá trị rời rạc nhưng qua các ví dụ thực tế lại thấy rằng phần lớn các dữ liệu gặp phải lại có biến phụ thuộc ở dạng nhị phân. Khi \\(Y\\) chỉ nhận hai giá trị, chúng ta sẽ luôn mã hóa giá trị của \\(Y\\) thành hai số là 0 và 1. Một vài cuốn sách khác, hoặc trong một vài lĩnh vực nghiên cứu khác, người xây dựng mô hình có thể mã hóa \\(Y\\) thành -1 và 1. Tuy nhiên hai cách mã hóa này chỉ khác nhau ở hình thức chứ không làm ảnh hưởng đến kết quả của mô hình. 1.2.1.1 Phân phối xác suất của biến phụ thuộc. Khi biến phụ thuộc là biến dạng nhị phân, một cách tự nhiên, chúng ta sẽ sử dụng phân phối nhị thức, hay còn gọi là phân phối Bernoulli, để mô tả biến phụ thuộc. Biến ngẫu nhiên \\(B\\) có phân phối nhị thức với tham số \\(\\rho\\), \\(0 &lt; \\rho &lt; 1\\), ký hiệu \\(\\mathcal{B}(\\rho)\\), là biến ngẫu nhiên chỉ nhận hai giá trị là 0 và 1 với hàm khối lượng xác suất như sau \\[\\begin{align} \\mathbb{P}(B = x) = \\rho^x \\times (1-\\rho)^{(1-x)} \\text{ với } x \\in \\{0;1\\} \\tag{1.8} \\end{align}\\] Chúng ta có giá trị trung bình và phương sai của \\(\\mathcal{B}(\\rho)\\). \\[\\begin{align} &amp; \\mathbb{E}(B) = \\rho \\\\ &amp; \\mathbb{V}(B) = \\rho \\ (1-\\rho) \\tag{1.9} \\end{align}\\] Có thể thấy rằng phân phối nhị thức có duy nhất một tham số \\(\\rho\\) và tham số này cũng chính là giá trị trung bình của biến đó. Phương sai của \\(\\mathcal{B}(\\rho)\\) nhỏ hơn giá trị trung bình. 1.2.1.2 Lựa chọn hàm liên kết. Khi biến phụ thuộc \\(Y\\) có phân phối nhị thức, giá trị trung bình của biến phụ thuộc sẽ nằm trong khoảng \\((0,1)\\). Từ công thức (1.6), nếu cho \\(\\rho_i\\) là giá trị trung bình của biến phụ thuộc với điều kiện các biến độc lập \\(\\textbf{X} = \\textbf{x}_i\\), ta có \\[\\begin{align} &amp; \\mathbb{E}(Y|\\textbf{X} = \\textbf{x}_i) = \\rho_i \\\\ &amp; g(\\rho_i) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,3} \\tag{1.10} \\end{align}\\] Như vậy, mọi hàm số đơn điệu có miền xác định là khoảng \\((0,1)\\) và miền giá trị là toàn bộ tập số thực \\(\\mathbb{R}\\) đều có thể được lựa chọn để làm hàm ngược của hàm liên kết. Làm thế nào để có được những hàm số có tính chất như vậy? Chúng ta đều biết rằng các hàm phân phối xác suất của một biến ngẫu nhiên liên tục bất kỳ là các hàm số tăng, có miền xác định là \\(\\mathbb{R}\\) và miền giá trị là khoảng \\((0,1)\\). Do đó, hàm số ngược của các hàm phân phối xác suất, sẽ là các hàm số tăng, có miền xác định là khoảng \\((0,1)\\) và miền giá trị là \\(\\mathbb{R}\\). Nói một cách khác, hàm số ngược của các hàm phân phối xác suất bất kỳ thỏa mãn đầy đủ tính chất của hàm liên kết trong trường hợp \\(Y\\) có phân phối nhị thức. Trong thực tế, việc lựa chọn hàm liên kết còn có mục tiêu là để mô hình dễ giải thích và quá trình ước lượng mô hình đơn giản nhất có thể. Các hàm phân phối xác suất thường được lựa chọn làm \\(g^{-1}(.)\\) bao gồm có: thứ nhất là hàm phân phối của biến ngẫu nhiên logistic; thứ hai là hàm phân phối của biến ngẫu nhiên phân phối chuẩn; và thứ ba là hàm phân phối của biến ngẫu nhiên phân phối Cauchy. Hàm phân phối của biến ngẫu nhiên logistic và hàm ngược được cho bởi công thức sau \\[\\begin{align} &amp; \\textit{Hàm phân phối xác suất: } \\ g^{-1}(x) = \\cfrac{1}{1 + e^{-x}} \\\\ &amp; \\textit{Hàm ngược: } \\ g(x) = ln(\\cfrac{x}{1- x}) \\end{align}\\] Với biến phụ thuộc \\(Y\\) là có phân phối nhị thức và hàm \\(g\\) là hàm số ngược của hàm phân phối của biến ngẫu nhiên logistic, chúng ta có mô hình tuyến tính tổng quát như sau: \\[\\begin{align} &amp; Y_i \\sim \\mathcal{B}(\\rho_i) \\\\ &amp; \\rho_i = \\cfrac{1}{1 + exp(-(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p}))} \\\\ &amp; ln(\\cfrac{\\rho_i}{1 - \\rho_i}) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p} \\tag{1.11} \\end{align}\\] Đây là mô hình được biết đến rộng rãi với tên gọi là hồi quy logistic và cũng là mô hình thường được sử dụng nhất trong khi biến phụ thuộc là biến nhị phân. Mô hình có ưu điểm là sự dễ hiểu khi diễn giải kết quả: \\(\\rho_i\\) ngoài ý nghĩa là trung bình của biến ngẫu nhiên \\(Y_i\\) còn có ý nghĩa là xác suất xảy ra sự kiện \\(Y_i = 1\\). Giá trị \\(\\cfrac{\\rho_i}{1 - \\rho_i}\\) được gọi là odds của sự kiện \\(Y_i = 1\\). Mối liên hệ giữa quan sát thứ \\(i\\) của biến độc lập \\(X_j\\) là \\(x_{i,j}\\) và obbs của sự kiện \\(Y_i = 1\\) có thể được diễn giải thông qua hệ số \\(\\beta_j\\). Hàm phân phối của biến ngẫu nhiên chuẩn \\(\\mathcal{N}(0,1)\\) và hàm ngược của hàm phân phối được cho bởi công thức sau \\[\\begin{align} &amp; g^{-1}(x) = \\Phi(x) \\\\ &amp; g(x) = \\Phi^{-1}(x) \\\\ &amp; \\Phi(x) = \\cfrac{1}{\\sqrt{2 \\pi}} \\ \\int\\limits_{-\\infty}^x \\ exp(-t^2/2) \\\\ \\end{align}\\] Chúng ta có mô hình tuyến tính tổng quát như sau \\[\\begin{align} &amp; Y_i \\sim \\mathcal{B}(\\rho_i) \\\\ &amp; \\rho_i = \\Phi(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p}) \\\\ &amp; \\Phi^{-1}(\\rho_i) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p} \\tag{1.12} \\end{align}\\] Hàm số ngược của biến ngẫu nhiên phân phối chuẩn được gọi là hàm probit do đó mô hình GLM trong trường hợp này còn được biết đến với tên gọi là mô hình probit. Hàm phân phối của biến ngẫu nhiên Cauchy và hàm ngược của hàm phân phối được cho bởi công thức sau \\[\\begin{align} &amp; g^{-1}(x) = \\cfrac{1}{2} + \\cfrac{arctan(x)}{\\pi} \\\\ &amp; g(x) = tan\\left( \\pi \\left( x - \\cfrac{1}{2} \\right) \\right) \\tag{1.13} \\end{align}\\] Chúng ta có mô hình tuyến tính tổng quát như sau \\[\\begin{align} &amp; Y_i \\sim \\mathcal{B}(\\rho_i) \\\\ &amp; p_i = \\cfrac{1}{2} + \\cfrac{arctan(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p})}{\\pi} \\\\ &amp; tan\\left( \\pi \\left( \\rho_i - \\cfrac{1}{2} \\right) \\right) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p} \\tag{1.14} \\end{align}\\] Hàm số ngược của phân phối cauchy còn được gọi là hàm cauchit, do đó mô hình tuyến tính tổng quát trong trường hợp này còn được biết đến với tên là mô hình cauchit. Hình vẽ dưới đây mô tả hình dạng của ba hàm số kết nối Mô hình tuyến tính tổng quát trong trường hợp \\(Y\\) là biến nhị phân thường được ước lượng bằng phương pháp tối đa hóa hàm likelihood, hay gọi tắt là phương pháp MLE. Để tránh sự phức tạp không cần thiết chúng tôi sẽ trình bày phần ước lượng mô hình trong phần sau của chương sách. Trong R, hàm số glm() của thư viện \\(stat\\) được sử dụng để xây dựng mô hình tuyến tính tổng quát. Tham số \\(family\\) trong hàm glm() dùng để khai báo phân phối xác suất cho biến phụ thuộc \\(Y\\) và để lựa chọn hàm liên kết phù hợp. Trở lại với ví dụ khi \\(Y\\) là biến nhị phân mô tả khách hàng có hay không lựa chọn các quyền lợi đầy đủ khi tham gia bảo hiểm bổ sung, chúng ra thực hiện xây dựng mô hình như sau # Phân phối Y là nhị thức và hàm liên kết là hàm logit glm.binomial.logit&lt;-glm(Y ~ age + sex, data=dat, family = binomial(link = &quot;logit&quot;)) # Phân phối Y là nhị thức và hàm liên kết là hàm probit glm.binomial.probit&lt;-glm(Y ~ age + sex, data=dat, family = binomial(link = &quot;probit&quot;)) # Phân phối Y là nhị thức và hàm liên kết là hàm cauchit glm.binomial.cauchy&lt;-glm(Y ~ age + sex, data=dat, family = binomial(link = &quot;cauchit&quot;)) Cả ba mô hình tuyến tính tổng quát ở trên đều cho \\(Y\\) là một biến ngẫu nhiên phân phối nhị thức, nhưng mối liên hệ giữa độ tuổi và giới tính đến giá trị trung bình của \\(Y\\) lại được mô tả bằng các công thức khác nhau Trong mô hình logit: \\[\\begin{align} \\mathbb{P}(Y_i = 1| age_i, sex_i) = \\cfrac{1}{1 + exp(-(1.109 - 0.026 \\times age_{i} - 0.723 \\times sex_{i}))} \\end{align}\\] Trong mô hình probit \\[\\begin{align} \\mathbb{P}(Y_i = 1| age_i, sex_i) = \\Phi\\left(0.678 - 0.016 \\times age_{i} - 0.446 \\times sex_{i}\\right) \\end{align}\\] Trong mô hình cauchit \\[\\begin{align} \\mathbb{P}(Y_i = 1| age_i, sex_i) = \\cfrac{1}{2} + \\cfrac{arctan\\left(0.997 - 0.024 \\times age_{i} - 0.624 \\times sex_{i}\\right)} {\\pi} \\end{align}\\] Cả ba mô hình đều cho cùng một kết quả: người có độ tuổi càng cao thì càng ít có khả năng lựa chọn quyền lợi bảo hiểm bổ sung và xác suất nam giới lựa chọn quyền lợi bảo hiểm bổ sung là ít hơn so với nữ giới. Bảng dưới đây đưa ra khả năng/xác suất chấp nhận của ba mô hình tính dựa trên hai biến độc lập là tuổi và giới tính Người BH Độ tuổi Giới tính Logit Probit Cauchit 1 20 Nam 0.467 0.465 0.466 2 30 Nam 0.403 0.402 0.394 3 40 Nam 0.342 0.342 0.331 4 50 Nam 0.286 0.285 0.280 5 60 Nam 0.236 0.233 0.240 6 20 Nữ 0.643 0.640 0.652 7 30 Nữ 0.582 0.578 0.586 8 40 Nữ 0.517 0.515 0.512 9 50 Nữ 0.452 0.451 0.436 10 60 Nữ 0.389 0.389 0.367 Có thể thấy rằng không có sự khác biệt lớn trong tính toán xác suất của \\(Y\\) khi sử dụng hàm liên kết khác nhau. Thực tế thì việc lựa chọn hàm kết nối sẽ không ảnh hưởng lớn đến kết quả của mô hình bằng việc lựa chọn phân phối cho biến phụ thuộc hay việc lựa chọn biến độc lập để giải thích mô hình. 1.2.2 Biến phụ thuộc là biến rời rạc không có thứ tự. Biến rời rạc không có thứ tự, hay còn gọi là biến rời rạc danh nghĩa (non-ordinal variable), là biến ngẫu nhiên mà các giá trị có thể nhận không có ý nghĩa so sánh với nhau. Khi nói đến biến rời rạc không có thứ tự, chúng ta luôn hiểu rằng biến nhận từ ba giá trị trở lên bởi vì trường hợp có hai giá trị sẽ tương tự như biến có phân phối nhị phân. Một ví dụ đơn giản cho biến rời rạc không có thứ tự là màu sắc được chọn khi mua xe ô tô, hoặc loại hình bảo hiểm được lựa chọn bởi các khách hàng của một công ty bảo hiểm. Giả sử biến rời rạc danh nghĩa \\(Y\\) có thể nhận \\(J\\) giá trị khác nhau lần lượt là \\(1, 2, \\cdots, J\\). Với biến danh nghĩa, chúng ta không thể mô tả được mối liên hệ giữa xác suất của hai sự kiện \\((Y=i)\\) và \\((Y=j)\\) với \\(1 \\leq i &lt; j \\leq J\\) dưới dạng tham số. Chính vì thế cấu trúc dạng tham số của mô hình tuyến tính tổng quát như phương trình (1.1) là không thể áp dụng được. Một phương pháp tiếp cận cho trường hợp biến mục tiêu \\(Y\\) là biến danh nghĩa là mở rộng mô hình tuyến tính tổng quát với biến nhị phân: với mỗi \\(j \\in {1,2,\\cdots,J}\\) \\[\\begin{align} \\mathbb{P}\\left(Y = j\\right|\\textbf{x}_i) = \\cfrac{h(\\beta_{j,0} + \\beta_{j,1} \\cdot x_{i,1} + \\cdots + \\beta_{j,p} \\cdot x_{i,p} ) }{ \\sum\\limits_{j=1}^J h(\\beta_{j,0} + \\beta_{j,1} \\cdot x_{i,1} + \\cdots + \\beta_{j,p} \\cdot x_{i,p} ) } \\tag{1.15} \\end{align}\\] với hàm \\(h\\): \\(\\mathbb{R} \\rightarrow \\mathbb{R}^+\\). Hàm số \\(h\\) thường được lựa chọn là hàm lũy thừa cơ số tự nhiên exp(). Hàm số xác định xác suất xảy ra các sự kiện \\((Y=j)\\) trong phương trình (1.15) được gọi là hàm \\(softmax\\): \\[\\begin{align} softmax(z_1, z_2, \\cdots, z_p) = \\left(\\cfrac{e^{z_1}}{\\sum\\limits_{j=1}^p e^{z_j}}, \\cfrac{e^{z_2}}{\\sum\\limits_{j=1}^p e^{z_1}}, \\cdots, \\cfrac{e^{z_p}}{\\sum\\limits_{i=1}^p e^{z_j}} \\right) \\end{align}\\] Các tham số \\(\\beta_{j,k}\\) được ước lượng để tối thiểu hóa hàm tổn thất tính bằng cross-entropy: \\[\\begin{align} \\sum\\limits_{i=1}^n \\sum\\limits_{j=1}^J y_{i,j} \\cdot \\log\\left(\\mathbb{P}\\left(Y = j|\\textbf{x}_i\\right)\\right) \\end{align}\\] trong đó \\(\\mathbb{P}\\left(Y = j|\\textbf{x}_i\\right)\\) được tính toán từ công thức (1.15) và \\(y_{i,j}\\) nhận một trong hai giá trị: bằng 1 nếu giá trị quan sát thứ \\(i\\) của biến mục tiêu \\(Y\\) bằng \\(j\\) bằng 0 nếu giá trị quan sát thứ \\(i\\) của biến mục tiêu \\(Y\\) khác \\(j\\) Lưu ý rằng có \\(J\\) véc-tơ hệ số tuyến tính trong phương trình (1.15). Trong thực tế, khi biến mục tiêu \\(Y\\) có thể nhận \\(J\\) giá trị danh nghĩa, chúng ta xây dựng mô hình với \\((J-1)\\) véc-tơ hệ số tuyến tính tương ứng với các giá trị danh nghĩa \\(1, 2, \\cdots, (J-1)\\), đồng thời cố định giá trị của tất cả các hệ số tuyến tính bằng 0 với giá trị danh nghĩa \\(J\\). Khi tất cả các hệ số tuyến tính bằng 0, chúng ta có \\(h(.) = exp(0) = 1\\) với mọi \\(\\textbf{x}_i\\). \\[\\begin{align} &amp; \\mathbb{P}\\left(Y = j\\right|x_i) = \\cfrac{h(\\beta_{j,0} + \\beta_{j,1} \\cdot x_{i,1} + \\cdots + \\beta_{j,p} \\cdot x_{i,p} ) }{1 + \\sum\\limits_{j=1}^{J-1} h(\\beta_{j,0} + \\beta_{j,1} \\cdot x_{i,1} + \\cdots + \\beta_{j,p} \\cdot x_{i,p} )} \\textit{ với } j &lt; J \\\\ &amp; \\mathbb{P}\\left(Y = J\\right|x_i) = \\cfrac{1}{1 + \\sum\\limits_{j=1}^{J-1} h(\\beta_{j,0} + \\beta_{j,1} \\cdot x_{i,1} + \\cdots + \\beta_{j,p} \\cdot x_{i,p} )} \\\\ \\tag{1.16} \\end{align}\\] Chúng ta sẽ xây dựng mô hình phân loại biến mục tiêu trên dữ liệu “travel insurance.csv”. Dữ liệu cung cấp thông tin về các sản phẩm bảo hiểm du lịch từ một đại lý du lịch, với biến mục tiêu là \\(product.name\\) cho biết khách hàng đã lựa chọn sản phẩm sản phẩm bảo hiểm nào. Biến mục tiêu có bốn giá trị tương ứng với bốn loại sản phẩm, mặc dù các sản phẩm này có mức giá khác nhau nhưng việc so sánh các giá trị là không có ý nghĩa. Dữ liệu có 10 biến độc lập, tuy nhiên, để đơn giản hóa, chúng ta chỉ lấy hai biến là giới tính và độ tuổi của người tham gia bảo hiểm. Mối liên hệ giữa độ tuổi và giới tính của khách hàng đến sản phẩm khách hàng lựa chọn được mô tả qua hình vẽ dưới đây Có thể thấy rằng có sự khác biệt về độ tuổi của những người lựa chọn các sản phẩm bảo hiểm: những người trẻ tuổi có xu hướng lựa chọn “Bronze Plan” và “Silver Plan” trong khi những người lớn tuổi có xu hướng lựa chọn “Basic Plan” và “Value Plan”. Có sự khác biệt về tỷ lệ nam và nữ khi lựa chọn sản phẩ bảo hiểm, tỷ lệ nam giới lựa chọn “Basic Plan” và “Value Plan” cao, trong khi nữ giới có xu hướng lựa chọn “Bronze Plan” và “Silver Plan”. Để xây dựng mô hình tuyến tính tổng quát cho biến phân loại danh nghĩa, chúng ta sử dụng hàm multinom() từ thư viện nnet: ## # weights: 16 (9 variable) ## initial value 19625.769270 ## iter 10 value 18535.510505 ## final value 18040.676017 ## converged ## Call: ## multinom(formula = Product.Name ~ Gender + Age, data = dat1) ## ## Coefficients: ## (Intercept) GenderM Age ## Bronze Plan 1.5631988 -0.5589519 -0.039513361 ## Silver Plan 0.6512458 -0.4871457 -0.031596816 ## Value Plan -1.0970424 0.3380718 0.002018711 ## ## Std. Errors: ## (Intercept) GenderM Age ## Bronze Plan 0.07047991 0.04302279 0.001653049 ## Silver Plan 0.08280363 0.05117056 0.001938850 ## Value Plan 0.08264747 0.05092679 0.001676413 ## ## Residual Deviance: 36081.35 ## AIC: 36099.35 Dựa trên kết quả ước lượng, chúng ta có công thức tính xác suất chấp nhận các sản phẩm bảo hiểm du lịch của một người có giới tính là \\(g_i\\) và độ tuổi \\(a_i\\) như sau: với sản phẩm “Basic Plan” \\[\\begin{align} \\mathbb{P}(Y = Basic|g_i, a_i) = \\cfrac{1}{S_0} \\end{align}\\] với \\[\\begin{align} S_0 = 1 + exp(1.512 - 0.558 \\cdot g_i - 0.038 \\cdot a_i) + exp(0.563 - 0.489 \\cdot g_i - 0.030 \\cdot a_i) + exp(-3.028 - 0.246 \\cdot g_i - 0.039 \\cdot a_i) \\end{align}\\] Với các sản phẩm Bronze Plan, Silver Plan và Value Plan, ta có \\[\\begin{align} &amp; \\mathbb{P}(Y = Bronze|g_i, a_i) = \\cfrac{exp(1.512 - 0.558 \\cdot g_i - 0.038 \\cdot a_i)}{S_0} \\\\ &amp; \\mathbb{P}(Y = Silver|g_i, a_i) = \\cfrac{exp(0.563 - 0.489 \\cdot g_i - 0.030 \\cdot a_i)}{S_0} \\\\ &amp; \\mathbb{P}(Y = Value|g_i, a_i) = \\cfrac{exp(-3.028 - 0.246 \\cdot g_i - 0.039 \\cdot a_i)}{S_0} \\end{align}\\] Bảng dưới đây tính toán xác suất chấp nhận các sản phẩm du lịch theo một vài độ tuổi và giới tính Khách hàng Độ tuổi Giới tính Bronze Plan Silver Plan Value Plan Basic Plan 1 Nữ 10 0.54 0.23 0.06 0.17 2 Nữ 20 0.48 0.22 0.08 0.22 3 Nữ 30 0.41 0.21 0.10 0.28 4 Nữ 40 0.34 0.19 0.13 0.35 5 Nữ 50 0.27 0.16 0.15 0.41 6 Nữ 60 0.21 0.14 0.18 0.47 7 Nam 10 0.44 0.21 0.11 0.24 8 Nam 20 0.37 0.19 0.15 0.30 9 Nam 30 0.30 0.16 0.18 0.36 10 Nam 40 0.23 0.14 0.21 0.42 11 Nam 50 0.18 0.11 0.24 0.47 12 Nam 60 0.13 0.09 0.27 0.51 Kết quả từ mô hình cho thấy chỉ có “Basic Plan” và “Bronze Plan” được chọn nếu chúng ta chỉ sử dụng hai biến độc lập là giới tính và độ tuổi. Khả năng dự đoán của mô hình không cao do mô hình còn quá đơn giản, chúng tôi muốn nhấn mạnh về cách xây dựng mô hình trước khi cố gắng xây dựng một mô hình có khả năng dự báo tốt. Chúng ta sẽ thảo luận về đánh giá hiệu quả của mô hình ở các phần sau của chương sách. 1.2.3 Biến phụ thuộc là biến rời rạc có thứ tự. Biến rời rạc có thứ tự, còn gọi là ordinal categorical variable, là các biến nhận giá trị rời rạc mà các giá trị rời rạc có thể so sánh được với nhau. Một ví dụ điển hình cho biến rời rạc có thứ tự là số lần mà một người đi khám chữa bệnh sử dụng bảo hiểm y tế hoặc một khách hàng gửi yêu cầu bồi thường đến công ty bảo hiểm. Đây là trường hợp mà chúng ta có thể sử dụng một phân phối xác suất rời rạc có tham số để mô tả biến phụ thuộc \\(Y\\) giống như mô hình (??). 1.2.3.1 Biến phụ thuộc có phân phối Poisson. Phân phối rời rạc thường được lựa chọn cho biến phụ thuộc rời rạc có thứ tự là phân phối Poisson. Hàm phân phối xác suất của biến ngẫu nhiên \\(Y\\) có phân phối Poisson với tham số \\(\\lambda &gt; 0\\), ký hiệu \\(Y \\sim \\mathcal{P}(\\lambda)\\) được cho bởi công thức sau \\[\\begin{align} \\mathbb{P}(Y = y) = e^{-\\lambda} \\cdot \\cfrac{\\lambda^y}{y!} \\text{ với } y = 0, 1, 2, \\cdots \\end{align}\\] Phân phối Poisson thường được sử dụng để mô tả số lần một hiện tượng xảy ra trong một khoảng thời gian nhất định. Nguyên nhân là do phân phối Poisson này có mối liên hệ trực tiếp đến các mô hình có thời gian chờ có phân phối kiểu mũ. Thật vậy, nếu thời gian chờ giữa hai sự kiện liên tiếp xảy ra của một hiện tượng nào đó là một biến ngẫu nhiên liên tục có hàm phân phối xác suất kiểu mũ với tham số \\(\\gamma\\) thì số lần hiện tượng đó xảy ra trong một khoảng thời gian từ \\(t_1\\) đến \\(t_2\\) sẽ là một biến ngẫu nhiên phân phối Poisson với tham số \\(\\lambda = \\cfrac{(t_1 - t_2)}{\\gamma}\\). Thật vậy, với \\(T\\) là khoảng thời gian giữa 2 sự kiện liên tiếp xảy ra và \\(T\\) có phân phối mũ: \\[\\begin{align} \\mathbb{P}(T \\leq x) = 1 - exp(-\\gamma x) \\end{align}\\] và nếu \\(N\\) là số lần xảy ra sự kiện (đi khám bệnh, lái xe gây ra tai nạn) giữa hai mốc thời gian \\(t_1 &lt; t_2\\) thì \\(N\\) sẽ có phân phối Poisson với tham số \\(\\lambda\\): \\[\\begin{align} &amp; \\mathbb{P}(N = k) = e^{-\\lambda} \\cdot \\cfrac{\\lambda^k}{k!}\\\\ &amp; \\lambda = \\cfrac{(t_1 - t_2)}{\\gamma} \\end{align}\\] Biến ngẫu nhiên có phân phối Poisson với tham số \\(\\lambda\\), ký hiệu \\(\\mathcal{P}(\\lambda)\\), có tính chất là giá trị trung bình và phương sai đều bằng tham số của biến đó là \\(\\lambda\\). Phân phối Poisson nằm trong họ các phân phối mũ nên sẽ rất thuận tiện trong xây dựng và ước lượng mô hình bằng phương pháp hợp lý tối đa. Ngoài ra, bằng cách cho tham số của phân phối Poisson một phân phối xác suất, chúng ta có thể thu được các phân phối rời rạc linh hoạt hơn trong mô tả các biến ngẫu nhiên dạng đếm được. Khi xây dựng mô hình tuyến tính với biến mục tiêu \\(Y\\) có phân phối Poisson, giá trị trung bình \\(Y\\) nhận giá trị dương nên chúng ta cần chọn các hàm liên kết \\(g\\) có miền xác định là tập các số thực dương \\(\\mathbb{R}^+\\) và miền giá trị là tập số thực \\(\\mathbb{R}\\). Hàm số thường được lựa chọn là hàm \\(log\\). Chúng ta có thể viết mô hình tuyến tính tổng quát khi \\(Y\\) có phân phối Poisson, thường được gọi tắt là hồi quy Poisson, như sau \\[\\begin{align} &amp; Y_i \\sim \\mathcal{P}(\\lambda_i) \\\\ &amp; log(\\lambda_i) = \\left(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,p}\\right) \\\\ \\tag{1.17} \\end{align}\\] Dữ liệu được sử dụng để mô tả mô hình tuyến tính tổng quát với biến phụ thuộc phân phối Poisson là dữ liệu \\(SingaporeAuto.csv\\). Dữ liệu được tổng hợp bởi Hiệp hội bảo hiểm Singapore trong năm 1993 mô tả số vụ tai nạn ô tô xảy ra cùng với các đặc điểm của người lái và đặc điểm của xe gây tai nạn. Cũng giống như các phần trước, chúng ta sẽ xây dựng mô hình ở mức độ đơn giản nhất để bạn đọc dễ dàng hình dung. Biến phụ thuộc trong mô hình là biến \\(Clm\\_Count\\) cho biết số vụ tai nạn mà một lái xe gây ra trong vòng một năm, hai biến phụ thuộc bao gồm có: Biến \\(PC\\) là biến nhận hai giá trị là 0 tương ứng với xe được đăng ký theo công ty và nhận giá trị 1 tương ứng với xe được đăng ký theo cá nhân. Biến \\(NCD\\), viết tắt của No Claims Discount, cho biết lịch sử gây ra tai nạn của lái xe. Giá trị \\(NCD\\) càng cao nghĩa là lịch sử người lái xe càng gây ra ít tai nạn. Chúng ta sử dụng hàm glm() để xây dựng và ước lượng mô hình tuyến tính tổng quát: dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/SingaporeAuto.csv&quot;) glm2&lt;-glm(Clm_Count~PC+NCD, data=dat, family = poisson(link = &quot;log&quot;)) summary(glm2) ## ## Call: ## glm(formula = Clm_Count ~ PC + NCD, family = poisson(link = &quot;log&quot;), ## data = dat) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -0.4685 -0.3801 -0.3520 -0.3283 4.1716 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -2.641681 0.073836 -35.778 &lt; 2e-16 *** ## PC 0.431980 0.091840 4.704 2.56e-06 *** ## NCD -0.013943 0.002618 -5.327 9.99e-08 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for poisson family taken to be 1) ## ## Null deviance: 2887.2 on 7482 degrees of freedom ## Residual deviance: 2848.3 on 7480 degrees of freedom ## AIC: 3849.4 ## ## Number of Fisher Scoring iterations: 6 Bạn đọc có thể thấy rằng cả hai biến \\(PC\\) và \\(NCD\\) đều có tác động đến giá trị trung bình của biến mục tiêu \\(Clm\\_Count\\) do các giá trị p-value đều nhỏ. Mối liên hệ giữa số lượng tai nạn xảy ra và các biến \\(PC\\) và \\(NCD\\) được mô tả như sau: \\[\\begin{align} &amp; Clm\\_Count_i \\sim \\mathcal{P}(\\lambda_i) \\\\ &amp; \\log(\\lambda_i) = -2.641 + 0.432 \\cdot PC_{i} - 0.013 \\cdot NCD_{i} \\\\ &amp; \\lambda_i = \\exp\\left(-2.641 + 0.432 \\cdot PC_{i} - 0.013 \\cdot NCD_{i} \\right) \\tag{1.18} \\end{align}\\] Hệ số của biến \\(PC\\) là số dương, điều này cho biết các xe đăng ký dưới dạng cá nhân có khả năng gây tai nạn cao hơn so với xe đăng ký dưới hình thức doanh nghiệp. Đồng thời, hệ số của biến \\(NCD\\) âm cho biết lái xe có lịch sử lái xe tốt, tương ứng với \\(NCD\\) cao, ít có khả năng gây ra tai nạn hơn lái xe có lịch sử lái xe không tốt, tương ứng với \\(NCD\\) thấp. 1.2.3.2 Phân phối rời rạc có lạm phát tại giá trị 0. Biến phụ thuộc dạng đếm chứa một tỷ lệ lớn giá trị bằng 0 là các kiểu biến phụ thuộc thường gặp phải khi làm việc trên dữ liệu trong lĩnh vực bảo hiểm. Tỷ lệ lớn ở đây thường được hiểu là trên 90% giá trị quan sát được. Đa số các phân phối xác suất rời rạc thông thường, bao gồm phân phối Poisson, không mô tả tốt khi biến phụ thuộc \\(Y\\) trong trường hợp này. Một giải pháp phổ biến khi làm việc với kiểu dữ liệu như vậy là thay đổi phân phối dạng đếm thông thường để làm tăng tỷ lệ giá trị nhận được tại 0, để thu được các phân phối thường được gọi là các phân phối lạm phát tại 0, hay Zero-inflated variable. Phân phối lạm phát tại 0 là hỗn hợp của hai phân phối xác suất rời rạc, bao gồm một phân phối nhị thức chỉ báo cho trường hợp 0, và một phân phối xác suất dành cho biến đếm thông thường. Hàm phân phối của biến ngẫu nhiên dạng đếm có lạm phát tại 0, ký hiệu \\(ZI_Y\\), có thể được mô tả như sau \\[\\begin{align} \\mathbb{P}(ZI_Y = y) = \\begin{cases} &amp; \\omega + (1-\\omega) \\cdot \\mathbb{P}(Y=0) \\text{ khi y = 0} \\\\ &amp; (1-\\omega) \\cdot \\mathbb{P}(Y=y) \\text{ khi y &gt; 0} \\end{cases} \\tag{1.19} \\end{align}\\] trong đó biến ngẫu nhiên \\(Y\\) tuân theo phân phối số đếm tiêu chuẩn được. Trong trường hợp tham số \\(\\omega\\) bằng 0, phân phối của biến ngẫu nhiên \\(ZI_Y\\) sẽ tương ứng tương ứng với phân phối của biến Y. Tất cả các phân phối kiểu đếm đều có thể được sử dụng để tạo ra các biến mới có lạm phát tại 0. Trong các mô hình tuyến tính tổng quát, biến dạng đếm thường được mô tả bằng phân phối cổ điển Poisson. Với việc sử dụng phương trình (1.19), hàm phân phối của biến ngẫu nhiên Poisson có lạm phát tại 0, ký hiệu là \\(ZI_\\mathcal{P}\\) được cho bởi công thức sau: \\[\\begin{align} \\mathbb{P}(ZI_\\mathcal{P} = y) = \\begin{cases} &amp; \\omega + (1-\\omega) \\cdot e^{-\\lambda} \\text{ khi y = 0} \\\\ &amp; (1-\\omega) \\cdot e^{-\\omega} \\cdot \\cfrac{\\lambda^y}{y!} \\text{ khi y &gt; 0} \\end{cases} \\tag{1.20} \\end{align}\\] Chúng ta có thể xác định giá trị trung bình và phương sai của phân phối \\(ZI_Y\\) dựa trên tham số \\(\\omega\\) và giá trị trung bình cũng như phương sai của biến \\(Y\\) như sau \\[\\begin{align} &amp; \\mathbb{E}(ZI_Y) = (1-\\omega) \\cdot \\mathbb{E}(Y) \\\\ &amp; \\mathbb{V}(ZI_Y) = (1-\\omega) \\cdot \\mathbb{V}(Y) + \\omega(1-\\omega) \\cdot \\mathbb{E}(Y)^2 \\tag{1.21} \\end{align}\\] Trong trường hợp \\(Y\\) có phân phối Poission, chúng ta có giá trị trung bình và phương sai của biến \\(ZI_\\mathcal{P}\\): \\[\\begin{align} &amp; \\mathbb{E}(ZI_\\mathcal{P}) = (1-\\omega) \\cdot \\lambda \\\\ &amp; \\mathbb{V}(ZI_\\mathcal{P}) = \\mathbb{E}(ZI_\\mathcal{P}) \\cdot (1 + \\lambda - \\mathbb{E}(ZI_\\mathcal{P})) \\tag{1.22} \\end{align}\\] Với giá trị trung bình và phương sai của biến \\(ZI_\\mathcal{P}\\) như phương trình (1.19), chúng ta có thể xây dựng mô hình tuyến tính tổng quát với biến phụ thuộc là \\(ZI_\\mathcal{P}\\) như sau: giá trị trung bình \\(\\left((1-\\omega) \\cdot \\lambda\\right)\\) sẽ được giải thích thông qua các biến phụ thuộc trong khi tham số \\(\\lambda\\) sẽ được ước lượng bằng phương pháp hợp lý tối đa. Biến phụ thuộc phân phối \\(ZI_\\mathcal{P}\\) sẽ hữu ích cho mục đích lập mô hình trong trường hợp dữ liệu quan sát có sự tập trung quá mức tại giá trị 0. Ngoài phân phối Poisson, các phân phối mở rộng từ phân phối Poisson cũng có thể được sử dụng với để tạo ra các phân phối có lạm phát tại 0, chẳng hạn như biến ngẫu nhiên phân phối Poisson - Gamma, Poisson - Inverse gaussian. Trong các nghiên cứu thực nghiệm, nhiều tác giả đã chứng minh rằng việc áp dụng phân phối có lạm phát tại 0 để mô hình hóa số lượng yêu cầu bồi thường bảo hiểm là phù hợp để mô tả hành vi của người được bảo hiểm. Thật vậy, trong ngành bảo hiểm không phải tất cả các vụ tai nạn đều được báo cáo, công ty bảo hiểm chỉ có thông tin về các yêu cầu bồi thường được báo cáo. Có hai cách để giải thích cách phân phối có lạm phát tại 0 như sau: (1) Một số người được bảo hiểm không gửi yêu cầu bồi thường dù có xảy ra sự kiện bảo hiểm, do họ không có nhận thức được về việc được bảo hiểm, hoặc không có nhu cầu gửi yêu cầu bảo hiểm. (2) Một cách giải thích khác của mô hình lạm phát tại 0 là xem xét xác suất của mỗi vụ tai nạn được báo cáo. Một hành vi thực tế của người được bảo hiểm là nếu họ đã báo cáo vụ tai nạn đầu tiên thì những vụ tai nạn tiếp theo cũng sẽ được báo cáo, còn nếu vụ tai nạn đầu tiên không được báo cáo thì các vụ tai nạn sau sẽ không được báo cáo. Cả hai cách giải thích dựa trên hành vi này đều dẫn đến việc số lượng biến mục tiêu nhận giá trị bằng 0 cao hơn so với số lượng tai nạn thực tế xảy ra. Dữ liệu \\(exposure.csv\\) là dữ liệu điển hình cho biến phụ thuộc có lạm phát tại giá trị 0. Dữ liệu được rút gọn chỉ bao gồm hai biến độc lập là tuổi (Age) và giới tính (Gender) của người được bảo hiểm. Biến phụ thuộc là số lần người được bảo hiểm báo cáo tai nạn trong khoảng thời gian một năm. Sự khác nhau giữa mô hình tuyến tính tổng quát với biến phụ thuộc có phân phối Poisson thông thường và mô hình tuyến tính tổng quát với biến phụ thuộc có phân phối Poisson có lạm phát tại 0 được mô tả như sau: Table 1.1: Khác nhau giữa GLM - Poisson và GLM - ZIP Thành phần GLM Poisson GLM Poisson Zero-inflated Phân phối của biến phụ thuộc \\(Y_i \\sim \\mathcal{P}(\\lambda_i)\\) \\(Y_i \\sim ZI_\\mathcal{P}(\\lambda_i, \\omega)\\) Trung bình của biến phụ thuộc \\(\\lambda_i\\) \\(\\lambda_i \\cdot (1-\\omega)\\) Tham số của biến Poisson \\(\\lambda_i = exp(\\beta_0 + \\beta_1 \\cdot Age_i + \\beta_2 \\cdot Gender_i)\\) \\(\\lambda_i = exp(\\beta_0 + \\beta_1 \\cdot Age_i + \\beta_2 \\cdot Gender_i)\\) Tham số Zero-inflated 0 \\(\\omega = exp(\\alpha_0)\\) Để xây dựng mô hình tuyến tính tổng quát trong đó biến phụ thuộc có phân phối \\(ZI_\\mathcal{P}\\) chúng ta sử dụng hàm số zeroinfl() của thư viện \\(pscl\\). dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/exposure.csv&quot;) # Biến phụ thuộc có phân phối Poisson glm1&lt;-glm(Claim_Count~Age+Gender, family = poisson(link = &quot;log&quot;), data=dat) # Biến phụ thuộc có phân phối Zero inflated poisson zip.glm&lt;-zeroinfl(Claim_Count~Age+Gender|1, dist = &#39;poisson&#39;, link = &quot;log&quot;, data = dat) summary(glm1) summary(zip.glm) Chúng ta có kết quả ước lượng các mô hình Table 1.2: Kết quả ước lượng GLM - Poisson và GLM - ZIP Thành phần GLM Poisson GLM Poisson Zero-inflated Phân phối của biến phụ thuộc \\(Y_i \\sim \\mathcal{P}(\\lambda_i)\\) \\(Y_i \\sim ZI_\\mathcal{P}(\\lambda_i, \\theta)\\) Trung bình của biến phụ thuộc \\(\\lambda_i\\) \\(\\lambda_i \\cdot (1-\\theta)\\) Tham số của biến Poisson \\(\\lambda_i = exp(-0.544 - 0.0214 \\cdot Age + 0.106 \\cdot Gender)\\) \\(\\lambda_i = exp(-0.063 - 0.0215 \\cdot Age + 0.104 \\cdot Gender)\\) Tham số Zero-inflated 0 \\(\\theta = exp(-0.971)\\) Giá trị Log Likelyhood -6419 -6353 Có thể thấy rằng mô hình tuyến tính tổng quát với biến phụ thuộc phân phối \\(ZI_\\mathcal{P}\\) có giá trị hàm hợp lý tối đa lớn hơn, điều này cũng có nghĩa là phân phối \\(ZI_\\mathcal{P}\\) phù hợp hơn phân phối Poisson thông thường khi mô tả biến phụ thuộc trong dữ liệu. Dựa vào kết quả ước lượng từ hai mô hình, chúng ta có thể tính toán xác suất không có tai nạn và xác suất để xảy ra một tai nạn theo độ tuổi và giới tính của người tham gia bảo hiểm như sau Có thể nhận thấy rằng xác suất mà một người được bảo hiểm không để xảy ra tai nạn trong mô hình tuyến tính tổng quát với biến phụ thuộc có phân phối \\(ZI_\\mathcal{P}\\) là luôn cao hơn so với mô hình tuyến tính tổng quát với biến phụ thuộc có phân phối Poisson thông thường. Đồng thời, mô hình tuyến tính tổng quát với biến phụ thuộc có phân phối \\(ZI_\\mathcal{P}\\) cho kết quả xác suất xảy ra đúng một tai nạn thấp hơn so với mô hình có biến phụ thuộc có phân phối Poisson thông thường. 1.2.4 Biến phụ thuộc có phân phối liên tục. Một giả thiết quan trọng của mô hình tuyến tính tổng quát là biến phụ thuộc nằm trong họ các biến ngẫu nhiên có phân phối kiểu mũ, hay exponential family. Chúng ta sẽ thảo luận kỹ hơn về họ các biến ngẫu nhiên có phân phối kiểu mũ trong phần sau của cuốn sách. Lưu ý rằng họ các biến ngẫu nhiên có phân phối kiểu mũ không tương đồng với khái niệm biến ngẫu nhiên có phân phối mũ. Phân phối mũ chỉ là mộ trường hợp đặc biệt của phân phối kiển mũ. Có nhiều biến ngẫu nhiên liên tục khác có phân phối nằm trong họ các phân phối kiểu mũ. Có thể kể đến như phân phối gamma, phân phối chuẩn, phân phối chuẩn ngược… Các bước để xây dựng mô hình tuyến tính tổng quát trong trường hợp biến phụ thuộc \\(Y\\) là biến ngẫu nhiên liên tục hoàn toàn tương tự như cách xây dựng mô hình tuyến tính tổng quát ở trên, bao gồm bước chọn phân phối xác suất cho biến mục tiêu và lựa chọn hàm liên kết phù hợp. Chúng ta sẽ tiếp tục xây dựng mô hình với dữ liệu “exposure.csv” đã đề cập ở các phần trên. Biến mục tiêu không còn là số lần khách hàng gửi yêu cầu bồi thường, mà là số tiền trung bình mỗi lần khách hàng gửi yêu cầu (biến \\(Ave\\_Amount\\)). Các biến giải thích vẫn tiếp tục là giới tính (\\(Gender\\)) và độ tuổi (\\(Age\\)) của người được bảo hiểm. dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/exposure.csv&quot;) dat&lt;-mutate(dat,Ave_Amount = ifelse(Claim_Count&gt;0,Total_Claim/Claim_Count,0)) dat1&lt;-filter(dat,Claim_Count&gt;0) Mối liên hệ giữa \\(Ave\\_Amount\\) được thể hiện qua đồ thị dưới đây dat1$Gender&lt;-ifelse(dat1$Gender==0,&quot;F&quot;,&quot;M&quot;) p1&lt;-dat1%&gt;%ggplot()+geom_boxplot(aes(Gender,y = Ave_Amount))+ ylim(0,200)+ggtitle(&quot;Số tiền yêu cầu bồi thường trung bình và giới tính&quot;) p2&lt;-dat1%&gt;%ggplot(aes(x=Age,y = Ave_Amount))+geom_point(alpha=0.2)+ geom_smooth(col=&quot;black&quot;, size = 1, se = FALSE)+ylim(0,200)+ ggtitle(&quot;Số tiền yêu cầu bồi thường trung bình và độ tuổi&quot;) grid.arrange(p1,p2,ncol=2) Đồ thị bên trái cho thấy số tiền yêu cầu bồi thường trung bình của nữ là cao hơn nam giới. Phân phối xác suất của số tiền yêu cầu bồi thương trung bình là phân phối liên tục lệch phải, có đuôi bên phải lớn. Đồ thị bên phải cho thấy số tiền yêu cầu bồi thường trung bình có xu hướng tăng theo độ tuổi. Số tiền bảo hiểm trung bình là số dương nên chúng ta sẽ sử dụng phân phối \\(gamma\\) với hàm liên kết là hàm log(). Lưu ý rằng phân phối gamma() là phân phối có hai tham số, thường được ký hiệu là \\(\\alpha\\) và \\(\\gamma\\), với hàm mật độ xác suất, giá trị trung bình, và phương sai như sau \\[\\begin{align} &amp; f_Y(y) = \\cfrac{\\beta^\\alpha}{\\Gamma(\\alpha)} \\ y^{\\alpha-1} \\ e^{-\\gamma y} \\\\ &amp; \\mathbb{E}(X) = \\cfrac{\\alpha}{\\gamma} \\\\ &amp; \\mathbb{V}(X) = \\cfrac{\\alpha}{\\gamma^2} \\end{align}\\] Khi phân phối \\(gamma\\) được sử dụng cho biến phụ thuộc, giá trị trung bình được tính bằng \\(\\alpha/\\gamma\\), sẽ được mô tả thông qua các biến độc lập trong khi tham số \\(\\alpha\\) sẽ được ước lượng dựa trên hàm hợp lý tối đa: dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/exposure.csv&quot;) dat&lt;-mutate(dat,Ave_Amount = ifelse(Claim_Count&gt;0,Total_Claim/Claim_Count,0)) dat1&lt;-filter(dat,Claim_Count&gt;0) glm3&lt;-glm(Ave_Amount~Age+Gender, family = Gamma(link = &quot;log&quot;),data = dat1) summary(glm3) ## ## Call: ## glm(formula = Ave_Amount ~ Age + Gender, family = Gamma(link = &quot;log&quot;), ## data = dat1) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -4.3309 -0.9498 -0.3047 0.3360 2.9954 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) -0.047535 0.065517 -0.726 0.468 ## Age 0.079089 0.001534 51.563 &lt;2e-16 *** ## Gender -0.534010 0.041951 -12.730 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for Gamma family taken to be 0.9241118) ## ## Null deviance: 4666.5 on 2110 degrees of freedom ## Residual deviance: 2205.7 on 2108 degrees of freedom ## AIC: 15710 ## ## Number of Fisher Scoring iterations: 6 Ngoài các hệ số của các biến độc lập trong mô hình tuyến tính tổng quát, hàm glm() còn cung cấp giá trị ước lượng được cho tham số \\(\\phi\\) (disperson paramter hay tham số phân tán) là \\(0.924\\). Tham số phân tán được định nghĩa trong họ các phân phối kiểu mũ sẽ được thảo luận trong phần tiếp theo. Đối với phân phối \\(gamma\\), tham số phân tán được tính bằng \\(\\phi = 1/\\alpha\\). Giá trị số tiền bồi thường trung bình được được mô tả bằng mô hình tuyến tính tổng quát như sau: \\[\\begin{align} &amp; Y_i \\sim Gamma(\\mu_i = \\alpha_i/\\gamma_i , \\phi_i = 1/\\alpha_i) \\\\ &amp; \\phi_i = 0.924 \\\\ &amp; log(\\mu_i) = -0.0475 + 0.079 \\cdot Age_i + 0.534 \\cdot Gender_i \\end{align}\\] Trước khi đi vào chi tiết các thành phần của mô hình, chúng tôi muốn kết luận rằng mô hình tuyến tính tổng quát có thể được sử dụng để mô hình hóa dữ liệu trong nhiều hoàn cảnh khác nhau. Việc xây dựng mô hình tuyến tính tổng quát luôn được bắt đầu bằng việc lựa chọn phân phối cho biến phụ thuộc và lựa chọn hàm số liên kết. Có các quy tắc chung trong việc lựa chọn phân phối và hàm liên kết giống như chúng tôi đã trình bày ở phần trên. Tuy nhiên để đưa ra được mô hình tuyến tính tổng quát phù hợp cho từng dữ liệu cụ thể, hoặc để có thể mở rộng được mô hình tuyến tính tổng quát trong các kiểu dữ liệu phức tạp hơn, bạn đọc cần am hiểu sâu hơn về các đặc điểm kỹ thuật của các mô hình này. Các kiến thức này sẽ được trình bày trong các phần tiếp theo của chương. 1.3 Các thành phần của mô hình tuyến tính tổng quát. Như chúng ta đã thảo luận trong phần trước, mô hình tuyến tính tổng quát khắc phục hai giả thiết, cũng là hai nhược điểm của mô hình tuyến tính thông thường, đó là i) biến phụ thuộc có phân phối chuẩn, và ii) giá trị trung bình của biến phụ thuộc bằng một tổ hợp tuyến tính của các biến độc lập. Trong phần này của cuốn sách, chúng tôi sẽ thảo luận kỹ hơn vào cách tiếp cận để khắc phục các hạn chế kể trên. Thứ nhất, thay vì sử dụng phân phối chuẩn, mô hình tuyến tính tổng quát giả thiết rằng biến phụ thuộc có phân phối nằm trong họ các phân phối kiểu mũ (exponential family). Phân phối chuẩn chỉ là một trường hợp đặc biệt của họ các phân phối này. Thứ hai, mô hình tuyến tính tổng quát sử dụng một hàm \\(g\\), được gọi là hàm liên kết, để mô tả mối liên hệ giữa giá trị trung bình của biến phụ thuộc với tổ hợp tuyến tính của các biến độc lập. Lựa chọn hàm \\(g\\) có ý nghĩa quan trọng không chỉ trong cách luận giải kết quả của mô hình, mà còn ở việc dễ dàng ước lượng tham số của mô hình. 1.3.1 Họ các biến ngẫu nhiên có phân phối kiểu mũ. Thay vì giả thiết rằng \\(Y\\) có phân phối chuẩn trong mô hình tuyến tính thông thường, mô hình tuyến tính tổng quát giả thiết biến phụ thuộc \\(Y\\) nằm trong họ các biến ngẫu nhiên có phân phối kiểu mũ. Họ các biến ngẫu nhiên có phân phối kiểu mũ (exponential family) có hàm mật độ xác suất có thể viết dưới dạng như sau: \\[\\begin{align} f(y;\\theta,\\phi) = \\exp\\left[ \\cfrac{y \\theta - b(\\theta)}{a(\\phi)} + c(y,\\phi) \\right] \\end{align}\\] trong đó Tham số \\(\\theta\\) được gọi là tham số \\(chính\\) \\(tắc\\) của phân phối kiểu mũ. Tham số \\(\\phi\\) được gọi là tham số \\(phân\\) \\(tán\\). Nguyên nhân là do giá trị trung bình của biến ngẫu nhiên \\(Y\\) không phụ thuộc vào \\(\\phi\\). Tham số \\(\\phi\\), mà tổng quát hơn là hàm \\(a(\\phi)\\) sẽ xác định phương sai của biến phụ thuộc. Các hàm số \\(b(\\theta)\\), \\(a(\\phi)\\) và \\(c(y,\\phi)\\) sẽ quyết định kiểu phân phối của biến phụ thuộc. Giá trị trung bình và phương sai của biến phụ thuộc \\(Y\\) được cho bởi các công thức sau: \\[\\begin{align} &amp; \\mathbb{E}(Y) = b^{&#39;}(\\theta) \\\\ &amp; \\mathbb{V}(Y) = a(\\phi) \\cdot b^{&#39;&#39;}(\\theta) \\tag{1.23} \\end{align}\\] với \\(b^{&#39;}(\\theta)\\) và \\(b^{&#39;&#39;}(\\theta)\\) lần lượt là đạo hàm bậc một và đạo hàm bậc hai của hàm số \\(b\\) theo biến \\(\\theta\\). Họ các biến ngẫu nhiên có phân phối kiểu mũ bao gồm đa số các biến ngẫu nhiên liên tục thông thường như phân phối chuẩn, phân phối mũ, phân phối Gamma, phân phối chuẩn ngược. Các biến ngẫu nhiên phân phối rời rạc như phân phối nhị thức, phân phối binomial, hoặc phân phối Poisson cũng nằm trong họ các biến ngẫu nhiên có phân phối kiểu mũ. Ví dụ 1: phân phối Poisson thường được sử dụng để mô tả phân phối của biến đếm trong mô hình tuyến tính tổng quát. Hàm phân phối của biến ngẫu nhiên Poisson với tham số \\(\\lambda\\), ký hiệu \\(\\mathcal{P}(\\lambda)\\), được cho bởi công thức \\[\\begin{align} \\mathbb{P}(Y = y; \\lambda) = exp(-\\lambda) \\ \\cfrac{\\lambda^y}{y!} \\end{align}\\] Chúng ta có thể viết phân phối \\(\\mathcal{P}(\\lambda)\\) dưới dạng phân phối mũ như sau \\[\\begin{align} \\mathbb{P}(Y = y; \\theta) = exp\\left[ \\cfrac{\\theta y - exp(\\theta)}{1} - log(\\Gamma(y+1)) \\right] \\text{ với } \\lambda = exp(\\theta) \\end{align}\\] Đây là hàm phân phối của biến ngẫu nhiên nằm trong họ các phân phối kiểu mũ với \\(a(\\phi) = 1\\); \\(b(\\theta) = exp(\\theta)\\) và \\(c(y,\\phi) = log\\left(\\Gamma(y+1)\\right)\\). Bạn đọc có thể tính toán trung bình và phương sai của phân phối \\(\\lambda\\) dựa theo công thức (1.23) \\[\\begin{align} &amp; \\mathbb{E}(Y) = b^{&#39;}(\\theta) = exp(\\theta) = \\lambda \\\\ &amp; \\mathbb{V}(Y) = a(\\phi) \\cdot b^{&#39;&#39;}(\\theta) = 1 \\cdot exp(\\theta) = \\lambda \\end{align}\\] Ví dụ 2: phân phối chuẩn là một biến ngẫu nhiên nằm trong họ các phân phối kiểu mũ. Thật vậy, chúng ta có hàm mật độ của biến ngẫu nhiên phân phối chuẩn với trung bình \\(\\mu\\) và độ lệch chuẩn \\(\\sigma\\), ký hiệu \\(\\mathcal{N}(\\mu,\\sigma)\\), như sau \\[\\begin{align} f(y,\\mu,\\sigma) = \\cfrac{1}{\\sqrt{2 \\pi \\sigma^2}} \\exp\\left[ \\cfrac{-(y - \\mu)^2}{2 \\ \\sigma^2} \\right] \\end{align}\\] Hàm phân phối của \\(\\mathcal{N}(\\mu,\\sigma)\\) có thể được viết dưới dạng phân phối kiểu mũ \\[\\begin{align} \\cfrac{1}{\\sqrt{2 \\pi} \\sigma} \\exp\\left[ \\cfrac{-(y - \\mu)^2}{2 \\ \\sigma^2} \\right] &amp;= \\exp\\left[ \\cfrac{-(y - \\mu)^2}{2 \\ \\sigma^2} - \\cfrac{1}{2} log(2 \\pi \\sigma^2) \\right] \\\\ &amp;= \\exp\\left[ \\cfrac{\\mu y - \\mu^2/2} {\\sigma^2} - \\cfrac{y^2}{2\\sigma^2} - \\cfrac{1}{2} log(2 \\pi \\sigma^2) \\right] \\end{align}\\] Với \\(\\theta = \\mu\\) và \\(\\phi = \\sigma^2\\) chúng ta có hàm mật độ của biến ngẫu nhiên \\(\\mathcal{N}(\\mu,\\sigma)\\) là hàm mật độ của biến ngẫu nhiên nằm trong họ các phân phối kiểu mũ, với \\(a(\\phi) = \\phi\\), \\(b(\\theta) = \\theta^2/2\\) và \\[\\begin{align} c(y,\\phi) = -\\cfrac{y^2}{2\\phi} - \\cfrac{1}{2} log(2 \\pi \\phi) \\end{align}\\] Bạn đọc có thể kiểm tra giá trị trung bình và phương sai của phân phối \\(\\mathcal{N}(\\mu,\\sigma)\\) dựa theo công thức (1.23) \\[\\begin{align} &amp; \\mathbb{E}(Y) = b^{&#39;}(\\theta) = \\theta = \\mu \\\\ &amp; \\mathbb{V}(Y) = a(\\phi) \\cdot b^{&#39;&#39;}(\\theta) = \\phi \\cdot 1 = \\phi = \\sigma^2 \\end{align}\\] Ví dụ 3: phân phối \\(Gamma(\\alpha,\\gamma)\\) nằm trong họ các phân phối kiểu mũ. Thật vậy \\[\\begin{align} f(y) &amp;= \\cfrac{\\gamma^\\alpha}{\\Gamma(\\alpha)} \\ y^{\\alpha-1} \\ e^{-\\gamma \\cdot y} \\\\ &amp;= \\exp\\left[ -\\gamma \\cdot y + \\alpha \\log(\\gamma) - \\log(\\Gamma(\\alpha)) - (\\alpha-1) \\cdot \\log(y) \\right] \\end{align}\\] Với \\(\\theta = -\\gamma/\\alpha\\) và \\(\\phi = 1/\\alpha\\) ta có \\[\\begin{align} f(y) &amp; = \\exp\\left[ \\cfrac{\\theta y + \\log(-\\theta)}{1/\\alpha} - \\cfrac{\\log(\\alpha)}{1/\\alpha} - \\log(\\Gamma(\\alpha)) - (\\alpha-1) \\cdot \\log(y) \\right] \\\\ &amp; = \\exp\\left[ \\cfrac{\\theta y + \\log(-\\theta)}{\\phi} + \\cfrac{\\log(\\phi)}{\\phi} - \\log(\\Gamma(1/\\phi)) - (1/\\phi-1) \\cdot \\log(y) \\right] \\end{align}\\] Chúng ta có phân phối kiểu mũ với \\(a(\\phi) = \\phi\\), \\(b(\\theta) = \\log(-\\theta)\\), và \\[\\begin{align} c(y,\\phi) = \\cfrac{\\log(\\phi)}{\\phi} - \\log(\\Gamma(1/\\phi)) - (1/\\phi-1) \\cdot \\log(y) \\end{align}\\] Chúng ta kiểm tra giá trị trung bình và phương sai của phân phối \\(Gamma(\\alpha,\\beta)\\) theo công thức (1.23) \\[\\begin{align} &amp; \\mathbb{E}(Y) = b^{&#39;}(\\theta) = - \\cfrac{1}{\\theta} = \\cfrac{\\alpha}{\\gamma} \\\\ &amp; \\mathbb{V}(Y) = a(\\phi) \\cdot b^{&#39;&#39;}(\\theta) = \\cfrac{1}{\\alpha} \\cdot \\cfrac{\\alpha^2}{\\gamma^2} = \\cfrac{\\alpha}{\\gamma^2} \\end{align}\\] Trong trường hợp hàm số \\(a(\\phi)\\) là hàm số tuyến tính theo \\(\\phi\\), nghĩa là tồn tại số \\(\\omega\\) sao cho \\(a(\\phi) = \\cfrac{\\phi}{\\omega}\\) chúng ta có hàm mật độ của biến ngẫu nhiên có phân phối kiểu mũ như sau \\[\\begin{align} f(y;\\theta,\\phi) = \\exp\\left[ \\cfrac{y \\theta - b(\\theta)}{\\phi/\\omega} + c(y,\\phi) \\right] \\end{align}\\] Giá trị trung bình và phương sai của biến ngẫu nhiên \\(Y\\) trong trường hợp này được xác định như sau: \\[\\begin{align} &amp; \\mathbb{E}(Y) = b^{&#39;}(\\theta) \\\\ &amp; \\mathbb{V}(Y) = \\cfrac{\\phi}{\\omega} \\cdot b^{&#39;&#39;}(\\theta) \\end{align}\\] Giả sử hàm \\(b^{&#39;}(.)\\) là hàm số đơn điệu và tồn tại hàm số ngược \\({b^{&#39;}}^{-1}(.)\\) thì \\(\\theta = {b^{&#39;}}^{-1}\\left(\\mathbb{E}(Y)\\right)\\). Do đó mối liên hệ giữa phương sai của biến ngẫu nhiên \\(Y\\) và giá trị trung bình của biến \\(Y\\) được thể hiện qua công thức sau \\[\\begin{align} \\mathbb{V}(Y) = \\cfrac{\\phi}{\\omega} \\cdot b^{&#39;&#39;}({b^{&#39;}}^{-1}(\\mathbb{E}(Y))) \\end{align}\\] Hàm số \\(V(\\cdot) = b^{&#39;&#39;}({b^{&#39;}}^{-1}(\\cdot))\\) được gọi là hàm phương sai của phân phối kiểu mũ. Tại sao chúng ta cần định nghĩa một hàm số phức tạp như vậy? Bởi vì hàm \\(V(\\cdot)\\) là cơ sở để người xây dựng mô hình kiểm soát phương sai của biến ngẫu nhiên kiểu mũ. Giả sử biến phụ thuộc quan sát được là \\(Y_1, Y_2, \\cdots, Y_n\\) có cùng phân phối kiểu mũ với cùng tham số \\(\\phi\\), cùng hàm \\(b(\\cdot)\\) và \\(c(\\cdot)\\), nhưng có giá trị \\(\\omega_i\\) khác nhau. Giá trị trung bình của biến \\(Y_i\\), ký hiệu là \\(\\mu_i\\) được giải thích thông qua các biến độc lập và không phụ thuộc vào \\(\\omega_i\\), trong khi phương sai của biến \\(Y_i\\) phụ thuộc vào \\(\\omega_i\\) và giá trị trung bình \\(\\mu_i\\): \\[\\begin{align} \\mathbb{V}(Y_i) = \\cfrac{\\phi}{\\omega_i} \\cdot V(\\mu_i) \\end{align}\\] Khi ước lượng mô hình tuyến tính tổng quát trên một dữ liệu cụ thể, giá trị hàm phương sai \\(V\\) phụ thuộc vào cách chúng ta lựa chọn hàm \\(b\\) và giá trị trung bình của \\(Y_i\\). Tham số \\(\\phi\\) không phụ thuộc vào quan sát \\(Y_i\\), do đó hệ số \\(w_i\\) có ý nghĩa quyết định trong xác định phương sai của \\(Y_i\\). Chúng ta có thể lựa chọn đơn giản là cho \\(w_i\\) bằng 1 với mọi \\(i\\), nếu chúng ta tin rằng tỷ lệ \\(\\cfrac{V(\\mu_i)}{\\mathbb{V}(Y_i)}\\) là hằng số. Trong một số trường hợp, \\(\\cfrac{V(\\mu_i)}{\\mathbb{V}(Y_i)}\\) thay đổi theo \\(i\\), đó là lúc chúng ta cần lựa chọn \\(w_i\\) để cho kết quả tốt nhất. Chúng ta sẽ tiếp tục thảo luận về hàm phương sai của biến phụ thuộc trong phần hàm hợp lý tối đa của biến ngẫu nhiên nằm trong họ phân phối các phân phối kiểu mũ. 1.3.2 Hàm liên kết. Hàm số liên kết \\(g(\\cdot)\\) liên kết giá trị trung bình của biến phụ thuộc với tổ hợp tuyến tính của các biến độc lập luôn được lựa chọn trong nhóm các hàm số đơn điệu và có đạo hàm trên miền xác định của hàm số đó. Các giả thiết này đảm bảo để hàm liên kết có hàm số ngược \\(g^{-1}(\\cdot)\\) cũng là hàm đơn điệu và có đạo hàm trên miền xác định. Một yếu tố quan trọng khác khi lựa chọn hàm liên kết đó là \\(g(\\cdot)\\) có miền xác định trùng với miền xác định của giá trị trung bình của biến phụ thuộc và miền giá trị của \\(g(\\cdot)\\) là tập số thực \\(\\mathbb{R}\\). Xin được nhắc lại rằng mối liên hệ giữa trung bình của biến phụ thuộc và tổ hợp tuyến tính của biến độc lập được mô tả thông qua hàm liên kết như sau: \\[\\begin{align} &amp; g(\\mu_i) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,d} \\\\ &amp; \\mu_i = g^{-1}\\left( beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} + \\cdots + \\beta_p \\cdot x_{i,d} \\right) \\end{align}\\] Danh sách các hàm số thường được sử dụng làm hàm liên kết được cho trong bảng dưới đây Tên hàm số Hàm \\(g(\\mu)\\) Hàm \\(g^{-1}(\\mu)\\) Miền xác định Identily \\(\\mu\\) \\(\\mu\\) (-,+) Log \\(\\log(\\mu)\\)$ \\(\\exp(\\mu)\\) (0,+) Logit \\(\\log(\\mu/(1-\\mu)\\) \\(e^{\\mu}/(1+e^\\mu)\\) (0,1) Probit \\(\\Phi^{-1}(\\mu)\\) \\(\\Phi(\\mu)\\) (0,1) Log-log \\(\\log(-\\log(1-\\mu))\\) \\(1 - \\exp(-\\exp(\\mu))\\) (0,1) Inverse \\(1/\\mu\\) \\(1/\\mu\\) (-,+)/0 Inverse squared \\(1/\\mu^2\\) \\(1/\\sqrt{\\mu}\\) (0,+) Ví dụ 1: khi \\(Y\\) mô tả số lần khách hàng gửi yêu cầu bảo hiểm, giá trị trung bình của \\(Y\\) sẽ là số thực dương. Các hàm số có miền xác định là tập các số thực dương sẽ phù hợp trong trường hợp này. Có thể thấy trong bảng trên các hàm \\(g(\\mu) = \\log(\\mu)\\) và hàm \\(g(\\mu) = 1/\\mu^2\\) là các hàm số có thể lựa chọn là hàm liên kết. Ví dụ 2: khi \\(Y\\) mô tả khách hàng có gửi yêu cầu bảo hiểm hay không, hoặc mô tả sự kiện tai nạn có xảy ra hay không, giá trị trung bình của \\(Y\\) nằm trong khoảng \\((0,1)\\). Do đó các hàm \\(Logit\\), hàm \\(Probit\\), hàm \\(Log-Log\\), hoặc hàm \\(Cauchit\\) sẽ là lựa chọn phù hợp cho hàm liên kết. Khi lựa chọn hàm liên kết bạn đọc cần cân nhắc đến khả năng giải thích của mô hình và sự khó khăn có thể gặp phải khi ước lượng của tham số trong mô hình. Ví dụ như khi biến mục tiêu chỉ nhận giá trị 0 hoặc 1, hàm logit thường xuyên được sử dụng bởi vì khả năng giải thích tốt hơn hàm \\(Probit\\) hay \\(Log-Log\\). Hoặc khi cân nhắc lựa chọn giữa hàm \\(log\\) và hàm \\(inverse\\) \\(squared\\), hàm \\(log\\) thường được ưu tiên lựa chọn. Có thể so sánh mối liên hệ giữa \\(\\mu_i\\) với các biến độc lập như dưới đây thông qua hàm \\(log\\) hoặc hàm \\(inverse\\) \\(squared\\) như sau \\[\\begin{align} &amp;\\text{ Hàm log: } \\mu_i = exp(\\beta_0) \\cdot exp(\\beta_1 \\cdot x_{i,1}) \\cdots exp(\\beta_p \\cdot x_{i,p}) \\\\ &amp;\\text{ Inverse squared: } \\mu_i = \\cfrac{1}{\\sqrt{\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{i,p}}} \\end{align}\\] Khi sử dụng hàm \\(log\\), mỗi biến độc lập tác động lên giá trị trung bình của biến phụ thuộc một cách độc lập với nhau theo quy tắc nhân, trong khi đó không dễ để đánh giá tác động của một biến độc lập lên biến phụ thuộc trong công thức của hàm \\(inverse\\) \\(squared\\). Hay nói cách khác, sử dụng hàm \\(log\\) thường sẽ dễ dàng giải thích kết quả hơn so với khi sử dụng hàm \\(inverse\\) \\(squared\\). Với \\(Y\\) là biến ngẫu nhiên nằm trong họ các phân phối kiểu mũ ta có \\(\\mathbb{E}(Y_i) = b^{&#39;}(\\theta_i)\\). Khi chúng ta lựa chọn hàm liên kết là \\(g(\\cdot) = (b^{&#39;})^{-1}(\\cdot)\\) thì mối liên hệ giữa tham số chính tắc \\(\\theta_i\\) với các biến độc lập sẽ là tuyến tính. Thật vậy, \\[\\begin{align} &amp; \\mu_i = g^{-1}(\\theta_i) \\\\ &amp; g(\\mu_i) = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{i,p}\\\\ &amp; \\rightarrow \\theta_i = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\beta_2 \\cdot x_{i,2} \\cdots + \\beta_p \\cdot x_{i,p} \\end{align}\\] Như vậy, với lựa chọn hàm liên kết \\(g(\\cdot) = (b^{&#39;})^{-1}(\\cdot)\\), tham số chính tắc \\(\\theta_i\\) của biến ngẫu nhiên phân phối mũ \\(Y_i\\) bằng tổ hợp tuyến tính của các biến độc lập. Trong trường hợp này, hàm liên kết \\((b^{&#39;})^{-1}(\\cdot)\\) còn được gọi là hàm liên kết chính tắc của biến phụ thuộc \\(Y\\). Ví dụ 1: khi \\(Y\\) là biến ngẫu nhiên có phân phối chuẩn \\(\\mathcal{N}(\\mu, \\sigma)\\), chúng ta có \\(b(\\mu) = \\mu^2/2\\) và \\(b^{&#39;}(\\mu) = \\mu\\) do đó hàm liên kết chính tắc của biến ngẫu nhiên phân phối chuẩn \\(\\mathcal{N}(\\mu, \\sigma)\\) là \\(g(\\mu) = \\mu\\). Ví dụ 2: khi \\(Y\\) là biến ngẫu nhiên có phân phối \\(gamma(\\alpha,\\gamma)\\), chúng ta có \\(b(\\mu) = \\log(-\\mu)\\), và \\(b^{&#39;}(\\mu) = -1/\\mu\\), do đó hàm liên kết chính tắc của biến ngẫu nhiên phân phối gamma là \\(g(\\mu) = -1/\\mu\\). Trong trường hợp này hàm liên kết không có miền xác định là tập các số thực dương. Có thể thấy rằng lựa chọn hàm liên kết chính tắc không phải là một lựa chọn phù hợp. 1.4 Hàm hợp lý tối đa và ước lượng mô hình. Hệ số tuyến tính của các biến độc lập \\(\\boldsymbol{\\beta} = (\\beta_0, \\beta_1, \\cdots, \\beta_p)\\) được ước lượng từ dữ liệu \\(\\textbf{y} = (y_1, y_2, \\cdots y_n)\\) và \\(\\textbf{x} = (\\textbf{x}_1, \\textbf{x}_2, \\cdots \\textbf{x}_n)\\) bằng phương pháp tối đa hóa hàm hợp lý, hay còn gọi là hàm likelihood. Khi biến mục tiêu \\(Y_i\\) có phân phối kiểu mũ, hàm likelihood được viết như sau \\[\\begin{align} L(\\textbf{y},\\boldsymbol{\\beta}) = \\prod\\limits_{i=1}^n \\ \\exp\\left[ \\cfrac{y_i \\theta - b(\\theta)}{a_i(\\phi)} + c_i(y_i,\\phi) \\right] \\end{align}\\] Trong hầu hết các trường hợp, chúng ta sẽ thực hiện tính toán trên hàm Log-likelihood thay vì hàm likelihood. Hàm Log-likelihood được ký hiệu \\(l(\\textbf{y},\\beta)\\) được xác định như sau \\[\\begin{align} l(\\textbf{y},\\beta) &amp;= \\log \\left( \\prod\\limits_{i=1}^n \\ \\exp\\left[ \\cfrac{y_i \\theta_i - b(\\theta_i)}{a_i(\\phi)} + c_i(y_i,\\phi) \\right] \\right) \\\\ &amp;= \\sum\\limits_{i=1}^n \\left(\\cfrac{y_i \\theta_i - b(\\theta_i)}{a_i(\\phi)} + c_i(y_i,\\phi)\\right) \\end{align}\\] Véc-tơ hệ số \\(\\boldsymbol{\\beta}\\) được ước lượng sao cho giá trị của hàm Log-likelihood đạt giá trị lớn nhất. Như vậy \\(\\boldsymbol{\\beta}\\) là nghiệm của hệ phương trình \\[\\begin{align} \\cfrac{\\partial l(\\textbf{y},\\boldsymbol{\\beta})}{\\partial \\beta_j} &amp; = 0 \\ \\ \\forall j = 1,2, \\cdots, p \\end{align}\\] Lưu ý rằng \\(b^{&#39;}(\\theta_i) = \\mu_i\\) nên trong các thành phần của hàm mật độ xác suất của biến \\(Y_i\\) chỉ có hàm số \\(b(\\cdot)\\) và tham số \\(\\theta_i\\) phụ thuộc vào hệ số \\(\\boldsymbol{\\beta}\\). Đạo hàm của hàm Log-likelihood theo \\(\\beta\\) có thể viết được như sau \\[\\begin{align} \\cfrac{\\partial l(\\textbf{y},\\beta)}{\\partial \\beta_j} &amp; = \\sum\\limits_{i=1}^n \\cfrac{1}{a_i(\\phi)} \\left(y_i \\cfrac{\\partial \\theta_i}{\\partial \\beta_j} - \\cfrac{\\partial b(\\theta_i)}{\\partial \\beta_j} \\right) \\\\ &amp; = \\sum\\limits_{i=1}^n \\cfrac{y_i - b^{&#39;}(\\theta_i)}{a_i(\\phi)} \\cfrac{\\partial \\theta_i}{\\partial \\beta_j} \\end{align}\\] Lưu ý rằng \\(\\mu_i = b^{&#39;}(\\theta_i)\\), đo đó \\[\\begin{align} \\theta_i = (b^{&#39;})^{-1}(\\mu_i) = (b^{&#39;})^{-1}\\left(g^{-1}(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots \\beta_p \\cdot x_{i,p})\\right) \\end{align}\\] đồng thời, đạo hàm của hàm ngược được của các hàm \\(b^{&#39;}(\\cdot)\\) và \\(g(\\cdot)\\) được xác định như sau \\[\\begin{align} &amp; \\left((b^{&#39;})^{-1}\\right)^{&#39;}(\\mu_i) = \\cfrac{1}{(b^{&#39;&#39;}\\left((b^{&#39;})^{-1}(\\mu_i)\\right)} = \\cfrac{1}{b^{&#39;&#39;}(\\theta_i)} \\\\ &amp; (g^{-1}(\\psi_i))^{&#39;} = \\cfrac{1}{(g^{&#39;}(g^{-1}(\\psi_i))} = \\cfrac{1}{g^{&#39;}(\\mu_i)} \\end{align}\\] với \\(\\psi_i = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots \\beta_p \\cdot x_{i,p}\\). Như vậy, đạo hàm của \\(\\theta_i\\) theo \\(\\beta_j\\) được tính như sau \\[\\begin{align} \\cfrac{\\partial \\theta_i}{\\partial \\beta_j} = \\cfrac{\\partial (b^{&#39;})^{-1}(g^{-1}(\\psi_i(\\beta_j)))}{\\partial \\beta_j} = \\cfrac{x_{i,j}}{b^{&#39;&#39;}(\\theta_i) \\cdot g^{&#39;}(\\mu_i)} \\end{align}\\] Ta có đạo hàm của hàm Log-likelihood theo các tham số \\(\\beta_j\\) \\[\\begin{align} \\cfrac{\\partial l(\\textbf{y},\\beta)}{\\partial \\beta_j} = \\sum\\limits_{i=1}^n \\cfrac{(y_i - \\mu_i) \\cdot x_{i,j}}{a_i(\\phi) \\cdot b^{&#39;&#39;}(\\theta_i) \\cdot g^{&#39;}(\\mu_i)} \\end{align}\\] Với lựa chọn \\(a_i(\\phi) = \\cfrac{\\phi}{\\omega_i}\\), do phương sai của biến phụ thuộc là \\(a_i(\\phi) \\cdot b^{&#39;&#39;}(\\theta_i)\\) nên ta có thể viết hàm Log-likelihood theo các tham số \\(\\beta_j\\) theo giá trị trung bình và phương sai của biến phụ thuộc \\[\\begin{align} \\cfrac{\\partial l(\\textbf{y},\\boldsymbol{\\beta})}{\\partial \\beta_j} &amp;= \\sum\\limits_{i=1}^n \\cfrac{(y_i - \\mu_i) \\cdot x_{i,j}}{\\mathbb{V}(y_i) \\cdot g^{&#39;}(\\mu_i)} \\\\ &amp; = \\sum\\limits_{i=1}^n w_i \\cfrac{(y_i - \\mu_i) \\cdot x_{i,j}}{\\phi V(\\mu_i) \\cdot g^{&#39;}(\\mu_i)} \\\\ &amp; =\\cfrac{1}{\\phi} \\sum\\limits_{i=1}^n w_i \\cfrac{x_{i,j}}{V(\\mu_i) \\cdot g^{&#39;}(\\mu_i)} (y_i - \\mu_i) \\end{align}\\] Có thể thầy rằng: Thứ nhất, \\(\\beta_j\\) là nghiệm của phương trình \\(\\cfrac{\\partial l(\\textbf{y},\\beta)}{\\partial \\beta_j} = 0\\) sẽ không phụ thuộc vào giá trị của tham số phân tán \\(\\phi\\). Thứ hai, giá trị của \\(\\mu_i\\) phụ thuộc vào giá trị của các biến độc lập \\(\\textbf{x}_i\\) và phụ thuộc vào các hệ số \\(\\boldsymbol{\\beta}\\), do đó giá trị \\(\\cfrac{x_{i,j}}{V(\\mu_i) \\cdot g^{&#39;}(\\mu_i)}\\) không phụ thuộc hoàn toàn vào cách chúng ta xây dựng mô hình. Thứ ba, giá trị \\(w_i\\) không phụ thuộc vào dữ liệu do đó có thể được sử dụng linh hoạt để ước lượng mô hình có kết quả tốt nhất. Giải hệ phương trình với ẩn là véc-tơ tham số \\(\\boldsymbol{\\beta}\\) như trên thường phải sử dụng các phương pháp giải số. Phương pháp thường được sử dụng là thuật toán Newton Raphson. Hàm glm() sử dụng xuyên suốt trong chương sách cho phép bạn đọc ước lượng mô hình tuyến tính tổng quát cho đa số các phân phối thường gặp của \\(Y_i\\). Tham số \\(weight\\) trong hàm glm() là véc-tơ tham số \\(w_i\\) như chúng ta đã trình bày ở trên. Lựa chọn giá trị cho \\(w_i\\) hoàn toàn do cách tiếp cận của người xây dựng mô hình. Ví dụ 1: khi lựa chọn \\(Y_i\\) có phân phối Poisson với tham số \\(\\lambda_i = exp(\\theta_i)\\) và hàm liên kết là hàm \\(g(\\cdot) = log(\\cdot)\\). Chúng ta có \\(a(\\phi) = 1\\) do đó \\(w_i = 1 \\forall i\\). \\[\\begin{align} &amp; g(\\mu_i) = log(\\mu_i) \\rightarrow g^{&#39;}(\\mu_i) = 1/\\mu_i \\\\ &amp; b(\\theta) = exp(\\theta) \\rightarrow b^{&#39;}(\\theta) = b^{&#39;&#39;}(\\theta) = exp(\\theta) \\rightarrow (b^{&#39;})^{-1}(\\theta) = \\log(\\theta) \\rightarrow V(\\theta) = b^{&#39;&#39;}(b^{&#39;})^{-1})(\\theta) = \\theta \\end{align}\\] Đạo hàm của hàm Log-likelihood theo \\(\\beta_j\\) trở thành \\[\\begin{align} \\sum\\limits_{i=1}^n w_i \\cdot \\cfrac{x_{i,j}}{\\phi V(\\mu_i) \\cdot g^{&#39;}(\\mu_i)} (y_i - \\mu_i) &amp;= \\sum\\limits_{i=1}^n x_{i,j} (y_i - \\mu_i) \\\\ &amp;= \\sum\\limits_{i=1}^n x_{i,j} \\left[y_i - \\exp(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{i,p})\\right] \\end{align}\\] hay nói một cách khác, véc-tơ tham số \\(\\beta\\) để tối đa hóa giá trị của hàm Log-likelihood là nghiệm của hệ phương trình \\[\\begin{align} \\sum\\limits_{i=1}^n x_{i,j} \\left[y_i - \\exp \\left(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{i,p} \\right) \\right] = 0 \\ \\forall j \\end{align}\\] Ví dụ 2: khi \\(Y_i\\) có phân phối Gamma với tham số \\(\\alpha\\), \\(\\gamma_i\\) chúng ta có \\(b(\\theta_i) = log(-\\theta_i)\\) với \\(\\theta_i = - \\cfrac{\\gamma_i}{\\alpha}\\) đồng thời \\(a(\\phi) = \\phi\\) do đó \\(w_i = 1\\) \\(\\forall i\\). Giả sử hàm liên kết được lựa chọn là hàm \\(log\\): \\(g(\\cdot) = log(\\cdot)\\). \\[\\begin{align} &amp; g(\\mu_i) = log(\\mu_i) \\rightarrow g^{&#39;}(\\mu_i) = 1/\\mu_i \\\\ &amp; b(\\theta_i) = log(-\\theta_i) \\rightarrow b^{&#39;}(\\theta_i) = -1/\\theta_i \\rightarrow b^{&#39;&#39;}(\\theta) = 1/\\theta^2 \\rightarrow (b^{&#39;})^{-1}(\\theta) = -1/\\theta \\rightarrow V(\\mu) = b^{&#39;&#39;}(b^{&#39;})^{-1})(\\mu) = \\mu^2 \\end{align}\\] Đạo hàm của hàm Log-likelihood theo \\(\\beta_j\\) trở thành \\[\\begin{align} \\sum\\limits_{i=1}^n w_i \\cdot \\cfrac{x_{i,j}}{\\phi V(\\mu_i) \\cdot g^{&#39;}(\\mu_i)} (y_i - \\mu_i) &amp;= \\sum\\limits_{i=1}^n \\cfrac{x_{i,j}}{\\mu_i} (y_i - \\mu_i) \\end{align}\\] véc-tơ tham số \\(\\boldsymbol{\\beta}\\) để tối đa hóa giá trị của hàm Log-likelihood là nghiệm của hệ phương trình \\[\\begin{align} \\sum\\limits_{i=1}^n x_{i,j} \\left\\{y_i \\cdot \\exp\\left[-(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{i,p}) \\right] - 1 \\right\\} = 0 \\ \\forall j \\end{align}\\] Ví dụ 3: khi \\(Y_i\\) là số tiền bồi thường trung bình cho 1 tai nạn trong vòng 1 năm của một khách hàng, biết rằng khách hàng được bồi thường \\(n_i\\) lần trong năm và số tiền bồi thường của một vụ tai nạn là biến ngẫu nhiên \\(Y^*_i\\) phân phối Gamma với tham số \\(\\alpha\\), \\(\\beta_i\\). Do \\(Y_i\\) là giá trị trung bình của \\(n_i\\) biến phân phối Gamma độc lập với cùng tham số \\(\\alpha\\), \\(\\beta_i\\) nên \\(Y_i\\) sẽ có phân phối Gamma với tham số \\((n_i \\alpha)\\) và \\((n_i \\beta_i)\\). Khi viết \\(Y_i\\) dưới dạng phân phối kiểu mũ, chúng ta có \\(b(\\theta_i) = log(-\\theta_i)\\) với \\(\\theta_i = - \\cfrac{\\beta_i}{\\alpha}\\) và \\(a(\\phi) = \\phi/n_i\\). Véc-tơ tham số \\(\\boldsymbol{\\beta}\\) để tối đa hóa giá trị của hàm Log-likelihood là nghiệm của hệ phương trình \\[\\begin{align} \\sum\\limits_{i=1}^n n_i \\cdot \\ x_{i,j} \\cdot \\left[y_i \\cdot \\exp\\left(-(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{i,p}) \\right) - 1 \\right] = 0 \\ \\forall j \\end{align}\\] 1.5 So sánh và lựa chọn mô hình tuyến tính tổng quát. Nắm được các nguyên tắc chung bạn đọc có thể tự xây dựng nhiều mô hình tuyến tính tổng quát khác nhau cho một dữ liệu cụ thể. Thách thức đặt ra là một mô hình liệu có thực sự có tốt hơn các mô hình khác, hay trong số các mô hình bạn lựa chọn mô hình nào là phù hợp nhất? Phần này của chương sẽ thảo luận về vấn đề so sánh mô hình và lựa chọn mô hình. Các chỉ tiêu thống kê được sủ dụng để so sánh mô hình sẽ xoay quanh giá trị của hàm hợp lý tối đa, bao gồm có thước đo deviance, chỉ tiêu AIC, AICC, hay BIC. 1.5.1 Thước đo deviance Thước đo được gọi là deviance thường được sử dụng để đánh giá và so sánh các mô hình tuyến tính tổng quát có cùng phân phối của biến độc lập. Chỉ tiêu này được tính toán dựa trên giá trị hàm Log-likelihood. Khi \\(Y\\) là biến ngẫu nhiên trong nhóm các phân phối mũ, hàm log-likelihood được viết như sau \\[\\begin{align} l(\\textbf{y},\\theta) &amp; = \\sum\\limits_{i=1}^n \\left(\\cfrac{y_i \\theta_i - b(\\theta_i)}{a_i(\\phi)} + c_i(y_i,\\phi)\\right) \\end{align}\\] với \\(\\boldsymbol{\\theta}\\) là véc-tơ các tham số chính tắc, \\(\\boldsymbol{\\theta} = (\\theta_1, \\theta_2, \\cdots, \\theta_n)\\). Sau khi phân phối của \\(Y\\) và hàm liên kết được lựa chọn, chúng ta ước lượng được véc-tơ tham số \\(\\boldsymbol{\\beta}\\) là hệ số của các biến độc lập bằng cách tối đa hóa hàm log-likelihood. Sau khi đã xác định được véc-tơ tham số \\(\\boldsymbol{\\beta}\\), với mỗi lựa chọn cho phân phối của \\(Y\\) và hàm liên kết, chúng ta sẽ tính toán được các tham số chính tắc của mô hình tuyến tính tổng quát. Nếu hàm liên kết được lựa chọn là hàm liên kết chính tắc, \\(g(\\cdot) = (b^{&#39;})^{-1}(\\cdot)\\), chúng ta có các tham số chính tắc chính là tổ hợp tuyến tính của các biến độc lập \\(\\boldsymbol{\\theta}^M = (\\theta^M_1, \\theta^M_2, \\cdots, \\theta^M_n)\\) với \\[\\begin{align} \\theta^M_i = \\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{i,p} \\tag{1.24} \\end{align}\\] Với mỗi lựa chọn cho mô hình tuyến tính tổng quát, bao gồm lựa chọn cho phân phối của \\(Y\\) và hàm liên kết \\(g\\), tạm gọi là mô hình \\(M\\), chúng ta gọi \\(l(\\textbf{y},\\boldsymbol{\\theta}^M)\\) là giá trị của hàm Log-likelihood tại tham số \\(\\boldsymbol{\\theta}^M\\) được xác định qua phương trình (1.24). Lưu ý rằng véc-tơ \\(\\boldsymbol{\\theta}^M\\) có độ dài là \\(n\\), bằng với kích thước của dữ liệu, tuy nhiên các tham số này được tính toán từ \\((p+1)\\) giá trị \\(\\beta\\) ước lượng được và giá trị của biến độc lập. Điều gì xảy ra nếu tham số chính tắc \\(\\boldsymbol{\\theta}\\) hoàn toàn tự do và không phụ thuộc vào biến độc lập? Hàm Log-likelihood sẽ đạt giá trị cực đại tại \\(\\theta^S = (\\theta^S_1, \\theta^S_2, \\cdots, \\theta^S_n)\\) với \\(\\theta^S_i\\) là giá trị sao cho đạo hàm của hàm Log-likelihood tại \\(\\theta^S_i\\) bằng 0. Do \\(\\theta\\) hoàn toàn tự do nên chỉ có thành phần thứ \\(i\\) của hàm Log-likelihood phụ thuộc vào \\(\\theta^S_i\\) \\[\\begin{align} \\cfrac{\\partial l(\\textbf{y},\\theta)}{\\partial \\theta_i} &amp; = \\cfrac{y_i - b^{&#39;}(\\theta_i)}{a_i(\\phi)} \\end{align}\\] Cho đạo hàm của \\(l(\\textbf{y},\\theta)\\) theo \\(\\theta_i\\) bằng 0 chúng ta có \\(y_i - b^{&#39;}(\\theta^S_i) = 0\\) hay \\(\\theta^S_i = (b^{&#39;})^{-1}(y_i)\\). Bạn đọc lưu ý rằng giá trị hàm Log-likelihood đạt cực đại tại \\(\\boldsymbol{\\theta}^S\\) không có nghĩa là tham số \\(\\boldsymbol{\\theta}^S\\) là lựa chọn tốt nhất cho mô hình tuyến tính tổng quát bởi tham số có đến \\(n\\) bậc tự do. \\(\\boldsymbol{\\theta}^S\\) cho chúng ta thông tin về giá trị cận trên của \\(l(\\textbf{y},\\theta)\\) khi \\(\\theta\\) thay đổi. Thước đo deviance của mô hình \\(M\\), ký hiệu \\(D*(y,\\theta^M)\\) được định nghĩa là hai lần khoảng cách từ \\(l(\\textbf{y},\\boldsymbol{\\theta}^M)\\) đến giá trị tối đa \\(l(\\textbf{y},\\boldsymbol{\\theta}^S)\\). Deviance của một mô hình cho biết mô hình được lựa chọn gần với phân phối quan sát được như thế nào, và mô hình có deviance càng nhỏ thì càng giải thích tốt hơn biến phụ thuộc \\[\\begin{align} D^{*}(y, \\theta^M) &amp;= 2 \\left( l(\\textbf{y},\\theta^S) - l(\\textbf{y},\\theta^M) \\right) \\\\ &amp; = 2 \\sum\\limits_{i=1}^n \\cfrac{y_i (\\theta^S_i - \\theta^M_i) - (b(\\theta^S_i) - b(\\theta^M_i))}{a_i(\\phi)} \\end{align}\\] Trong trường hợp hàm \\(a_i(\\phi)\\) là tuyến tính theo \\(\\phi\\); \\(a_i(\\phi) = \\cfrac{\\phi}{w_i}\\), ta có \\[\\begin{align} D^{*}(y, \\theta^M) &amp; = \\cfrac{1}{\\phi} \\sum\\limits_{i=1}^n 2w_i \\cdot \\left[y_i (\\theta^S_i - \\theta^M_i) - (b(\\theta^S_i) - b(\\theta^M_i)) \\right] = \\cfrac{D(y, \\theta^M)}{\\phi} \\end{align}\\] với \\[\\begin{align} D(y, \\theta^M) &amp; = \\sum\\limits_{i=1}^n 2w_i \\cdot \\left[y_i (\\theta^S_i - \\theta^M_i) - (b(\\theta^S_i) - b(\\theta^M_i)) \\right] \\end{align}\\] trong đó \\(D(y, \\theta^M)\\) là thước đo deviance bỏ qua ảnh hưởng của tham số dispersion \\(\\phi\\). Ví dụ 1: biến mục tiêu \\(Y_i\\) có phân phối chuẩn: \\(Y_i \\sim \\mathcal{N}(\\mu_i, \\sigma)\\) và hàm liên kết \\(g(x) = x\\). Có thể viết hàm mật độ của \\(Y_i\\) dưới dạng phân phối mũ như sau \\[\\begin{align} f(y, \\theta_i, \\phi) &amp; = \\exp\\left[ \\cfrac{\\theta_i y - \\theta_i^2/2} {\\phi} - \\cfrac{y^2}{2\\phi} - \\cfrac{1}{2} log(2 \\pi \\phi) \\right] \\end{align}\\] với \\(\\theta_i = \\mu_i\\) và \\(\\phi = \\sigma^2\\). Ta có \\(\\theta^S_i = (b^{&#39;})^{-1}(y_i) = y_i\\), do đó deviance tính trên quan sát \\(\\textbf{y}\\) được xác định như sau \\[\\begin{align} D(y, \\theta^M) &amp; = \\sum\\limits_{i=1}^n 2 \\cdot \\left[y_i (\\theta^S_i - \\theta^M_i) - (b(\\theta^S_i) - b(\\theta^M_i)) \\right] \\\\ &amp; = \\sum\\limits_{i=1}^n (y_i - \\theta^M_i)^2 \\\\ &amp; = \\sum\\limits_{i=1}^n \\left[y_i - (\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{p,1}) \\right]^2 \\end{align}\\] Trong trường hợp hồi quy tuyến tính thông thường, deviance chính là tổng bình phương sai số. Ví dụ 2: biến mục tiêu \\(Y_i\\) có phân phối Poisson \\(Y_i \\sim \\mathcal{P}(\\lambda_i)\\) và hàm liên kết \\(g(\\cdot) = log(\\cdot)\\). \\[\\begin{align} f(y; \\theta_i) = exp\\left[ \\cfrac{\\theta_i y - exp(\\theta_i)}{1} - log(\\Gamma(y+1)) \\right] \\text{ với } \\lambda_i = exp(\\theta_i) \\end{align}\\] Ta có \\(\\theta^S_i = (b^{&#39;})^{-1}(y_i) = log(y_i)\\), do đó deviance tính trên quan sát \\(\\textbf{y}\\) được xác định như sau \\[\\begin{align} D(y, \\theta^M) &amp; = \\sum\\limits_{i=1}^n 2 \\cdot \\left[y_i (\\theta^S_i - \\theta^M_i) - (b(\\theta^S_i) - b(\\theta^M_i)) \\right] \\\\ &amp; = \\sum\\limits_{i=1}^n 2 \\cdot \\left[y_i (log(y_i) - \\theta^M_i) - (y_i - exp(\\theta^M_i)) \\right] \\\\ &amp; = \\sum\\limits_{i=1}^n 2 \\cdot \\left[y_i \\left(log(y_i) - log(\\mu^M_i)\\right) - (y_i - \\mu^M_i) \\right] \\end{align}\\] với \\(\\mu^M_i = \\exp(\\beta_0 + \\beta_1 \\cdot x_{i,1} + \\cdots + \\beta_p \\cdot x_{p,1})\\). Kết quả ước lượng khi sử dụng hàm glm() trong R hiển thị hai giá trị là Null deviance và Residual deviance. Null deviance được tính toán với giả thiết là chỉ có hệ số chặn \\(\\beta_0\\), còn Residual deviance được tính toán với véc-tơ \\(\\boldsymbol{\\beta}\\) đầy đủ. Giá trị Residual deviance ngoài sử dụng để so sánh hai mô hình có cùng phân phối của biến phụ thuộc còn được sử dụng để lựa chọn biến trong mô hình. Giả sử hai mô hình \\(M1\\) và \\(M2\\) có cùng phân phối cho biến phụ thuộc và có cùng hàm liên kết \\(g(.)\\), mô hình \\(M1\\) có \\(m_1\\) biến độc lập trong khi mô hình \\(M_2\\) có \\(m_2\\) biến độc lập, bao gồm tất cả các biến độc lập của mô hình \\(M1\\). Nói một cách khác, \\(M_2\\) có nhiều hơn \\(M_1\\) là \\((m_2 - m_1)\\) biến độc lập. Mô hình \\(M_2\\) sẽ có deviance lớn hơn mô hình \\(M_1\\) do có nhiều biến độc lập hơn, tuy nhiên việc thêm \\((m_2 - m_1)\\) biến độc lập vào mô hình có ý nghĩa thống kê nếu hiệu số giữa \\(D^*(y, \\theta^{M_2})\\) và \\(D^*(y, \\theta^{M_1})\\) là đủ lớn. Có thể chứng minh được rằng khi kích thước dữ liệu đủ lớn, hiệu số giữa \\(D^*(y, \\theta^{M_2})\\) và \\(D^*(y, \\theta^{M_1})\\) là một biến ngẫu nhiên phân phối xấp xỉ phân phối \\(\\chi^2\\) với bậc tự do \\((m_2 - m_1)\\) \\[\\begin{align} D^{*}(y, \\theta^{M_1}) - D^{*}(y, \\theta^{M_2}) = 2 \\cdot \\log\\left( \\cfrac{L(y,\\theta^{M_2})}{L(y,\\theta^{M_1})} \\right) \\sim \\chi^2(m_2 - m_1) \\end{align}\\] Ví dụ 3: trong dữ liệu \\(exposure.csv\\), khi biến \\(Claim\\_Count\\) được giả thiết có phân phối Poisson và giá trị trung bình được giải thích bằng độ tuổi, hoặc giới tính của người được bảo hiểm, hoặc cả hai biến. Chúng ta gọi mô hình \\(M_1\\) là mô hình mà giá trị trung bình của biến phụ thuộc được giải thích bằng biến độ tuổi, mô hình \\(M_2\\) là mô hình mà giá trị trung bình của biến phụ thuộc được giải thích bằng cả biến giới tính, và mô hình \\(M_3\\) là mô hình mà biến phụ thuộc phụ thuộc vào cả độ tuổi và giới tính của khách hàng. dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/exposure.csv&quot;) glm_M1&lt;-glm(Claim_Count~Age, family = poisson(link=&quot;log&quot;), data = dat) glm_M2&lt;-glm(Claim_Count~Gender, family = poisson(link=&quot;log&quot;), data = dat) glm_M3&lt;-glm(Claim_Count~Age+Gender, family = poisson(link=&quot;log&quot;), data = dat) summary(glm_M1) summary(glm_M2) summary(glm_M3) Giá trị residual deviance của ba mô hình được tổng hợp ở bảng dưới đây Mô hình Biến phụ thuộc Deviance \\(M_1\\) Age 8324.2 \\(M_2\\) Gender 8540.5 \\(M_3\\) Age, Gender 8316.8 Mô hình \\(M_1\\) và \\(M_2\\) đều chỉ có một biến độc lập và \\(M_1\\) có deviance nhỏ hơn \\(M_2\\) do đó mô hình \\(M_1\\) tốt hơn \\(M_2\\). So sánh mô hình \\(M_1\\) với 1 biến độc lập là \\(Age\\) với mô hình \\(M_3\\) có 2 biến độc lập là \\(Age\\) và \\(Gender\\) cần dựa trên kiểm định \\(\\chi^2\\). Ta có \\(D^{*}(y, \\theta^{M_1}) - D^{*}(y, \\theta^{M_2}) = 8324.2 - 8316.8 = 7.4\\). Giá trị 7.4 tương ứng với mức xác suất \\(0.994\\) của phân phối \\(\\chi^2(1)\\). Điều này có ý nghĩa là ở mức độ tin cậy 99%, có thể kết luận rằng thêm biến \\(Gender\\) vào mô hình \\(M_1\\) là có ý nghĩa thống kê, tuy nhiên việc thêm biến \\(Gender\\) lại không có ý nghĩa thống kê ở mức độ tin cậy \\(99.5\\%\\). 1.5.2 Giá trị hàm log-likelihood, AIC và BIC Deviance là một thước đo hữu ích trong so sánh các mô hình có cùng phân phối của biến phụ thuộc và hàm liên kết. Khi các mô hình cần so sánh không có chung phân phối của biến phụ thuộc thì hiệu giữa hai hàm log-likelihood sẽ không có phân phối \\(\\chi^2\\) và khi đó việc so sánh các mô hình là không thế thực hiện được. Trong phần trước, chúng ta đã định nghĩa \\(l(y,\\theta^M)\\) là giá trị tối đa của hàm log-likelihood cho mô hình M với tập hợp các biến độc lập đã lựa chọn. Nhìn chung, giá trị của \\(l(y,\\theta^M)\\) không cho biết nhiều thông tin về độ phù hợp của mô hình, nhưng người xây dựng mô hình thường mong muốn giá trị này càng lớn thì càng tốt. Tuy nhiên, có một vấn đề khi so sánh trực tiếp giá trị \\(l(y,\\theta^M)\\) giữa các mô hình là: một mô hình bao gồm nhiều biến độc lập hơn thì rất có thể có giá trị \\(l(y,\\theta^M)\\) lớn hơn. Để giải quyết vấn đề này, có ba thước đo được điều chỉnh từ \\(l(y,\\theta^M)\\) thường được sử dụng cho mô hình tuyến tính tổng quát với mục đích đánh giá và so sánh giữa các mô hình là AIC, AICC và BIC. Chỉ tiêu AIC, viết tắt của Akaike information criterion, là chỉ tiêu đơn giản nhất được tính toán từ công thức như sau \\[\\begin{align} AIC = 2 \\left(-l(y,\\theta^M)+r\\right) \\end{align}\\] trong đó \\(r\\) là số lượng tham số cần ước lượng trong mô hình. Giá trị \\(AIC\\) càng nhỏ thì mô hình càng khớp hơn với dữ liệu. Chỉ tiêu AICC (hoặc AICs) được điều chỉnh từ AIC, được sử dụng khi kích thước dữ liệu không quá lớn để thay thế cho AIC, và được tính bởi công thức như sau \\[\\begin{align} AICC = AIC + \\cfrac{2r(r+1)}{n-r-1} \\end{align}\\] Khi kích thước dữ liệu \\(n\\) lớn, AIC và AICC sẽ tương đương nhau do \\(\\cfrac{2r(r+1)}{n-r-1}\\) nhỏ. Chỉ tiêu thứ ba là BIC, là viết tắt của Bayesian information criterion. Trong một vài tài liệu BIC còn được gọi là SBC. Cũng giống như AIC và AICC, BIC là chỉ tiêu được tính toán từ giá trị cực đại của hàm log-likelihood điểu chỉnh để phản ánh số lượng tham số sử dụng trong mô hình là nhiều hay ít \\[\\begin{align} BIC = 2 \\left(-l(y,\\theta^M)+r log(n)\\right) \\end{align}\\] Cơ sở lý thuyết cho các chỉ tiêu AIC, AICC, và BIC bạn đọc có thể tìm thấy trong bất kỳ tài liệu thống kê toán nào, do đó chúng tôi sẽ không trình bày trong cuốn sách này. Chúng tôi muốn nhấn mạnh vào góc độ ứng dụng của các chỉ tiêu này khi sử dụng để so sánh các mô hình. Ví dụ 1: chúng ta quay trở lại dữ liệu “MotoInsurance.csv” khi biến mục tiêu \\(Y\\) chỉ nhận hai giá trị là “No” hoặc “Yes”. Biến \\(Y\\) có thể là biến dạng nhị phân hoặc vừa có thể là biến dạng đếm nếu chúng ta cho tương đương giá trị “No” tương đương với 0 và giá trị “Yes” tương ứng với 1. Khi xây dựng mô hình tuyến tính tổng quát, chúng ta có thể sử dụng phân phối Poisson cho biến mục tiêu với hàm liên kết \\(g(\\cdot) = log(\\cdot)\\). dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/MotoInsurance.csv&quot;) dat$Y&lt;-ifelse(dat$Y==&quot;Yes&quot;,1,0) dat$sex&lt;-as.factor(dat$sex) dat$urban&lt;-as.factor(dat$urban) glm.pois&lt;-glm(Y~age+sex+urban+seniority,data=dat, family = poisson(link = &quot;log&quot;)) summary(glm.pois) ## ## Call: ## glm(formula = Y ~ age + sex + urban + seniority, family = poisson(link = &quot;log&quot;), ## data = dat) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -2.0824 -0.7362 -0.5465 0.5711 1.9556 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -0.286511 0.105615 -2.713 0.00667 ** ## age -0.034131 0.002546 -13.406 &lt; 2e-16 *** ## sexM -0.491418 0.057331 -8.572 &lt; 2e-16 *** ## urban1 0.625032 0.053999 11.575 &lt; 2e-16 *** ## seniority 0.070888 0.004257 16.652 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for poisson family taken to be 1) ## ## Null deviance: 2938.1 on 3999 degrees of freedom ## Residual deviance: 2418.7 on 3995 degrees of freedom ## AIC: 5202.7 ## ## Number of Fisher Scoring iterations: 5 Do \\(Y\\) là biến nhị phân nên một cách tự nhiên, bạn đọc sẽ cân nhắc sử dụng phân phối nhị phân cho \\(Y\\). Chúng ta xây dựng mô hình tuyến tính tổng quát với phân phối nhị thức cho \\(Y\\) và hàm liên kết là hàm \\(logit\\). Thay vì sử dụng cả 4 biến độc lập, chúng ta chỉ sử dụng hai biến độc lập là \\(age\\) và \\(sex\\), dat$Y&lt;-as.factor(dat$Y) # đổi biến Y thành factor glm.binom.logit&lt;-glm(Y~age+sex,data=dat, family = binomial(link = &quot;logit&quot;)) summary(glm.binom.logit) ## ## Call: ## glm(formula = Y ~ age + sex, family = binomial(link = &quot;logit&quot;), ## data = dat) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -1.4544 -0.9261 -0.7396 1.2607 2.0088 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) 1.109828 0.130876 8.480 &lt;2e-16 *** ## age -0.026603 0.002709 -9.822 &lt;2e-16 *** ## sexM -0.723479 0.076585 -9.447 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 5163.3 on 3999 degrees of freedom ## Residual deviance: 4935.3 on 3997 degrees of freedom ## AIC: 4941.3 ## ## Number of Fisher Scoring iterations: 4 Tương tự như mô hình \\(glm.pois\\), mô hình \\(glm.binom.logit\\) cũng có tất cả các hệ số của biến độc lập khác 0. Làm thế nào để biết rằng mô hình \\(glm.pois\\) sử dụng phân phối Poisson với 4 biến độc lập hay mô hình \\(glm.binom.logit\\) với phân phối nhị thức cho \\(Y\\) và 2 biến độc lập là tốt hơn? Nếu chúng ta sử dụng thước đo deviance thì kết quả sẽ không chính xác vì các mô hình có phân phối của biến phụ thuộc khác nhau. Chỉ tiêu \\(AIC\\) được tính toán sẵn từ hàm \\(glm\\) có thể được sử dụng để so sánh hai mô hình trong trường hợp này. Chỉ tiêu AIC của \\(glm.pois\\) là 5202.7 trong khi chỉ tiêu AIC của \\(glm.binom.logit\\) là 4941.3. Mô hình \\(glm.binom.logit\\) có AIC nhỏ hơn nên sẽ tốt hơn để mô hình hóa dữ liệu trong trường hợp này. Ví dụ 2: chúng ta sẽ tiếp tục với dữ liệu “MotoInsurance.csv”. Một cách tự nhiên, khi sử dụng phân phối nhị thức cho biến phụ thuộc, bạn đọc sử dụng hàm liên kết là hàm \\(logit\\). Liệu lựa chọn này có là tốt nhất để mô hình hóa dữ liệu mà chúng ta đang nghiên cứu? Bạn đọc có thể sử dụng chỉ tiêu AIC để lựa chọn hàm liên kết phù hợp. Chúng ta sẽ sử dụng 4 biến độc lập là \\(age\\), \\(sex\\), \\(urban\\), và \\(seniority\\) để giải thích giá trị trung bình của biến phụ thuộc khi xây dựng mô hình glm.binom.logit&lt;-glm(Y~age+sex+seniority+urban,data=dat, family = binomial(link = &quot;logit&quot;)) glm.binom.probit&lt;-glm(Y~age+sex+seniority+urban,data=dat, family = binomial(link = &quot;probit&quot;)) summary(glm.binom.logit) ## ## Call: ## glm(formula = Y ~ age + sex + seniority + urban, family = binomial(link = &quot;logit&quot;), ## data = dat) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -2.4424 -0.8115 -0.5046 1.0440 2.7439 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) 0.793757 0.144541 5.492 3.98e-08 *** ## age -0.058754 0.003525 -16.668 &lt; 2e-16 *** ## sexM -0.983040 0.085377 -11.514 &lt; 2e-16 *** ## seniority 0.133569 0.006808 19.618 &lt; 2e-16 *** ## urban1 1.174515 0.078060 15.046 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 5163.3 on 3999 degrees of freedom ## Residual deviance: 4295.8 on 3995 degrees of freedom ## AIC: 4305.8 ## ## Number of Fisher Scoring iterations: 4 summary(glm.binom.probit) ## ## Call: ## glm(formula = Y ~ age + sex + seniority + urban, family = binomial(link = &quot;probit&quot;), ## data = dat) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -2.4931 -0.8168 -0.4987 1.0639 2.9359 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) 0.449579 0.085724 5.244 1.57e-07 *** ## age -0.034482 0.002009 -17.163 &lt; 2e-16 *** ## sexM -0.577303 0.050821 -11.360 &lt; 2e-16 *** ## seniority 0.077888 0.003890 20.021 &lt; 2e-16 *** ## urban1 0.697759 0.046129 15.126 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 5163.3 on 3999 degrees of freedom ## Residual deviance: 4292.4 on 3995 degrees of freedom ## AIC: 4302.4 ## ## Number of Fisher Scoring iterations: 5 Mô hình \\(glm.binom.probit\\) có deviance và AIC nhỏ hơn \\(glm.binom.logit\\), điều này cho biết sử dụng hàm liên kết \\(probit\\) sẽ cho kết quả tốt hơn so với hàm liên kết \\(logit\\). "],["reference.html", "Chương 2 REFERENCE", " Chương 2 REFERENCE 1. Annette J. Dobson and Adrian G. Barnett (2018). An Introduction to Generalized Linear Models. 2. Alan Agresti. (2015). Foundations of Linear and Generalized Linear Models. "],["mô-hình-tần-suất---mức-độ-nghiêm-trọng..html", "Chương 3 Mô hình tần suất - mức độ nghiêm trọng. 3.1 Tại sao tần suất lại có ảnh hưởng đến mức độ nghiêm trọng? 3.2 Các nền tảng xây dựng mô hình. 3.3 Mô hình tần suất - mức độ nghiêm trọng.", " Chương 3 Mô hình tần suất - mức độ nghiêm trọng. Nhiều dữ liệu thu thập được trong lĩnh vực bảo hiểm có thông tin về tần suất, chẳng hạn như tần suất phát sinh yêu cầu bồi thường, cũng như mức độ nghiêm trọng của yêu cầu bồi thường. Phần này của cuốn sách giới thiệu các công cụ để xử lý phân phân phối xác suất đồng thời của tần suất và mức độ nghiêm trọng. Mô hình hóa tần suất rất quan trọng trong các ứng dụng bảo hiểm vì các đặc điểm của hợp đồng, hành vi của chủ hợp đồng, cơ sở dữ liệu mà các công ty bảo hiểm duy trì và cả các yêu cầu pháp lý. Việc lựa chọn mô hình tùy thuộc vào kiểu dữ liệu thu thập được. Đối với một số dữ liệu, chúng tôi quan sát số tiền yêu cầu bồi thường và coi yêu cầu bồi thường bằng 0 có nghĩa là không có yêu cầu bồi thường nào trong khoảng thời gian dữ liệu được thu thập. Đối với các dữ liệu khác, dữ liệu quan sát được lại là số tiền yêu cầu bồi thường của từng cá nhân. Cũng như các phần trước, chúng tôi sẽ không quá đi sâu vào các kỹ thuật xây dựng hay ước lượng mô hình mà sẽ nhấn mạnh vào các ứng dụng thực tế. Chương này của cuốn sách sử dụng công cụ thường được áp dụng trong thực tế để so sánh các mô hình đó là xác nhận mô hình ngoài mẫu (out-of-sample validation) 3.1 Tại sao tần suất lại có ảnh hưởng đến mức độ nghiêm trọng? Hiểu một cách đơn giản nhất, hoạt động cơ bản nhất trong bảo hiểm là các công ty bảo hiểm nhận phí bảo hiểm để đổi lấy lời hứa bồi thường cho chủ hợp đồng về sự cố không chắc chắn của người được bảo hiểm. Mỗi lần khách hàng gặp sự cố sẽ gửi một thông báo đến công ty để yêu cầu công ty thanh toán tổn thất, thông báo này được gọi là yêu cầu bồi thường. Số tiền được gọi là mức độ nghiêm trọng của yêu cầu bồi thường, là khoản chi quan trọng đối với công ty bảo hiểm. Chúng ta cũng có thể coi yêu cầu bồi thường bằng 0 tương đương với việc sự kiện được bảo hiểm không xảy ra. Bỏ qua chi phí, một công ty bảo hiểm nếu chỉ quan tâm đến số tiền đã thanh toán sẽ không quan tâm đến hai yêu cầu bồi thường, mỗi yêu cầu bằng 100 triệu, so sánh với một yêu cầu bồi thường 200 triệu, mặc dù số lượng yêu cầu bồi thường khác nhau. Tuy nhiên, nghiên cứu tần suất phát sinh các yêu cầu bồi thường, hay còn gọi tắt là tần suất, cũng là một chủ đề đáng quan tâm của những người nghiên cứu về bảo hiểm. Dưới đây là các nguyên nhân mà chúng ta cần quan tâm đến tần suất của sự kiện bảo hiểm: Thứ nhất: thông thường thì các hợp đồng bảo hiểm sẽ áp đặt các khoản khấu trừ và giới hạn trên cho mỗi lần xảy ra sự cố. Ví dụ: nếu hợp đồng có mức khấu trừ là 100 triệu cho mỗi lần xảy ra, thì hai khoản lỗ 100 triệu sẽ dẫn đến khoản thanh toán (hoặc yêu cầu bồi thường) bằng 0 từ công ty bảo hiểm, trong khi một sự kiện ở mức tổn thất 200 triệu sẽ dẫn đến khoản thanh toán là 100 triệu. Tổng số tiền tổn thất được bảo hiểm cần phải tính đến các khoản khấu trừ và giới hạn chi trả cho từng sự kiện được bảo hiểm. Thứ hai là do hành vi của các bên liên quan đến hợp đồng bảo hiểm. Các mô hình tổn thất bảo hiểm giải thích rõ ràng hoặc ngầm định các hành vi dẫn đến quyết định của người dân và doanh nghiệp có thể ảnh hưởng đến cả tần suất và mức độ nghiêm trọng của tổn thất. Những người liên quan đến hợp đồng có thể không chỉ bao gồm chủ hợp đồng mà còn có cả người bảo hiểm, chuyên gia sửa chữa (oto, nhà), nhà cung cấp dịch vụ y tế, v.v. Các biến giải thích hành vi có thể có những tác động khác nhau lên tần suất xảy ra một sự kiện. Ví dụ, trong bảo hiểm nhà, khi xem xét một người mua bảo hiểm rất cẩn thận và sống trong một khu nhà đắt đỏ. Chúng ta có thể xem xét các đặc điểm của chủ nhà như một dấu hiệu cho thấy việc áp dụng các biện pháp ngăn ngừa tổn thất như những yếu tố quyết định cho thấy tần suất thấp. Đồng thời, chúng ta có thể xem xét mức thu nhập chung của khu vực địa lý nơi có ngôi nhà làm đại diện cho mức chi phí sửa chữa trong trường hợp xảy ra tai nạn, cho thấy mức độ nghiêm trọng cao. Trong bảo hiểm ô tô, chúng ta có thể nghĩ mật độ dân số có mối tương quan dương với tần suất tai nạn và có mối tương quan nghịch với mức độ nghiêm trọng. Ví dụ, ở một khu đô thị đông dân cư, tình trạng tắc nghẽn giao thông cao, có nghĩa là người lái xe có thể gặp tai nạn thường xuyên nhưng chi phí tương đối thấp. Điều này trái ngược với một khu vực nông thôn dân cư thưa thớt hơn, nơi có đường rộng, ít tắc nghẽn và lái xe có thể chạy với tốc độ cao, có nghĩa là tai nạn ít xảy ra hơn, nhưng tốc độ cao hơn có nghĩa là mức độ nghiêm trọng hơn. Lịch sử yêu cầu bồi thường trước đây là một biến số khác cung cấp thông tin về mức độ chấp nhận rủi ro của chủ hợp đồng. Đặc biệt trong bảo hiểm cá nhân, người ta thường sử dụng dấu hiệu cho biết liệu yêu cầu bồi thường có xảy ra hay không, chẳng hạn như trong ba năm qua, thay vì số tiền yêu cầu bồi thường. Ở nhiều quốc gia, phí bảo hiểm ô tô được điều chỉnh bằng hệ thống được gọi là hệ thống thưởng-phạt, trong đó tần suất yêu cầu trước được sử dụng để điều chỉnh linh hoạt phí bảo hiểm. Thứ ba: là các cơ sở dữ liệu trong bảo hiểm. Đa số các công ty bảo hiểm lưu trữ dữ liệu theo hướng làm cơ sở để phát triển các mô hình tần suất và mức độ nghiêm trọng một cách riêng biệt. Ví dụ: các công ty bảo hiểm duy trì hồ sơ chủ hợp đồng được thiết lập khi soạn thảo hợp đồng. Hồ sơ này ghi lại thông tin phát hành và lịch sử hợp đồng, bao gồm có thông tin người được bảo hiểm, chẳng hạn như tuổi tác, giới tính và kinh nghiệm yêu cầu bồi thường trước đó; thông tin về phạm vi bảo hiểm, khoản khấu trừ và giới hạn; và thông tin về sự kiện yêu cầu bồi thường bảo hiểm. Một hồ sơ riêng biệt khác, thường được gọi là hồ sơ yêu cầu bồi thường, ghi lại chi tiết về yêu cầu bồi thường đối với công ty bảo hiểm. Cách lưu trữ dữ liệu như vậy giúp các công ty bảo hiểm mô hình hóa tần suất và mức độ nghiêm trọng thành các quy trình riêng biệt một cách hoàn toàn tự nhiên. Thứ tư là do quy định pháp luật. Bảo hiểm là một ngành dịch vụ được giám sát chặt chẽ. Các cơ quan quản lý thường xuyên yêu cầu công ty báo cáo cả số lượng và số tiền yêu cầu bồi thường. Các công ty bảo hiểm cần các hệ thống quản lý khác nhau để xử lý các tổn thất nhỏ, xảy ra thường xuyên như bảo hiểm sức khỏa, và các sự kiện hiếm xảy ra, có tác động lớn, chẳng hạn như bảo hiểm cháy nổ hay hàng hải. Mỗi yêu cầu bồi thường bảo hiểm có nghĩa là công ty phải chịu thêm chi phí, cho thấy tần suất yêu cầu bồi thường là yếu tố quan trọng quyết định chi phí của công ty. 3.2 Các nền tảng xây dựng mô hình. Hãy bắt đầu xây dựng mô hình bằng cách suy nghĩ về cơ sở dữ liệu của công ty bảo hiểm duy trì, bao gồm dữ liệu chủ hợp đồng và dữ liệu về yêu cầu bồi thường. Công ty bảo hiểm ký hợp đồng với người được bảo hiểm, quản lý dữ liệu hợp đồng và dữ liệu về yêu cầu bồi thường một cách liên tục theo thời gian. Đối với các mục đích, chẳng hạn như xác định số dự phòng tổn thất, sẽ rất hữu ích khi xem xét dữ liệu một cách liên tục theo thời gian. Phần này của cuốn sách chỉ tập trung vào xây dựng mô hình trong một khoảng thời gian cụ thể, chẳng hạn như 1 năm, và chỉ xem xét đến các yêu cầu bồi thường đã hoàn thành, nghĩa là đã được thanh toán đầy đủ hoặc không đủ điều kiện để bồi thường. Đây là cách xem xét dữ liệu gắn liền với các nghiệp vụ tính toán như xác định mức phí bảo hiểm (rate making) cho hợp đồng mới và tái bảo hiểm (reinsurance). Giả sử rằng có \\(n\\) hợp đồng trong danh mục nghiệp vụ bảo hiểm của công ty, các hợp đồng được ký hiệu là \\(1, 2, \\cdots, n\\) với \\(N_i\\) là số lượng yêu cầu bồi thường được chấp thuận của hợp đồng \\(i\\) trong thời gian quan sát. Khi \\(N_i &gt; 0\\), ký hiệu \\(y_{i,j}\\), với \\(j = 1, 2, \\cdots, N_i\\) lần lượt là số tiền yêu cầu bồi thường của lần yêu cầu thứ \\(j\\). Tổng số tiền bồi thường cho hợp đồng \\(i\\) trong thời gian quan sát là \\[\\begin{align} S_i = \\begin{cases} 0 &amp; \\text{ nếu } N_i = 0 \\\\ \\sum\\limits_{j=1}^{N_i} y_{i,j} &amp; \\text{ nếu } N_i &gt; 0 \\end{cases} \\end{align}\\] Trong cơ sở dữ liệu của các công ty bảo hiểm, tổn thất có thể được lưu trữ dưới các dạng như sau Chỉ có \\(S_i\\) được lưu lại, chẳng hạn như các hợp đồng bảo hiểm thương mại. Cả \\(N_i\\) và \\(S_i\\) đều được lưu lại. Tất cả các thông tin liên quan đến yêu cầu bồi thường đều được lưu lại, nghĩa là dữ liệu có đầy đủ thông tin về \\(y_{i,j}\\), với \\(j = 1, 2, \\cdots, N_i\\) với mọi hợp đồng \\(i\\). Chúng ta có thể sử dụng quy tắc xác suất có điều kiện để xây dựng phân phối đồng thời cho các thành phần tần suất và mức độ nghiêm trọng. Để cụ thể, giả sử dữ liệu được quan sát một cách đầy đủ. Chúng ta có hàm phân phối đồng thời cho hai biến \\(N\\) - tần suất và \\(Y\\) mức độ nghiêm trọng như sau \\[\\begin{align} f(N,Y) = p(N) \\cdot f(Y|N) \\tag{3.1} \\end{align}\\] trong đó \\(f(N,Y)\\) là hàm phân phối xác suất đồng thời của hai biến \\(N\\) và \\(Y\\), \\(p(N)\\) là phân phối xác suất của biến \\(N\\) và \\(f(Y|N)\\) là phân phối xác suất của mức độ nghiêm trọng \\(Y\\) với điều kiện \\(N\\). Khi dữ liệu thu thập được ở dạng thứ hai, chúng ta cũng có thể mô tả mối liên hệ giữa tần suất và mức độ nghiêm trọng một cách tương tự, thay thế véc-tơ tổn thất riêng \\(y\\) bằng tổng tổn thất \\(S\\). Đối với dữ liệu thu thập được ở dạng thứ nhất, chúng ta có thể phân tách dữ liệu bằng cách tách sự kiện \\(N = 0\\) thông qua ký hiệu chỉ báo \\(R_i = \\mathbb{I}_{S_i &gt; 0}\\) cho thành phần tần suất và chỉ sử dụng phần dữ liệu có \\(R_i = 1\\) cho thành phần mức độ nghiêm trọng. Thông qua việc phân tách \\(S_i\\) thành hai thành phần có phân phối như (3.1), chúng ta không yêu cầu giả thiết độc lập của các thành phần như truyền thống. Có nhiều cách để mô hình hóa sự phụ thuộc khi xét \\(f(N,Y)\\). Ví dụ: chúng ta có thể sử dụng một biến ngẫu nhiên ẩn ảnh hưởng đồng thời đến cả tần số \\(N\\) và lượng tổn thất \\(Y\\) để mô tả mối liên hệ cùng chiều, hoặc ngược chiều. Kỹ thuật copula là một công cụ hữu ích được sử dụng thường xuyên để mô hình hóa các mối liên hệ giữa \\(N\\) và \\(Y\\). Nhìn chung, xuất phát từ công thức xác suất có điều kiện là một tiếp cận hợp lý cho phép mô tả mối liên hệ giữa các thành phần và cung cấp nền tảng khởi đầu cho các tính toán thực nghiệm. Nền tảng thứ hai cho mô hình tần suất - mức độ nghiêm trọng là mô hình tuyến tính tổng quát. Khả năng tùy biến linh hoạt của GLM cho phép chúng ta xây dựng được mối liên hệ của tần suất và mức độ nghiêm trọng với các biến độc lập một cách đồng thời. Giả sử biến \\(Y_i\\) là biến mục tiêu, có thể là tần suất hoặc mức độ nghiêm trọng, chúng ta luôn có thể xây dựng mô hình tuyến tính tổng quát mà giá trị trung bình của biến phụ thuộc được giải thích thông qua các biến phụ thuộc. Do giá trị trung bình của tần suất và mức độ nghiêm trọng là số dương nên trong đa số các trường hợp chúng ta sử dụng hàm liên kết là hàm \\(log(\\cdot)\\). Ta có \\(\\mathbb{E}(Y_i) = exp(\\textbf{x}_i^{&#39;} \\beta)\\). Trong một số trường hợp, giá trị trung bình của biến phụ thuộc được biết là thay đổi tỷ lệ thuận với một biến mà chúng ta gắn nhãn là \\(E_i\\), trong đó \\(E\\) là viết tắt của “Exposure” - một đại lượng mà chúng ta sẽ thảo luận ở phần dưới. Mối liên hệ giữa giá trị trung bình của biến phụ thuộc và exposure được mô tả như sau \\[\\begin{align} \\mathbb{E}(Y_i) = E_i \\cdot \\exp(\\textbf{x} \\beta) \\end{align}\\] Lấy \\(log\\) của hai vế, chúng ta có phương trình tuyến tính mà một trong các biến độc lập là \\(log(E_i)\\) với hệ số là 1. \\[\\begin{align} \\log(\\mu_i) = \\log(E_i) + \\textbf{x}_i^{&#39;} \\beta \\end{align}\\] Khi xây dựng các mô hình trong bảo hiểm, các chuyên gia tính toán thường sử dụng khái niệm “exposure” để hiệu chỉnh quy mô của một rủi ro. Tùy theo loại hình bảo hiểm mà exposure được định nghĩa khác nhau. Ví dụ như trong bảo hiểm vật chất xe oto, exposure thường được sử dụng là 1 năm mà một xe ô tô được bảo hiểm. Trong bảo hiểm trách nhiệm lái xe ô tô, exposure lại có thể là tổng quãng đường lái xe tính theo km, chẳng hạn như mỗi 10,000 km. Khi xây dựng mô hình tần suất - mức độ nghiêm trọng, cần xác định được mối liên hệ giữa tần suất hoặc mức độ nghiêm trọng với exposure. Đối với bảo hiểm vật chất xe ô tô, tần suất có mối liên hệ trực tiếp đến exposure bởi vì thời gian bảo hiểm hoặc quãng đường lái xe càng dài thì tần suất cũng tăng theo tương ứng nhưng mức độ nghiêm trọng lại không có mối liên hệ. Trái lại, trong bảo hiểm thất nghiệp, exposure là tháng lương của người lao động nên sẽ được điều chỉnh theo lạm phát, nghĩa là exposure có tác động đến mức độ nghiêm trọng nhưng lại không có tác động lên tần suất. Để minh họa cách hiệu chỉnh mô hình khi sử dụng exposure, giả sử trong bảo hiểm xe ô tô, \\(E_i\\) là một phần của năm mà chủ hợp đồng được bảo hiểm. Logic đằng sau là số vụ tai nạn dự kiến tỷ lệ thuận với độ dài của thời gian bảo hiểm. Trong trường hợp tần suất xảy ra tai nạn có phân phối Poisson, xây dựng mô hình tuyến tính tổng quát là đơn giản vì nếu 1 đơn vị exposure có phân phối Poisson với tham số \\(\\mu_i\\) thì \\(E_i\\) đơn vị exposure sẽ có phân phối Poisson với tham số \\(\\lambda_i = E_i \\cdot \\mu_i\\). Mô hình tuyến tính tổng quát sẽ có dạng như sau \\[\\begin{align} &amp; Y_i \\sim \\mathcal{P}(\\lambda_i) \\\\ &amp; \\log(\\lambda_i) = \\log(E_i) + \\textbf{x}_i^{&#39;} \\beta \\tag{1.17} \\end{align}\\] Trong trường hợp biến phụ thuộc có giá trị nhị phân và hàm liên kết có dạng logit. Với một đơn vị exposure, xác suất xảy ra tai nạn là \\(p_i = \\cfrac{\\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}{1 + \\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}\\). Giả sử \\(Y_i\\) là biến phụ thuộc cho trường hợp có \\(E_i\\) đơn vị exposure. Có một số tiếp cận khác nhau để xây dựng mô hình tuyến tính tổng quát cho \\(Y_i\\) như sau \\[\\begin{align} \\text{Cách 1: } &amp; P(Y_i = 1) = \\pi_i = E_i \\cdot p_i = E_i \\cfrac{\\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}{1 + \\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}\\\\ \\text{Cách 2: } &amp; P(Y_i = 1) = \\pi_i = 1 - (1 - p_i)^{E_i} = 1 - \\left(1 - \\cfrac{\\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}{1 + \\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}} \\right)^{E_i}\\\\ \\text{Cách 3: } &amp; P(Y_i = 1) = \\pi_i = \\cfrac{E_i \\cdot p_i}{1 - (1 - E_i) \\cdot p_i} = \\cfrac{E_i \\cdot \\cfrac{\\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}{1 + \\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}} {1 - (1 - E_i) \\cdot \\cfrac{\\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}{1 + \\exp{\\left(\\textbf{x}_i^{&#39;} \\beta\\right)}}} \\end{align}\\] Đối với phân bố Poisson, phương sai bằng giá trị trung bình, do đó cả giá trị trung bình và phương sai đều tăng tỷ lệ với giá trị \\(E_i\\). Do đó, khi sử dụng phân phối Poisson với hàm liên kết \\(log(\\cdot)\\), chúng ta chỉ cần sử dụng \\(log(E_i)\\) để tự động tính đến phương sai ngày càng tăng. Tuy nhiên, điều này lại không đúng đối với các phân phối khác thuộc nhóm phân phối mũ. Ví dụ, hãy xem xét phân phối \\(gamma\\) với tham số \\(\\alpha\\) và \\(beta\\) khi viết dưới dạng phân phối kiểu mũ có tham số chính tắc \\(\\theta\\) và tham số phân tán \\(\\phi\\). Nếu có \\(E_i\\) biến ngẫu nhiên \\(gamma\\) độc lập trong cùng nhóm \\(i\\), mỗi biến có trung bình \\(\\alpha/\\beta\\) và phương sai \\(\\alpha/\\beta^2\\), thì phân phối tổng của \\(E_i\\) expusure cũng sẽ là phân phối gamma với trung bình \\(E_i \\cdot \\alpha/\\beta\\) và phương sai \\(E_i \\cdot \\alpha/\\beta^2\\). Khi sử dụng phân phối \\(gamma\\) cho biến phụ thuộc và hàm liên kết \\(log(\\cdot)\\), giá trị trung bình của tổng sẽ tăng tỷ lệ thuận với \\(E_i\\), nhưng phương sai sẽ tăng tỷ lệ thuận với \\(E^2_i\\) chứ không phải \\(E_i\\). Giả sử dữ liệu quan sát được bao gồm \\(n\\) nhóm; với nhóm thứ \\(i\\), \\(1 \\leq i \\leq n\\), chúng ta có \\(E_i\\) quan sát độc lập với cùng phân phối thuộc họ các phân phối kiểu mũ hàm mũ. Phân phối của nhóm \\(i\\) có tham số chính tắc \\(\\theta_i\\), trung bình \\(\\mu_i\\) và tham số phân tán \\(\\phi\\) (có thể phụ thuộc hoặc không phụ thuộc vào \\(i\\)). Có hai hướng tiếp cận để xây dựng mô hình trong trường hợp này. Thứ nhất đó là tiến hành phân tích với tập dữ liệu dựa trên từng quan sát riêng lẻ \\(j = 1, 2, \\cdots, E_i\\) với mỗi \\(i = 1, 2, \\cdots, n\\). Mặt khác, với những giả định này, thì trung bình của nhóm thứ \\(i\\) cũng sẽ có phân phối kiểu mũ với cùng giá trị trung bình \\(\\mu_i\\), cùng tham số chính tắc \\(\\theta_i\\) nhưng có tham số phân tán \\(\\phi_i/E_i\\). Do đó hướng tiếp cận thứ hai là sử dụng mẫu dữ liệu theo nhóm bao gồm \\(n\\) quan sát và sử dụng nghịch đảo của \\(E_i\\) làm trọng số. Với quan sát riêng lẻ thứ \\(j\\) thuộc nhóm \\(i\\), các biến phụ thuộc bao gồm \\((N_{i,j}, Y_{i_j})\\). Nếu các biến giải thích có sẵn cho từng quan sát riêng lẻ thì việc tổng hợp thông tin cho nhóm \\(i\\) sẽ gặp khó khăn vì chúng ta sẽ đi thông tin. Thay vào đó, nếu các biến giải thích chỉ có sẵn theo nhóm và chúng ta muốn xây dựng mô hình các biến tần suất và mức độ nghiêm trọng tổng: \\(N_i = \\sum\\limits_{i=1}^{E_i} N_{i,j}\\), và \\(S_i = \\sum\\limits_{i=1}^{E_i} Y_{i,j}\\) thì Đối với biến tần suất chúng ta sử dụng phân phối Poisson với biến phụ thuộc \\(N_i\\) được điều chỉnh bởi \\(log(E_i)\\), hoặc sử dụng biến ngẫu nhiên dạng đếm thuộc họ phân phối kiểu mũ cho biến phụ thuộc là \\(N_i/E_i\\) và tham số phân tán \\(\\phi/E_i\\). Đối với biến mức độ nghiêm trọng, chúng ta sử dụng biến phụ thuộc là \\(S_i/N_i\\) thuộc nhóm các phân phối kiểu mũ có tham số phân tán là \\(\\phi/N_i\\). 3.3 Mô hình tần suất - mức độ nghiêm trọng. Như chúng ta đã nói ở trên, có ba kiểu dữ liệu được thu thập, đó là i) chỉ có tổng tổn thất theo hợp đồng \\(S_i\\); ii) có thông tin tần suất và tổng giá trị tổn thất \\((N_i, S_i)\\); và iii) có đầy đủ thông tin về \\(N_i\\) và các tổn thất riêng lẻ \\(y_{i,j}\\) với \\(j = 1, 2, \\cdots, N_i\\). Tùy theo kiểu dữ liệu của công ty bảo hiểm mà mô hình tần suất mức độ nghiêm trọng được xây dựng theo các trình tự khác nhau. 3.3.1 Mô hình hai thành phần Mô hình hai thành phần thường được sử dụng để xây dựng mô hình trong trường hợp chúng ta chỉ có thông tin về tổng giá trị tổn thất của hợp đồng \\(S_i\\) với \\(i = 1, 2, \\cdots, n\\). Đây là một trường hợp đặc biệt của mô hình tần suất - mức độ nghiêm trọng. Thành phần thứ nhất của mô hình là biến ngẫu nhiên \\(B_i\\) có phân phối nhị phân chỉ nhận hai giá trị là 0 hoặc 1, trong đó 0 tương ứng với hợp đồng không có yêu cầu bổi thường và 1 tương ứng với hợp đồng có yêu cầu bối thường. Thành phần thứ hai của mô hình là biến ngẫu nhiên \\(S_i\\) cho biết tổn thất đó có độ lớn như thế nào với điều kiện \\(B_i = 1\\). Quá trình ước lượng mô hình hai thành phần bao gồm hai mô hình tuyến tính tổng quát: Mô hình thứ nhất có biến phụ thuộc là \\(B_i\\) với véc-tơ các biến giải thích \\(\\textbf{x}_{i,B}\\) và các hệ số tương ứng của các biến độc lập là \\(\\boldsymbol{\\beta}_B\\). Hàm liên kết được chọn thường là hàm logit. Mô hình thứ hai có biến phụ thuộc là \\(S_i\\) với véc-tơ các biến giải thích \\(\\textbf{x}_{i,S}\\) và các hệ số tương ứng của các biến độc lập là \\(\\boldsymbol{\\beta}_S\\). Dữ liệu để ước lượng mô hình là dữ liệu chỉ tính đến các hợp đồng có \\(S_i &gt; 0\\). Lựa chọn phổ biến cho phân phối của biến độc lập là phân phối gamma và hàm liên kết là hàm log. Thông thường sẽ luôn luôn có các biến giải thích vừa nằm trong véc-tơ \\(\\textbf{x}_{i,B}\\) và véc-tơ \\(\\textbf{x}_{i,S}\\). Một giả thiết khác trong mô hình hai thành phần nói riêng và mô hình tổn thất - mức độ nghiêm trọng nói riêng là các véc-tơ hệ số \\(\\boldsymbol{\\beta}_B\\) và \\(\\boldsymbol{\\beta}_S\\) độc lập với nhau. Giả thiết này đảm bảo việc ước lượng các hệ số của mỗi thành phần hoàn toàn riêng biệt. Trong trường hợp dữ liệu xây dựng mô hình ở dạng thứ hai, nghĩa là chúng ta có quan sát đồng thời cho tần suất và tổng tổn thất của mỗi hợp đồng \\((N_i, S_i)\\), hai bước ước lượng mô hình tần suất - mức độ nghiêm trọng cụ thể như sau Sử dụng một biến ngẫu nhiên dạng đếm để mô tả tần suất \\(N_i\\) với tập hợp các biến độc lập là \\(\\textbf{x}_{i,N}\\). Hệ số của các biến độc lập được ước lượng là \\(\\boldsymbol{\\beta}_N\\). Phân phối thường được lựa chọn là phân phối Poisson hoặc phân phối nhị thức âm. Với điều kiện \\(N_i &gt; 0\\), sử dụng mô hình tuyến tính tổng quát với \\(S_i/N_i\\) là biến phụ thuộc và \\(\\textbf{x}_{i,S}\\) là các biến độc lập. Hệ số của các biến độc lập được ước lượng là \\(\\boldsymbol{\\beta}_S\\). Phân phối của biến phụ thuộc thường được lựa chọn là phân phối \\(gamma\\) sao cho tham số phân tán của quan sát thứ \\(i\\) là \\(\\phi/N_i\\). Nếu dữ liệu xây dựng mô hình ở dạng thứ ba, nghĩa là chúng ta có thông tin chính xác về từng khoảng tổn thất riêng biệt, bước xây dựng mô hình cho tần suất hoàn toàn tương tự như khi dữ liệu ở dạng thứ hai. Trong bước xây dựng mô hình cho mức độ nghiêm trọng, chúng ta sử dụng \\(y_{i,j}\\) là các biến phụ thuộc thay vì sử dụng giá trị trung bình của nhóm \\(i\\). Phân phối được lựa chọn cho biến \\(y_{i,j}\\) thường là phân phối gamma, hoặc phân phối chuẩn với hàm liên kết là hàm log. 3.3.2 Phân phối Tweedie Họ các phân phối kiểu mũ bao gồm các phân phối liên tục, chẳng hạn như phân phối chuẩn và phân phối gamma, cũng như các phân bố rời rạc, chẳng hạn như phân phối nhị thức và Poisson. Ngoài ra, các phân phối kiểu mũ cũng bao gồm cả các phân phối hỗn hợp, nghĩa là các phân phối vừa có thành phần rời rạc và vừa có thành phần liên tục. Trong mô hình hóa dữ liệu trong bảo hiểm, một phân phối hỗn hợp được sử dụng rộng rãi là phân phối Tweedie (1984). Phân phối này có mật độ xác suất dương tại điểm 0 (rời rạc) biểu thị rằng không có yêu cầu bồi thường nào, và phân phối này có thành phần liên tục tại mọi giá trị dương, biểu thị tổng số tiền cho một hoặc nhiều yêu cầu bồi thường. Phân phối Tweedie được định nghĩa là tổng Poisson của các biến ngẫu nhiên Gamma. Cụ thể, giả sử rằng \\(N\\) có phân phối Poisson với giá trị trung bình \\(\\lambda\\), mô tả tần suất yêu cầu bồi thường. Giả sử \\(Y_j\\), với \\(j = 1, 2, \\cdots, N_i\\), là các biến ngẫu nhiên độc lập có cùng phân phối và độc lập với \\(N\\). Hơn nữa, mỗi \\(Y_j\\) có phân phối gamma với các tham số \\(\\alpha\\) và \\(\\gamma\\), mô tả số tiền yêu cầu bồi thường thứ \\(j\\). Khi đó \\[\\begin{align} S_N = \\begin{cases} 0 &amp; \\text{ nếu } N = 0 \\\\ \\sum\\limits_{j=1}^{N} y_{j} &amp; \\text{ nếu } N &gt; 0 \\end{cases} \\end{align}\\] là tổng Poisson của các phân phối gamma. Chúng ta nói rằng \\(S_N\\) có phân phối Tweedie với các tham số \\((\\lambda, \\alpha, \\gamma)\\). Hàm phân phối của biến ngẫu nhiên phân phối Tweedie được xác định như sau: \\[\\begin{align} \\mathbb{P}(S_N = 0) = \\mathbb{P}(N = 0) = exp(-\\lambda) \\end{align}\\] với \\(s \\geq 0\\) thì \\[\\begin{align} \\mathbb{P}(S_N \\leq y) = exp(-\\lambda) + \\sum\\limits_{k = 1}^{\\infty} \\mathbb{P}(N = k) \\cdot \\mathbb{P}(S_k \\leq y) \\end{align}\\] Do \\(S_k\\) là tổng của \\(k\\) biến ngẫu nhiên phân phối gamma độc lập với tham số \\(\\alpha\\), \\(\\gamma\\) do đó \\(S_k\\) cũng có phân phối gamma với tham số \\((k \\cdot \\alpha)\\), \\(\\gamma\\). Ta có hàm mật độ xác suất của biến \\(S_k\\) \\[\\begin{align} f_{S_k}(y) = \\cfrac{\\gamma^{k \\cdot \\alpha}}{\\Gamma(k \\cdot \\alpha)} \\cdot y^{(k \\cdot \\alpha - 1)} \\cdot e^{-\\gamma \\cdot y} \\end{align}\\] Vậy hàm mật độ của phân phối Tweedie tại \\(y &gt; 0\\) được viết như sau \\[\\begin{align} f_{S_N}(y) = \\sum\\limits_{k = 1}^{\\infty} e^{-\\lambda} \\cdot \\cfrac{\\lambda^k}{k!} \\cdot \\cfrac{\\gamma^{k \\cdot \\alpha}}{\\Gamma(k \\cdot \\alpha)} \\cdot y^{(k \\cdot \\alpha - 1)} \\cdot e^{-\\gamma \\cdot y} \\end{align}\\] Phân phối Tweedie nằm trong họ các phân phối kiểu mũ. Tuy nhiên sẽ không dễ dàng để viết phân phối ở trên dưới dạng phân phối kiểu mũ nếu chúng ta không định nghĩa lại các tham số. Trước hết, ta có giá trị trung bình và phương sai của \\(S_N\\) được tính toán thông qua các tham số của phân phối Poisson và phân phối gamma như sau \\[\\begin{align} &amp; \\mathbb{E}(S_N) = \\mathbb{E}(N) \\cdot \\mathbb{E}(S) = \\lambda \\cdot \\cfrac{\\alpha}{\\gamma} \\\\ &amp; \\mathbb{V}(S_N) = \\cfrac{\\lambda \\alpha}{\\gamma^2} \\cdot (1 + \\alpha) \\end{align}\\] Với các tham số \\(\\mu\\), \\(\\phi\\), \\(p\\) được định nghĩa từ các tham số ban đầu \\[\\begin{align} &amp; \\mu = \\lambda \\cdot \\cfrac{\\alpha}{\\gamma} \\\\ &amp; p = \\cfrac{\\alpha + 2}{\\alpha + 1} \\\\ &amp; \\phi = \\cfrac{1}{\\mu^p} \\cdot \\cfrac{\\lambda \\alpha}{\\gamma^2} \\cdot (1 + \\alpha) \\end{align}\\] chúng ta có thể viết hàm phân phối của biến ngẫu nhiên phân phối Tweedie dưới dạng phân phối kiểu mũ như sau \\[\\begin{align} f_{S_N}(y) &amp; = \\exp\\left( \\cfrac{1}{\\phi(1-p)} \\cdot \\left( y \\cdot \\mu^{1-p} - \\cfrac{1-p}{2-p} \\mu^{2-p} \\right) + H(y,p,\\phi) \\right) \\end{align}\\] với hàm \\(H(y,p,\\phi)\\) chỉ phụ thuộc vào các tham số \\(\\phi\\) và \\(p\\) \\[\\begin{align} H(y,p,\\phi) = \\log\\left( \\cfrac{1}{y} \\sum\\limits_{k=1}^{\\infty} \\cfrac{1}{k! \\Gamma(k \\alpha)} \\cdot \\left( \\cfrac{y^\\alpha}{\\phi^{1/(1-p)}(2-p)(1-p)^\\alpha} \\right)^n \\right) \\end{align}\\] Với tham số chính chắc \\(\\theta = \\mu^{1-p}\\), ta có \\(\\cfrac{1-p}{2-p} \\mu^{2-p} = \\cfrac{1-p}{2-p} \\theta^{(2-p)/(1-p)}\\) hay nói cách khác \\(b(\\theta) = - \\cfrac{\\theta^{-\\alpha}}{\\alpha}\\). Giá trị trung bình và phương sai của \\(S_N\\) tính toán theo hàm mật độ xác suất của phân phối kiểu mũ là \\[\\begin{align} \\mathbb{E}(S_N) = b^{&#39;}(\\theta) = \\partial \\cfrac{-\\theta^{-\\alpha}}{\\alpha}/ \\partial \\theta = \\theta^{-(\\alpha+1)} = \\theta^{1/(1-p)} = \\mu \\\\ \\mathbb{V}(S_N) = a(\\phi) b^{&#39;&#39;}(\\theta) = \\phi (1-p) \\cdot \\cfrac{1}{1-p} \\theta^{p/(1-p)} = \\phi \\cdot \\mu^p \\end{align}\\] Khi sử dụng phân phối Tweedie cho biến phụ thuộc trong mô hình tuyến tính tổng quát, chúng ta ước lượng một mô hình GLM thay vì ước lượng hai thành phần tần suất và mức độ nghiêm trọng. Giả sử các biến \\(\\textbf{x}_{i,T}\\) là các biến độc lập trong mô hình Tweedie với hàm liên kết là hàm log và hệ số \\(\\boldsymbol{\\beta_T}\\) là các hệ số tương ứng của các biến độc lập, ta có mô hình tuyến tính tổng quát như sau \\[\\begin{align} Y_i \\sim Tweedie(\\mu_i , p , \\phi) \\\\ \\mu_i = \\exp(\\textbf{x}_{i,T}^{&#39;} \\cdot \\boldsymbol{\\beta_T}) \\end{align}\\] Chúng ta sẽ so sánh giữa giữa sử dụng mô hình tần suất - mức độ nghiêm trọng với sử dụng phân phối Tweedie trên dữ liệu “exposure.csv”. Chỉ tiêu để so sánh hai mô hình là giá trị trung bình của tổng tổn thất theo mỗi hợp đồng trên dữ liệu ngoài mẫu. Giá trị trung bình của tổng tổn thất còn được gọi bằng thuật ngữ là phí bảo hiểm thuần. Dữ liệu sử dụng để xây dựng mô hình được lấy ngẫu nhiên 70% từ dữ liệu ban đầu và chúng ta sẽ so sánh giá trị của phí bảo hiểm thuần được tính toán từ mô hình tần suất mức độ nghiêm trọng với mô hình Tweedie. Để sử dụng phân phối Tweedie trong hàm glm(), chúng ta cần cài đặt thêm thư viện \\(statmod\\). library(statmod) dat&lt;-read.csv(&quot;../KHDL_KTKD Final/Dataset/exposure.csv&quot;) n&lt;-nrow(dat); p&lt;-ncol(dat) dat$Gender&lt;-as.factor(dat$Gender) set.seed(10) train.index&lt;-sample(1:n,size = round(n*0.7),replace=FALSE) train&lt;-dat[train.index,] test&lt;-dat[-train.index,] glm.ser&lt;-glm(Ave_Claim~Age+Gender,family = Gamma(link = &quot;log&quot;),data=train, weight = Claim_Count) glm.fre&lt;-glm(Claim_Count~Age+Gender,family = poisson(link = &quot;log&quot;), data = train) glm.twe&lt;-glm(Total_Claim~Age+Gender,family=tweedie(var.power=1.5,link.power=0),data=train) glm.fre ## ## Call: glm(formula = Claim_Count ~ Age + Gender, family = poisson(link = &quot;log&quot;), ## data = train) ## ## Coefficients: ## (Intercept) Age Gender1 ## -0.54133 -0.02187 0.11533 ## ## Degrees of Freedom: 6999 Total (i.e. Null); 6997 Residual ## Null Deviance: 5952 ## Residual Deviance: 5785 AIC: 8934 glm.ser ## ## Call: glm(formula = Ave_Claim ~ Age + Gender, family = Gamma(link = &quot;log&quot;), ## data = train, weights = Claim_Count) ## ## Coefficients: ## (Intercept) Age Gender1 ## -0.08272 0.07992 -0.51748 ## ## Degrees of Freedom: 1469 Total (i.e. Null); 1467 Residual ## (5530 observations deleted due to missingness) ## Null Deviance: 3833 ## Residual Deviance: 1713 AIC: 13250 glm.twe ## ## Call: glm(formula = Total_Claim ~ Age + Gender, family = tweedie(var.power = 1.5, ## link.power = 0), data = train) ## ## Coefficients: ## (Intercept) Age Gender1 ## -0.50403 0.05485 -0.37003 ## ## Degrees of Freedom: 6999 Total (i.e. Null); 6997 Residual ## Null Deviance: 91600 ## Residual Deviance: 82290 AIC: NA Hệ số của các biến độc lập của các mô hình ở trong bảng dưới đây df&lt;-data.frame(a = c(&quot;Tần suất&quot;, &quot;Mức độ nghiêm trọng&quot;, &quot;Tweedie&quot;), b = c(&quot;glm.fre&quot;, &quot;glm.ser&quot;, &quot;glm.twe&quot;), d = c(-0.541,-0.082,-0.504), e = c(-0.021,0.079,0.055), f = c(0.115,-0.517,-0.370)) knitr::kable(df, booktabs = T, caption = &quot;Hệ số tuyến tính của biến độc lập&quot;, col.names = c(&quot;Mô hình&quot;, &quot;Tên mô hình trên R&quot;,&quot;Hệ số chặn&quot;, &quot;Hệ số của Age&quot;, &quot;Hệ số của Gender&quot;), escape=F, align = &#39;l&#39;) %&gt;% #column_spec(c(1,4,5,6,7),border_left = T) %&gt;% column_spec(7,border_right = T) %&gt;% kable_styling(latex_options = &quot;scale_down&quot;,full_width = F) Table 3.1: Hệ số tuyến tính của biến độc lập Mô hình Tên mô hình trên R Hệ số chặn Hệ số của Age Hệ số của Gender Tần suất glm.fre -0.541 -0.021 0.115 Mức độ nghiêm trọng glm.ser -0.082 0.079 -0.517 Tweedie glm.twe -0.504 0.055 -0.370 Có thể thấy rằng hệ số của các biến độc lập trong mô hình Tweedie khá gần với tổng của hệ số của biến độc lập trong mô hình tần suất và hệ số của biến độc lập trong mô hình mức độ nghiêm trọng. Điều này có thể được giải thích bởi hàm liên kết được sử dụng trong cả ba mô hình đều là hàm \\(log(\\cdot)\\). Giá trị trung bình của tổng tổn thất được tính toán từ các mô hình như sau: \\[\\begin{align} \\mathbb{E}(S_N|\\text{x}_i) &amp;= \\mathbb{E}(N|\\text{x}_i) \\cdot \\mathbb{E}(Y|\\text{x}_i) \\\\ &amp;= exp(\\beta^F_{0,i} + \\beta^F_{1,i} \\cdot Age_i + \\beta^F_{2,i} \\cdot Gender_i) \\cdot \\end{align}\\] "],["tính-toán-phí-bảo-hiểm-thuần-bằng-mô-hình-tần-suất---mức-độ-nghiêm-trọng..html", "Chương 4 Tính toán phí bảo hiểm thuần bằng mô hình tần suất - mức độ nghiêm trọng. 4.1 Dữ liệu để xây dựng mô hình 4.2 Phân tích khai phá dữ liệu 4.3 Mô hình tuyến tính tổng quát cho tần suất. 4.4 Xây dựng mô hình tuyến tính tổng quát nhiều biến 4.5 Mô hình tuyến tính tổng quát cho biến mức độ nghiêm trọng. 4.6 Xác định phí bảo hiểm thuần và xác thực mô hình 4.7 Kết luận", " Chương 4 Tính toán phí bảo hiểm thuần bằng mô hình tần suất - mức độ nghiêm trọng. Tính toán phí của các sản phẩm bảo hiểm là một công việc phức tạp đòi hỏi phải kết hợp nhiều yếu tố khác nhau. Trước hết dữ liệu lịch sử phải được phân tích chính xác, các xu hướng kinh tế xã hội cũng phải được xác định và thậm chí hoạt động của các công ty cạnh tranh cũng phải được tính đến. Các chuyên gia tính toán (hay các actuary) được đào tạo bài bản có kiến thức trong tất cả các lĩnh vực này và có khả năng đề xuất những nội dung cần thiết để phát triển và thực hiện thành công chiến lược định giá sản phẩm bảo hiểm. Trong phần này, chúng tôi sẽ minh họa quá trình tính toán ra một trong những nền tảng cơ bản nhất của một quá trình định giá, đó là xác định phí bảo hiểm thuần (Net premium). Chúng tôi sẽ xác định các khoản phí bảo hiểm thuần này dựa trên các mô hình tuyến tính tổng quát về tần suất và mức độ nghiêm trọng. Quá trình xây dựng mô hình sẽ được minh họa thông qua tất cả các giai đoạn: xác định đặc điểm dữ liệu, khai phá dữ liệu, phân tích đơn biến và đa biến, kết hợp tần suất và mức độ nghiêm trọng thành phí bảo hiểm thuần, và cuối cùng là xác thực mô hình. Các kỹ thuật mà chúng tôi minh họa có thể áp dụng rộng rãi và chúng tôi khuyến khích bạn đọc thực hành thông qua các đoạn câu lệnh được viết bằng phần mềm R. Các chuyên gia tính toán phân tích dữ liệu lịch sử và giải thích các xu hướng kinh tế xã hội để xác định mức giá hợp lý của sản phẩm bảo hiểm. Những tính toán của Actuary là nền tảng cho mức giá cuối cùng mà công ty đưa ra cho khách hàng của mình. Đưa ra mức giá cuối cùng phải kết hợp nhiều yếu tố, chẳng hạn như hành động của đối thủ cạnh tranh, chiến lược tăng trưởng và sự hài lòng của người tiêu dùng, … Do đó, các chuyên gia tính toán, các nhà bảo lãnh phát hành, phòng tiếp thị phân phối sản phẩm, bộ phận tiếp nhận yêu cầu bồi thường, và ban quản lý công ty phải cùng nhau hợp tác trong việc định giá sản phẩm. Các đối tượng đa dạng này đều phải hiểu rõ các hướng tiếp cận về định giá sản phẩm để có thể đưa ra quyết định chung. Trong các phần này của cuốn sách, chúng ta sẽ tập trung vào các giai đoạn đầu tiên của quá trình hình thành giá của sản phẩm bào hiểm đó là xây dựng, cải tiến, và mô hình. Kết quả của các quá trình này là tính toán ra phí bảo hiểm thuần dựa trên dữ liệu lịch sử và mô hình tuyến tính tổng quát. Sẽ có hai mô hình được xây dựng, một mô hình dành cho tần suất xảy ra sự kiện bảo hiểm và mô hình còn lại sẽ có biến mục tiêu là mức độ nghiêm trọng. Vì phí bảo hiểm thuần chỉ phản ánh dữ liệu lịch sử nên sẽ không phù hợp để sử dụng làm dự báo giá cho tương lai do không tính toán đến các xu hướng kinh tế xã hội trong khoảng thời gian tiếp theo. Phí bảo hiểm thuần cũng không tính toán đến các chi phí, chi phí vốn rủi ro, hay lợi nhuận biên cần thiết để giúp công ty tồn tại trên thị trường. Chương sách này được cấu trúc như sau: trước hết, chúng tôi mô tả các đặc điểm chính của tập dữ liệu mà chúng ta sử dụng làm cơ sở xây dựng mô hình. Điều này giúp bạn đọc có hiểu biết tổng quan về dữ liệu lịch sử. Tiếp theo, chúng tôi thực hiện các phân tích khai phá các biến trong tập dữ liệu. Đây là tập dữ liệu về bào hiểm đối với các xe ô tô chở khách tư nhân có nhiều đặc điểm điển hình mà bạn sẽ gặp phải mỗi khi làm việc với dữ liệu bảo hiểm. Những hiểu biết về dữ liệu bạn thu được khi khai phá dữ liệu về các biến riêng và mối quan hệ giữa các biến sẽ phục vụ tốt cho bạn trong giai đoạn xây dựng mô hình. Sau phân tích khai phá, chúng ta sẽ bắt đầu xây dựng các mô hình: mô hình cho tần suất và và mô hình cho mức độ nghiêm trọng tương ứng. Các mô hình sẽ được xây dựng từ đơn giản đến phức tạp, bắt đầu với các mô hình một biến và chuyển sang phân tích mô hình đa biến. Những mô hình chúng tôi xây dựng không nhất thiết phải là những mô hình tốt nhất và chúng tôi khuyến khích bạn đọc tự khám phá và cố gắng tạo ra những mô hình tốt hơn. Sau cùng, chúng ta sẽ kết hợp các mô hình tần suất và mức độ nghiêm trọng để tạo ra phí bảo hiểm thuần túy và xác thực mô hình trên tập dữ liệu ngoài mẫu. 4.1 Dữ liệu để xây dựng mô hình Tập dữ liệu “pricing-modeling-dataset.csv” được sử dụng làm dữ liệu để chúng ta phân tích và xây dựng các mô hình tuyến tính tổng quát. Bộ dữ liệu bao gồm thông tin về các hợp đồng bảo hiểm ô tô chở khách thương mại và chứa cả thông tin về yêu cầu bồi thường. Dữ liệu được quan sát trong các năm từ 2010 đến 2013. Có tổng cộng 40,760 hàng và 24 biến. dat&lt;-read_csv(&quot;../KHDL_KTKD Final/Dataset/pricing-modeling-dataset.csv&quot;) head(dat) ## # A tibble: 6 × 24 ## pol.id year exposure nb.rb driver.age driver.gender marital.status ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; ## 1 POL0001 2010 1 RB 63 Male Married ## 2 POL0002 2010 1 NB 33 Male Married ## 3 POL0003 2010 1 RB 68 Male Married ## 4 POL0004 2010 0.0833 RB 68 Male Married ## 5 POL0005 2010 1 RB 68 Male Married ## 6 POL0006 2010 0.0833 RB 68 Male Married ## # ℹ 17 more variables: yrs.licensed &lt;dbl&gt;, ncd.level &lt;dbl&gt;, region &lt;dbl&gt;, ## # body.code &lt;chr&gt;, vehicle.age &lt;dbl&gt;, vehicle.value &lt;dbl&gt;, seats &lt;dbl&gt;, ## # ccm &lt;dbl&gt;, hp &lt;dbl&gt;, weight &lt;dbl&gt;, length &lt;dbl&gt;, width &lt;dbl&gt;, height &lt;dbl&gt;, ## # fuel.type &lt;chr&gt;, prior.claims &lt;dbl&gt;, clm.count &lt;dbl&gt;, clm.incurred &lt;dbl&gt; Cần lưu ý là một hàng dữ liệu có thể thể hiện nhiều yêu cầu bồi thường từ một đối tượng được bảo hiểm. Biến \\(clm.count\\) đo lường số lượng yêu cầu bồi thường và biến \\(clm.incurred\\) là tổng số tiền thanh toán yêu cầu bồi thường và bao gồm cả các khoản cần phải thanh toán trong tương lai. Các biến độc lập của dữ liệu có thể được nhóm thành bốn loại: biến điều khiển, biến đặc điểm người lái, biến đặc điểm địa lý, và biến đặc điểm phương tiện. Bảng dưới đây cho biết tên các biến trong tập dữ liệu Table 4.1: Các biến trong dữ liệu lịch sử Biến mục tiêu Biến điều khiển Đặc điểm người lái Đặc điểm phương tiện Đặc điểm địa lý clm.count pol.id nb.rb body.code region clm.incurred year driver.age vehicle.age exposure driver.gender vehicle.value marital.status seats yrs.licensed ccm ncd.level hp prior.claims weight length width height fuel.type Biến \\(year\\) cho biết năm (năm dương lịch) mà xe ô tô chở khách được bảo hiểm và biến \\(exposure\\) đo lường khoảng thời gian (đo bằng năm) mà xe ô tô được bảo vệ trong năm dương lịch. Chúng ta chỉ có một biến địa lý là \\(region\\) cho chúng ta biết địa điểm (gara đăng ký) của xe. Điều đáng tiếc là biến \\(region\\) đã được mã hóa thành số và chúng ta không có bất kỳ thông tin nào về mối liên hệ về không gian của các vùng này. Đây là một nhược điểm đáng kể đối với tập dữ liệu mà chúng ta có. Xin được nhắc lại rằng việc chuẩn bị dữ liệu tốt trước khi xây dựng mô hình là rất quan trọng nên loại bỏ biến chỉ thực hiện khi chúng ta chắc chắn rằng biến không có chứa thông tin hữu ích. Các biến đặc tính của người lái xe bao gồm độ tuổi (\\(driver.age\\)), giới tính (\\(driver.gender\\)) của người điều khiển phương tiện, tình trạng hôn nhân (\\(marital.status\\)), số năm mà người điều khiển phương tiện đã được cấp phép (\\(yrs.licensed\\)), mức chiết khấu khi không yêu cầu bồi thường \\(ncd.level\\) (giá trị cao hơn phản ánh mức chiết khấu lớn hơn khi không có bất kỳ yêu cầu nào) và số lượng yêu cầu gửi trước đó \\(prior.claims\\). Biến \\(nb.rb\\) cho chúng ta biết hợp đồng này là hoạt động kinh doanh mới (nb) hay hoạt động kinh doanh tái tục (rb). Các biến đặc tính của xe đo lường các thuộc tính khác nhau như kiểu dáng thân xe (\\(body.code\\)); tuổi và giá trị của xe (\\(vehicle.age\\) và \\(vehicle.value\\)); số lượng chỗ ngồi (\\(seats\\)); và trọng lượng (\\(weight\\)), chiều dài (\\(length\\)), chiều rộng (\\(width\\)) và chiều cao (\\(height\\)) của xe. Các biến \\(ccm\\), \\(hp\\) và \\(fuel.type\\) lần lượt đo kích thước của động cơ theo xăng-ti-mét khối, mã lực và loại nhiên liệu (xăng, dầu diesel hoặc khí hóa lỏng). Như đã giới thiệu ở trên, hai biến mục tiêu là \\(clm.count\\) và \\(clm.incurred\\), cho biết số lần gửi yêu cầu bồi thường và tổng chi phí cuối cùng của những yêu cầu đó. Tất cả các biến trong tập dữ liệu đều có thể được phân loại là liên tục hoặc rời rạc. Các bảng dưới đây trình bày một số thông tin và chỉ số thống kê cho 14 biến liên tục và 12 biến rời rạc: Table 4.2: Các biến kiểu số Tên biến Trung bình Phương sai Giá trị min Giá trị max Trung vị exposure 0.51 0.27 0.08 1.00 0.50 driver.age 44.55 10.78 18.00 93.00 44.00 yrs.licensed 3.21 1.89 1.00 10.00 3.00 vehicle.age 3.26 2.59 0.00 18.00 3.00 vehicle.value 23.50 8.89 4.50 132.60 22.10 ccm 1670.69 390.12 970.00 3198.00 1560.00 hp 86.38 19.62 42.00 200.00 75.00 weight 1364.22 222.01 860.00 2275.00 1320.00 length 4.32 0.36 1.80 6.94 4.28 width 1.78 0.10 1.48 2.12 1.74 height 1.81 0.09 1.42 2.52 1.82 prior.claims 0.83 1.33 0.00 20.00 0.00 clm.count 0.08 0.30 0.00 5.00 0.00 clm.incurred 66.52 406.23 0.00 11683.58 0.00 Table 4.3: Các biến kiểu rời rạc Tên biến Số giá trị rời rạc Giá trị mode Các giá trị điển hình year 4 2012 2010,2011,2012,2013 nb.rb 2 NB NB,RB driver.gender 2 Male Female,Male marital.status 4 Married Divorced,Married,Single,Widow ncd.level 6 1 1,2,3,4,5 region 38 17 1,2,3,4,5 body.code 8 A A,B,C,D,E seats 8 5 2,3,4,5,6 fuel.type 3 Diesel Diesel,Gasoline,LPG Thống kê chung về tần suất và mức độ nghiêm trọng theo năm được cho trong bảng phía dưới: Table 4.4: Tần suất và mức độ nghiêm trọng trung bình theo năm Năm Exposure Số yêu cầu Tổng giá trị Tần suất Mức độ nghiêm trọng 2010 3661.9 422 287868.9 0.115 78.612 2011 5221.7 551 314430.6 0.106 60.216 2012 6527.2 1278 1021151.8 0.196 156.446 2013 5386.2 1180 1087735.2 0.219 201.949 Total 20797.1 3431 2711186.6 0.165 130.364 Lưu ý rằng khối lượng kinh doanh đã tăng khoảng 78% từ năm 2010 đến năm 2012 và sau đó giảm 17% vào năm 2013. Tần suất trong hai năm đầu tiên là khoảng 11% và sau đó tăng đáng kể lên khoảng 20%. Mức độ nghiêm trọng trung bình trong tất cả các năm dương lịch là 790, nhưng có mức tăng mạnh theo thời gian, ngoại trừ năm 2011. Thông thường quá trình xây dựng và xác thực mô hình sẽ cần chia dữ liệu của thành ba phần: tập dữ liệu huấn luyện (training dataset), tập dữ liệu kiểm tra mô hình (test dataset) và tập dữ liệu xác thực mô hình (validation dataset). Lưu ý rằng việc phân chia dữ liệu thành ba phần chỉ khả thi khi có một lượng lớn dữ liệu. Trong trường hợp của dữ liệu ở trên, chúng ta chỉ có khoảng 41.000 quan sát trong bốn năm dương lịch. Đây là một tập dữ liệu không đủ lớn, vì vậy chúng tôi sẽ sử dụng phương pháp tập xác thực. Thay vì chia dữ liệu thành ba tập, chúng ta sẽ chỉ chia dữ liệu thành hai tập: tập huấn luyện và tập xác thực. Tập dữ liệu huấn luyện để phát triển và thử nghiệm các mô hình chứa 70% dữ liệu. 30% dữ liệu được sử dụng để kiểm tra mô hình. Trong xác thực chéo, chúng tôi chia dữ liệu huấn luyện của mình thành năm tập hợp con (5-folds) và gắn nhãn cho các tập này từ 1 đến 5. Tham số cuối cùng của mô hình được sử dụng là giá trị trung bình của các tham số được ước lượng ra từ mỗi lần xác thực chéo. 4.2 Phân tích khai phá dữ liệu Trong phần này, chúng ta bắt đầu bằng cách khai phá các biến riêng lẻ để hiểu rõ hơn về thông tin có trong tập dữ liệu của mình. Trong quá trình phân tích dữ liệu, chúng ta sẽ tập trung vào việc tìm hiểu mức độ phổ biến của từng biến, loại giá trị mà mỗi biến nhận, cách mã hóa các giá trị còn thiếu và mối quan hệ qua lại giữa các biến. 4.2.1 Biến tần suất và mối liên hệ đến các biến khác Từ phần trước, chúng ta biết rằng tần suất chung của toàn bộ tập dữ liệu là 16,5%. Do chúng ta xây dựng mô hình dựa trên cách tiếp cận xác thực chéo nên dữ liệu xây dựng mô hình chỉ bao gồm 70% dữ liệu hiện có. Chúng ta chia dữ liệu một cách ngẫu nhiên như sau # Đổi các biến rời rạc về kiểu factor factor.variable&lt;-c(&quot;year&quot;,&quot;nb.rb&quot;,&quot;driver.gender&quot;,&quot;marital.status&quot;,&quot;ncd.level&quot;,&quot;region&quot;, &quot;body.code&quot;,&quot;seats&quot;,&quot;fuel.type&quot;) dat&lt;-as.data.frame(dat) for (i in 1:ncol(dat)){ if(names(dat)[i] %in% factor.variable){ dat[,i]&lt;-as.factor(dat[,i]) } } # Chia dữ liệu thành hai phần, dữ liệu huấn luyện mô hình và dữ liệu xác thực mô hình set.seed(10) train.index&lt;-sample(1:nrow(dat),size = round(0.7*nrow(dat),0),replace = FALSE) training.dat&lt;-dat[train.index,] test.dat&lt;-dat[-train.index,] # Tần suất trung bình trên tập dữ liệu huấn luyện sum(training.dat$clm.count)/sum(training.dat$exposure) ## [1] 0.1635727 Trên tập dữ liệu huấn luyện, tần suất trung bình là 16,35% rất gần với tần suất chung ở phần trước. Quá trình khai phá dữ liệu là quá trình tìm hiểu biến tần suất phụ thuộc như thế nào vào các biến số mà chúng ta có trong dữ liệu. Hãy bắt đầu bằng cách xem xét biến \\(nb.rb\\). Đây là một biến chỉ báo cho chúng ta biết hợp đồng bảo hiểm là hoạt động khai thác mới (NB) hay là hợp đồng tái tục (RB). Tần suất trong tập dữ liệu huấn luyện của chúng tôi theo chỉ số khai thác mới hoặc tái tục này nằm trong bảng dưới đây Table 4.5: Tần suất trung bình theo năm của hợp đồng khai thác mới và tái tục Năm HĐ mới/Tái tục Exposure Số yêu cầu Tần suất 2010 NB 2477.3 306 0.124 2010 RB 1184.6 116 0.098 2011 NB 3475.4 440 0.127 2011 RB 1746.3 111 0.064 2012 NB 4389.6 934 0.213 2012 RB 2137.7 344 0.161 2013 NB 3762.1 953 0.253 2013 RB 1624.1 227 0.140 Total NB 14104.4 2633 0.187 Total RB 6692.7 798 0.119 Có thể thấy rằng trong dữ liệu đào tạo, tần suất trung bình của với hợp đồng khai thác mới là 18,7% và của các hợp đồng tái tục là 11,9%. Đây là một sự khác biệt đáng kể, do đó biến \\(rb.nb\\) này là một lựa chọn tốt để đưa vào mô hình. Tiếp theo, chúng ta quan tâm đến biến vị trí địa lý \\(region\\). Mặc dù vị trí địa lý đã được mã hóa bằng các số tự nhiên từ 1 đến 38 và chúng ta không biết được vị trí thực sự của các vùng. Tuy nhiên, có sự phân bố không đồng đều về tần suất xảy ra tai nạn giữa các vùng địa lý theo thời gian. Thật vậy, hình vẽ dưới đây mô tả điều đó Có thể thấy rằng có sự khác nhau rõ rệt về tần suất xảy ra tai nạn giữa các vùng, và tần suất cũng có sự thay đổi theo thời gian. Do đó, không nên loại bỏ biến vùng ra khỏi dữ liệu xây dựng mô hình. Tiếp theo chúng ta xem xét \\(driver.age\\). Biến này cho chúng ta biết tuổi của người điều khiển chính phương tiện. Trong dữ liệu huấn luyện mô hình, chúng ta có độ tuổi từ 18 đến 89 và tuổi 93(!), tổng cộng có 73 độ tuổi duy nhất. Khi gặp dữ liệu như vậy, chúng ta nên nghi ngờ những độ tuổi rất cao này và cần kiểm tra xem dữ liệu có chính xác không. Ngoài ra, chúng ta cũng nên kiểm tra tổng số exposure theo từng độ tuổi. Có thể thấy rằng khi tổng số exposure nhỏ thì tần suất có biến động rất mạnh, điển hình là độ tuổi dưới 25 và trên 60. Độ tuổi có tần suất tai nạn cao nhất không được thể hiện trong đồ thị ở trên là tuổi 19 với tần suất là 182%, tuy nhiên tổng exposure cho độ tuổi này chỉ là 2,2 năm nên tần suất không có ý nghĩa thống kê. Nhìn chung có sự giảm dần của tần suất xảy ra tai nạn khi độ tuổi trung bình. Bạn đọc có thể quan sát thấy rằng đường thẳng mô tả mối quan hệ tuyến tính giữa tần suất và độ tuổi có độ dốc âm. Như vậy \\(driver.age\\) cũng là biến cần đưa vào mô hình. Các biến liên quan đến đặc điểm người lái xe còn có giới tính của người lái xe (\\(driver.gender\\)) và tình trạng hôn nhân (\\(marital.status\\). Mối liên hệ của các biến và tần suất được mô tả như đồ thị dưới đây Có thể thấy rằng tần suất gây ra tai nạn của lái xe nữ là cao hơn so với lái xe nam, sự khác biệt là tương đối rõ trong nhóm những người đã lập gia đình hoặc chưa từng lập gia đình. Cũng giống như kinh nghiệm nghiên cứu từ nhiều dữ liệu khác, nhóm những người góa vợ/chồng có tần suất gây ra tai nạn cao hơn đáng kể so với nhóm khác. Có thể nhận xét rằng tình trạng hôn nhân và giới tính của người lái xe có ảnh hưởng đến tần suất mặc dù ảnh hưởng không rõ ràng như các biến khác. Chúng ta có thể tiếp tục quá trình trên cho các biến khác liên quan đến người lái xe. Tuy nhiên, mục tiêu cuối cùng sẽ là xây dựng mô hình cho biến tần suất, do đó, bạn đọc có thể dựa trên các nguyên tắc ở trên để nghiên cứu mối liên hệ của các biến khác lên tần suất xảy ra tai nạn. Quá trình khai phá dữ liệu có ý nghĩa quan trọng trong việc lựa chọn đưa biến vào trong mô hình nhất là với các dữ liệu có nhiều biến. Bạn đọc có thể tiếp tục quá trình này với các biến liên quan đến đặc điểm của xe. 4.2.2 Biến mức độ nghiêm trọng và mối liên hệ với các biến khác Dữ liệu sử dụng để xây dựng mô hình cho mức độ nghiêm trọng chỉ bao gồm các hợp đồng có xảy ra yêu cầu bồi thường. Trong dữ liệu dùng để huấn luyện mô hình, có 2209 hợp đồng nằm trong phạm vi. Giá trị tiền bồi thường trung bình trên mỗi yêu cầu bồi thường là 800,57 \\[\\begin{align} \\cfrac{\\textit{Tổng chi phí}}{\\textit{Tổng số yêu cầu}} = \\cfrac{1.906.958}{2382} = 800,57 \\end{align}\\] Trước hết, chúng ta xem xét biến \\(nb.rb\\) có tác động lên mức độ nghiêm trọng hay không. Bảng dưới đây cho biết số lượng yêu cầu bồi thường, tổng mức bồi thường và giá trị tiền bồi thường trung bình của các hợp đồng bán mới và các hợp đồng tái tục. Table 4.6: Mức độ nghiêm trọng trung bình của hợp đồng khai thác mới và tái tục HĐ mới/Tái tục Tổng giá trị Số yêu cầu Mức nghiêm trọng NB 1530245.4 1848 828.055 RB 376712.6 534 705.454 Có thể thấy rằng mức độ nghiêm trọng trung bình của các hợp đồng khai thác mới (828) cao hơn đáng kể so với các hợp đồng tái tục (705). Điều này cho thấy biến \\(nb.rb\\) là biến có ý nghĩa giải thích trong mô hình hóa mức độ nghiêm trọng của yêu cầu bảo hiểm. Việc phân tích các biến liên quan đến đặc điểm của người lái xe hoàn toàn được thực hiện tương tự như đối với biến tần suất nên chúng tôi sẽ không lặp lại. Việc lựa chọn các biến đưa vào mô hình tần suất sẽ được tiếp tục thảo luận trong phần xây dựng mô hình. 4.3 Mô hình tuyến tính tổng quát cho tần suất. Khi phân tích khai phá dữ liêu, chúng ta biết rằng biến tần suất tập dữ liệu huấn luyện có giá trị trung bình là 16,4% và có một số biến có thể là phù hợp để đưa vào mô hình bao gồm tuổi của người lái xe hoặc chỉ số cho biết hợp đồng là bán mới hay tái tục. Chúng ta sẽ bắt đầu xây dựng mô hình tần số bằng cách thực hiện phân tích mô hình có một biến độc lập duy nhất, sau đó sẽ chuyển sang xây dựng mô hình có nhiều biến độc lập bằng cách bổ sung thêm các biến có ý nghĩa khác. Xây dựng mô hình có một biến độc lập là bước quan trọng để chúng ta có nhận định chính xác về khả năng giải thích của các biến độc lập và cách biến đổi các biến độc lập để tăng khả năng giải thích trước khi xây dựng mô hình có nhiều biến độc lập Trước khi nói đến biến độc lập, chúng ta cần đưa ra lựa chọn cho hàm liên kết và phân phối cho biến tần suất. Đối với hầu hết các mô hình tính toán phí bảo hiểm thuần, chúng ta muốn có biến phụ thuộc được giải thích bởi biến phụ thuộc thông qua quy tắc nhân, do đó chúng ta sẽ sử dụng hàm liên kết \\(log()\\). Đối với phân phối biến phụ thuộc, chúng ta có thể chọn giữa phân phối Poisson, phân phối nhị thức âm hoặc phân phối nhị thức do biến tần suất là biến dạng đếm. Hãy nhớ rằng mục tiêu của chúng ta là ước tính tần suất trung bình và mặc dù các giả thiết về phân phối là cần thiết nhưng không quan trọng bằng việc tìm ra các biến độc lập chính xác để đưa vào mô hình. Nếu phân phối xác suất của số lượng yêu cầu bồi thường là Poisson thì phương sai của biến phụ thuộc phải bằng giá trị trung bình. Tuy nhiên, trong trường hợp dữ liệu chúng ta đang có, và trong hầu hết các tập dữ liệu bảo hiểm, phương sai của tần suất thường lớn hơn giá trị trung bình. Hiện tượng này được gọi là phân tán quá mức. Bạn đọc nên lựa chọn phân phối nhị thức âm trong các trường hợp như vậy. Tuy nhiên, phân phối nhị thức âm không nằm trong nhóm các phân phối kiểu mũ nên để tránh sự phức tạp không cần thiết, chúng tôi vẫn chọn phân phối Poisson cho biến phụ thuộc. Hàm liên kết được sử dụng là hàm log. 4.3.1 Mô hình tuyến tính tổng quát với một biến giải thích. Mô hình tuyến tính tổng quát đơn giản nhất mà chúng ta có thể áp dụng cho dữ liệu tần suất là mô hình chỉ có duy nhất hệ số chặn. Mô hình này sẽ cho biết tần suất trung bình của biến phụ thuộc. Chúng ta xây dựng mô hình với biến phụ thuộc có phân phối Poisson, với hàm liên kết log, và chỉ có hệ số chặn như sau ## ## Call: ## glm(formula = clm.count ~ 1, family = poisson(link = &quot;log&quot;), ## data = training.dat, offset = log(exposure)) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -0.5720 -0.4953 -0.3692 -0.2335 4.5865 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -1.81050 0.02049 -88.36 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for poisson family taken to be 1) ## ## Null deviance: 11573 on 28531 degrees of freedom ## Residual deviance: 11573 on 28531 degrees of freedom ## AIC: 16097 ## ## Number of Fisher Scoring iterations: 6 Giá trị ước lượng được của hệ số chặn là \\(-1.8105\\) và giá trị này khác 0 một cách có ý nghĩa thống kê. Mô hình tuyến tính tổng quát trong trường hợp này có thể được viết như sau: \\[\\begin{align} &amp; Y_i \\sim \\mathcal{P}(\\lambda_i) \\\\ &amp; \\log(\\lambda_i) = \\log(e_i) + \\beta_0 \\end{align}\\] trong đó \\(e_i\\) là giá trị của biến \\(exposure\\) của hợp đồng thứ \\(i\\). Nói cách khác, nếu hợp đồng được quan sát đủ 1 năm (\\(e_i = 1\\)) thì giá trị trung bình của tần suất xảy ra tai nạn là \\[\\begin{align} \\lambda_i = \\exp\\left(\\log(1) + \\beta_0\\right) = \\exp(-1.8105) = 0.164 \\end{align}\\] Giá trị này rất gần với giá trị trung bình của biến tần suất mà chúng ta đã tính trong phần phân tích khai phá dữ liệu. Để xây dựng mô hình có một biến phụ thuộc, chúng ta sẽ sử dụng các tiêu chí để so sánh mô hình được để cập trong chương mô hình tuyến tính tổng quát, bao gồm có thước đo \\(deviance\\) và chỉ tiêu AIC. Nhắc lại rằng thước đo \\(deviance\\) đo khoảng cách từ giá trị log-likelihood của một mô hình tuyến tính tổng quát đến giá trị log-likelihood lớn nhất có thể có được khi sử dụng cùng một phân phối của biến phụ thuộc trong khi AIC là được tính từ giá trị của hàm log-likelihood có điều chỉnh theo số lượng tham số. Mô hình tuyến tính tổng quát có thước đo \\(deviance\\) và chỉ tiêu AIC nhỏ hơn là các mô hình phù hợp hơn với dữ liệu. Trước khi xây dựng mô hình, bạn đọc cần lưu ý về biến độc lập kiểu số và biến độc lập kiểu factor. Biến \\(year\\) trong mô hình đang được coi là biến kiểu factor với 4 giá trị khác nhau là 2010, 2011, 2012, và 2014, nghĩa là khi chúng ta sử dụng \\(year\\) như một biến độc lập trong mô hình, sẽ có 4 tham số độc lập được ước lượng dành cho biến \\(year\\), mỗi tham số đại diện cho 1 giá trị. Nếu chúng ta coi biến \\(year\\) như một biến kiểu số, khi xây dựng mô hình sẽ chỉ có một tham số ứng với biến \\(year\\) và thêm 1 hệ số chặn. Với một số biến trong mô hình, chúng ta vừa có thể coi biến đó là kiểu số và vừa có thể coi biến đó là biến kiểu rời rạc. Danh sách các biến nằm trong bảng dưới đây Table 4.7: Các biến vừa có thể là biến kiểu số vừa là rời rạc Tên biến Số giá trị riêng biệt Miền giá trị yrs.licensed 9 Các số tự nhiên từ 1 đến 9 vehicle.age 19 Các số tự nhiên từ 0 đến 18 prior.claims 18 Các số tự nhiên từ 0 đến 20 Đối với các biến này, chúng ta sẽ lưu trong dữ liệu huấn luyện mô hình đồng thời dưới dạng số (tên biến có \\(.num\\) và dưới dạng factor (tên biến có \\(.f\\)). training.dat&lt;-training.dat%&gt;%mutate(yrs.licensed.num = yrs.licensed, vehicle.age.num = vehicle.age, prior.claims.num = prior.claims, yrs.licensed.f = as.factor(yrs.licensed), vehicle.age.f = as.factor(vehicle.age), prior.claims.f = as.factor(prior.claims)) %&gt;% select(-yrs.licensed,-vehicle.age,-prior.claims) # thực hiện biến đổi tương tự trên tập xác thực test.dat&lt;-test.dat%&gt;%mutate(yrs.licensed.num = yrs.licensed, vehicle.age.num = vehicle.age, prior.claims.num = prior.claims, yrs.licensed.f = as.factor(yrs.licensed), vehicle.age.f = as.factor(vehicle.age), prior.claims.f = as.factor(prior.claims)) %&gt;% select(-yrs.licensed,-vehicle.age,-prior.claims) Chúng ta ước lượng các mô hình GLM với một biến độc lập, tính toán \\(AIC\\) và \\(deviance\\) và mô tả giá trị \\(deviance\\) và \\(AIC\\) trên một đồ thị rải điểm như sau exposure&lt;-training.dat$exposure variable.list&lt;-names(training.dat) remove.list&lt;-c(&quot;pol.id&quot;,&quot;exposure&quot;,&quot;clm.count&quot;,&quot;clm.incurred&quot;) variable.list&lt;-variable.list[!(variable.list %in% remove.list)] deviance &lt;- rep(0,length(variable.list)) AIC &lt;- rep(0,length(variable.list)) for (i in 1:length(variable.list)){ x &lt;- variable.list[i] simple.dat&lt;-select(training.dat,x,clm.count) simple.glm&lt;-glm(clm.count~., family = poisson(link = &quot;log&quot;), data = simple.dat, offset = log(exposure)) AIC[i]&lt;-simple.glm$aic deviance[i]&lt;-simple.glm$deviance } result&lt;-data.frame(variable_names = variable.list, aic = AIC, deviance = deviance) result%&gt;%ggplot()+geom_point(aes(x = AIC, y = deviance), shape = 21)+ geom_label_repel(aes(x = AIC, y = deviance, label = variable.list))+ ggtitle(&quot;So sánh các mô hình GLM có một biến giải thích (1)&quot;)+ theme_minimal() Đồ thị rải điểm mô tả chỉ tiêu AIC trên trục x và giá trị deviance trên trục y. Các biến giải thích tốt hơn sẽ xuất hiện ở góc dưới bên trái của đồ thị, nơi cả deviance và AIC đều có giá trị nhỏ. Chúng ta thấy các biến \\(ncd.level\\), \\(year\\) và \\(yrs.licensed\\) là nằm ở góc trái và phía dưới hơn các biến khác. Biến \\(driver.age\\) và \\(region\\) có tác động lên tần suất xảy ra tai nạn nhưng mô hình tuyến tính tổng quát xây dựng trên các biến này lại không có kết quả giống như ta mong muốn. Nguyên nhân là do - Biến \\(region\\) là biến kiểu rời rạc và có 38 giá trị riêng biệt dẫn đến việc xây dựng mô hình sẽ có quá nhiều tham số. - Biến \\(driver.age\\) có các giá trị từ 75 tuổi trở lên là có quá ít quan sát và không có tai nạn nào xảy ra. Đối với các biến kiểu rời rạc trong mô hình tuyến tính tổng quát, kinh nghiệm xây dựng mô hình là kết hợp các nhóm có cùng hệ số ước lượng gần nhau để tạo thành nhóm mới. Điều này giúp mô hình ước lượng có phương sai nhỏ hơn nhưng không làm giảm sai số của mô hình đi quá nhiều. Hình vẽ dưới đây cho biết hệ số ước lượng cho mỗi vùng khác nhau của biến \\(region\\). simple.dat&lt;-select(training.dat,region,clm.count) simple.glm&lt;-glm(clm.count~., family = poisson(link = &quot;log&quot;), data = simple.dat, offset = log(exposure)) dat1&lt;-data.frame(d.name = names(simple.glm$coefficients), coef = simple.glm$coefficients) dat1$d.name[1]&lt;-&quot;region1&quot; dat1$coef[2:38]&lt;-dat1$coef[2:38]+dat1$coef[1] dat1&lt;-arrange(dat1,-coef) dat1%&gt;%ggplot(aes(x = coef, y = d.name))+geom_point(shape=21)+ scale_y_discrete(limits = dat1$d.name)+theme_minimal()+ xlab(&quot;&quot;)+ylab(&quot;&quot;)+ggtitle(&quot;Hệ số của biến region trong mô hình GLM&quot;) Chúng ta có thể biến đổi biến \\(region\\) bằng cách nhóm các vùng có hệ số ước lượng tương tự nhau vào cùng nhóm để giảm số lượng tham số. Table 4.8: Nhóm các vùng theo hệ số ước lượng Tên biến mới Region R1 7,2 R2 20,22 R3 27,29,14,35 R4 11,37,12,30,28,15,19 R5 4,13,24,3,10,16 R6 1,38,34,31,21,32,25,23 R7 6,33,9,17 R8 8,26 Biến mới được tạo từ biến \\(region\\) được gọi tên là \\(region.f\\) được thêm vào dữ liệu như sau training.dat&lt;-mutate(training.dat, region.f = ifelse(region %in% c(7,2), &quot;R1&quot;, ifelse(region %in% c(20,22), &quot;R2&quot;, ifelse(region %in% c(27,29,14,35), &quot;R3&quot;, ifelse(region %in% c(11,37,12,30,28,15,19), &quot;R4&quot;, ifelse(region %in% c(4,13,24,3,10,16), &quot;R5&quot;, ifelse(region %in% c(1,38,34,31,21,32,25,23), &quot;R6&quot;, ifelse(region %in% c(6,33,9,17), &quot;R7&quot;,&quot;R8&quot;)))))))) # Thực hiện biến đổi tương tự trên tập xác thực test.dat&lt;-mutate(test.dat, region.f = ifelse(region %in% c(7,2), &quot;R1&quot;, ifelse(region %in% c(20,22), &quot;R2&quot;, ifelse(region %in% c(27,29,14,35), &quot;R3&quot;, ifelse(region %in% c(11,37,12,30,28,15,19), &quot;R4&quot;, ifelse(region %in% c(4,13,24,3,10,16), &quot;R5&quot;, ifelse(region %in% c(1,38,34,31,21,32,25,23), &quot;R6&quot;, ifelse(region %in% c(6,33,9,17), &quot;R7&quot;,&quot;R8&quot;)))))))) Có thể thấy rằng mô hình với biến \\(region.f\\) có chỉ tiêu AIC nhỏ hơn so với \\(region\\) vì số lượng tham số sử dụng chỉ là 8 tham số thay vì 38 tham số như ban đầu. Bạn đọc có thể tiếp tục quá trình phân tích đơn biến như phân tích đối với biến \\(region\\) để có các biến đầu vào tốt hơn trong mô hình nhiều biến. Với các phân tích đơn biến ở trên, chúng ta có thể kết luận rằng các biến \\(ncd.levels\\), \\(year\\), \\(nb.rb\\), \\(region.f\\), \\(yrs.licenced.f\\), \\(driver.age\\) và \\(prior.claims\\) là các biến có ý nghĩa nhất va có ảnh hưởng đến tần suất gây ra tai nạn. Lưu ý rằng biến \\(year\\) không phải là biến liên quan đến đặc điểm của người lái xe hay phương tiện được bảo hiểm. Trong các mô hình tần suất và mức độ nghiêm trọng, biến thời gian thường được gọi là biến điều khiển và luôn có mặt trong mô hình đa biến. 4.4 Xây dựng mô hình tuyến tính tổng quát nhiều biến Sau khi đã có ý tưởng tốt hơn về những biến giải thích phù hợp với dữ liệu, chúng ta có thể chuyển sang xây dựng các mô hình kết hợp nhiều hơn một biến giải thích. Về mặt lý thuyết, để tìm ra mô hình đa biến tốt, chúng ta có thể xem xét cả hai mô hình biến và chọn mô hình tốt nhất; sau đó có thể xem xét cả ba mô hình biến và lại chọn mô hình tốt nhất, v.v. Chiến lược này gọi là \\(forward-stepwise-selection\\). Tuy nhiên với số lượng biến chúng ta hiện có thì chiến lược này không khả thi Một chiến lược khác là xây dựng một mô hình có đầy đủ các biến sau đó lần lượt loại đi các biến không cần thiết. Mặc dù chiến lược này không yêu cầu về mặt tính toán nhưng nhược điểm chính là sự phụ thuộc vào thứ tự chúng ta loại bỏ đi các biến giải thích. Phương pháp khả thi nhất trong trường hợp hày là xây dựng mô hình đa biến được lựa chọn từ một tập hợp con các biến có ý nghĩa trong phân tích một biến sau đó cố gắng thêm các biến khác vào mô hình. Chúng ta cho mô hình với 7 biến giải thích \\(ncd.levels\\), \\(year\\), \\(nb.rb\\), \\(region.f\\), \\(yrs.licenced.f\\), \\(driver.age\\) và \\(prior.claims.f\\) là mô hình cơ sở và sẽ tìm kiếm các biến khác thêm vào mô hình nhằm cải thiện các chỉ tiêu như \\(deviance\\) và \\(AIC\\). Đồ thị trên cho thấy các biến có làm tăng chất lượng của mô hình là \\(body.code\\), \\(height\\), và \\(marital.status\\). Cách tốt nhất để đưa thêm biến độc lập vào mô hình cơ sở là thêm lần lượt từng biến vào mô hình sau đó và lặp lại các bước ở trên. Tuy nhiên, để tránh sự phức tạp không cần thiết, chúng ta sẽ đưa đồng thời cả ba biến vào mô hình sau đó thực hiện kiểm định \\(\\chi^2\\): hiệu số giữa \\(residual\\) \\(deviance\\) của mô hình sau khi thêm biến và mô hình cơ sở có phân phối xấp xỉ phân phối \\(\\chi^2\\) với bậc tự do \\(m_2 - m_1\\), với \\(m_2 - m_1\\) là số lượng tham số thêm vào trong mô hình mới. Biến \\(body.code\\) là biến kiểu factor có 8 giá trị riêng biệt, biết \\(height\\) là biến kiểu số, trong khi biến \\(marital.status\\) là biến kiểu factor có 4 giá trị riêng biệt, do đó thêm 3 biến vào mô hình sẽ làm cho số lượng tham số của mô hình tăng lên là \\((8-1) + 1 + (4-1) = 11\\) tham số. Table 4.9: Thước đo deviance của mô hình cơ sở và mô hình thêm biến Mô hình Residual Deviance Deviance giảm Bậc tự do Mô hình cơ sở 10884.01 Mô hình thêm biến 10829.02 54.99 11 Giá trị deviance giảm 54.99 sau khi thêm 11 tham số vào mô hình. Lưu ý rằng giá trị phân vị ngưỡng 99.99% của phân phối \\(\\chi^2(11)\\) là 37.37, nhỏ hơn 54.99, nên chúng ta có thể kết luận rằng việc thêm 3 biến \\(body.code\\), \\(height\\), và \\(marital.status\\) là có ý nghĩa thống kê. Bạn đọc có thể lặp lại các bước ở trên để tìm được thêm các biến có ý nghĩa đưa vào mô hình giải thích tần suất. 4.5 Mô hình tuyến tính tổng quát cho biến mức độ nghiêm trọng. Xây dựng mô hình cho mức độ nghiêm trọng khó khăn hơn xây dựng mô hình cho tần suất vì thứ nhất, có ít dữ liệu hơn và thứ hai, các giá trị quan sát được thường biến động lớn. Thông thường, phần lớn các hợp đồng có yêu cầu bồi thường có mức độ nghiêm trọng nhỏ và trong khi một số ít hợp đồng có mức độ nghiêm trọng rất lớn. Điều này thường dẫn đến phân phối của mức độ nghiêm trọng bị lệch phải, như được thể hiện trong biểu đồ ở dưới. Bạn đọc có thể thấy rằng gần như tất cả các quan sát đều tập trung ở phía bên trái của biểu đồ. Có rất ít giá trị lớn hơn 6.000; trên thực tế, chỉ có 11 hợp đồng có yêu cầu bồi thường có mức độ nghiêm trọng lớn hơn 6000 trong tổng số 2209 quan sát có yêu cầu bồi thường trong tập dữ liệu huấn luyện. Tương tự như khi xây dựng mô hình cho biến tần suất, chúng ta bắt đầu xây dựng mô hình cho biến mức độ nghiêm trọng bằng mô hình không có biến phụ thuộc. glm(clm.serverity ~1, family = Gamma(link = &quot;log&quot;), data = training.dat, weights = clm.count , subset = clm.count&gt;0) ## ## Call: glm(formula = clm.serverity ~ 1, family = Gamma(link = &quot;log&quot;), ## data = training.dat, weights = clm.count, subset = clm.count &gt; ## 0) ## ## Coefficients: ## (Intercept) ## 6.685 ## ## Degrees of Freedom: 2208 Total (i.e. Null); 2208 Residual ## Null Deviance: 4626 ## Residual Deviance: 4626 AIC: 36280 Mô hình không có biến giải thích có hệ số chặn là 6.685, nghĩa là giá trị trung bình của biến mức độ nghiêm trọng là \\(e^{6.685} = 800.31\\) tương tự như giá trị trung bình đã tính toán ở phần khai phá dữ liệu. Biến \\(year\\) kiểm soát tác động của thời gian lên mức độ nghiêm trọng, do đó chúng ta sẽ đưa biến này vào tất cả các mô hình cho mức độ nghiêm trọng. Các bước để xây dựng mô hình giống như khi chúng ta xây dựng mô hình cho tần suất: chúng ta cần tìm kiếm các biến giải thích (ngoài biến \\(year\\)) có khả năng dự đoán mức độ nghiêm trọng của các yêu cầu bồi thường. Quá trình này tương tự như phần trước nên chúng tôi sẽ cố gắng trình bày ngắn gọn nhất có thể. 4.5.1 Mô hình đơn biến cho mức độ nghiêm trọng Mô hình đơn biến được hiểu là mô hình bao gồm hệ số chặn, biến điều khiển \\(year\\) và một biến giải thích. Tương tự như khi xây dựng mô hình cho biến tần suất, chúng ta tính toán \\(deviance\\) và chỉ tiêu \\(AIC\\) cho các mô hình và biểu diễn kết quả trên một đồ thị rải điểm variable.list&lt;-names(training.dat) remove.list&lt;-c(&quot;pol.id&quot;,&quot;exposure&quot;,&quot;clm.count&quot;,&quot;clm.incurred&quot;,&quot;clm.serverity&quot;, &quot;year&quot;, &quot;region&quot;) variable.list&lt;-variable.list[!(variable.list %in% remove.list)] p&lt;-length(variable.list) v.clm.count&lt;-training.dat$clm.count deviance &lt;- rep(0,p+1) AIC &lt;- rep(0,p+1) for (i in 1:p){ x &lt;- variable.list[i] simple.dat&lt;-select(training.dat,year,x,clm.serverity) simple.glm&lt;-glm(clm.serverity~., family = Gamma(link = &quot;log&quot;), data = simple.dat, weights = v.clm.count, subset = v.clm.count&gt;0) AIC[i]&lt;-simple.glm$aic deviance[i]&lt;-simple.glm$deviance } simple.dat&lt;-select(training.dat,year,clm.serverity) simple.glm&lt;-glm(clm.serverity~., family = Gamma(link = &quot;log&quot;), data = simple.dat, weights = v.clm.count, subset = v.clm.count&gt;0) AIC[p+1]&lt;-simple.glm$aic deviance[p+1]&lt;-simple.glm$deviance result&lt;-data.frame(variable_names = c(variable.list,&quot;Null&quot;), aic = AIC, deviance = deviance, last.col = as.factor(c(rep(0,p),1))) result%&gt;%ggplot()+geom_point(aes(x = AIC, y = deviance,, size = last.col, fill = last.col), shape = 21)+ geom_label_repel(aes(x = AIC, y = deviance, label = variable_names))+ ggtitle(&quot;Mô hình GLM đơn biến cho mức độ nghiêm trọng&quot;)+ scale_fill_manual(values = c(&quot;white&quot;,&quot;black&quot;))+ scale_size_manual(values = c(2,3))+ theme_minimal()+ theme(legend.position = &quot;none&quot;) Mô hình “Null” là mô hình chỉ bao gồm biến \\(year\\) và hệ số chặn. Có thể thấy rằng việc thêm biến giải thích vào mô hình sẽ làm cho \\(deviance\\) giảm, nhưng chưa chắc chỉ số AIC sẽ giảm vì AIC tính đến số lượng tham số trong mô hình. Một số biến có làm giảm AIC của mô hình bao gồm có \\(ncd.level\\), \\(nb.rb\\), \\(marital.status\\), \\(yrs.licensed.num\\), \\(driver.gender\\). 4.5.2 Mô hình nhiều biến cho mức độ nghiêm trọng Chúng ta xây dựng mô hình đa biến bao gồm 5 biến kể trên sau đó tìm kiếm thêm các biến khác. glm1&lt;-glm(clm.serverity ~ year + ncd.level+ nb.rb + marital.status + yrs.licensed.num + driver.gender, family = Gamma(link = &quot;log&quot;), data = training.dat, weights = clm.count, subset = clm.count&gt;0) summary(glm1) ## ## Call: ## glm(formula = clm.serverity ~ year + ncd.level + nb.rb + marital.status + ## yrs.licensed.num + driver.gender, family = Gamma(link = &quot;log&quot;), ## data = training.dat, weights = clm.count, subset = clm.count &gt; ## 0) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -3.9662 -1.5961 -0.6651 0.3050 3.7805 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 6.628362 0.227028 29.196 &lt;2e-16 *** ## year2011 -0.232547 0.106311 -2.187 0.0288 * ## year2012 0.128161 0.092530 1.385 0.1662 ## year2013 0.271938 0.094109 2.890 0.0039 ** ## ncd.level2 -0.237103 0.268439 -0.883 0.3772 ## ncd.level3 0.007723 0.073769 0.105 0.9166 ## ncd.level4 -0.123855 0.102547 -1.208 0.2273 ## ncd.level5 -0.215120 0.125589 -1.713 0.0869 . ## ncd.level6 -0.196879 0.114226 -1.724 0.0849 . ## nb.rbRB -0.086679 0.075003 -1.156 0.2479 ## marital.statusMarried 0.102740 0.204406 0.503 0.6153 ## marital.statusSingle 0.204259 0.241585 0.845 0.3979 ## marital.statusWidow 0.428399 0.283793 1.510 0.1313 ## yrs.licensed.num 0.002306 0.021181 0.109 0.9133 ## driver.genderMale -0.128635 0.086560 -1.486 0.1374 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for Gamma family taken to be 1.854572) ## ## Null deviance: 4626.1 on 2208 degrees of freedom ## Residual deviance: 4526.6 on 2194 degrees of freedom ## AIC: 36243 ## ## Number of Fisher Scoring iterations: 8 Có thể thấy rằng biến \\(yrs.licensed.num\\) có thể làm giảm AIC trong mô hình đơn biến nhưng trong mô hình đa biến biến này lại không có ý nghĩa. Chúng ta sẽ loại bỏ biến \\(yrs.licensed.num\\) ra khỏi mô hình đa biến. Các biến khác đều là các biến dạng factor và không phải tất cả các giá trị của biến factor đều có ý nghĩa thống kê. Chẳng hạn như \\(ncd.level3\\) gần như không có khác biệt với \\(ncd.level1\\). Hoặc các giá trị \\(Divorced\\) và \\(Married\\) của biến \\(marital.status\\) cũng không có sự khác biệt. Điều này gợi ý cho bạn đọc về việc tạo các biến \\(ncd.level\\) và \\(marital.status\\) mới có ý nghĩa thống kê hơn. Trong phần này của cuốn sách, để tránh sự phức tạp không cần thiết, chúng tôi sẽ giữ nguyên các biến \\(ncd.level\\) và \\(marital.status\\) ở trạng thái hiện tại. Chúng ta coi mô hình bao gồm 5 biến giải thích \\(year\\), \\(ncd.level\\), \\(nb.rb\\), \\(marital.status\\), và \\(driver.gender\\) là mô hình cơ sở để tìm kiếm thêm các biến giải thích khác. Đồ thị trên gợi ý cho chúng ta biết biến \\(vehicle.age.num\\) là một biến giải thích tốt có làm giảm chỉ tiêu AIC. Chúng ta thực hiện kiểm định \\(\\chi^2\\) để kiểm tra xem việc thêm biến vào có ý nghĩa thống kê hay không Table 4.10: Thước đo deviance của mô hình cơ sở và mô hình thêm biến Mô hình Residual Deviance Deviance giảm Bậc tự do Mô hình cơ sở 4526.664 Mô hình thêm biến 4519.061 7.6 1 Giá trị deviance giảm 7.6 sau khi thêm 1 tham số vào mô hình. Đây là giá trị phân vị ngưỡng 99.4% của phân phối \\(\\chi^2(1)\\) nên chúng ta có thể kết luận rằng việc thêm biến \\(vehicle.age.num\\) là có ý nghĩa thống kê. Bạn đọc có thể lặp lại các bước ở trên để tìm được thêm các biến có ý nghĩa đưa vào mô hình giải thích mức độ nghiêm trọng. 4.6 Xác định phí bảo hiểm thuần và xác thực mô hình Trong phần này, chúng ta kết hợp các mô hình tần suất và mức độ nghiêm trọng để xác định mức phí bảo hiểm thuần. Công thức xác định phí bảo hiểm thuần chỉ đơn giản là \\[\\begin{align} \\textit{Phí bảo hiểm thuần} = \\textit{Tần suất} \\times \\textit{Mức độ nghiêm trọng} \\end{align}\\] Chúng ta sử dụng mô hình tần suất và mô hình mức độ nghiêm trọng với các biến được xác định trong phần trước. Danh sách các biến được liệt kê trong bảng dưới đây. Table 4.11: Các biến sử dụng trong xác định phí bảo hiểm thuần Mô hình Danh sách biến Tần suất year, ncd.level, nb.rb, yrs.licensed.f, region.f, driver.age, prior.claims.f,body.code, height, marital.status Mức độ nghiêm trọng year, ncd.level, nb.rb, marital.status, driver.gender, vehicle.age.num Chúng ta thêm biến tần suất trung bình (\\(E.fre\\)), mức độ nghiêm trọng trung bình (\\(E.ser\\)) và phí thuần (\\(Net.prem\\)) vào dữ liệu huấn luyện mô hình. glm.fre&lt;-glm(clm.count~ year + ncd.level+ nb.rb+ yrs.licensed.f + region.f + driver.age + prior.claims.f + marital.status + body.code+ height, family = poisson(link = &quot;log&quot;), data = training.dat, offset = log(exposure)) glm.ser&lt;-glm(clm.serverity ~ year + ncd.level+ nb.rb + marital.status + driver.gender + vehicle.age.num, family = Gamma(link = &quot;log&quot;), data = training.dat, weights = clm.count, subset = clm.count&gt;0) ## Tính toán expected frequency và expected severity training.dat&lt;-mutate(training.dat, E.fre = exp(predict(glm.fre, training.dat)), E.ser = exp(predict(glm.ser, training.dat)), Net.prem = E.fre*E.ser) # Dự đoán expected frequency và expected severity trên test test.dat&lt;-mutate(test.dat, E.fre = exp(predict(glm.fre, test.dat)), E.ser = exp(predict(glm.ser, test.dat)), Net.prem = E.fre * E.ser) Chúng ta thực hiện so sánh giữa tổng phí thuần của tất cả các hợp đồng với tổng số tiền thực trả cho các hợp đồng trong tập dữ liệu huấn luyện. Không có gì ngạc nhiên khi tổng tần suất trung bình bằng tổng số yêu cầu bổi thường và tổng phí bảo hiểm thuần xấp xỉ tổng số tiền yêu cầu bồi thường thực tế do mô hình được xây dựng trên tập huấn luyện. Table 4.12: Giá trị thực tế và dự đoán trên dữ liệu huấn luyên mô hình Thực tế Dự đoán Tỷ lệ dự đoán/thực tế Tần suất yêu cầu bồi thường 2382 2382 100% Tổng chi phí bồi thường 1906958 1914962 100.42% Thước đo quan trọng nhất về hiệu quả của mô hình là khả năng dự đoán của mô hình trên tập dữ liệu được sử dụng để kiểm tra (\\(test.dat\\)). Tổng số lượng yêu cầu bồi thường và tổng chi phí bồi thường được dự đoán bằng mô hình tần suất - mức độ nghiêm trọng được so sánh với giá trị thực tế như ở bảng dưới đây Table 4.13: Giá trị thực tế và dự đoán trên dữ liệu huấn luyên mô hình Thực tế Dự đoán Tỷ lệ dự đoán/thực tế Tần suất yêu cầu bồi thường 1049.0 1004.69 95.78% Tổng chi phí bồi thường 804228.5 807962.62 100.46% Bạn đọc có thể thấy rằng trên dữ liệu ngoài mẫu, tổng số lượng yêu cầu bồi thường dự đoán bằng 95.78% tổng số lượng yêu cầu bồi thường thực tế, trong khi tổng số tiền yêu cầu bồi thường dự đoán bằng 100.46% tổng số tiền yêu cầu bồi thường thực tế. Có thể thấy rằng khả năng dự đoán ngoài mẫu của mô hình về cơ bản không thể giống như dự đoán trong mẫu, tuy nhiên các tỷ lệ 95.78% và 100.46% là vượt quá mức độ kỳ vọng vì tổng số lượng hợp đồng ngoài mẫu là 12228 hợp đồng. Ngoài phương pháp xác thực bằng dữ liệu ngoài mẫu, bạn đọc cũng có thể sử dụng xác thực chéo để đánh giá khả năng dự đoán của mô hình. Chúng ta sẽ chia dữ liệu ban đầu thành 5 phần (một cách ngẫu nhiên), tạm gọi là các phần 1, 2, 3, 4 và 5. Mỗi lần xây dựng mô hình, chúng ta sẽ lấy 1 phần làm dữ liệu ngoài mẫu và sử dụng 4 phần còn lại để xây dựng mô hình. Một mô hình ổn định là mô hình có khả năng dự đoán trên các tập ngoài mẫu không bị biến động quá nhiều. 4.7 Kết luận Chúng ta đã thảo luận về một số bước cần thiết để phát triển một mô hình xác định phí bảo hiểm thuần, yếu tố quan trọng nhất trong quá trình hình thành phí bảo hiểm. Đê thực các bước này, chúng ta đã thực hiện một số phân tích dữ liệu khám phá để làm quen với dữ liệu và nhằm đạt được một số hiểu biết quan trọng trong giai đoạn lập mô hình. Tiếp theo chúng tôi bắt đầu vào việc tạo ra một số mô hình tuyến tính tổng quát cho biến tần suất yêu cầu bồi thường và biến mức độ nghiêm trọng của yêu cầu bồi thường. Các biến được sử dụng trong mô hình bao gồm cả các biến liên tục và biến rời rạc. Một vài biến được chuyển đổi để tăng khả năng giải thích các biến mục tiêu. Sau cùng, chúng tôi kết hợp hai mô hình lại để xác định phí bảo hiểm thuần. Mô hình được xác thực trên một tập dữ liệu ngoài mẫu và cho kết quả rất khả quan. Nhìn chung, chúng ta đã hoàn thành khá nhiều bước để tiến đến kết quả. Tuy nhiên trong thực tế, để đưa phí thuần vào hoạt động kinh doanh vẫn còn nhiều việc phải làm. Các bước tiếp theo vượt quá phạm vi của mô hình toán thông thường nên sẽ không nằm trong phạm vi của cuốn sách này. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
