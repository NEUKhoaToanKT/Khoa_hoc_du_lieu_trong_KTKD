<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chương 3 Kiến thức R nâng cao | bookdown-demo.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chương 3 Kiến thức R nâng cao | bookdown-demo.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chương 3 Kiến thức R nâng cao | bookdown-demo.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="kiến-thức-r-cơ-bản.html"/>
<link rel="next" href="nhập-dữ-liệu-vào-r.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">KHDL KT&KD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="giới-thiệu-chung.html"><a href="giới-thiệu-chung.html"><i class="fa fa-check"></i><b>1</b> Giới thiệu chung</a>
<ul>
<li class="chapter" data-level="1.1" data-path="giới-thiệu-chung.html"><a href="giới-thiệu-chung.html#các-khái-niệm-cơ-bản-trong-khoa-học-dữ-liệu"><i class="fa fa-check"></i><b>1.1</b> Các khái niệm cơ bản trong khoa học dữ liệu</a></li>
<li class="chapter" data-level="1.2" data-path="giới-thiệu-chung.html"><a href="giới-thiệu-chung.html#r-là-gì-và-tại-sao-lại-sử-dụng-r"><i class="fa fa-check"></i><b>1.2</b> R là gì và tại sao lại sử dụng R</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html"><i class="fa fa-check"></i><b>2</b> Kiến thức R cơ bản</a>
<ul>
<li class="chapter" data-level="2.1" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#làm-quen-với-các-dòng-lệnh-cơ-bản"><i class="fa fa-check"></i><b>2.1</b> Làm quen với các dòng lệnh cơ bản</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#sử-dụng-r-như-một-máy-tính-cầm-tay"><i class="fa fa-check"></i><b>2.1.1</b> Sử dụng R như một máy tính cầm tay</a></li>
<li class="chapter" data-level="2.1.2" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#sử-dụng-cửa-sổ-script-để-viết-câu-lệnh"><i class="fa fa-check"></i><b>2.1.2</b> Sử dụng cửa sổ Script để viết câu lệnh</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#biến-trong-ngôn-ngữ-r"><i class="fa fa-check"></i><b>2.2</b> Biến trong ngôn ngữ R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#biến-kiểu-số"><i class="fa fa-check"></i><b>2.2.1</b> Biến kiểu số</a></li>
<li class="chapter" data-level="2.2.2" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#biến-kiểu-logic"><i class="fa fa-check"></i><b>2.2.2</b> Biến kiểu logic</a></li>
<li class="chapter" data-level="2.2.3" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#biến-kiểu-chuỗi-ký-tự"><i class="fa fa-check"></i><b>2.2.3</b> Biến kiểu chuỗi ký tự</a></li>
<li class="chapter" data-level="2.2.4" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#biến-kiểu-thời-gian"><i class="fa fa-check"></i><b>2.2.4</b> Biến kiểu thời gian</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#véc-tơ"><i class="fa fa-check"></i><b>2.3</b> Véc-tơ</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#tại-sao-xử-lý-véc-tơ-là-thế-mạnh-của-r"><i class="fa fa-check"></i><b>2.3.1</b> Tại sao xử lý véc-tơ là thế mạnh của R?</a></li>
<li class="chapter" data-level="2.3.2" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#khởi-tạo-véc-tơ-và-các-phép-toán-trên-véc-tơ"><i class="fa fa-check"></i><b>2.3.2</b> Khởi tạo véc-tơ và các phép toán trên véc-tơ</a></li>
<li class="chapter" data-level="2.3.3" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#lấy-các-thành-phần-con-từ-một-véc-tơ"><i class="fa fa-check"></i><b>2.3.3</b> Lấy các thành phần con từ một véc-tơ</a></li>
<li class="chapter" data-level="2.3.4" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#các-hàm-tạo-chỉ-số"><i class="fa fa-check"></i><b>2.3.4</b> Các hàm tạo chỉ số</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#ngôn-ngữ-lập-trình-r"><i class="fa fa-check"></i><b>2.4</b> Ngôn ngữ lập trình R</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#câu-lệnh-điều-kiện"><i class="fa fa-check"></i><b>2.4.1</b> Câu lệnh điều kiện</a></li>
<li class="chapter" data-level="2.4.2" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#viết-vòng-lặp"><i class="fa fa-check"></i><b>2.4.2</b> Viết vòng lặp</a></li>
<li class="chapter" data-level="2.4.3" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#hàm-số"><i class="fa fa-check"></i><b>2.4.3</b> Hàm số</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#đồ-thị-cơ-bản"><i class="fa fa-check"></i><b>2.5</b> Đồ thị cơ bản</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#đồ-thị-phân-tán"><i class="fa fa-check"></i><b>2.5.1</b> Đồ thị phân tán</a></li>
<li class="chapter" data-level="2.5.2" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#đồ-thị-cột"><i class="fa fa-check"></i><b>2.5.2</b> Đồ thị cột</a></li>
<li class="chapter" data-level="2.5.3" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#đồ-thị-hình-hộp"><i class="fa fa-check"></i><b>2.5.3</b> Đồ thị hình hộp</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#phụ-lục"><i class="fa fa-check"></i><b>2.6</b> Phụ lục</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#biểu-thức-chính-quy-và-thư-viện-textbfstringr"><i class="fa fa-check"></i><b>2.6.1</b> Biểu thức chính quy và thư viện <span class="math inline">\(\textbf{stringr}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="kiến-thức-r-cơ-bản.html"><a href="kiến-thức-r-cơ-bản.html#bài-tập"><i class="fa fa-check"></i><b>2.7</b> Bài tập</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html"><i class="fa fa-check"></i><b>3</b> Kiến thức R nâng cao</a>
<ul>
<li class="chapter" data-level="3.1" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#ma-trận"><i class="fa fa-check"></i><b>3.1</b> Ma trận</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#khởi-tạo-ma-trận"><i class="fa fa-check"></i><b>3.1.1</b> Khởi tạo ma trận</a></li>
<li class="chapter" data-level="3.1.2" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#lấy-phần-tử-con-và-ma-trận-con-của-ma-trận."><i class="fa fa-check"></i><b>3.1.2</b> Lấy phần tử con và ma trận con của ma trận.</a></li>
<li class="chapter" data-level="3.1.3" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#các-phép-toán-trên-ma-trận"><i class="fa fa-check"></i><b>3.1.3</b> Các phép toán trên ma trận</a></li>
<li class="chapter" data-level="3.1.4" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#phép-nhân-ma-trận"><i class="fa fa-check"></i><b>3.1.4</b> Phép nhân ma trận</a></li>
<li class="chapter" data-level="3.1.5" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#ma-trận-đường-chéo-và-ma-trận-đơn-vị"><i class="fa fa-check"></i><b>3.1.5</b> Ma trận đường chéo và ma trận đơn vị</a></li>
<li class="chapter" data-level="3.1.6" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#định-thức-của-ma-trận"><i class="fa fa-check"></i><b>3.1.6</b> Định thức của ma trận</a></li>
<li class="chapter" data-level="3.1.7" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#ma-trận-nghịch-đảo"><i class="fa fa-check"></i><b>3.1.7</b> Ma trận nghịch đảo</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#mảng-nhiều-chiều"><i class="fa fa-check"></i><b>3.2</b> Mảng nhiều chiều</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#khởi-tạo-mảng-nhiều-chiều"><i class="fa fa-check"></i><b>3.2.1</b> Khởi tạo mảng nhiều chiều</a></li>
<li class="chapter" data-level="3.2.2" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#sử-dụng-mảng-nhiều-chiều-để-biến-đổi-dữ-liệu-kiểu-hình-ảnh"><i class="fa fa-check"></i><b>3.2.2</b> Sử dụng mảng nhiều chiều để biến đổi dữ liệu kiểu hình ảnh</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#list-trong-r"><i class="fa fa-check"></i><b>3.3</b> List trong R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#khởi-tạo-list-và-chỉ-số-của-list."><i class="fa fa-check"></i><b>3.3.1</b> Khởi tạo list và chỉ số của list.</a></li>
<li class="chapter" data-level="3.3.2" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#sử-dụng-list-trong-viết-hàm-số"><i class="fa fa-check"></i><b>3.3.2</b> Sử dụng list trong viết hàm số</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#các-hàm-họ-apply"><i class="fa fa-check"></i><b>3.4</b> Các hàm họ <code>apply()</code></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#hàm-apply"><i class="fa fa-check"></i><b>3.4.1</b> Hàm <code>apply()</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#hàm-lapply-và-sapply."><i class="fa fa-check"></i><b>3.4.2</b> Hàm <code>lapply()</code> và <code>sapply()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#phụ-lục-1"><i class="fa fa-check"></i><b>3.5</b> Phụ lục</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#advrappen1"><i class="fa fa-check"></i><b>3.5.1</b> Kiến thức nâng cao liên quan đến ma trận</a></li>
<li class="chapter" data-level="3.5.2" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#advrappen2"><i class="fa fa-check"></i><b>3.5.2</b> Gradient, Hessian và Jacobian</a></li>
<li class="chapter" data-level="3.5.3" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#thuật-toán-gradient-descent"><i class="fa fa-check"></i><b>3.5.3</b> Thuật toán gradient descent</a></li>
<li class="chapter" data-level="3.5.4" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#advrappen3"><i class="fa fa-check"></i><b>3.5.4</b> Các giá trị đặc trưng của một dòng tiền tương lai</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="kiến-thức-r-nâng-cao.html"><a href="kiến-thức-r-nâng-cao.html#bài-tập-1"><i class="fa fa-check"></i><b>3.6</b> Bài tập</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html"><i class="fa fa-check"></i><b>4</b> Nhập dữ liệu vào R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#đối-tượng-dùng-để-lưu-dữ-liệu-trong-r"><i class="fa fa-check"></i><b>4.1</b> Đối tượng dùng để lưu dữ liệu trong R</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#data.frame-là-gì"><i class="fa fa-check"></i><b>4.1.1</b> data.frame là gì?</a></li>
<li class="chapter" data-level="4.1.2" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#tibble-là-một-cải-tiến-của-data.frame"><i class="fa fa-check"></i><b>4.1.2</b> <span class="math inline">\(tibble\)</span> là một cải tiến của <span class="math inline">\(data.frame\)</span>?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#nhập-dữ-liệu-bằng-hàm-sẵn-có."><i class="fa fa-check"></i><b>4.2</b> Nhập dữ liệu bằng hàm sẵn có.</a></li>
<li class="chapter" data-level="4.3" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#nhập-dữ-liệu-bằng-thư-viện-textbfreadr."><i class="fa fa-check"></i><b>4.3</b> Nhập dữ liệu bằng thư viện <span class="math inline">\(\textbf{readr}\)</span>.</a></li>
<li class="chapter" data-level="4.4" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#tương-tác-giữa-r-với-microsoft-excel"><i class="fa fa-check"></i><b>4.4</b> Tương tác giữa R với Microsoft Excel</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#đọc-dữ-liệu-lưu-dưới-định-dạng-của-excel"><i class="fa fa-check"></i><b>4.4.1</b> Đọc dữ liệu lưu dưới định dạng của Excel</a></li>
<li class="chapter" data-level="4.4.2" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#tương-tác-với-microsoft-excel-bằng-thư-viện-textbfopenxlsx"><i class="fa fa-check"></i><b>4.4.2</b> Tương tác với Microsoft Excel bằng thư viện <span class="math inline">\(\textbf{openxlsx}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#kết-nối-r-với-cơ-sở-dữ-liệu"><i class="fa fa-check"></i><b>4.5</b> Kết nối R với cơ sở dữ liệu</a></li>
<li class="chapter" data-level="4.6" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#thu-thập-dữ-liệu-từ-các-website"><i class="fa fa-check"></i><b>4.6</b> Thu thập dữ liệu từ các website</a></li>
<li class="chapter" data-level="4.7" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#phụ-lục-2"><i class="fa fa-check"></i><b>4.7</b> Phụ lục</a></li>
<li class="chapter" data-level="4.8" data-path="nhập-dữ-liệu-vào-r.html"><a href="nhập-dữ-liệu-vào-r.html#bài-tập-2"><i class="fa fa-check"></i><b>4.8</b> Bài tập</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html"><i class="fa fa-check"></i><b>5</b> Tiền xử lý dữ liệu</a>
<ul>
<li class="chapter" data-level="5.1" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#tiền-xử-lý-dữ-liệu-là-gì"><i class="fa fa-check"></i><b>5.1</b> Tiền xử lý dữ liệu là gì?</a></li>
<li class="chapter" data-level="5.2" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#định-dạng-cột-dữ-liệu-sử-dụng-thư-viện-textbfreadr"><i class="fa fa-check"></i><b>5.2</b> Định dạng cột dữ liệu sử dụng thư viện <span class="math inline">\(\textbf{readr}\)</span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#quy-tắc-định-dạng-tự-động-của-textbfreadr"><i class="fa fa-check"></i><b>5.2.1</b> Quy tắc định dạng tự động của <span class="math inline">\(\textbf{readr}\)</span></a></li>
<li class="chapter" data-level="5.2.2" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#định-dạng-véc-tơ-bằng-các-hàm-parse_"><i class="fa fa-check"></i><b>5.2.2</b> Định dạng véc-tơ bằng các hàm <code>parse_*()</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#định-dạng-cột-kiểu-chuỗi-ký-tự"><i class="fa fa-check"></i><b>5.2.3</b> Định dạng cột kiểu chuỗi ký tự</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#xử-lý-giá-trị-không-quan-sát-được"><i class="fa fa-check"></i><b>5.3</b> Xử lý giá trị không quan sát được</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#xác-định-giá-trị-không-quan-sát-được"><i class="fa fa-check"></i><b>5.3.1</b> Xác định giá trị không quan sát được</a></li>
<li class="chapter" data-level="5.3.2" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#xử-lý-giá-trị-không-quan-sát-được."><i class="fa fa-check"></i><b>5.3.2</b> Xử lý giá trị không quan sát được.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#xử-lý-giá-trị-ngoại-lai"><i class="fa fa-check"></i><b>5.4</b> Xử lý giá trị ngoại lai</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#ảnh-hưởng-của-giá-trị-ngoại-lai-lên-kết-quả-phân-tích"><i class="fa fa-check"></i><b>5.4.1</b> Ảnh hưởng của giá trị ngoại lai lên kết quả phân tích</a></li>
<li class="chapter" data-level="5.4.2" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#phương-pháp-phát-hiện-giá-trị-ngoại-lai"><i class="fa fa-check"></i><b>5.4.2</b> Phương pháp phát hiện giá trị ngoại lai</a></li>
<li class="chapter" data-level="5.4.3" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#xử-lý-giá-trị-ngoại-lai."><i class="fa fa-check"></i><b>5.4.3</b> Xử lý giá trị ngoại lai.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#phụ-lục-3"><i class="fa fa-check"></i><b>5.5</b> Phụ lục</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#appenptdl01"><i class="fa fa-check"></i><b>5.5.1</b> Kiểm định sự độc lập của hai biến</a></li>
<li class="chapter" data-level="5.5.2" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#appenptdl02"><i class="fa fa-check"></i><b>5.5.2</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="5.5.3" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#phương-pháp-chuẩn-hóa-véc-tơ-bằng-hàm-ngược"><i class="fa fa-check"></i><b>5.5.3</b> Phương pháp chuẩn hóa véc-tơ bằng hàm ngược</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="tiền-xử-lý-dữ-liệu.html"><a href="tiền-xử-lý-dữ-liệu.html#bài-tập-3"><i class="fa fa-check"></i><b>5.6</b> Bài tập</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html"><i class="fa fa-check"></i><b>6</b> Biến đổi và sắp xếp dữ liệu</a>
<ul>
<li class="chapter" data-level="6.1" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#biến-đổi-dữ-liệu-bằng-thư-viện-textbfdplyr"><i class="fa fa-check"></i><b>6.1</b> Biến đổi dữ liệu bằng thư viện <span class="math inline">\(\textbf{dplyr}\)</span></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#thêm-biến-bằng-hàm-mutate"><i class="fa fa-check"></i><b>6.1.1</b> Thêm biến bằng hàm <code>mutate()</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#lựa-chọn-biến-bằng-hàm-select"><i class="fa fa-check"></i><b>6.1.2</b> Lựa chọn biến bằng hàm <code>select()</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#sắp-xếp-dữ-liệu-bằng-hàm-arrange"><i class="fa fa-check"></i><b>6.1.3</b> Sắp xếp dữ liệu bằng hàm <code>arrange()</code></a></li>
<li class="chapter" data-level="6.1.4" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#kết-hợp-các-phép-biến-đổi-bằng-toán-tử-pipe"><i class="fa fa-check"></i><b>6.1.4</b> Kết hợp các phép biến đổi bằng toán tử pipe (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="6.1.5" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#tổng-hợp-dữ-liệu-bằng-group_by-và-summarise"><i class="fa fa-check"></i><b>6.1.5</b> Tổng hợp dữ liệu bằng <code>group_by</code> và <code>summarise()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#sắp-xếp-dữ-liệu-bằng-thư-viện-textbftidyr"><i class="fa fa-check"></i><b>6.2</b> Sắp xếp dữ liệu bằng thư viện <span class="math inline">\(\textbf{tidyr}\)</span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#kéo-dài-dữ-liệu-bằng-gather"><i class="fa fa-check"></i><b>6.2.1</b> Kéo dài dữ liệu bằng <code>gather()</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#mở-rộng-dữ-liệu-với-speard"><i class="fa fa-check"></i><b>6.2.2</b> Mở rộng dữ liệu với <code>speard()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#phụ-lục-4"><i class="fa fa-check"></i><b>6.3</b> Phụ lục</a></li>
<li class="chapter" data-level="6.4" data-path="biến-đổi-và-sắp-xếp-dữ-liệu.html"><a href="biến-đổi-và-sắp-xếp-dữ-liệu.html#bài-tập-4"><i class="fa fa-check"></i><b>6.4</b> Bài tập</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="kiến-thức-r-nâng-cao" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chương 3</span> Kiến thức R nâng cao<a href="kiến-thức-r-nâng-cao.html#kiến-thức-r-nâng-cao" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Trong cuốn sách này chúng tôi cố gắng tránh nhắc đến các khái niệm toán học phức tạp bởi đối tượng chúng tôi hướng đến là những người làm việc với dữ liệu nhưng không có một nền tảng chuyên sâu về toán học. Tuy nhiên để làm việc được với dữ liệu thì các kiến thức về ma trận nói riêng và kiến thức về đại số tuyến tính nói chung là bắt buộc phải nắm vững. Điều đáng tiếc là tại thời điểm chúng tôi viết cuốn sách này, đa số các chương trình đào tạo dành cho sinh viên các ngành kinh tế đang cắt giảm dần kiến thức về toán học và đặc biệt là kiến thức đại số tuyến tính.</p>
<div id="ma-trận" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Ma trận<a href="kiến-thức-r-nâng-cao.html#ma-trận" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ma trận có ý nghĩa đặc biệt quan trọng trong phân tích dữ liệu bởi đa số các dữ liệu đều được chuyển thành kiểu ma trận để dễ dàng phân tích và tính toán. Cũng giống như véc-tơ, ma trận là một đối tượng dùng để lưu các biến có cùng kiểu. Khác với véc-tơ, ma trận lưu phần tử theo hàng và cột, nghĩa là trong không gian hai chiều trong khi véc-tơ lưu phần tử trong không gian một chiều. Bạn đọc cũng có thể hiểu véc-tơ là một cột trong khi ma trận là tập hợp của các cột có cùng độ dài. Kích thước của một véc-tơ là chiều dài của véc-tơ đó trong khi kích thước của một ma trận là số hàng và số cột của ma trận đó.</p>
<div id="khởi-tạo-ma-trận" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Khởi tạo ma trận<a href="kiến-thức-r-nâng-cao.html#khởi-tạo-ma-trận" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hàm số dùng để tạo ra ma trận trong R là hàm <code>matrix()</code>. Khi tạo ma trận, bạn đọc sẽ luôn luôn phải khởi tạo giá trị cho ma trận đó. Đoạn lệnh sau sẽ khởi tạo một ma trận có tên <span class="math inline">\(M\)</span>, có 3 hàng, 4 cột, và giá trị trong ma trận là các số tự nhiên từ 1 đến 12 được sắp xếp theo thứ tự</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="kiến-thức-r-nâng-cao.html#cb274-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="co"># nrow: số hàng, ncol: số cột</span></span>
<span id="cb274-2"><a href="kiến-thức-r-nâng-cao.html#cb274-2" tabindex="-1"></a>M <span class="co"># In M</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12</code></pre>
<p>Các giá trị dùng để khởi tạo cho ma trận là các số từ 1 đến 12 và được điền vào ma trận <span class="math inline">\(M\)</span> theo nguyên tắc từ trên xuống dưới rồi từ trái sang phải, nghĩa là</p>
<ul>
<li>Cột thứ nhất sẽ được ưu tiên cho giá trị trước; phần tử hàng thứ nhất của cột thứ nhất sẽ được điền giá trị trước tiên, sau đó đến phần tử ở hàng thứ hai của cột thứ nhất, … Sau khi điền hết cột thứ nhất R sẽ tiếp tục điền vào giá trị ở hàng thứ nhất của cột thứ hai, rồi phần tử hàng hai ở cột thứ hai,… cho đến hết cột thứ hai. Quá trình điền số vào ma trận sẽ tiếp tục như thế sau khi tất cả các phần tử trong ma trận đều có giá trị. Véc-tơ dùng đề khởi tạo giá trị cho ma trận có độ dài 12 vừa đúng với số phần tử trong ma trận nên câu lệnh tạo ma trận <span class="math inline">\(M\)</span> ở trên hoạt động bình thường. Trong trường hợp bạn đọc sử dụng véc-tơ có độ dài khác 12 để khởi tạo giá trị cho ma trận, câu lệnh vẫn sẽ chạy nhưng có kèm theo cảnh báo:</li>
</ul>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="kiến-thức-r-nâng-cao.html#cb276-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="co"># Sẽ có cảnh báo; </span></span>
<span id="cb276-2"><a href="kiến-thức-r-nâng-cao.html#cb276-2" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="co"># Sẽ có cảnh báo;  </span></span></code></pre></div>
<p>Bạn đọc có thể thấy rằng:</p>
<ul>
<li><p>Nếu véc-tơ dùng để khởi tạo giá trị cho ma trận <span class="math inline">\(M\)</span> có độ dài lớn hơn 12, R sẽ dùng 12 giá trị đầu tiên để khởi tạo giá trị cho ma trận.</p></li>
<li><p>Nếu véc-tơ dùng để khởi tạo giá trị cho ma trận <span class="math inline">\(M\)</span> có độ dài nhỏ hơn 12, R sẽ lặp lại véc-tơ đó cho đến khi có độ dài lớn hơn hoặc bằng 12 rồi sau đó dùng 12 giá trị đầu tiên để khởi tạo giá trị cho ma trận.</p></li>
</ul>
<p>Khi khởi tạo ma trận, bạn đọc có thể yêu cầu giá trị được khởi tạo theo hàng thay vì theo cột bằng tùy biến <code>byrow = TRUE</code> trong hàm <code>matrix()</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="kiến-thức-r-nâng-cao.html#cb277-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb277-2"><a href="kiến-thức-r-nâng-cao.html#cb277-2" tabindex="-1"></a>M <span class="co"># in M ra của sổ console</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12</code></pre>
<p>Để biết kích cỡ của ma trận, chúng ta sử dụng hàm <code>dim()</code>. Hàm <code>dim()</code> trả lại giá trị là một véc-tơ kiểu số có độ dài là hai, phần tử thứ nhất là số hàng, phần tử thứ hai là số cột của ma trận:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="kiến-thức-r-nâng-cao.html#cb279-1" tabindex="-1"></a><span class="fu">dim</span>(M) <span class="co"># ma trận 3 hàng 4 cột</span></span></code></pre></div>
<pre><code>## [1] 3 4</code></pre>
<p>Ma trận cũng có thể được khởi tạo bằng cách ghép các véc-tơ hoặc các ma trận khác theo hàng hay theo cột bằng các hàm <code>cbind()</code> hoặc <code>rbind()</code>:</p>
<ul>
<li><p>Hàm <code>cbind()</code> nối các ma trận có cùng số hàng hoặc ma trận với véc-tơ có độ dài bằng số hàng của ma trận.</p></li>
<li><p>Tương tự, <code>rbind()</code> nối các ma trận có cùng số cột hoặc ma trận với véc-tơ có độ dài bằng số cột của ma trận.</p></li>
</ul>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="kiến-thức-r-nâng-cao.html#cb281-1" tabindex="-1"></a><span class="fu">cbind</span>(M,<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>)) <span class="co"># ghép THEO CỘT, ma trận M (3 hàng, 4 cột) với véc-tơ độ dài 3</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    2    3    4    1
## [2,]    5    6    7    8    1
## [3,]    9   10   11   12    1</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="kiến-thức-r-nâng-cao.html#cb283-1" tabindex="-1"></a><span class="fu">rbind</span>(M,<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="co"># ghép THEO HÀNG, ma trận M (3 hàng, 4 cột) với véc-tơ độ dài 4</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12
## [4,]    1    1    1    1</code></pre>
<p>Các phép tính toán thông thường trên ma trận cũng có nguyên tắc giống như đối với véc-tơ. Các phép toán như cộng, trừ, nhân, chia, lũy thừa, …, sẽ tác động lên tất cả các phần tử trong ma trận theo thứ tự của các phần tử xuất hiện trên ma trận. Ví dụ khi nhân ma trận <span class="math inline">\(M\)</span> kích thước <span class="math inline">\((3 \times 4)\)</span> với một số ta sẽ có kết quả như sau:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="kiến-thức-r-nâng-cao.html#cb285-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb285-2"><a href="kiến-thức-r-nâng-cao.html#cb285-2" tabindex="-1"></a>M <span class="sc">*</span> <span class="dv">2</span> <span class="co"># in M*2 ra của sổ console</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    2    8   14   20
## [2,]    4   10   16   22
## [3,]    6   12   18   24</code></pre>
<p>Bạn đọc có thể thấy rằng kết quả nhận được là một ma trận có kích thước bằng với kích thước của ma trận M và mỗi phần tử bằng phần tử ở vị trí tương ứng của ma trận <span class="math inline">\(M\)</span> nhân với 2.</p>
<p>Khi thực hiện phép nhân thông thường ma trận <span class="math inline">\(M\)</span> với một ma trận <span class="math inline">\(M_1\)</span> có cùng kích thước thì kết quả nhận được là một ma trận mà mỗi phần tử bằng tích của 2 phần tử ở vị trí tương ứng của M và <span class="math inline">\(M_1\)</span>. R sẽ báo lỗi nếu thực hiện phép nhân thông thường giữa hai ma trận không có cùng kích thước:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="kiến-thức-r-nâng-cao.html#cb287-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb287-2"><a href="kiến-thức-r-nâng-cao.html#cb287-2" tabindex="-1"></a>M1<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dv">6</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb287-3"><a href="kiến-thức-r-nâng-cao.html#cb287-3" tabindex="-1"></a>M <span class="sc">*</span> M1<span class="co"># in M * M1 ra của sổ console</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    0    4    0   10
## [2,]    2    0    8    0
## [3,]    0    6    0   12</code></pre>
<p>Phép nhân thông thường cũng có thể được thực hiện giữa ma trận <span class="math inline">\(M\)</span> với một véc-tơ có độ dài nhỏ hơn hoặc bằng số phần tử của <span class="math inline">\(M\)</span>. Trước khi thực hiệp phép nhân, R sẽ chuyển các phần tử trong véc-tơ vào một ma trận có kích thước tương ứng với <span class="math inline">\(M\)</span> sau đó thực hiện phép nhân giống như nhân hai ma trận có cùng kích thước:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="kiến-thức-r-nâng-cao.html#cb289-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb289-2"><a href="kiến-thức-r-nâng-cao.html#cb289-2" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>) <span class="co"># véc-tơ độ dài 5</span></span>
<span id="cb289-3"><a href="kiến-thức-r-nâng-cao.html#cb289-3" tabindex="-1"></a>M <span class="sc">*</span> x <span class="co"># phép nhân được thực hiện mà không báo lỗi</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   -2    4   -7   20
## [2,]   -2   10    0  -22
## [3,]    0  -12    9  -12</code></pre>
<p>Khi thực hiện tính toán như trên, R đã tự động lặp lại véc-tơ <span class="math inline">\(x\)</span> cho đến khi số lượng phần tử bằng với số phần tử của <span class="math inline">\(M\)</span>, điền các giá trị này vào một ma trận có kích thước bằng với kích thước của <span class="math inline">\(M\)</span> rồi sau đó thực hiện phép nhân. Thật vậy, chúng ta có thể kiểm tra như sau:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="kiến-thức-r-nâng-cao.html#cb291-1" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">rep</span>(x,<span class="dv">3</span>) </span>
<span id="cb291-2"><a href="kiến-thức-r-nâng-cao.html#cb291-2" tabindex="-1"></a><span class="co"># Lặp lại x cho đến khi số phần tử của véc-tơ thu được lớn hơn 12</span></span>
<span id="cb291-3"><a href="kiến-thức-r-nâng-cao.html#cb291-3" tabindex="-1"></a></span>
<span id="cb291-4"><a href="kiến-thức-r-nâng-cao.html#cb291-4" tabindex="-1"></a>M1<span class="ot">&lt;-</span><span class="fu">matrix</span>(y[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>],<span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb291-5"><a href="kiến-thức-r-nâng-cao.html#cb291-5" tabindex="-1"></a><span class="co"># Dùng 12 giá trị ban đầu để tạo thành ma trận có cùng kích thước 3*4</span></span>
<span id="cb291-6"><a href="kiến-thức-r-nâng-cao.html#cb291-6" tabindex="-1"></a></span>
<span id="cb291-7"><a href="kiến-thức-r-nâng-cao.html#cb291-7" tabindex="-1"></a>M <span class="sc">*</span> M1 <span class="co"># Kết quả giống như M * x</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   -2    4   -7   20
## [2,]   -2   10    0  -22
## [3,]    0  -12    9  -12</code></pre>
</div>
<div id="lấy-phần-tử-con-và-ma-trận-con-của-ma-trận." class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Lấy phần tử con và ma trận con của ma trận.<a href="kiến-thức-r-nâng-cao.html#lấy-phần-tử-con-và-ma-trận-con-của-ma-trận." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Tương tự như với véc-tơ, chúng ta sử dụng dấu ngoặc vuông <code>[]</code> để lấy phần tử con trong ma trận. Khác với véc-tơ, ma trận có chỉ số hàng và chỉ số cột nên chúng ta cần cho biết phần tử được lấy ra ở hàng thứ bao nhiêu và cột thứ bao nhiêu:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="kiến-thức-r-nâng-cao.html#cb293-1" tabindex="-1"></a>M[<span class="dv">2</span>,<span class="dv">3</span>] <span class="co"># Phần tử ở hàng thứ hai, cột thứ ba của ma trận M</span></span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>Chúng ta cũng có thể lấy ra véc-tơ hàng hoặc véc-tơ cột của ma trận bằng cách sau</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="kiến-thức-r-nâng-cao.html#cb295-1" tabindex="-1"></a>M[,<span class="dv">3</span>] <span class="co"># Lấy ra véc-tơ cột thứ 3 của ma trận M</span></span></code></pre></div>
<pre><code>## [1] 7 8 9</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="kiến-thức-r-nâng-cao.html#cb297-1" tabindex="-1"></a>M[<span class="dv">2</span>,] <span class="co"># Lấy ra véc-tơ hàng thứ 2 của ma trận M</span></span></code></pre></div>
<pre><code>## [1]  2  5  8 11</code></pre>
<p>Để lấy ra một ma trận con của một ma trận, chúng ta cũng tạo véc-tơ chỉ số giống như cách tạo chỉ số với véc-tơ. Thay vì chỉ tạo một véc-tơ chỉ số duy nhất như khi làm với véc-tơ, chúng ta cần tạo một véc-tơ chỉ số theo hàng và một véc-tơ chỉ số theo cột. Bạn đọc có thể tạo chỉ số bằng một véc-tơ kiểu số hoặc véc-tơ kiểu logical hoặc kết hợp cả hai phương pháp này</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="kiến-thức-r-nâng-cao.html#cb299-1" tabindex="-1"></a>chi_so_hang<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span>) <span class="co"># Chỉ số theo hàng kiểu logical</span></span>
<span id="cb299-2"><a href="kiến-thức-r-nâng-cao.html#cb299-2" tabindex="-1"></a>chi_so_cot<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>) <span class="co"># Chỉ số cột theo kiểu số</span></span>
<span id="cb299-3"><a href="kiến-thức-r-nâng-cao.html#cb299-3" tabindex="-1"></a>M[chi_so_hang,chi_so_cot] <span class="co"># Ma trận con của ma trận M</span></span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    4   10
## [2,]    6   12</code></pre>
</div>
<div id="các-phép-toán-trên-ma-trận" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Các phép toán trên ma trận<a href="kiến-thức-r-nâng-cao.html#các-phép-toán-trên-ma-trận" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Các phép toán trên ma trận có ý nghĩa đặc biệt quan trọng trong phân tích dữ liệu. Ở các chương tiếp theo bạn đọc sẽ thấy rằng tất cả các tính toán nhằm biến đổi dữ liệu, hoặc ước lượng tham số cho các mô hình trên dữ liệu đều dựa trên các phép tính toán trên ma trận. Chúng tôi sẽ giải thích các phép toán này một cách đơn giản nhất để những bạn đọc không có nền tảng chuyên sâu về toán cũng có thể hiểu được. Tuy nhiên, để có kỹ năng thành thạo trong biến đổi dữ liệu, phân tích dữ liệu, và xây dựng các mô hình trên dữ liệu, chúng tôi khuyên bạn đọc nên tự trang bị cho mình các kiến thức về ma trận nói riêng và đại số tuyến tính nói chung.</p>
<div id="phép-chuyển-vị" class="section level4 hasAnchor" number="3.1.3.1">
<h4><span class="header-section-number">3.1.3.1</span> Phép chuyển vị<a href="kiến-thức-r-nâng-cao.html#phép-chuyển-vị" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Phép toán chuyển vị (transpose) là một phép toán biến đổi một ma trận <span class="math inline">\(M\)</span> kích thước <span class="math inline">\(n \times p\)</span> (<span class="math inline">\(n\)</span> hàng và <span class="math inline">\(p\)</span> cột) thành một ma trận mới, ký hiệu là <span class="math inline">\(M^T\)</span>, có kích thước <span class="math inline">\(p \times n\)</span> (<span class="math inline">\(p\)</span> hàng và <span class="math inline">\(n\)</span> cột), đồng thời phần tử hàng thứ <span class="math inline">\(j\)</span> và cột thứ <span class="math inline">\(i\)</span> của ma trận <span class="math inline">\(M^T\)</span> bằng phần tử ở hàng thứ <span class="math inline">\(i\)</span> và cột thứ <span class="math inline">\(j\)</span> của ma trận <span class="math inline">\(M\)</span>.</p>
<p><span class="math display" id="eq:mat01">\[\begin{align}
\begin{bmatrix}
m_{11} &amp; m_{12} &amp; m_{13}\\
m_{21} &amp; m_{22} &amp; m_{23}
\end{bmatrix}

\xrightarrow[\text{(transpose)}]{\text{chuyển vị}}

\begin{bmatrix}
m_{11} &amp; m_{21} \\
m_{12} &amp; m_{22} \\
m_{13} &amp; m_{23}
\end{bmatrix}
\tag{3.1}
\end{align}\]</span></p>
<p>Hàm số để thực hiện phép chuyển vị ma trận trong R là hàm <code>t()</code></p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="kiến-thức-r-nâng-cao.html#cb301-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="co"># nrow: số hàng, ncol: số cột</span></span>
<span id="cb301-2"><a href="kiến-thức-r-nâng-cao.html#cb301-2" tabindex="-1"></a>M <span class="co"># in M ra của sổ console</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="kiến-thức-r-nâng-cao.html#cb303-1" tabindex="-1"></a><span class="fu">t</span>(M) <span class="co"># ma trận chuyển vị của ma trận </span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    5    9
## [2,]    2    6   10
## [3,]    3    7   11
## [4,]    4    8   12</code></pre>
<p>Bạn đọc có thể thấy rằng nếu thực hiện phép chuyển vị hai lần liên tiếp ta sẽ thu được ma trận ban đầu</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="kiến-thức-r-nâng-cao.html#cb305-1" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(M)) <span class="co"># ma trận chuyển vị của ma trận chuyển vị là ma trận ban đầu </span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12</code></pre>
</div>
</div>
<div id="phép-nhân-ma-trận" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Phép nhân ma trận<a href="kiến-thức-r-nâng-cao.html#phép-nhân-ma-trận" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Phép nhân ma trận (matrix multiplication) của ma trận <span class="math inline">\(A\)</span> với ma trận <span class="math inline">\(B\)</span> chỉ thực hiện được nếu số cột của ma trận <span class="math inline">\(A\)</span> bằng với số hàng của ma trận <span class="math inline">\(B\)</span>. Giả sử rằng <span class="math inline">\(A\)</span> có kích thước là <span class="math inline">\(n \times p\)</span> và <span class="math inline">\(B\)</span> có kích thước là <span class="math inline">\(p \times k\)</span> thì kết quả của phép nhân ma trận của ma trận <span class="math inline">\(A\)</span> với ma trận <span class="math inline">\(B\)</span> là một ma trận <span class="math inline">\(M\)</span> có kích thước <span class="math inline">\(n \times k\)</span>, phần tử ở hàng thứ <span class="math inline">\(i\)</span> và cột thứ <span class="math inline">\(j\)</span> của ma trận <span class="math inline">\(M\)</span> là tích vô hướng giữa véc-tơ hàng <span class="math inline">\(i\)</span> của ma trận <span class="math inline">\(A\)</span> và véc-tơ cột <span class="math inline">\(j\)</span> của ma trận <span class="math inline">\(B\)</span>. Nhắc lại với bạn đọc rằng tích vô hướng của hai véc-tơ <span class="math inline">\(x\)</span> và <span class="math inline">\(y\)</span> (phải) có cùng độ dài <span class="math inline">\(n\)</span> được ký hiệu là <span class="math inline">\(&lt;x,y&gt;\)</span> và được tính như sau</p>
<p><span class="math display">\[\begin{align}
&lt;x,y&gt; = \sum\limits_{i = 1}^n \ x_i y_i
\end{align}\]</span></p>
<p>trong đó <span class="math inline">\(x_i\)</span>, <span class="math inline">\(y_i\)</span> lần lượt là phần tử thứ <span class="math inline">\(i\)</span> của véc-tơ <span class="math inline">\(x\)</span> và véc-tơ <span class="math inline">\(y\)</span>. Để phân biệt với phép nhân thông thường, chúng tôi sử dụng ký hiệu <span class="math inline">\(*\)</span> cho phép nhân ma trận mà chỉ đơn giản ký hiệu phép nhân ma trận giữa ma trận <span class="math inline">\(A\)</span> và ma trận <span class="math inline">\(B\)</span> là <span class="math inline">\(AB\)</span>. Công thức dưới đây mô tả phép nhân ma trận giữa một ma trận có 2 hàng và 3 cột với một ma trận có 3 hàng và 4 cột để được một ma trận có kích thước là 2 hàng và 4 cột</p>
<p><span class="math display" id="eq:mat02">\[\begin{align}
&amp; AB = M \\

&amp; \begin{bmatrix}
a_{11} &amp; a_{12} &amp; a_{13}\\
a_{21} &amp; a_{22} &amp; a_{23}
\end{bmatrix}

\% * \%

\begin{bmatrix}
b_{11} &amp; b_{12} &amp; b_{13} &amp; b_{14} \\
b_{21} &amp; b_{22} &amp; b_{23} &amp; b_{24} \\
b_{31} &amp; b_{32} &amp; b_{33} &amp; b_{34}
\end{bmatrix}

=

\begin{bmatrix}
m_{11} &amp; m_{12} &amp; m_{13} &amp; m_{14} \\
m_{21} &amp; m_{22} &amp; m_{23} &amp; m_{24} \\
\end{bmatrix} \\

&amp; m_{ij} = &lt;A[i,],B[,j]&gt;
\tag{3.2}
\end{align}\]</span></p>
<p>trong đó <span class="math inline">\(A[i,]\)</span> là véc-tơ hàng <span class="math inline">\(i\)</span> của ma trận <span class="math inline">\(A\)</span> và <span class="math inline">\(B[,j]\)</span> là véc-tơ cột <span class="math inline">\(j\)</span> của ma trận <span class="math inline">\(B\)</span>.</p>
<p>Toán tử dùng để thực hiện phép nhân ma trận trong R là <span class="math inline">\(\% * \%\)</span>. Bạn đọc có thể thực hiện phép nhân hai ma trận <span class="math inline">\(A\)</span> và <span class="math inline">\(B\)</span> như sau</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="kiến-thức-r-nâng-cao.html#cb307-1" tabindex="-1"></a>A<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="co"># ma trận kích thước 2 * 3</span></span>
<span id="cb307-2"><a href="kiến-thức-r-nâng-cao.html#cb307-2" tabindex="-1"></a><span class="fu">print</span>(A)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="kiến-thức-r-nâng-cao.html#cb309-1" tabindex="-1"></a>B<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="co"># ma trận kích thước 3 * 4</span></span>
<span id="cb309-2"><a href="kiến-thức-r-nâng-cao.html#cb309-2" tabindex="-1"></a><span class="fu">print</span>(B)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="kiến-thức-r-nâng-cao.html#cb311-1" tabindex="-1"></a>M <span class="ot">&lt;-</span> A <span class="sc">%*%</span> B <span class="co"># kết quả là ma trận M có kich thước 2 * 4</span></span>
<span id="cb311-2"><a href="kiến-thức-r-nâng-cao.html#cb311-2" tabindex="-1"></a><span class="fu">print</span>(M)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   22   49   76  103
## [2,]   28   64  100  136</code></pre>
<p>Chúng ta có thể kiểm tra giá trị của phần tử ở hàng thứ 2 và cột thứ 3 của ma trận kết quả (số 100) chính là tích vô hướng giữa véc-tơ hàng thứ hai của ma trận <span class="math inline">\(A\)</span> và véc-tơ cột thứ ba của ma trận <span class="math inline">\(B\)</span>.</p>
<p><span class="math display">\[\begin{align}
&lt;(2,4,6),(7,8,9)&gt; = 2 \times 7 + 4 \times 8 + 6 \times 9 = 100
\end{align}\]</span></p>
<p>Bạn đọc cần phân biệt giữa phép nhân ma trận (ký hiệu <span class="math inline">\(\% * \%\)</span>) và phép nhân thông thường (ký hiệu <span class="math inline">\(*\)</span>) như đã trình bày ở trên. Để tránh gây nhầm lẫn, chúng tôi luôn sử dụng cụm từ nhân ma trận cho phép nhân <span class="math inline">\(\% * \%\)</span>.</p>
</div>
<div id="ma-trận-đường-chéo-và-ma-trận-đơn-vị" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Ma trận đường chéo và ma trận đơn vị<a href="kiến-thức-r-nâng-cao.html#ma-trận-đường-chéo-và-ma-trận-đơn-vị" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Các khái niệm và phép toán trên ma trận được trình bày bắt đầu từ phần này sẽ chỉ áp dụng trên ma trận vuông, nghĩa là ma trận có số hàng bằng với số cột. Trong một ma trận vuông, các phần tử nằm trên đường chéo chính là các phần tử có chỉ số hàng bằng với chỉ số cột, các phần tử nằm trên đường chéo phụ là các phần tử có chỉ số hàng cộng với chỉ số cột bằng <span class="math inline">\(n+1\)</span> trong đó <span class="math inline">\(n\)</span> là số hàng (hay cột) của ma trận vuông. Với ma trận vuông <span class="math inline">\(M\)</span> có kích thước <span class="math inline">\(n \times n\)</span> đường chéo chính của ma trận được ký hiệu là <span class="math inline">\(diag(M)\)</span> xác định như sau</p>
<p><span class="math display" id="eq:mat03">\[\begin{align}
&amp; M
=
\begin{bmatrix}
m_{11} &amp; m_{12} &amp; m_{13} &amp; m_{14} \\
m_{21} &amp; m_{22} &amp; m_{23} &amp; m_{24} \\
m_{31} &amp; m_{32} &amp; m_{33} &amp; m_{34}\\
m_{41} &amp; m_{42} &amp; m_{43} &amp; m_{44}
\end{bmatrix} \\
&amp; \\
&amp; diag(M) = (m_{11}, m_{22}, m_{33},  m_{44})
\tag{3.3}
\end{align}\]</span></p>
<p>Ma trận có tất cả các phần tử nằm ngoài đường chéo chính bằng 0 được gọi là ma trận đường chéo. Hàm <code>diag()</code> trong R được sử dụng để lấy ra véc-tơ đường chéo chính của một ma trận vuông, hoặc để tạo ra một ma trận đường chéo, hoặc cũng có thể dùng để khai báo một ma trận đường chéo:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="kiến-thức-r-nâng-cao.html#cb313-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb313-2"><a href="kiến-thức-r-nâng-cao.html#cb313-2" tabindex="-1"></a><span class="fu">diag</span>(M) <span class="co"># Lấy ra véc-tơ đường chéo chính của M</span></span></code></pre></div>
<pre><code>## [1] 1 5 9</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="kiến-thức-r-nâng-cao.html#cb315-1" tabindex="-1"></a><span class="co"># Tạo ra ma trận đường chéo có đường chéo chính là (1,10,100)</span></span>
<span id="cb315-2"><a href="kiến-thức-r-nâng-cao.html#cb315-2" tabindex="-1"></a>M1<span class="ot">&lt;-</span><span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>)) </span>
<span id="cb315-3"><a href="kiến-thức-r-nâng-cao.html#cb315-3" tabindex="-1"></a><span class="fu">print</span>(M1)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    0    0
## [2,]    0   10    0
## [3,]    0    0  100</code></pre>
<p>Ma trận đơn vị kích thước <span class="math inline">\(n \times n\)</span>, thường được ký hiệu <span class="math inline">\(I_n\)</span>, là một ma trận đường chéo mà tất cả các phần tử trên đường chéo chính bằng 1. Ma trận đơn vị <span class="math inline">\(I_n\)</span> có tính chất quan trọng là mọi ma trận <span class="math inline">\(M\)</span> kích thước <span class="math inline">\(k \times n\)</span> khi thực hiện phép nhân ma trận với ma trận <span class="math inline">\(I_n\)</span> sẽ có kết quả đúng bằng ma trận <span class="math inline">\(M\)</span>. Bạn đọc có thể quan sát ví dụ sau:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="kiến-thức-r-nâng-cao.html#cb317-1" tabindex="-1"></a>In<span class="ot">&lt;-</span><span class="fu">diag</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="co"># ma trận đơn vị kích thước 4*4</span></span>
<span id="cb317-2"><a href="kiến-thức-r-nâng-cao.html#cb317-2" tabindex="-1"></a><span class="fu">print</span>(In)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    0    0    0
## [2,]    0    1    0    0
## [3,]    0    0    1    0
## [4,]    0    0    0    1</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="kiến-thức-r-nâng-cao.html#cb319-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="co"># ma trận vuông 5 * 4</span></span>
<span id="cb319-2"><a href="kiến-thức-r-nâng-cao.html#cb319-2" tabindex="-1"></a><span class="fu">print</span>(M <span class="sc">%*%</span> In) <span class="co"># kết quả vẫn là ma trận M</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    6   11   16
## [2,]    2    7   12   17
## [3,]    3    8   13   18
## [4,]    4    9   14   19
## [5,]    5   10   15   20</code></pre>
</div>
<div id="định-thức-của-ma-trận" class="section level3 hasAnchor" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Định thức của ma trận<a href="kiến-thức-r-nâng-cao.html#định-thức-của-ma-trận" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Định thức của ma trận là một khái niệm toán học phức tạp. Phần lớn bạn đọc khi làm quen với khái niệm định thức trong môn học đại số tuyến tính sẽ được giới thiệu về công thức tính định thức của một ma trận, hoặc sử dụng định thức của ma trận để thực hiện tính toán như giải hệ phương trình thay vì thực sự hiểu khái niệm định thức được bắt đầu từ đâu. Định thức là một giá trị số thực đặc trưng của một ma trận vuông. Định thức cho biết nhiều tính chất quan trọng của ma trận đó, đồng thời định thức xuất hiện trong rất nhiều tính toán liên quan đến ma trận.</p>
<p>Hãy bắt đầu với một ma trận vuông <span class="math inline">\(M\)</span> kích thước <span class="math inline">\(2 \times 2\)</span> như sau:
<span class="math display">\[\begin{align}
M
=
\begin{bmatrix}
m_{11} &amp; m_{12}\\
m_{21} &amp; m_{22}
\end{bmatrix}
\end{align}\]</span></p>
<p>Định thức của ma trận <span class="math inline">\(M\)</span> được ký hiệu là <span class="math inline">\(|M|\)</span> hoặc <span class="math inline">\(det(M)\)</span> được xác định bởi công thức
<span class="math display" id="eq:mat04">\[\begin{align}
det(M) = m_{11} \times m_{22} - m_{12} \times m_{21}
\tag{3.4}
\end{align}\]</span></p>
<p>Định thức của ma trận <span class="math inline">\(M\)</span> có thể biểu diễn dưới dạng diện tích của hình bình hành tạo thành từ 4 điểm có tọa độ <span class="math inline">\((0,0)\)</span>, <span class="math inline">\((m_{11},m_{12})\)</span>, <span class="math inline">\((m_{21},m_{22})\)</span>, và <span class="math inline">\((m_{11}+m_{21}, m_{12}+m_{22})\)</span>. Thật vậy, giả sử hai ma trận <span class="math inline">\(M\)</span> và <span class="math inline">\(M_1\)</span> có kích thước <span class="math inline">\(2 \times 2\)</span>; ma trận <span class="math inline">\(M_1\)</span> nhận được bằng cách đổi vị trí 2 dòng của ma trận <span class="math inline">\(M\)</span></p>
<p><span class="math display">\[\begin{align}
&amp; M
=
\begin{bmatrix}
2 &amp; 1 \\
1 &amp; 3
\end{bmatrix}  \text{  và  } M_1
=
\begin{bmatrix}
1 &amp; 3 \\
2 &amp; 1
\end{bmatrix} \\
&amp; \\

&amp; det(M) = 5  \text{  và  } det(M_1) = -5

\end{align}\]</span></p>
<p>Hiểu một cách đơn giản, chúng ta có thể coi định thức của <span class="math inline">\(M\)</span> và <span class="math inline">\(M_1\)</span> qua diện tích của các hình bình hành tạo bởi hai véc-tơ (2,1) và véc-tơ (1,3) giống như hình <a href="#fig:fgadvr01"><strong>??</strong></a>. Sự khác nhau của hai định thức chỉ ở thứ tự véc-tơ: đối với định thức của <span class="math inline">\(M\)</span> thì véc-tơ (2,1) được đặt trước trong khi đối với định thức của <span class="math inline">\(M_1\)</span> thì véc-tơ (1,3) được tính đến trước.</p>
<div class="figure">
<img src="bookdown-demo_files/figure-html/fgadvr01%20-1.png" alt="Định thức của ma trận kích thước 2 * 2 có thể được biểu diễn dưới dạng diện tích. Hình bên trái: Định thức là số dương vì véc-tơ hàng thứ nhất (2,1) nằm phía bên phải véc-tơ hàng thứ hai (1,3). Hình bên phải: Định thức là số âm vì véc-tơ hàng thứ nhất (1,3) nằm phía bên trái véc-tơ hàng thứ hai (2,1)" width="672" />
<p class="caption">
(#fig:fgadvr01 )Định thức của ma trận kích thước 2 * 2 có thể được biểu diễn dưới dạng diện tích. Hình bên trái: Định thức là số dương vì véc-tơ hàng thứ nhất (2,1) nằm phía bên phải véc-tơ hàng thứ hai (1,3). Hình bên phải: Định thức là số âm vì véc-tơ hàng thứ nhất (1,3) nằm phía bên trái véc-tơ hàng thứ hai (2,1)
</p>
</div>
<p>Giá trị của định thức sẽ cho ta biết thông tin về các véc-tơ tạo nên ma trận:</p>
<ul>
<li><p>Định thức bằng 0 chỉ xảy ra khi hai véc-tơ (hai mũi tên màu xanh và màu cam xuất phát từ điểm <span class="math inline">\((0,0)\)</span>) trùng nhau hoặc đối đỉnh nhau. Điều này chỉ xảy ra khi véc-tơ thứ nhất bằng véc-tơ thứ hai nhân với một số. Trong trường hợp tổng quát với ma trận vuông kích thước <span class="math inline">\(n \times n\)</span>, định thức bằng 0 khi một véc-tơ nào đó là tổ hợp tuyến tính của các véc-tơ còn lại.</p></li>
<li><p>Định thức gần bằng 0 nghĩa là góc tạo bởi 2 véc-tơ rất gần 0 hoặc tạo với nhau một góc xấp xỉ 180 độ. Ma trận vuông kích thước <span class="math inline">\(n \times n\)</span> có định thức xấp xỉ bằng 0 nghĩa là mối liên hệ tuyến tính giữa các véc-tơ của ma trận là rất chặt chẽ.</p></li>
<li><p>Dấu của định thức cho ta biết vị trí của các véc-tơ. Véc-tơ hàng thứ nhất tương ứng với màu xanh trong khi véc-tơ hàng thứ hai tương ứng với màu cam. Dấu của định thức dương chỉ khi véc-tơ màu xanh nằm phía trên (bên trái) véc-tơ màu cam, và dấu của định thức là âm chỉ khi véc-tơ màu xanh nằm phía dưới (bên phải) véc-tơ màu cam.</p></li>
</ul>
<p>Với các ma trận vuông kích thước <span class="math inline">\(n \times n\)</span>; <span class="math inline">\(n \geq 3\)</span> định thức của ma trận được tính bằng cách lựa chọn một dòng (hoặc cột) thứ <span class="math inline">\(i\)</span> bất kỳ và sau đó thực hiện phép khai triển
<span class="math display" id="eq:mat05">\[\begin{align}
det(M) = \sum\limits_{j = 1}^n (-1)^{i+j} \times m_{ij} \times det(M_{-i,-j})
\tag{3.5}
\end{align}\]</span>
trong đó <span class="math inline">\(M_{\{-i,-j\}}\)</span> mà ma trận vuông kích thước <span class="math inline">\((n-1) \times (n-1)\)</span> nhận được sau khi bỏ đi hàng thứ <span class="math inline">\(i\)</span> và cột thứ <span class="math inline">\(j\)</span> của ma trận <span class="math inline">\(M\)</span>.</p>
<p>Định thức của ma trận <span class="math inline">\(M\)</span> kích thước <span class="math inline">\(3 \times 3\)</span> có thể tính toán dựa trên định thức của các ma trận con và lựa chọn hàng <span class="math inline">\(i=2\)</span> như sau</p>
<p><span class="math display" id="eq:mat06">\[\begin{align}
&amp; M
=
\begin{bmatrix}
m_{11} &amp; m_{12} &amp; m_{13}  \\
m_{21} &amp; m_{22} &amp; m_{23} \\
m_{31} &amp; m_{32} &amp; m_{33}
\end{bmatrix} \\
&amp; \\
&amp; det(M) = - m_{21} \times \begin{vmatrix}
m_{12} &amp; m_{13}  \\
m_{32} &amp; m_{33}
\end{vmatrix} + m_{22} \times \begin{vmatrix}
m_{11} &amp; m_{13}  \\
m_{31} &amp; m_{33}  
\end{vmatrix} - m_{23} \times \begin{vmatrix}
m_{11} &amp; m_{12}  \\
m_{31} &amp; m_{32}  
\end{vmatrix}
\tag{3.6}
\end{align}\]</span></p>
<p>Hàm <code>det()</code> trong R được sử dụng để tính định thức của ma trận.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="kiến-thức-r-nâng-cao.html#cb321-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>),<span class="at">nrow =</span> <span class="dv">2</span>,<span class="at">ncol =</span> <span class="dv">2</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb321-2"><a href="kiến-thức-r-nâng-cao.html#cb321-2" tabindex="-1"></a><span class="fu">det</span>(M)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>Một vài tính chất quan trọng của định thức:</p>
<ul>
<li>Định thức của một ma trận đường chéo bằng tích các phần tử nằm trên đường chéo chính của ma trận đó. Ma trận đường chéo là một trường hợp đặc biệt của ma trận tam giác. Ma trận tam giác trên là ma trận có tất cả các phần tử nằm phía dưới đường chéo chính nhận giá trị bằng 0. Tương tự, ma trận tam giác dưới là ma trận có tất cả các phần tử nằm phía trên đường chéo chính nhận giá trị bằng 0. Các ma trận tam giác có tính chất như đã phát biểu ở trên: định thức của các ma trận này bằng tích các phần tử nằm trên đường chéo chính.</li>
</ul>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="kiến-thức-r-nâng-cao.html#cb323-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>,<span class="at">nrow =</span> <span class="dv">4</span>,<span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb323-2"><a href="kiến-thức-r-nâng-cao.html#cb323-2" tabindex="-1"></a>M[<span class="fu">lower.tri</span>(M)]<span class="ot">&lt;-</span><span class="dv">0</span> <span class="co"># cho các phần tử phía dưới đường chéo chính bằng 0</span></span>
<span id="cb323-3"><a href="kiến-thức-r-nâng-cao.html#cb323-3" tabindex="-1"></a><span class="fu">print</span>(M) <span class="co"># ma trận M là ma trận tam giác trên</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    5    9   13
## [2,]    0    6   10   14
## [3,]    0    0   11   15
## [4,]    0    0    0   16</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="kiến-thức-r-nâng-cao.html#cb325-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="fu">det</span>(M), <span class="fu">prod</span>(<span class="fu">diag</span>(M)))) <span class="co"># định thức của M bằng tích các số trên đường chéo chính</span></span></code></pre></div>
<pre><code>## [1] 1056 1056</code></pre>
<ul>
<li>Định thức của ma trận chuyển vị của một ma trận bằng định thức của ma trận đó:
<span class="math display">\[\begin{align}
det(M) = det(M^T)
\end{align}\]</span></li>
</ul>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="kiến-thức-r-nâng-cao.html#cb327-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">16</span>),<span class="at">nrow =</span> <span class="dv">4</span>,<span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb327-2"><a href="kiến-thức-r-nâng-cao.html#cb327-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="fu">det</span>(M),<span class="fu">det</span>(<span class="fu">t</span>(M))))</span></code></pre></div>
<pre><code>## [1] -0.05385941 -0.05385941</code></pre>
<ul>
<li>Định thức của tích hai ma trận bằng tích của các định thức. Lưu ý rằng điều này chỉ đúng với hai ma trận vuông có cùng kích thước:
<span class="math display">\[\begin{align}
det(A \% * \% B) = det(A) \times det(B)
\end{align}\]</span></li>
</ul>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="kiến-thức-r-nâng-cao.html#cb329-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">16</span>),<span class="at">nrow =</span> <span class="dv">4</span>,<span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb329-2"><a href="kiến-thức-r-nâng-cao.html#cb329-2" tabindex="-1"></a>M1<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">16</span>),<span class="at">nrow =</span> <span class="dv">4</span>,<span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb329-3"><a href="kiến-thức-r-nâng-cao.html#cb329-3" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="fu">det</span>(M<span class="sc">%*%</span>M1),<span class="fu">det</span>(M)<span class="sc">*</span><span class="fu">det</span>(M1))) </span></code></pre></div>
<pre><code>## [1] 0.1100249 0.1100249</code></pre>
</div>
<div id="ma-trận-nghịch-đảo" class="section level3 hasAnchor" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> Ma trận nghịch đảo<a href="kiến-thức-r-nâng-cao.html#ma-trận-nghịch-đảo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ma trận nghịch đảo của một ma trận vuông <span class="math inline">\(M\)</span>, thường được ký hiệu <span class="math inline">\(M^{-1}\)</span>, là ma trận vuông có cùng kích thước với ma trận <span class="math inline">\(M\)</span> và thỏa mãn tính chất: phép nhân ma trận giữa ma trận <span class="math inline">\(M\)</span> với ma trận nghịch đảo <span class="math inline">\(M^{-1}\)</span> sẽ cho kết quả là một ma trận đơn vị. Không phải ma trận vuông nào cũng có ma trận nghịch đảo; chỉ có các ma trận có định thức khác 0 là có ma trận nghịch đảo. Các ma trận có ma trận nghịch đảo được còn được gọi là các ma trận khả nghịch. Các ma trận khả nghịch luôn có một ma trận nghịch đảo duy nhất.</p>
<p><span class="math display" id="eq:mat07">\[\begin{align}
M \ \% * \% \ M^{-1} = I_n
\tag{3.7}
\end{align}\]</span></p>
<p>Hai lần lấy nghịch đảo liên tiếp với một ma trận khả nghịch sẽ quay trở lại ma trận ban đầu, hay nói một cách khác ma trận nghịch đảo của ma trận <span class="math inline">\(M^{-1}\)</span> chính là ma trận <span class="math inline">\(M\)</span>
<span class="math display">\[\begin{align}
M^{-1} \ \% * \% \ M = I_n
\end{align}\]</span></p>
<p>Phương pháp chung để tính toán ma trận nghịch đảo là dựa trên các ma trận liên hợp (adjugate matrix). Ma trận liên hợp của ma trận <span class="math inline">\(M\)</span> được ký hiệu là <span class="math inline">\(adj(M)\)</span> là ma trận vuông kích thước <span class="math inline">\(n \times n\)</span> mà phần tử ở hàng thứ <span class="math inline">\(i\)</span>, cột thứ <span class="math inline">\(j\)</span> được tính bằng
<span class="math display" id="eq:mat08">\[\begin{align}
adj(M)_{ij} = (-1)^{j+i} det(M_{\{-j,-i\}})
\tag{3.8}
\end{align}\]</span>
Khi tính toán định thức của ma trận <span class="math inline">\(M\)</span>, chúng tôi đã sử dụng ký hiệu <span class="math inline">\(M_{\{-j,-i\}}\)</span> cho ma trận vuông kích thước <span class="math inline">\((n-1) \times (n-1)\)</span> nhận được sau khi bỏ đi hàng thứ <span class="math inline">\(j\)</span> và cột thứ <span class="math inline">\(i\)</span> của ma trận <span class="math inline">\(M\)</span>. Bạn đọc lưu ý rằng có sự thay đổi vị trí của <span class="math inline">\(i\)</span> và <span class="math inline">\(j\)</span> trong vế phải của phương trình <a href="kiến-thức-r-nâng-cao.html#eq:mat08">(3.8)</a>. Ma trận nghịch đảo <span class="math inline">\(M^{-1}\)</span> được tính từ ma trận liên hợp như sau
<span class="math display" id="eq:mat09">\[\begin{align}
M^{-1} = \cfrac{1}{det(M)} adj(M)_{ij}
\tag{3.9}
\end{align}\]</span></p>
<p>Nhìn chung, để tính toán ma trận nghịch đảo của một ma trận kích thước <span class="math inline">\(n \times n\)</span>, chúng ta sẽ phải tính toán định thức của ma trận ban đầu và định thức của <span class="math inline">\(n^2\)</span> ma trận vuông có kích thước <span class="math inline">\((n-1) \times (n-1)\)</span>. Với các ma trận vuông có kích thước lớn, việc tính toán sử dụng công thức như trên sẽ tốn nhiều thời gian và bộ nhớ. Có nhiều thuật toán để tính xấp xỉ ma trận nghịch đảo của một ma trận. Nội dung của các thuật toán này vượt quá phạm vi của cuốn sách. Bạn đọc có thể sử dụng hàm <code>solve()</code> có sẵn trong để tính toán ma trận nghịch đảo như sau</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="kiến-thức-r-nâng-cao.html#cb331-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb331-2"><a href="kiến-thức-r-nâng-cao.html#cb331-2" tabindex="-1"></a></span>
<span id="cb331-3"><a href="kiến-thức-r-nâng-cao.html#cb331-3" tabindex="-1"></a><span class="co"># Tạo ma trận gồm toàn các số ngẫu nhiên</span></span>
<span id="cb331-4"><a href="kiến-thức-r-nâng-cao.html#cb331-4" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">16</span>),<span class="at">nrow =</span> <span class="dv">4</span>,<span class="at">ncol =</span> <span class="dv">4</span>) </span>
<span id="cb331-5"><a href="kiến-thức-r-nâng-cao.html#cb331-5" tabindex="-1"></a>M1<span class="ot">&lt;-</span><span class="fu">solve</span>(M) <span class="co"># Ma trận M1 là ma trận nghịch đảo của ma trận M</span></span>
<span id="cb331-6"><a href="kiến-thức-r-nâng-cao.html#cb331-6" tabindex="-1"></a></span>
<span id="cb331-7"><a href="kiến-thức-r-nâng-cao.html#cb331-7" tabindex="-1"></a><span class="co"># Kiểm tra:</span></span>
<span id="cb331-8"><a href="kiến-thức-r-nâng-cao.html#cb331-8" tabindex="-1"></a>M1 <span class="sc">%*%</span> M <span class="co"># Tích của M1 với M là ma trận đơn vị</span></span></code></pre></div>
<pre><code>##               [,1]         [,2]          [,3]          [,4]
## [1,]  1.000000e+00 1.110223e-16 -4.440892e-16  2.220446e-16
## [2,]  2.220446e-16 1.000000e+00  0.000000e+00 -2.220446e-16
## [3,] -5.551115e-17 0.000000e+00  1.000000e+00 -1.387779e-17
## [4,]  1.110223e-16 1.110223e-16  0.000000e+00  1.000000e+00</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="kiến-thức-r-nâng-cao.html#cb333-1" tabindex="-1"></a>M <span class="sc">%*%</span> M1 <span class="co"># Tích của M với M1 là ma trận đơn vị</span></span></code></pre></div>
<pre><code>##               [,1]          [,2]          [,3]          [,4]
## [1,]  1.000000e+00 -2.775558e-17 -2.775558e-17 -5.551115e-17
## [2,]  0.000000e+00  1.000000e+00  0.000000e+00 -2.220446e-16
## [3,] -5.551115e-17  0.000000e+00  1.000000e+00  4.440892e-16
## [4,]  2.775558e-17 -4.163336e-17 -8.326673e-17  1.000000e+00</code></pre>
<p>Các tính toán liên quan đến định thức cần nhớ</p>
<ol style="list-style-type: decimal">
<li><p>Định thức của ma trận sau khi nhân tất cả các phần tử với một số
<span class="math display" id="eq:mat10">\[\begin{align}
det(\lambda M) = \lambda^n \times det(M)
\tag{3.10}
\end{align}\]</span></p></li>
<li><p>Định thức của ma trận chuyển vị <span class="math inline">\(M^{-T}\)</span> bằng định thức của ma trận <span class="math inline">\(M\)</span>
<span class="math display" id="eq:mat11">\[\begin{align}
det(M^T) = det(M)
\tag{3.11}
\end{align}\]</span></p></li>
<li><p>Tích của định thức của ma trận <span class="math inline">\(M^{-1}\)</span> với định thức của ma trận <span class="math inline">\(M\)</span> bằng 1.
<span class="math display" id="eq:mat12">\[\begin{align}
det(M^{-1}) \times det(M) = det(I_n) = 1
\tag{3.12}
\end{align}\]</span></p></li>
</ol>
</div>
</div>
<div id="mảng-nhiều-chiều" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Mảng nhiều chiều<a href="kiến-thức-r-nâng-cao.html#mảng-nhiều-chiều" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ma trận lưu phần tử trong hai chiều mà chúng ta gọi là hàng và cột. Đa số dữ liệu kiểu bảng biểu truyền thống đều có thể biểu diễn dưới dạng ma trận. Tuy nhiên có những kiểu dữ liệu mà khi biểu diễn dưới dạng ma trận hai chiều là không dễ dàng và có thể gây nhầm lẫn cho người sử dụng. Có thể kể đến dữ liệu kiểu hình ảnh. Khi bạn đọc lưu một bức ảnh màu lên trên máy tính điện tử, bức ảnh sẽ được số hóa thành một mảng ba chiều, bao gồm có chiều cao, chiều rộng của ảnh và một chiều thứ ba là màu sắc của điểm ảnh. Phức tạp hơn nữa nếu dữ liệu là một đoạn phim, hay một hình động, bạn đọc sẽ cần phải sử dụng thêm chiều thứ tư để mô tả thời gian xuất hiện của mỗi hình ảnh trong đoạn phim.</p>
<p>Thông thường thì người làm việc với dữ liệu sẽ đổi các mảng nhiều chiều về mảng hai chiều hoặc một chiều (véc-tơ) để dễ dàng xử lý. Tuy nhiên, bạn đọc cũng cần nằm được các thao tác cơ bản khi làm việc với mảng nhiều chiều để xử lý được các dữ liệu như đề cập ở trên.</p>
<div id="khởi-tạo-mảng-nhiều-chiều" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Khởi tạo mảng nhiều chiều<a href="kiến-thức-r-nâng-cao.html#khởi-tạo-mảng-nhiều-chiều" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Để tạo mảng nhiều chiều bạn đọc sử dụng hàm <span class="math inline">\(array()\)</span>.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="kiến-thức-r-nâng-cao.html#cb335-1" tabindex="-1"></a>Ar<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>,<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)) <span class="co"># mảng 3 chiều</span></span>
<span id="cb335-2"><a href="kiến-thức-r-nâng-cao.html#cb335-2" tabindex="-1"></a>Ar <span class="co"># hiển thị mảng 3 chiều Ar</span></span></code></pre></div>
<pre><code>## , , 1
## 
##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6
## 
## , , 2
## 
##      [,1] [,2] [,3]
## [1,]    7    9   11
## [2,]    8   10   12
## 
## , , 3
## 
##      [,1] [,2] [,3]
## [1,]   13   15   17
## [2,]   14   16   18
## 
## , , 4
## 
##      [,1] [,2] [,3]
## [1,]   19   21   23
## [2,]   20   22   24</code></pre>
<p>Bạn đọc có thể thấy R hiển thị mảng ba chiều <span class="math inline">\(Ar\)</span> kích thước <span class="math inline">\(2 \times 3 \times 4\)</span> như là sự kết hợp của 4 ma trận kích thước <span class="math inline">\(2 \times 3\)</span>. Tương tự như khi khởi tạo giá trị cho ma trận, số lượng phần tử đưa vào trong mảng phải bằng với số phần tử của mảng, trong trường hợp mảng <span class="math inline">\(Ar\)</span> ở trên là véc-tơ có độ dài 24 tương ứng với <span class="math inline">\(2 \times 3 \times 4 = 24\)</span> phần tử của mảng.</p>
<p>Để lấy ra các phần tử con (một biến, một ma trận, hay 1 mảng nhiều chiều) từ một nhiều mảng, bạn đọc sử dụng dấu ngoặc vuông <code>[]</code> giống như khi làm với ma trận. Lưu ý rằng khi lấy phần tử con từ một mảng, bạn đọc cần phải sử dụng chỉ số cho tất cả các chiều.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="kiến-thức-r-nâng-cao.html#cb337-1" tabindex="-1"></a>Ar[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>] <span class="co"># phần tử có các chỉ số 1 - 2 - 1 </span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="kiến-thức-r-nâng-cao.html#cb339-1" tabindex="-1"></a>Ar[,,<span class="dv">1</span>] <span class="co"># ma trận 2 * 3</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="kiến-thức-r-nâng-cao.html#cb341-1" tabindex="-1"></a>Ar[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)] <span class="co"># mảng trận 2 * 2 * 2</span></span></code></pre></div>
<pre><code>## , , 1
## 
##      [,1] [,2]
## [1,]    1    5
## [2,]    2    6
## 
## , , 2
## 
##      [,1] [,2]
## [1,]   19   23
## [2,]   20   24</code></pre>
<p>Thứ tự các phần tử khi điền vào mảng khi sử dụng hàm trong hàm <code>array()</code> sẽ là ưu tiên ma trận kích thước <span class="math inline">\(2 \times 3\)</span> tương ứng với chỉ số <span class="math inline">\([,,1]\)</span> trước, rồi đến ma trận kích thước <span class="math inline">\(2 \times 3\)</span> tương ứng với chỉ số <span class="math inline">\([,,2]\)</span>,…, và tiếp tục như thế cho đến khi tất cả các phần tử của mảng được gán giá trị.</p>
</div>
<div id="sử-dụng-mảng-nhiều-chiều-để-biến-đổi-dữ-liệu-kiểu-hình-ảnh" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Sử dụng mảng nhiều chiều để biến đổi dữ liệu kiểu hình ảnh<a href="kiến-thức-r-nâng-cao.html#sử-dụng-mảng-nhiều-chiều-để-biến-đổi-dữ-liệu-kiểu-hình-ảnh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Để bạn đọc có cái nhìn trực quan hơn về mảng nhiều chiều, chúng ta sẽ thực hiện các phép biến đổi, tính toán trên một dữ liệu cụ thể. Như chúng tôi đã nói ở trên, mảng nhiều chiều là một đối tượng thích hợp dùng để lưu dữ liệu kiểu hình ảnh. Thư viện <span class="math inline">\(\textbf{imager}\)</span> có thể được cài đặt thêm vào R có các hàm thích hợp để làm việc với dữ liệu kiểu hình ảnh. Chúng ta sẽ sử dụng một mảng nhiều chiều để lưu một bức ảnh và thực hiện các phép biến đổi bức ảnh đó sử dụng tính toán trên mảng nhiều chiều.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="kiến-thức-r-nâng-cao.html#cb343-1" tabindex="-1"></a><span class="co">#install.packages(&quot;imager&quot;)</span></span>
<span id="cb343-2"><a href="kiến-thức-r-nâng-cao.html#cb343-2" tabindex="-1"></a><span class="fu">library</span>(imager)</span></code></pre></div>
<p>Hàm <code>load.image()</code> trong thư viện <span class="math inline">\(\textbf{imager}\)</span> có thể đọc các file hình ảnh có định dạng <span class="math inline">\(png\)</span>, <span class="math inline">\(jpeg\)</span>, hoặc <span class="math inline">\(bmp\)</span>. Bạn đọc có thể đọc một hình ảnh có một trong các định dạng kể trên</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="kiến-thức-r-nâng-cao.html#cb344-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/AD/Desktop/Tex file/Thu latex/Book demo/bookdown_demo_hieu/Image&quot;</span>)</span>
<span id="cb344-2"><a href="kiến-thức-r-nâng-cao.html#cb344-2" tabindex="-1"></a>img<span class="ot">&lt;-</span><span class="fu">load.image</span>(<span class="st">&quot;cat.jpg&quot;</span>) <span class="co"># đọc hình ảnh tên &quot;cat&quot; vào </span></span>
<span id="cb344-3"><a href="kiến-thức-r-nâng-cao.html#cb344-3" tabindex="-1"></a><span class="fu">plot</span>(img)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>Để biết <span class="math inline">\(img\)</span> được đọc bằng hàm <code>load.image()</code> là kiểu đối tượng nào, bạn đọc dùng hàm <code>class()</code></p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="kiến-thức-r-nâng-cao.html#cb345-1" tabindex="-1"></a><span class="fu">class</span>(img)</span></code></pre></div>
<pre><code>## [1] &quot;cimg&quot;         &quot;imager_array&quot; &quot;numeric&quot;</code></pre>
<p>R cho biết đây là một đối tượng kiểu <span class="math inline">\(cimg\)</span>. Kiểu đối tượng này về bản chất là một mảng bốn chiều. Chiều thứ nhất là cho biết chiều rộng của bức ảnh, chiều thứ hai cho biết chiều cao của bức ảnh, chiều thứ ba luôn bằng 1 đối với dữ liệu kiểu ảnh và chiều thứ tư bằng 3 nếu bức ảnh là ảnh màu.</p>
<p>Đối tượng kiểu <span class="math inline">\(cimg\)</span> cho phép bạn đọc thực hiện các biến đổi, tính toán giống như trên một mảng nhiều chiều mà không cần phải chuyển đổi sang kiểu mảng. Chẳng hạn như để biết bức ảnh được lưu bởi đối tượng tên <span class="math inline">\(img\)</span> có bao nhiêu chiều, chúng ta sử dụng hàm <code>dim()</code> giống như với mảng</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="kiến-thức-r-nâng-cao.html#cb347-1" tabindex="-1"></a><span class="fu">dim</span>(img) <span class="co"># mảng bốn chiều: chiều rộng * chiều cao * chiều thời gian * chiều màu sắc</span></span></code></pre></div>
<pre><code>## [1] 535 595   1   3</code></pre>
<p>Bức ảnh được lưu bởi đối tượng <span class="math inline">\(img\)</span> ở trên là một bức ảnh màu có chiều rộng 535 và chiều cao 595. Chiều thứ ba bằng 1 nghĩa là đây là một bức ảnh (chiều thứ ba lớn hơn 1 khi đối tượng là hình ảnh động). Chiều thứ tư bằng 3 đại diện cho 3 sắc màu: màu đỏ (Red), màu xanh lá cây (Green), và màu xanh da trời (Blue). Bạn đọc có thể hình dung một bức ảnh màu ở trên như là sự kết hợp của ba ma trận cùng kích thước 535 <span class="math inline">\(\times\)</span> 595, ma trận thứ nhất đại diện cho màu đỏ, ma trận thứ hai đại diện cho màu xanh lá cây và ma trận thứ ba đại diện cho màu xanh da trời. Mỗi giá trị trong ma trận là một số trong khoảng từ 0 đến 1. Giá trị 0 tương ứng với màu đen và giá trị càng gần 1 thì màu sắc của điểm đó càng gần màu mà ma trận đại diện. Để quan sát ma trận tương ứng với mỗi màu, bạn đọc cần gán giá trị của 2 ma trận còn lại bằng 0 trước khi hiển thị.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="kiến-thức-r-nâng-cao.html#cb349-1" tabindex="-1"></a>img_red<span class="ot">&lt;-</span>img</span>
<span id="cb349-2"><a href="kiến-thức-r-nâng-cao.html#cb349-2" tabindex="-1"></a>img_red[,,<span class="dv">1</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]<span class="ot">&lt;-</span><span class="dv">0</span> <span class="co"># cho 2 ma trận màu xanh lá và xanh dương bằng 0</span></span>
<span id="cb349-3"><a href="kiến-thức-r-nâng-cao.html#cb349-3" tabindex="-1"></a></span>
<span id="cb349-4"><a href="kiến-thức-r-nâng-cao.html#cb349-4" tabindex="-1"></a>img_green<span class="ot">&lt;-</span>img</span>
<span id="cb349-5"><a href="kiến-thức-r-nâng-cao.html#cb349-5" tabindex="-1"></a>img_green[,,<span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]<span class="ot">&lt;-</span><span class="dv">0</span> <span class="co"># cho 2 ma trận màu đỏ và xanh dương bằng 0</span></span>
<span id="cb349-6"><a href="kiến-thức-r-nâng-cao.html#cb349-6" tabindex="-1"></a></span>
<span id="cb349-7"><a href="kiến-thức-r-nâng-cao.html#cb349-7" tabindex="-1"></a>img_blue<span class="ot">&lt;-</span>img</span>
<span id="cb349-8"><a href="kiến-thức-r-nâng-cao.html#cb349-8" tabindex="-1"></a>img_blue[,,<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span> <span class="co"># cho 2 ma trận màu xanh lá và đỏ bằng 0</span></span>
<span id="cb349-9"><a href="kiến-thức-r-nâng-cao.html#cb349-9" tabindex="-1"></a></span>
<span id="cb349-10"><a href="kiến-thức-r-nâng-cao.html#cb349-10" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb349-11"><a href="kiến-thức-r-nâng-cao.html#cb349-11" tabindex="-1"></a><span class="fu">plot</span>(img_red, <span class="at">main =</span> <span class="st">&quot;Chỉ còn lại màu đỏ&quot;</span>)</span>
<span id="cb349-12"><a href="kiến-thức-r-nâng-cao.html#cb349-12" tabindex="-1"></a><span class="fu">plot</span>(img_green, <span class="at">main =</span> <span class="st">&quot;Chỉ còn lại màu xanh lá&quot;</span>)</span>
<span id="cb349-13"><a href="kiến-thức-r-nâng-cao.html#cb349-13" tabindex="-1"></a><span class="fu">plot</span>(img_blue, <span class="at">main =</span> <span class="st">&quot;Chỉ còn lại màu xanh dương&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<p>Hàm <code>as.cimg()</code> được dùng để đổi một mảng bốn chiều sang kiểu <span class="math inline">\(cimg\)</span> để có thể hiển thị khi sử dụng hàm <code>plot()</code>. Lưu ý rằng hãy luôn sử dụng chiều thứ ba bằng 1 và chiều thứ tư bằng 3 nếu bạn muốn tạo ảnh màu. Các câu lệnh dưới đây tạo ra các bức ảnh mà các giá trị trong các ma trận màu sắc hoàn toàn là các giá trị ngẫu nhiên phân phối đều (uniform) trong khoảng (0,1).</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="kiến-thức-r-nâng-cao.html#cb350-1" tabindex="-1"></a>img1<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="fu">runif</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">5</span><span class="sc">*</span><span class="dv">1</span><span class="sc">*</span><span class="dv">3</span>),<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">3</span>)) <span class="co"># bức ảnh màu kích thước 5*5</span></span>
<span id="cb350-2"><a href="kiến-thức-r-nâng-cao.html#cb350-2" tabindex="-1"></a>img1<span class="ot">&lt;-</span><span class="fu">as.cimg</span>(img1)</span>
<span id="cb350-3"><a href="kiến-thức-r-nâng-cao.html#cb350-3" tabindex="-1"></a></span>
<span id="cb350-4"><a href="kiến-thức-r-nâng-cao.html#cb350-4" tabindex="-1"></a>img2<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="fu">runif</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">1000</span><span class="sc">*</span><span class="dv">1</span><span class="sc">*</span><span class="dv">3</span>),<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">1000</span>,<span class="dv">1000</span>,<span class="dv">1</span>,<span class="dv">3</span>)) <span class="co"># bức ảnh màu kích thước 1000*1000</span></span>
<span id="cb350-5"><a href="kiến-thức-r-nâng-cao.html#cb350-5" tabindex="-1"></a>img2<span class="ot">&lt;-</span><span class="fu">as.cimg</span>(img2)</span>
<span id="cb350-6"><a href="kiến-thức-r-nâng-cao.html#cb350-6" tabindex="-1"></a></span>
<span id="cb350-7"><a href="kiến-thức-r-nâng-cao.html#cb350-7" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb350-8"><a href="kiến-thức-r-nâng-cao.html#cb350-8" tabindex="-1"></a><span class="fu">plot</span>(img1, <span class="at">interpolate =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Ảnh nhiễu 5 * 5&quot;</span>) </span>
<span id="cb350-9"><a href="kiến-thức-r-nâng-cao.html#cb350-9" tabindex="-1"></a><span class="fu">plot</span>(img2, <span class="at">interpolate =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Ảnh nhiễu 1000 * 1000&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>Tham số <span class="math inline">\(interpolate\)</span> nhận giá trị bằng FALSE có nghĩa là các điểm ảnh giữ nguyên giá trị. Tham số này có giá trị là mặc định là TRUE. Khi <span class="math inline">\(interpolate\)</span> nhận giá trị bằng TRUE hình ảnh hiển thị sẽ có sự giao thoa về màu sắc tại viền các điểm ảnh và làm cho ảnh nhìn mượt mà hơn.</p>
<p>Về bản chất, xử lý ảnh trên máy tính điện tử chính là xử lý các con số nằm trong mảng nhiều chiều. Chúng tôi sẽ giới thiệu một vài kỹ thuật xử lý đơn giản trên ảnh để bạn đọc có thể hiểu hơn về xử lý mảng nhiều chiều.</p>
<ul>
<li>Trước hết là thao tác cắt ảnh. Cắt ảnh chính là một phép lấy mảng con từ một mảng ban đầu. Thật vậy, trong ví dụ dưới đây chúng tôi cắt bức ảnh được lưu trong đối tượng tên là <span class="math inline">\(img\)</span> thành hai nửa, bức ảnh được chia theo chiều rộng:</li>
</ul>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="kiến-thức-r-nâng-cao.html#cb351-1" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="fu">dim</span>(img)[<span class="dv">1</span>] <span class="co"># Chiều rộng của ảnh</span></span>
<span id="cb351-2"><a href="kiến-thức-r-nâng-cao.html#cb351-2" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span>) <span class="co"># Điểm giữa để chia ảnh làm hai nửa</span></span>
<span id="cb351-3"><a href="kiến-thức-r-nâng-cao.html#cb351-3" tabindex="-1"></a>img1<span class="ot">&lt;-</span>img[<span class="dv">1</span><span class="sc">:</span>k,,,] <span class="co"># img1 là nửa bên trái của ảnh</span></span>
<span id="cb351-4"><a href="kiến-thức-r-nâng-cao.html#cb351-4" tabindex="-1"></a>img2<span class="ot">&lt;-</span>img[(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n,,,] <span class="co"># img2 là nửa bên phải của ảnh</span></span>
<span id="cb351-5"><a href="kiến-thức-r-nâng-cao.html#cb351-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb351-6"><a href="kiến-thức-r-nâng-cao.html#cb351-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.cimg</span>(img1), <span class="at">main =</span> <span class="st">&quot;Nửa bên trái&quot;</span>) </span>
<span id="cb351-7"><a href="kiến-thức-r-nâng-cao.html#cb351-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.cimg</span>(img2), <span class="at">main =</span> <span class="st">&quot;Nửa bên phải&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<ul>
<li>Tiếp theo, chúng ta sẽ thực hiện tăng hoặc giảm độ sáng của ảnh. Tăng hoặc giảm độ sáng của ảnh tương đương với việc điều chỉnh đồng thời các số trong mảng nhiều chiều gần hơn đến giá trị 1 hoặc gần hơn đến giá trị 0 theo cùng một tỷ lệ. Chúng ta thực hiện như sau</li>
</ul>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="kiến-thức-r-nâng-cao.html#cb352-1" tabindex="-1"></a>img1<span class="ot">&lt;-</span>img <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> img) <span class="sc">*</span> <span class="fl">0.3</span> <span class="co"># img1 là bức ảnh sau khi tăng độ sáng lên 30% </span></span>
<span id="cb352-2"><a href="kiến-thức-r-nâng-cao.html#cb352-2" tabindex="-1"></a>img2<span class="ot">&lt;-</span>img <span class="sc">-</span> img <span class="sc">*</span> <span class="fl">0.5</span> <span class="co"># img2 là bức ảnh sau khi giảm độ sáng đi 50%</span></span>
<span id="cb352-3"><a href="kiến-thức-r-nâng-cao.html#cb352-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb352-4"><a href="kiến-thức-r-nâng-cao.html#cb352-4" tabindex="-1"></a><span class="fu">plot</span>(img, <span class="at">rescale =</span> <span class="cn">FALSE</span>, <span class="at">main=</span> <span class="st">&quot;Ảnh ban đầu&quot;</span>) </span>
<span id="cb352-5"><a href="kiến-thức-r-nâng-cao.html#cb352-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.cimg</span>(img1), <span class="at">rescale =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Tăng độ sáng&quot;</span>) </span>
<span id="cb352-6"><a href="kiến-thức-r-nâng-cao.html#cb352-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.cimg</span>(img2),<span class="at">rescale =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Giảm độ sáng&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<ul>
<li>Một kỹ thuật xử lý ảnh khác là giảm kích thước của ảnh. Giả sử bạn đọc muốn giảm kích thước ảnh mỗi chiều 50%. Để làm được việc này, mỗi ma trận kích thước <span class="math inline">\(n \times m\)</span> sẽ được đổi thành ma trận kích thước <span class="math inline">\([n/2] \times [m/2]\)</span> trong đó <span class="math inline">\([n/2]\)</span> là phần nguyên của số <span class="math inline">\(n/2\)</span>. Nguyên tắc chuyển từ ma trận ban đầu sang ma trận có kích thước nhỏ hơn là mỗi ô <span class="math inline">\(2 \times 2\)</span> của ma trận ban đầu được chuyển thành 1 số (ô) trong ma trận mới. Giá trị mới này thường là giá trị trung bình, hoặc max, min của 4 phần tử của ma trận ban <span class="math inline">\(2 \times 2\)</span></li>
</ul>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="kiến-thức-r-nâng-cao.html#cb353-1" tabindex="-1"></a>giamchieu<span class="ot">&lt;-</span><span class="cf">function</span>(M,k){</span>
<span id="cb353-2"><a href="kiến-thức-r-nâng-cao.html#cb353-2" tabindex="-1"></a>  n<span class="ot">&lt;-</span><span class="fu">dim</span>(M)[<span class="dv">1</span>]; m<span class="ot">&lt;-</span><span class="fu">dim</span>(M)[<span class="dv">2</span>]</span>
<span id="cb353-3"><a href="kiến-thức-r-nâng-cao.html#cb353-3" tabindex="-1"></a>  n1<span class="ot">&lt;-</span><span class="fu">round</span>(n<span class="sc">/</span>k)<span class="sc">-</span><span class="dv">1</span>; m1<span class="ot">&lt;-</span><span class="fu">round</span>(m<span class="sc">/</span>k)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb353-4"><a href="kiến-thức-r-nâng-cao.html#cb353-4" tabindex="-1"></a>  M1<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,n1,m1)</span>
<span id="cb353-5"><a href="kiến-thức-r-nâng-cao.html#cb353-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n1){</span>
<span id="cb353-6"><a href="kiến-thức-r-nâng-cao.html#cb353-6" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m1){</span>
<span id="cb353-7"><a href="kiến-thức-r-nâng-cao.html#cb353-7" tabindex="-1"></a>      i1<span class="ot">&lt;-</span>(k<span class="sc">*</span>(i<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(k<span class="sc">*</span>i)</span>
<span id="cb353-8"><a href="kiến-thức-r-nâng-cao.html#cb353-8" tabindex="-1"></a>      j1<span class="ot">&lt;-</span>(k<span class="sc">*</span>(j<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(k<span class="sc">*</span>j)</span>
<span id="cb353-9"><a href="kiến-thức-r-nâng-cao.html#cb353-9" tabindex="-1"></a>      M1[i,j]<span class="ot">&lt;-</span><span class="fu">mean</span>(M[i1,j1],<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb353-10"><a href="kiến-thức-r-nâng-cao.html#cb353-10" tabindex="-1"></a>    }</span>
<span id="cb353-11"><a href="kiến-thức-r-nâng-cao.html#cb353-11" tabindex="-1"></a>  }</span>
<span id="cb353-12"><a href="kiến-thức-r-nâng-cao.html#cb353-12" tabindex="-1"></a>  <span class="fu">return</span>(M1)</span>
<span id="cb353-13"><a href="kiến-thức-r-nâng-cao.html#cb353-13" tabindex="-1"></a>}</span>
<span id="cb353-14"><a href="kiến-thức-r-nâng-cao.html#cb353-14" tabindex="-1"></a></span>
<span id="cb353-15"><a href="kiến-thức-r-nâng-cao.html#cb353-15" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="fu">dim</span>(img)[<span class="dv">1</span>]; m<span class="ot">&lt;-</span><span class="fu">dim</span>(img)[<span class="dv">2</span>]</span>
<span id="cb353-16"><a href="kiến-thức-r-nâng-cao.html#cb353-16" tabindex="-1"></a>k1<span class="ot">&lt;-</span><span class="dv">10</span>; k2<span class="ot">&lt;-</span><span class="dv">20</span></span>
<span id="cb353-17"><a href="kiến-thức-r-nâng-cao.html#cb353-17" tabindex="-1"></a>n1<span class="ot">&lt;-</span><span class="fu">round</span>(n<span class="sc">/</span>k1)<span class="sc">-</span><span class="dv">1</span>; m1<span class="ot">&lt;-</span><span class="fu">round</span>(m<span class="sc">/</span>k1)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb353-18"><a href="kiến-thức-r-nâng-cao.html#cb353-18" tabindex="-1"></a>n2<span class="ot">&lt;-</span><span class="fu">round</span>(n<span class="sc">/</span>k2)<span class="sc">-</span><span class="dv">1</span>; m2<span class="ot">&lt;-</span><span class="fu">round</span>(m<span class="sc">/</span>k2)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb353-19"><a href="kiến-thức-r-nâng-cao.html#cb353-19" tabindex="-1"></a></span>
<span id="cb353-20"><a href="kiến-thức-r-nâng-cao.html#cb353-20" tabindex="-1"></a>img1<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(n1,m1,<span class="dv">1</span>,<span class="dv">3</span>));</span>
<span id="cb353-21"><a href="kiến-thức-r-nâng-cao.html#cb353-21" tabindex="-1"></a>img2<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(n2,m2,<span class="dv">1</span>,<span class="dv">3</span>));</span>
<span id="cb353-22"><a href="kiến-thức-r-nâng-cao.html#cb353-22" tabindex="-1"></a></span>
<span id="cb353-23"><a href="kiến-thức-r-nâng-cao.html#cb353-23" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){ </span>
<span id="cb353-24"><a href="kiến-thức-r-nâng-cao.html#cb353-24" tabindex="-1"></a>  img1[,,<span class="dv">1</span>,i]<span class="ot">&lt;-</span><span class="fu">giamchieu</span>(img[,,<span class="dv">1</span>,i],k1)</span>
<span id="cb353-25"><a href="kiến-thức-r-nâng-cao.html#cb353-25" tabindex="-1"></a>  img2[,,<span class="dv">1</span>,i]<span class="ot">&lt;-</span><span class="fu">giamchieu</span>(img[,,<span class="dv">1</span>,i],k2)</span>
<span id="cb353-26"><a href="kiến-thức-r-nâng-cao.html#cb353-26" tabindex="-1"></a>}</span>
<span id="cb353-27"><a href="kiến-thức-r-nâng-cao.html#cb353-27" tabindex="-1"></a></span>
<span id="cb353-28"><a href="kiến-thức-r-nâng-cao.html#cb353-28" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb353-29"><a href="kiến-thức-r-nâng-cao.html#cb353-29" tabindex="-1"></a><span class="fu">plot</span>(img, <span class="at">interpolate =</span> <span class="cn">FALSE</span>, <span class="at">main=</span> <span class="st">&quot;Ảnh ban đầu&quot;</span>) </span>
<span id="cb353-30"><a href="kiến-thức-r-nâng-cao.html#cb353-30" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.cimg</span>(img1), <span class="at">interpolate =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Giảm kích thước 1:10&quot;</span>) </span>
<span id="cb353-31"><a href="kiến-thức-r-nâng-cao.html#cb353-31" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.cimg</span>(img2), <span class="at">interpolate =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Giảm kích thước 1:20&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-159-1.png" width="672" />
Bạn đọc có thể thấy rằng giảm kích thước của ảnh cũng là giảm kích thước của các mảng nhiều chiều. Khi kích thước ảnh giảm, khả năng hiển thị của ảnh cũng bị ảnh hưởng. Chúng ta sẽ quay trở lại với dữ liệu kiểu hình ảnh khi thảo luận về mô hình mạng thần kinh nhân tạo.</p>
</div>
</div>
<div id="list-trong-r" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> List trong R<a href="kiến-thức-r-nâng-cao.html#list-trong-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Không giống như véc-tơ, ma trận, hay mảng nhiều chiều, list là một cấu trúc trong R mà có thể chứa nhiều kiểu đối tượng khác nhau bao gồm biến, véc-tơ, ma trận, và cả các list khác. Với những bạn đọc đã học qua Python, list cũng giống như một dictionary. Đối với các bạn đọc đã học qua ngôn ngữ lập trình C++, list tương tự như một struct. List đóng vai trò quan trọng trong R, đặc biệt là trong viết hàm số và lập trình hướng đối tượng.</p>
<p>Trong phần này của cuốn sách, chúng ta sẽ tìm hiểu cách tạo ra list và ứng dụng cấu trúc của list để phục vụ công việc phân tích dữ liệu một cách hiệu quả nhất.</p>
<div id="khởi-tạo-list-và-chỉ-số-của-list." class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Khởi tạo list và chỉ số của list.<a href="kiến-thức-r-nâng-cao.html#khởi-tạo-list-và-chỉ-số-của-list." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hàm số để tạo ra một list trong R là hàm <code>list()</code>. Giả sử chúng ta muốn tạo thành một đối tượng có tên <span class="math inline">\(SV1\)</span> chứa các thông tin về một sinh viên</p>
<ol style="list-style-type: decimal">
<li><p>Tên của sinh viên: được lưu trong một biến kiểu chuỗi ký tự.</p></li>
<li><p>Ngày sinh của sinh viên: được lưu trong một biến kiểu thời gian.</p></li>
<li><p>Giới tính của sinh viên: được lưu trong một biến kiểu logic, giá trị TRUE tương ứng với giới tính Nam, và FALSE tương ứng với giới tính nữ.</p></li>
<li><p>Bảng điểm của sinh viên: là một data.frame có 2 cột, 1 cột là tên môn học và một cột là điểm của môn học tương ứng.</p></li>
</ol>
<p>Chúng ta sử dụng hàm <code>list()</code> để tạo ra một <span class="math inline">\(list\)</span> có tên <span class="math inline">\(SV1\)</span> như sau</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="kiến-thức-r-nâng-cao.html#cb354-1" tabindex="-1"></a>SV1<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">Ten =</span> <span class="st">&quot;Nguyễn Đức Nam&quot;</span>,</span>
<span id="cb354-2"><a href="kiến-thức-r-nâng-cao.html#cb354-2" tabindex="-1"></a>          <span class="at">Ngay_sinh =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-06-20&quot;</span>),</span>
<span id="cb354-3"><a href="kiến-thức-r-nâng-cao.html#cb354-3" tabindex="-1"></a>          <span class="at">Gioi_tinh =</span> <span class="cn">TRUE</span>,</span>
<span id="cb354-4"><a href="kiến-thức-r-nâng-cao.html#cb354-4" tabindex="-1"></a>          <span class="at">Bang_diem =</span> <span class="fu">data.frame</span>(<span class="at">Mon_hoc =</span> <span class="fu">c</span>(<span class="st">&quot;Giải tích&quot;</span>, <span class="st">&quot;Đại số&quot;</span>, <span class="st">&quot;Xác suất&quot;</span>),</span>
<span id="cb354-5"><a href="kiến-thức-r-nâng-cao.html#cb354-5" tabindex="-1"></a>                                 <span class="at">Diem =</span> <span class="fu">c</span>(<span class="fl">6.5</span>, <span class="fl">8.5</span>, <span class="fl">7.0</span>)))</span>
<span id="cb354-6"><a href="kiến-thức-r-nâng-cao.html#cb354-6" tabindex="-1"></a><span class="fu">str</span>(SV1) <span class="co"># xem cấu trúc của list SV1</span></span></code></pre></div>
<pre><code>## List of 4
##  $ Ten      : chr &quot;Nguyễn Đức Nam&quot;
##  $ Ngay_sinh: Date[1:1], format: &quot;2000-06-20&quot;
##  $ Gioi_tinh: logi TRUE
##  $ Bang_diem:&#39;data.frame&#39;:   3 obs. of  2 variables:
##   ..$ Mon_hoc: chr [1:3] &quot;Giải tích&quot; &quot;Đại số&quot; &quot;Xác suất&quot;
##   ..$ Diem   : num [1:3] 6.5 8.5 7</code></pre>
<p>Bạn đọc có thể thấy <span class="math inline">\(SV1\)</span> có bốn đối tượng con có tên là <span class="math inline">\(Ten\)</span>, <span class="math inline">\(Ngay\_sinh\)</span>, <span class="math inline">\(Gioi\_tinh\)</span>, và <span class="math inline">\(Bang\_diem\)</span>. Mỗi đối tượng con có một kiểu giá trị khác nhau, riêng đối tượng con <span class="math inline">\(Bang\_diem\)</span> là một dữ liệu hay còn được gọi là một data.frame.</p>
<p>Để lấy ra một đối tượng con của list bạn đọc sử dụng ký hiệu <span class="math inline">\(\$\)</span>. Ví dụ bạn muốn hiển thị bảng điểm của sinh viên có thông tin được lưu trong list <span class="math inline">\(SV1\)</span>, hãy sử dụng câu lệnh sau:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="kiến-thức-r-nâng-cao.html#cb356-1" tabindex="-1"></a>SV1<span class="sc">$</span>Bang_diem <span class="co"># Hiển thị bảng điểm</span></span></code></pre></div>
<pre><code>##     Mon_hoc Diem
## 1 Giải tích  6.5
## 2    Đại số  8.5
## 3  Xác suất  7.0</code></pre>
<p>Để biết tên các đối tượng trong một list, bạn đọc sử dụng hàm <code>names()</code>:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="kiến-thức-r-nâng-cao.html#cb358-1" tabindex="-1"></a><span class="fu">names</span>(SV1)</span></code></pre></div>
<pre><code>## [1] &quot;Ten&quot;       &quot;Ngay_sinh&quot; &quot;Gioi_tinh&quot; &quot;Bang_diem&quot;</code></pre>
<p>Một cách khác để lấy ra một đối tượng con của list là sử dụng chỉ số của đối tượng. Do bảng điểm nằm ở vị trí thứ 4 trong list nên bạn đọc sử dụng câu lệnh sau</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="kiến-thức-r-nâng-cao.html#cb360-1" tabindex="-1"></a>SV1[[<span class="dv">4</span>]] <span class="co"># Sử dụng 2 lần dấu ngoặc vuông</span></span></code></pre></div>
<pre><code>##     Mon_hoc Diem
## 1 Giải tích  6.5
## 2    Đại số  8.5
## 3  Xác suất  7.0</code></pre>
<p>Bạn đọc có thể thấy rằng để lấy ra phần tử con, chúng ta cần phải sử dụng hai lần dấu ngoặc vuông. Nếu chỉ sử dụng một dấu ngoặc vuông, phần tử được lấy ra sẽ là một list có 1 phần tử và phần tử duy nhất đó là bảng điểm.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="kiến-thức-r-nâng-cao.html#cb362-1" tabindex="-1"></a>SV1[<span class="dv">4</span>] <span class="co"># Là một list có 1 phần tử</span></span></code></pre></div>
<pre><code>## $Bang_diem
##     Mon_hoc Diem
## 1 Giải tích  6.5
## 2    Đại số  8.5
## 3  Xác suất  7.0</code></pre>
<p>Để thêm một đối tượng vào list, chúng ta có thể đặt tên trực tiếp cho đối tượng mới và gán giá trị cho đối tượng. Ví dụ như chúng ta muốn thêm thông tin về quê quán của sinh viên vào một đối tượng có tên là <span class="math inline">\(que\_quan\)</span></p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="kiến-thức-r-nâng-cao.html#cb364-1" tabindex="-1"></a>SV1<span class="sc">$</span>que_quan<span class="ot">&lt;-</span><span class="st">&quot;Hà Nội&quot;</span> <span class="co"># Thêm vào một phần tử có tên que_quan là một biến</span></span>
<span id="cb364-2"><a href="kiến-thức-r-nâng-cao.html#cb364-2" tabindex="-1"></a><span class="fu">str</span>(SV1) <span class="co"># list SV1 đã có thêm phần tử thứ năm</span></span></code></pre></div>
<pre><code>## List of 5
##  $ Ten      : chr &quot;Nguyễn Đức Nam&quot;
##  $ Ngay_sinh: Date[1:1], format: &quot;2000-06-20&quot;
##  $ Gioi_tinh: logi TRUE
##  $ Bang_diem:&#39;data.frame&#39;:   3 obs. of  2 variables:
##   ..$ Mon_hoc: chr [1:3] &quot;Giải tích&quot; &quot;Đại số&quot; &quot;Xác suất&quot;
##   ..$ Diem   : num [1:3] 6.5 8.5 7
##  $ que_quan : chr &quot;Hà Nội&quot;</code></pre>
<p>Để xóa đi một đối tượng khỏi list, chúng ta gán cho đối tượng đó giá trị bằng NULL</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="kiến-thức-r-nâng-cao.html#cb366-1" tabindex="-1"></a>SV1<span class="sc">$</span>que_quan<span class="ot">&lt;-</span><span class="cn">NULL</span> <span class="co"># xóa phần tử có tên que_quan khỏi SV1</span></span>
<span id="cb366-2"><a href="kiến-thức-r-nâng-cao.html#cb366-2" tabindex="-1"></a><span class="fu">str</span>(SV1) <span class="co"># list SV1 chỉ còn 4 phần tử</span></span></code></pre></div>
<pre><code>## List of 4
##  $ Ten      : chr &quot;Nguyễn Đức Nam&quot;
##  $ Ngay_sinh: Date[1:1], format: &quot;2000-06-20&quot;
##  $ Gioi_tinh: logi TRUE
##  $ Bang_diem:&#39;data.frame&#39;:   3 obs. of  2 variables:
##   ..$ Mon_hoc: chr [1:3] &quot;Giải tích&quot; &quot;Đại số&quot; &quot;Xác suất&quot;
##   ..$ Diem   : num [1:3] 6.5 8.5 7</code></pre>
<p>Như chúng ta đã thảo luận trong phần giới thiệu, list là một cấu trúc nhiều lớp, nghĩa là một list có thể chứa các đối tượng có kiểu list. Thật vậy, giả sử chúng ta có list có tên là <span class="math inline">\(SV2\)</span> chứa các thông tin tương ứng của một sinh viên khác</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="kiến-thức-r-nâng-cao.html#cb368-1" tabindex="-1"></a>SV2<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">Ten =</span> <span class="st">&quot;Nguyễn Thị Loan&quot;</span>,</span>
<span id="cb368-2"><a href="kiến-thức-r-nâng-cao.html#cb368-2" tabindex="-1"></a>          <span class="at">Ngay_sinh =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-05-13&quot;</span>),</span>
<span id="cb368-3"><a href="kiến-thức-r-nâng-cao.html#cb368-3" tabindex="-1"></a>          <span class="at">Gioi_tinh =</span> <span class="cn">FALSE</span>,</span>
<span id="cb368-4"><a href="kiến-thức-r-nâng-cao.html#cb368-4" tabindex="-1"></a>          <span class="at">Bang_diem =</span> <span class="fu">data.frame</span>(<span class="at">Mon_hoc =</span> <span class="fu">c</span>(<span class="st">&quot;Xác suất&quot;</span>, <span class="st">&quot;Thống kê&quot;</span>, <span class="st">&quot;Học máy&quot;</span>,<span class="st">&quot;AI&quot;</span>),</span>
<span id="cb368-5"><a href="kiến-thức-r-nâng-cao.html#cb368-5" tabindex="-1"></a>                                 <span class="at">Diem =</span> <span class="fu">c</span>(<span class="fl">7.0</span>, <span class="fl">9.5</span>, <span class="fl">10.0</span>, <span class="fl">9.0</span>)),</span>
<span id="cb368-6"><a href="kiến-thức-r-nâng-cao.html#cb368-6" tabindex="-1"></a>          <span class="at">Que_quan =</span> <span class="st">&quot;Hà Nội&quot;</span>)</span></code></pre></div>
<p>Chúng ta có thể tạo một list có tên là <span class="math inline">\(DS\)</span> chứa thông tin của cả 2 sinh viên</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="kiến-thức-r-nâng-cao.html#cb369-1" tabindex="-1"></a>DS<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">SV1 =</span> SV1,<span class="at">SV2 =</span> SV2) <span class="co"># DS là một list có 2 phần tử, mỗi phần tử là 1 list</span></span>
<span id="cb369-2"><a href="kiến-thức-r-nâng-cao.html#cb369-2" tabindex="-1"></a><span class="fu">str</span>(DS) <span class="co"># xem cấu trúc của list DS</span></span></code></pre></div>
<pre><code>## List of 2
##  $ SV1:List of 4
##   ..$ Ten      : chr &quot;Nguyễn Đức Nam&quot;
##   ..$ Ngay_sinh: Date[1:1], format: &quot;2000-06-20&quot;
##   ..$ Gioi_tinh: logi TRUE
##   ..$ Bang_diem:&#39;data.frame&#39;:    3 obs. of  2 variables:
##   .. ..$ Mon_hoc: chr [1:3] &quot;Giải tích&quot; &quot;Đại số&quot; &quot;Xác suất&quot;
##   .. ..$ Diem   : num [1:3] 6.5 8.5 7
##  $ SV2:List of 5
##   ..$ Ten      : chr &quot;Nguyễn Thị Loan&quot;
##   ..$ Ngay_sinh: Date[1:1], format: &quot;2000-05-13&quot;
##   ..$ Gioi_tinh: logi FALSE
##   ..$ Bang_diem:&#39;data.frame&#39;:    4 obs. of  2 variables:
##   .. ..$ Mon_hoc: chr [1:4] &quot;Xác suất&quot; &quot;Thống kê&quot; &quot;Học máy&quot; &quot;AI&quot;
##   .. ..$ Diem   : num [1:4] 7 9.5 10 9
##   ..$ Que_quan : chr &quot;Hà Nội&quot;</code></pre>
<p>Để xem bảng điểm của sinh viên thứ hai, chúng ta cần sử dụng 2 lần ký hiệu <span class="math inline">\(\$\)</span>:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="kiến-thức-r-nâng-cao.html#cb371-1" tabindex="-1"></a>DS<span class="sc">$</span>SV2<span class="sc">$</span>Bang_diem <span class="co"># Xem bảng điểm của sinh viên thứ hai</span></span></code></pre></div>
<pre><code>##    Mon_hoc Diem
## 1 Xác suất  7.0
## 2 Thống kê  9.5
## 3  Học máy 10.0
## 4       AI  9.0</code></pre>
</div>
<div id="sử-dụng-list-trong-viết-hàm-số" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Sử dụng list trong viết hàm số<a href="kiến-thức-r-nâng-cao.html#sử-dụng-list-trong-viết-hàm-số" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hầu như tất cả các hàm số được xây dựng sẵn trong R đều cho kết quả đầu ra dưới dạng list. Ví dụ, bạn đọc quan sát giá trị đầu ra của hàm có tên là <code>uniroot()</code> như sau</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="kiến-thức-r-nâng-cao.html#cb373-1" tabindex="-1"></a>f<span class="ot">&lt;-</span><span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span></span>
<span id="cb373-2"><a href="kiến-thức-r-nâng-cao.html#cb373-2" tabindex="-1"></a>result<span class="ot">&lt;-</span><span class="fu">uniroot</span>(f,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb373-3"><a href="kiến-thức-r-nâng-cao.html#cb373-3" tabindex="-1"></a><span class="fu">class</span>(result) <span class="co"># Đối tượng result có kiểu list</span></span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="kiến-thức-r-nâng-cao.html#cb375-1" tabindex="-1"></a><span class="fu">str</span>(result) <span class="co"># Xem cấu trúc của đối tượng result</span></span></code></pre></div>
<pre><code>## List of 5
##  $ root      : num 0.5
##  $ f.root    : num -2.85e-05
##  $ iter      : int 6
##  $ init.it   : int NA
##  $ estim.prec: num 6.1e-05</code></pre>
<p>Hàm <code>uniroot()</code> được sử dụng để tìm nghiệm duy nhất của một hàm số trên một khoảng. Đoạn câu lệnh ở trên sử dụng hàm <code>uniroot()</code> để tìm nghiệm duy nhất của phương trình <span class="math inline">\(x^2 - 1/4 = 0\)</span> trên khoảng <span class="math inline">\((0,1)\)</span>. Kết quả của hàm <code>uniroot()</code> là một list có 5 phần tử đều là các biến kiểu số với tên tương ứng là <span class="math inline">\(root\)</span>, <span class="math inline">\(f.root\)</span>, <span class="math inline">\(iter\)</span>, <span class="math inline">\(init.it\)</span>, và <span class="math inline">\(estim.prec\)</span>. Các hàm số phức tạp hơn sẽ có kết quả đầu ra phức tạp hơn rất nhiều. Bạn đọc cần đọc kỹ hướng dẫn của các hàm để hiểu mỗi đối tượng con của kết quả đầu ra có ý nghĩa như thế nào.</p>
<p>Bạn đọc cũng nên sử dụng đối tượng list để làm đầu ra cho các hàm số tự xây dựng. Chúng ta sẽ quay trở lại ví dụ về xây dựng hàm số <span class="math inline">\(PV\)</span> để tính giá trị hiện tại của một dòng tiền. Đối với một dòng tiền tương lai, ngoài giá trị hiện tại, bạn đọc có thể quan tâm đến các giá trị khác như Macaulay Duration, Modified Duration, Dollar Duration. Ý nghĩa và cách tính các giá trị này ở trong phần phụ lục @ref(#advrappen3).</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="kiến-thức-r-nâng-cao.html#cb377-1" tabindex="-1"></a>summaryCF<span class="ot">&lt;-</span><span class="cf">function</span>(i,CF){</span>
<span id="cb377-2"><a href="kiến-thức-r-nâng-cao.html#cb377-2" tabindex="-1"></a>  n<span class="ot">&lt;-</span><span class="fu">length</span>(CF)</span>
<span id="cb377-3"><a href="kiến-thức-r-nâng-cao.html#cb377-3" tabindex="-1"></a>  PV<span class="ot">&lt;-</span><span class="fu">sum</span>(CF<span class="sc">/</span>((<span class="dv">1</span><span class="sc">+</span>i)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span>n)))</span>
<span id="cb377-4"><a href="kiến-thức-r-nâng-cao.html#cb377-4" tabindex="-1"></a>  Mac_D<span class="ot">&lt;-</span><span class="fu">sum</span>(CF<span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span>n)<span class="sc">/</span>((<span class="dv">1</span><span class="sc">+</span>i)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span>n)))<span class="sc">/</span>PV</span>
<span id="cb377-5"><a href="kiến-thức-r-nâng-cao.html#cb377-5" tabindex="-1"></a>  Mod_D<span class="ot">&lt;-</span>Mac_D<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>i)</span>
<span id="cb377-6"><a href="kiến-thức-r-nâng-cao.html#cb377-6" tabindex="-1"></a>  Dollar_D<span class="ot">&lt;-</span>PV<span class="sc">*</span>Mod_D<span class="sc">*</span><span class="fl">0.01</span></span>
<span id="cb377-7"><a href="kiến-thức-r-nâng-cao.html#cb377-7" tabindex="-1"></a>  ket_qua<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">PV =</span> PV, <span class="at">Mac_D =</span> Mac_D, <span class="at">Mod_D =</span> Mod_D, </span>
<span id="cb377-8"><a href="kiến-thức-r-nâng-cao.html#cb377-8" tabindex="-1"></a>               <span class="at">Dollar_D =</span> Dollar_D)</span>
<span id="cb377-9"><a href="kiến-thức-r-nâng-cao.html#cb377-9" tabindex="-1"></a>  <span class="fu">return</span>(ket_qua)</span>
<span id="cb377-10"><a href="kiến-thức-r-nâng-cao.html#cb377-10" tabindex="-1"></a>}</span></code></pre></div>
<p>Chúng ta có thể sử dụng hàm <code>summary_CF()</code> để tính toán các đặc trưng của một trái phiếu với các thông số như sau:</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-173">Table 3.1: </span>Các thông số của một trái phiếu
</caption>
<thead>
<tr>
<th style="text-align:left;">
Thông số trái phiếu
</th>
<th style="text-align:left;">
Giá trị
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Ngày hiện tại
</td>
<td style="text-align:left;">
Ngày 01 tháng 10 năm 2023
</td>
</tr>
<tr>
<td style="text-align:left;">
Ngày đáo hạn
</td>
<td style="text-align:left;">
Ngày 30 tháng 09 năm 2035
</td>
</tr>
<tr>
<td style="text-align:left;">
Mệnh giá
</td>
<td style="text-align:left;">
10 tỷ Vnd
</td>
</tr>
<tr>
<td style="text-align:left;">
Lãi suất Coupon
</td>
<td style="text-align:left;">
9,25%
</td>
</tr>
<tr>
<td style="text-align:left;">
Số lần trả coupon trong năm
</td>
<td style="text-align:left;">
1 lần/năm
</td>
</tr>
<tr>
<td style="text-align:left;">
Lãi suất chiết khấu
</td>
<td style="text-align:left;">
5,00%
</td>
</tr>
</tbody>
</table>
<p>Chúng ta tạo ra dòng tiền tương lai của trái phiếu với các thông số như trên và sau đó sử dụng hàm <code>summary_CF()</code></p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="kiến-thức-r-nâng-cao.html#cb378-1" tabindex="-1"></a><span class="co"># Nhập liệu</span></span>
<span id="cb378-2"><a href="kiến-thức-r-nâng-cao.html#cb378-2" tabindex="-1"></a>F<span class="ot">&lt;-</span><span class="dv">10</span> <span class="co"># Mệnh giá trái phiếu, đơn vị tỷ đồng </span></span>
<span id="cb378-3"><a href="kiến-thức-r-nâng-cao.html#cb378-3" tabindex="-1"></a>T<span class="ot">&lt;-</span><span class="dv">12</span> <span class="co"># 12 năm cho đến ngày đáo hạn</span></span>
<span id="cb378-4"><a href="kiến-thức-r-nâng-cao.html#cb378-4" tabindex="-1"></a>c<span class="ot">&lt;-</span><span class="fl">9.25</span><span class="sc">/</span><span class="dv">100</span> <span class="co"># Lãi suất coupon</span></span>
<span id="cb378-5"><a href="kiến-thức-r-nâng-cao.html#cb378-5" tabindex="-1"></a>i<span class="ot">&lt;-</span><span class="dv">5</span><span class="sc">/</span><span class="dv">100</span> <span class="co"># Lãi suất dùng để chiết khấu</span></span>
<span id="cb378-6"><a href="kiến-thức-r-nâng-cao.html#cb378-6" tabindex="-1"></a>CF<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">rep</span>(c<span class="sc">*</span>F,(T<span class="dv">-2</span>)),c<span class="sc">*</span>F<span class="sc">+</span>F) <span class="co"># Dòng tiền tương lai của trái phiếu</span></span>
<span id="cb378-7"><a href="kiến-thức-r-nâng-cao.html#cb378-7" tabindex="-1"></a><span class="fu">summaryCF</span>(i,CF)</span></code></pre></div>
<pre><code>## $PV
## [1] 13.53023
## 
## $Mac_D
## [1] 7.884908
## 
## $Mod_D
## [1] 7.509436
## 
## $Dollar_D
## [1] 1.016044</code></pre>
<p>Chúng ta chuyển sang một ví dụ khác khi sử dụng list làm đầu ra cho một hàm số tự xây dựng. Khi bạn đọc tìm hiểu về giá trị của một véc-tơ kiểu số, chúng ta thường tính toán các giá trị đặc trưng như giá trị trung bình, giá trị lớn nhất, nhỏ nhất, các phân vị, và muốn xem phân phối các giá trị trong véc-tơ đó như thế nào. Chúng ta có thể tự viết một hàm số để thực hiện việc này với đầu ra là một list:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="kiến-thức-r-nâng-cao.html#cb380-1" tabindex="-1"></a>summary_vec<span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb380-2"><a href="kiến-thức-r-nâng-cao.html#cb380-2" tabindex="-1"></a>  do_dai<span class="ot">&lt;-</span><span class="fu">length</span>(x) <span class="co"># Độ dài của véc-tơ</span></span>
<span id="cb380-3"><a href="kiến-thức-r-nâng-cao.html#cb380-3" tabindex="-1"></a>  ty_le_na<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(x))<span class="sc">/</span>do_dai<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">&quot;%&quot;</span>) </span>
<span id="cb380-4"><a href="kiến-thức-r-nâng-cao.html#cb380-4" tabindex="-1"></a>  <span class="co"># % giá trị không quan sát được</span></span>
<span id="cb380-5"><a href="kiến-thức-r-nâng-cao.html#cb380-5" tabindex="-1"></a>  gioi_han<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">min</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="fu">max</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb380-6"><a href="kiến-thức-r-nâng-cao.html#cb380-6" tabindex="-1"></a>  trung_binh<span class="ot">&lt;-</span><span class="fu">mean</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb380-7"><a href="kiến-thức-r-nâng-cao.html#cb380-7" tabindex="-1"></a>  do_lech_chuan<span class="ot">&lt;-</span><span class="fu">sd</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb380-8"><a href="kiến-thức-r-nâng-cao.html#cb380-8" tabindex="-1"></a>  phan_vi<span class="ot">&lt;-</span><span class="fu">quantile</span>(x,<span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>,<span class="fl">0.99</span>),<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb380-9"><a href="kiến-thức-r-nâng-cao.html#cb380-9" tabindex="-1"></a>  do_thi<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span>x), <span class="fu">aes</span>(<span class="at">x=</span>x))<span class="sc">+</span></span>
<span id="cb380-10"><a href="kiến-thức-r-nâng-cao.html#cb380-10" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb380-11"><a href="kiến-thức-r-nâng-cao.html#cb380-11" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>,<span class="at">alpha =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb380-12"><a href="kiến-thức-r-nâng-cao.html#cb380-12" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb380-13"><a href="kiến-thức-r-nâng-cao.html#cb380-13" tabindex="-1"></a>  result<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">do_dai =</span> do_dai, <span class="at">ty_le_na =</span> ty_le_na, <span class="at">gioi_han =</span> gioi_han,</span>
<span id="cb380-14"><a href="kiến-thức-r-nâng-cao.html#cb380-14" tabindex="-1"></a>               <span class="at">trung_binh =</span> trung_binh, <span class="at">do_lech_chuan =</span> do_lech_chuan, </span>
<span id="cb380-15"><a href="kiến-thức-r-nâng-cao.html#cb380-15" tabindex="-1"></a>               <span class="at">phan_vi =</span> phan_vi, <span class="at">do_thi =</span> do_thi)</span>
<span id="cb380-16"><a href="kiến-thức-r-nâng-cao.html#cb380-16" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb380-17"><a href="kiến-thức-r-nâng-cao.html#cb380-17" tabindex="-1"></a>}</span></code></pre></div>
<p>Chúng ta có thể sử dụng hàm <code>summary_vec()</code> để tổng hợp thông tin về lợi suất tính theo ngày của chỉ số FTSE (chỉ số cổ phiếu của 100 công ty có giá trị vốn hóa thị trường lớn nhất niêm yết trên Sở giao dịch chứng khoán London) trong năm 1991 đến năm 1999. Chỉ số này được lưu trong dữ liệu <span class="math inline">\(\textbf{EuStockMarkets}\)</span> có sẵn trong R.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="kiến-thức-r-nâng-cao.html#cb381-1" tabindex="-1"></a>chi_so<span class="ot">&lt;-</span>EuStockMarkets[,<span class="dv">4</span>] <span class="co"># lấy chỉ số FTSE ra từ cột thứ 4 của EuStockMarkets</span></span>
<span id="cb381-2"><a href="kiến-thức-r-nâng-cao.html#cb381-2" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="fu">length</span>(chi_so) <span class="co"># độ dài của chuỗi chỉ số chứng khoán</span></span>
<span id="cb381-3"><a href="kiến-thức-r-nâng-cao.html#cb381-3" tabindex="-1"></a>loi_suat<span class="ot">&lt;-</span><span class="fu">log</span>(chi_so[<span class="dv">2</span><span class="sc">:</span>n]<span class="sc">/</span>chi_so[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)]) <span class="co"># lợi suất của chỉ số</span></span>
<span id="cb381-4"><a href="kiến-thức-r-nâng-cao.html#cb381-4" tabindex="-1"></a><span class="fu">summary_vec</span>(loi_suat)</span></code></pre></div>
<pre><code>## $do_dai
## [1] 1859
## 
## $ty_le_na
## [1] &quot;0 %&quot;
## 
## $gioi_han
## [1] -0.04139903  0.05439552
## 
## $trung_binh
## [1] 0.0004319851
## 
## $do_lech_chuan
## [1] 0.007957728
## 
## $phan_vi
##            1%           10%           25%           50%           75% 
## -2.060655e-02 -9.139666e-03 -4.318778e-03  8.021069e-05  5.253592e-03 
##           90%           99% 
##  9.714781e-03  1.931723e-02 
## 
## $do_thi</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-176-1.png" width="672" /></p>
<p>Một lợi thế khác của đối tượng kiểu list là có thể đẩy nhanh tốc độ tính toán khi dùng các hàm họ <code>apply()</code>. Chúng ta sẽ thảo luận vấn đề này trong phần tiếp theo của cuốn sách.</p>
</div>
</div>
<div id="các-hàm-họ-apply" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Các hàm họ <code>apply()</code><a href="kiến-thức-r-nâng-cao.html#các-hàm-họ-apply" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nhóm hàm <code>apply()</code> là nhóm hàm có sẵn trong R cho phép bạn đọc thực hiện lặp đi lặp lại một hàm số trên nhiều đối tượng. Về cơ bản nhóm hàm này hoạt động giống như một vòng lặp nhưng câu lệnh viết bằng nhóm hàm này sẽ chạy nhanh hơn và đơn giản hơn viết vòng lặp rất nhiểu.</p>
<p>Các hàm mà chúng tôi sẽ giới thiệu đến bạn đọc trong phần này bao gồm <code>apply()</code>, <code>lapply()</code> và <code>sapply</code>. Còn nhiều hàm khác thuộc nhóm hàm này như <code>vapply()</code>, <code>tapply()</code>, <code>mapply()</code>, …, nhưng về nguyên tắc hoạt động của các hàm này là tương tự và chỉ khác ở chỗ chúng áp dụng trên các loại đối tượng khác nhau nên bạn đọc có thể tự tìm hiểu mà không gặp khó khăn nào.</p>
<div id="hàm-apply" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Hàm <code>apply()</code><a href="kiến-thức-r-nâng-cao.html#hàm-apply" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cho một véc-tơ <span class="math inline">\(x\)</span> kiểu số và một hàm <span class="math inline">\(f\)</span>, chẳng hạn như <span class="math inline">\(f(x) = x^2\)</span>. Khi bạn đọc viết <code>f(x)</code>, R sẽ hiểu rằng bạn đang thực hiện hàm số <span class="math inline">\(f\)</span> cho từng phần tử của véc-tơ <span class="math inline">\(x\)</span> và sẽ trả lại giá trị là một véc-tơ mà từng phần tử tương ứng là bình phương của các phần tử trong <span class="math inline">\(x\)</span>. Việc thực hiện hàm <span class="math inline">\(f\)</span> trên véc-tơ <span class="math inline">\(x\)</span> diễn ra một cách đồng thời và hiệu quả hơn so với việc viết một vòng lặp để tính hàm <span class="math inline">\(f\)</span> trên từng phần tử của <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="kiến-thức-r-nâng-cao.html#cb383-1" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>; f<span class="ot">&lt;-</span><span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb383-2"><a href="kiến-thức-r-nâng-cao.html#cb383-2" tabindex="-1"></a><span class="fu">f</span>(x) <span class="co"># f được áp dụng trên từng phần tử của x</span></span></code></pre></div>
<pre><code>## [1]  1  4  9 16 25</code></pre>
<p>Điều gì xảy ra khi <span class="math inline">\(x\)</span> không phải là một véc-tơ đồng các phần tử con của <span class="math inline">\(x\)</span> không phải là một biến, chẳng hạn như</p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(x\)</span> là một ma trận và bạn muốn tính toán một hàm <span class="math inline">\(f\)</span> trên các phần tử con của <span class="math inline">\(x\)</span> là một véc-tơ hàng hoặc một véc-tơ cột.</p></li>
<li><p><span class="math inline">\(x\)</span> là một dữ liệu và bạn muốn thực hiện một hàm <span class="math inline">\(f\)</span> trên tất cả các cột dữ liệu.</p></li>
<li><p><span class="math inline">\(x\)</span> là một list và bạn muốn thực hiện một hàm <span class="math inline">\(f\)</span> trên tất cả các đối tượng con của <span class="math inline">\(x\)</span>.</p></li>
</ol>
<p>Các hàm thuộc họ <code>apply()</code> sẽ giúp bạn đọc thực hiện tác tính toán như vậy. Cách viết hàm <code>apply()</code> như sau:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="kiến-thức-r-nâng-cao.html#cb385-1" tabindex="-1"></a><span class="fu">apply</span>(x, MARGIN, FUN, ...)</span></code></pre></div>
<p>trong đó <span class="math inline">\(x\)</span> là một ma trận, một mảng nhiều chiều, hoặc một dữ liệu; <code>MARGIN</code> là một số, hoặc véc-tơ chỉ số cho biết hàm sẽ áp dụng trên chiều (hoặc các chiều) nào, và <code>FUN</code> là hàm số mà bạn muốn thực hiện. Ví dụ như bạn đọc muốn tính giá trị trung bình của mỗi cột của một ma trận <span class="math inline">\(M\)</span>, hãy sử dụng câu lệnh như sau</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="kiến-thức-r-nâng-cao.html#cb386-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">20</span>,<span class="dv">5</span>) <span class="co"># Ma trận kích thước 20 * 5</span></span>
<span id="cb386-2"><a href="kiến-thức-r-nâng-cao.html#cb386-2" tabindex="-1"></a><span class="fu">apply</span>(M, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean) </span></code></pre></div>
<pre><code>## [1] 10.5 30.5 50.5 70.5 90.5</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="kiến-thức-r-nâng-cao.html#cb388-1" tabindex="-1"></a><span class="co"># MARGIN = 2 nghĩa là tính theo cột (1 theo hàng)  </span></span></code></pre></div>
<p>Do ma trận <span class="math inline">\(M\)</span> có 5 cột nên giá trị trả lại là một véc-tơ kiểu số có độ dài bằng 5. Véc-tơ này chứa giá trị là trung bình của các cột thứ 1, 2, 3, 4, và 5 của ma trận <span class="math inline">\(M\)</span>.</p>
<p>Về nguyên tắc đối tượng sử dụng trong hàm <code>apply()</code> là ma trận hoặc mảng nhiều chiều. Bạn đọc cũng có thể sử dụng hàm <code>apply()</code> trên đối tượng là dữ liệu (data.frame). Khi đối tượng của hàm <code>apply()</code> có từ 3 chiều trở lên, giá trị của tùy biến <code>MARGIN</code> có thể là một số hoặc một véc-tơ. Thật vậy,</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="kiến-thức-r-nâng-cao.html#cb389-1" tabindex="-1"></a>Ar<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co"># Mảng kích thước 5 * 2 * 2</span></span>
<span id="cb389-2"><a href="kiến-thức-r-nâng-cao.html#cb389-2" tabindex="-1"></a><span class="fu">apply</span>(Ar, <span class="at">MARGIN =</span> <span class="dv">3</span>, <span class="at">FUN =</span> mean) </span></code></pre></div>
<pre><code>## [1]  5.5 15.5</code></pre>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="kiến-thức-r-nâng-cao.html#cb391-1" tabindex="-1"></a><span class="co"># MARGIN = 3 nghĩa là áp dụng hàm mean theo chiều thứ 3  </span></span></code></pre></div>
<p>Giá trị trả lại sẽ là một véc-tơ có độ dài là 2, phần tử thứ nhất là giá trị trung bình của các phần tử thuộc ma trận kích thước <span class="math inline">\(5 \times 2\)</span> thứ nhất (ma trận <span class="math inline">\(Ar[,,1]\)</span>) và phần tử thứ hai là giá trị trung bình của các phần tử thuộc ma trận kích thước <span class="math inline">\(5 \times 2\)</span> thứ hai (ma trận <span class="math inline">\(Ar[,,2]\)</span>). Chúng ta có thể kiểm tra kết quả như sau:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="kiến-thức-r-nâng-cao.html#cb392-1" tabindex="-1"></a><span class="fu">mean</span>(Ar[,,<span class="dv">1</span>]) <span class="co"># bằng phần tử thứ nhất khi dùng apply</span></span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="kiến-thức-r-nâng-cao.html#cb394-1" tabindex="-1"></a><span class="fu">mean</span>(Ar[,,<span class="dv">2</span>]) <span class="co"># bằng phần tử thứ hai khi dùng apply</span></span></code></pre></div>
<pre><code>## [1] 15.5</code></pre>
<p>Chúng ta có thể áp dụng đồng thời hàm <code>mean()</code> theo chiều thứ 2 và chiều thứ 3 trên mảng <span class="math inline">\(Ar\)</span> như sau</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="kiến-thức-r-nâng-cao.html#cb396-1" tabindex="-1"></a><span class="fu">apply</span>(Ar, <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), mean) <span class="co"># MARGIN = c(2,3) nghĩa là áp dụng hàm mean theo chiều thứ 2 và 3  </span></span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    3   13
## [2,]    8   18</code></pre>
<p>Kết quả thu được sẽ là một ma trận kích thước <span class="math inline">\(2 \times 2\)</span> mà các phần tử sẽ tương ứng với giá trị trung bình:</p>
<ul>
<li><p>Phần tử ở vị trí [1,1] của ma trận kết quả là giá trị trung bình của véc-tơ <span class="math inline">\(Ar[,1,1]\)</span></p></li>
<li><p>Phần tử ở vị trí [1,2] của ma trận kết quả là giá trị trung bình của véc-tơ <span class="math inline">\(Ar[,1,2]\)</span></p></li>
<li><p>Phần tử ở vị trí [2,1] của ma trận kết quả là giá trị trung bình của véc-tơ <span class="math inline">\(Ar[,2,1]\)</span></p></li>
<li><p>Phần tử ở vị trí [2,2] của ma trận kết quả là giá trị trung bình của véc-tơ <span class="math inline">\(Ar[,2,2]\)</span></p></li>
</ul>
<p>Chúng ta có thể so sánh giá trị trung bình của các véc-tơ với ma trận kết quả của hàm <code>apply()</code>:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="kiến-thức-r-nâng-cao.html#cb398-1" tabindex="-1"></a><span class="fu">mean</span>(Ar[,<span class="dv">1</span>,<span class="dv">1</span>]) <span class="co"># bằng phần tử ở vị trí [1,1] của ma trận kết quả</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="kiến-thức-r-nâng-cao.html#cb400-1" tabindex="-1"></a><span class="fu">mean</span>(Ar[,<span class="dv">1</span>,<span class="dv">2</span>]) <span class="co"># bằng phần tử ở vị trí [1,2] của ma trận kết quả</span></span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="kiến-thức-r-nâng-cao.html#cb402-1" tabindex="-1"></a><span class="fu">mean</span>(Ar[,<span class="dv">2</span>,<span class="dv">1</span>]) <span class="co"># bằng phần tử ở vị trí [1,2] của ma trận kết quả</span></span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="kiến-thức-r-nâng-cao.html#cb404-1" tabindex="-1"></a><span class="fu">mean</span>(Ar[,<span class="dv">2</span>,<span class="dv">2</span>]) <span class="co"># bằng phần tử ở vị trí [1,2] của ma trận kết quả</span></span></code></pre></div>
<pre><code>## [1] 18</code></pre>
<p>Hàm số sử dụng với tùy biến <code>FUN</code> có thể là hàm số có sẵn trong R, hoặc trong các thư viện cài đặt bổ sung, hoặc cũng có thể là một hàm số mà bạn đọc tự xây dựng. Khi các câu lệnh của hàm số tự xây dựng ngắn gọn, bạn đọc có thể định nghĩa hàm số đó bên trong hàm <code>apply()</code>. Giá trị đầu ra của hàm số được tự định nghĩa cũng có thể là một véc-tơ, thậm chí là một ma trận hay là một mảng nhiều chiều, thậm chí là một list. Nếu kết quả đầu ra của hàm sử dụng trong <code>apply()</code> là một ma trận hoặc mảng nhiều chiều, R sẽ chuyển ma trận hoặc mảng nhiều chiều về dạng véc-tơ. Trong trường hợp đầu ra của hàm tự định nghĩa là một list, giá trị đầu ra sẽ là một ma trận hoặc mảng nhiều chiều mà mỗi phần tử con là một list. Dưới đây là một ví dụ mà giá trị đầu ra là một véc-tơ ba chiều.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="kiến-thức-r-nâng-cao.html#cb406-1" tabindex="-1"></a><span class="fu">apply</span>(M, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="fu">min</span>(x),<span class="fu">mean</span>(x),<span class="fu">max</span>(x))) </span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]  [,5]
## [1,]  1.0 21.0 41.0 61.0  81.0
## [2,] 10.5 30.5 50.5 70.5  90.5
## [3,] 20.0 40.0 60.0 80.0 100.0</code></pre>
<p>Kết quả nhận được sẽ là một ma trận kích thước <span class="math inline">\(3 \times 5\)</span>. Cột thứ nhất của ma trận kết quả nhận giá trị (1, 10.5, 20) tương ứng với các giá trị <span class="math inline">\(min\)</span>, <span class="math inline">\(mean\)</span>, và <span class="math inline">\(max\)</span> của véc-tơ <span class="math inline">\(M[,1]\)</span>.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="kiến-thức-r-nâng-cao.html#cb408-1" tabindex="-1"></a>M[,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="kiến-thức-r-nâng-cao.html#cb410-1" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">min</span>(M[,<span class="dv">1</span>]), <span class="fu">mean</span>(M[,<span class="dv">1</span>]), <span class="fu">max</span>(M[,<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>## [1]  1.0 10.5 20.0</code></pre>
<p>Bạn đọc cũng có thể tự xây dựng hàm số trên môi trường chung sau đó gọi tên hàm số này trong hàm <code>apply()</code>. Nếu hàm số tự xây dựng là hàm số có tham số khác ngoài <span class="math inline">\(x\)</span>, bạn đọc cần phải khai báo giá trị cho tham số đó trong môi trường cục bộ của hàm <code>apply()</code>:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="kiến-thức-r-nâng-cao.html#cb412-1" tabindex="-1"></a>my_range<span class="ot">&lt;-</span><span class="cf">function</span>(x, a) (<span class="fu">max</span>(x<span class="sc">^</span>a) <span class="sc">-</span> <span class="fu">min</span>(x<span class="sc">^</span>a)) <span class="co"># hàm số có tham số khác là a</span></span>
<span id="cb412-2"><a href="kiến-thức-r-nâng-cao.html#cb412-2" tabindex="-1"></a><span class="fu">apply</span>(M, <span class="dv">2</span>, my_range, <span class="at">a =</span> <span class="dv">2</span>) </span></code></pre></div>
<pre><code>## [1]  399 1159 1919 2679 3439</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="kiến-thức-r-nâng-cao.html#cb414-1" tabindex="-1"></a><span class="co"># Cần khai báo giá trị tham số a của my_range trong hàm apply</span></span></code></pre></div>
<p>Khi tham số của hàm số mà bạn đọc muốn áp dụng trên ma trận là không cố định mà thay đổi theo một chiều của <span class="math inline">\(x\)</span> thì không nên khai báo giá trị của tham số theo dạng véc-tơ trong hàm <code>apply()</code>. Thật vậy, giả sử bạn đọc muốn tính các giá trị phân vị ở mức xác suất 10% và 90% lần lượt của véc-tơ hàng thứ nhất và véc-tơ hàng thứ hai của một ma trận M kích thước <span class="math inline">\(2 \times 10\)</span>. Hàm số <code>quantile(x, probs = p)</code> là hàm số có sẵn trong R được sử dụng để tính giá trị phân vị tại mức xác suất <span class="math inline">\(p\)</span> của véc-tơ số <span class="math inline">\(x\)</span>. Hãy quan sát kết quả của hàm <code>apply()</code> khi sử dụng tham số <code>probs</code> của hàm <code>quantile()</code> dưới dạng véc-tơ:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="kiến-thức-r-nâng-cao.html#cb415-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">2</span>,<span class="dv">10</span>) <span class="co"># ma trận 2 * 10</span></span>
<span id="cb415-2"><a href="kiến-thức-r-nâng-cao.html#cb415-2" tabindex="-1"></a><span class="fu">apply</span>(M, <span class="dv">1</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>))</span></code></pre></div>
<pre><code>##     [,1] [,2]
## 10%  2.8  3.8
## 90% 17.2 18.2</code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="kiến-thức-r-nâng-cao.html#cb417-1" tabindex="-1"></a><span class="fu">quantile</span>(M[<span class="dv">1</span>,],<span class="fl">0.1</span>) <span class="co"># giá trị mong muốn</span></span></code></pre></div>
<pre><code>## 10% 
## 2.8</code></pre>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="kiến-thức-r-nâng-cao.html#cb419-1" tabindex="-1"></a><span class="fu">quantile</span>(M[<span class="dv">2</span>,],<span class="fl">0.9</span>) <span class="co"># giá trị mong muốn</span></span></code></pre></div>
<pre><code>##  90% 
## 18.2</code></pre>
<p>Bạn đọc có thể thấy rằng kết quả của hàm <code>apply()</code> khi tham số <span class="math inline">\(probs\)</span> là một véc-tơ là một ma trận, trong đó cột thứ nhất là giá trị phân vị tại các mức xác suất 10% và 90% của véc-tơ <span class="math inline">\(M[1,]\)</span> và cột thứ hai giá trị phân vị tại các mức xác suất 10% và 90% của véc-tơ <span class="math inline">\(M[2,]\)</span>. Giá trị chúng ta mong muốn lấy ra chính là các số nằm trên đường chéo chính của ma trận kết quả. Sẽ không có khó khăn gì nếu số lượng hàng của ma trận <span class="math inline">\(M\)</span> nhỏ. Bạn đọc sẽ gặp vấn đề khi số lượng véc-tơ được áp dụng là lớn bởi kích thước của ma trận kết quả sẽ tăng lên theo cấp số nhân. Thật vậy, nếu <span class="math inline">\(M\)</span> có <span class="math inline">\(n\)</span> hàng và hàm số được áp dụng có 1 tham số, ma trận kết quả sẽ có kích thước sẽ là <span class="math inline">\(n \times n\)</span> nếu bạn đọc sử dụng trực tiếp hàm <code>apply()</code>. Chẳng hạn như bạn muốn tính giá trị phân vị ở các mức xác suất 10%, 30%, 50%, 70%, và 90% của lần lượt các véc-tơ hàng thứ 1, 2, 3, 4, và 5 của một ma trận <span class="math inline">\(M\)</span> kích thước <span class="math inline">\(5 \times 10\)</span>.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="kiến-thức-r-nâng-cao.html#cb421-1" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>,<span class="dv">10</span>) <span class="co"># ma trận 5 * 10</span></span>
<span id="cb421-2"><a href="kiến-thức-r-nâng-cao.html#cb421-2" tabindex="-1"></a><span class="fu">apply</span>(M, <span class="dv">1</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.9</span>)) <span class="co"># ma trận kết quả kích thước 5 * 5</span></span></code></pre></div>
<pre><code>##     [,1] [,2] [,3] [,4] [,5]
## 10%  5.5  6.5  7.5  8.5  9.5
## 30% 14.5 15.5 16.5 17.5 18.5
## 50% 23.5 24.5 25.5 26.5 27.5
## 70% 32.5 33.5 34.5 35.5 36.5
## 90% 41.5 42.5 43.5 44.5 45.5</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="kiến-thức-r-nâng-cao.html#cb423-1" tabindex="-1"></a><span class="fu">diag</span>(<span class="fu">apply</span>(M, <span class="dv">1</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.9</span>))) <span class="co"># lấy ra đường chéo chính</span></span></code></pre></div>
<pre><code>## [1]  5.5 15.5 25.5 35.5 45.5</code></pre>
<p>Điều gì xảy ra khi ma trận <span class="math inline">\(M\)</span> có <span class="math inline">\(10^4\)</span> véc-tơ hàng? Ma trận kết quả sẽ có kích thước là <span class="math inline">\(10^4 \times 10^4\)</span>. Khi ma trận <span class="math inline">\(M\)</span> có <span class="math inline">\(10^5\)</span> véc-tơ hàng? Ma trận kết quả sẽ có kích thước là <span class="math inline">\(10^5 \times 10^5\)</span> và R sẽ báo lỗi vì bộ nhớ không đủ để lưu một ma trận có kích thước như vậy.</p>
<p>Một cách đơn giản để tiết kiệm thời gian và bộ nhớ khi áp dụng hàm số có tham số là hãy thêm tham số vào như là một phần của ma trận <span class="math inline">\(M\)</span> và điều chỉnh lại hàm <code>quantile()</code> trước khi sử dụng hàm <code>apply()</code></p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="kiến-thức-r-nâng-cao.html#cb425-1" tabindex="-1"></a>M1<span class="ot">&lt;-</span><span class="fu">cbind</span>(M,<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.9</span>)) <span class="co"># Thêm tham số vào cột cuối của ma trận M</span></span>
<span id="cb425-2"><a href="kiến-thức-r-nâng-cao.html#cb425-2" tabindex="-1"></a>my_quantile<span class="ot">&lt;-</span><span class="cf">function</span>(x){ </span>
<span id="cb425-3"><a href="kiến-thức-r-nâng-cao.html#cb425-3" tabindex="-1"></a>  <span class="co"># Định nghĩa lại hàm quantile có tham số p là giá trị cuối của véc-tơ</span></span>
<span id="cb425-4"><a href="kiến-thức-r-nâng-cao.html#cb425-4" tabindex="-1"></a>  n<span class="ot">&lt;-</span><span class="fu">length</span>(x)</span>
<span id="cb425-5"><a href="kiến-thức-r-nâng-cao.html#cb425-5" tabindex="-1"></a>  <span class="fu">quantile</span>(x[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)], x[n])</span>
<span id="cb425-6"><a href="kiến-thức-r-nâng-cao.html#cb425-6" tabindex="-1"></a>}</span>
<span id="cb425-7"><a href="kiến-thức-r-nâng-cao.html#cb425-7" tabindex="-1"></a><span class="fu">apply</span>(M1, <span class="dv">1</span>, my_quantile)</span></code></pre></div>
<pre><code>## [1]  5.5 15.5 25.5 35.5 45.5</code></pre>
</div>
<div id="hàm-lapply-và-sapply." class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Hàm <code>lapply()</code> và <code>sapply()</code>.<a href="kiến-thức-r-nâng-cao.html#hàm-lapply-và-sapply." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cơ chế hoạt động của <code>lapply()</code> tương tự như <code>apply()</code> và chỉ khác ở đối tượng áp dụng và cấu trúc của kết quả đầu ra. <code>lapply()</code> thường áp dụng trên các đối tượng kiểu list hoặc các kiểu đối tượng mà có thể sử dụng ký hiệu <span class="math inline">\(\$\)</span> để gọi phần tử con như data.frame và tibble. Chúng ta sẽ thảo luận về các đối tượng này ở phần sau của cuốn sách. Khi bạn đọc sử dụng hàm <code>lapply()</code>, bạn không cần phải sử dụng tùy biến <code>MARGIN</code> bởi vì <code>lapply()</code> sẽ luôn luôn hiểu các đối tượng được tác động đến là tất cả các đối tượng con của list.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="kiến-thức-r-nâng-cao.html#cb427-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb427-2"><a href="kiến-thức-r-nâng-cao.html#cb427-2" tabindex="-1"></a>          <span class="at">x2 =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>), </span>
<span id="cb427-3"><a href="kiến-thức-r-nâng-cao.html#cb427-3" tabindex="-1"></a>          <span class="at">x3 =</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">3</span>), </span>
<span id="cb427-4"><a href="kiến-thức-r-nâng-cao.html#cb427-4" tabindex="-1"></a>          <span class="at">x4 =</span> <span class="fu">list</span>(<span class="at">x41 =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">x42 =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)) )</span>
<span id="cb427-5"><a href="kiến-thức-r-nâng-cao.html#cb427-5" tabindex="-1"></a><span class="fu">lapply</span>(x, mean) <span class="co"># áp dụng hàm mean trên tất cả các phần tử con của x</span></span></code></pre></div>
<pre><code>## $x1
## [1] 5.5
## 
## $x2
## [1] 0.75
## 
## $x3
## [1] 3.5
## 
## $x4
## [1] NA</code></pre>
<p>Kết quả của <code>lapply()</code> là một list có số lượng phần tử và tên các phần tử con giống với véc-tơ <span class="math inline">\(x\)</span>. Trong trường hợp áp dụng hàm <code>mean()</code>, mỗi giá trị nằm trong list kết quả là giá trị trung bình của phần tử có tên tương ứng nằm trong list ban đầu. Do hàm <code>mean()</code> không thể sử dụng với đối tượng là một list nên phần tử <span class="math inline">\(x4\)</span> của kết quả có giá trị NA.</p>
<p>Hàm <code>sapply()</code> có cơ chế hoạt động hoàn toàn tương tự như <code>lapply()</code> và chỉ khác ở chỗ kết quả đầu ra là dưới dạng véc-tơ, ma trận, hoặc mảng. Thật vậy, vẫn với đối tượng <span class="math inline">\(x\)</span> kiểu list ở trên, chúng ta sử dụng <code>sapply()</code> thay vì <code>lapply()</code> sẽ cho kết quả dưới dạng véc-tơ thay vì dưới dạng list</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="kiến-thức-r-nâng-cao.html#cb429-1" tabindex="-1"></a><span class="fu">sapply</span>(x, mean) <span class="co"># áp dụng hàm mean trên tất cả các phần tử con của x</span></span></code></pre></div>
<pre><code>##   x1   x2   x3   x4 
## 5.50 0.75 3.50   NA</code></pre>
<p>Các hàm <code>lapply()</code> và <code>sapply()</code> thường xuyên được sử dụng khi làm việc với dữ liệu vì R lưu dữ liệu dưới dạng các data.frame hoặc tibbles. Khi sử dụng các hàm <code>lapply()</code> và <code>sapply()</code> với dữ liệu, các đối tượng được tác động đến sẽ luôn luôn là các véc-tơ cột. Hãy quan sát ví dụ dưới đây khi sử dụng <code>sapply()</code> để tính tỷ lệ giá trị không quan sát được của mỗi véc-tơ cột của một dữ liệu có tên là <span class="math inline">\(\textbf{gapminder}\)</span> nằm trong thư viện <span class="math inline">\(\textbf{dslabs}\)</span>.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="kiến-thức-r-nâng-cao.html#cb431-1" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span>
<span id="cb431-2"><a href="kiến-thức-r-nâng-cao.html#cb431-2" tabindex="-1"></a>s1<span class="ot">&lt;-</span><span class="fu">sapply</span>(gapminder, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))<span class="sc">/</span><span class="fu">length</span>(x)) </span>
<span id="cb431-3"><a href="kiến-thức-r-nâng-cao.html#cb431-3" tabindex="-1"></a><span class="co"># s1 là tỷ lệ không quan sát được của mỗi cột trong dữ liệu</span></span>
<span id="cb431-4"><a href="kiến-thức-r-nâng-cao.html#cb431-4" tabindex="-1"></a>s1<span class="ot">&lt;-</span><span class="fu">sort</span>(s1) <span class="co"># sắp xếp s1 theo thứ tự tăng dần</span></span>
<span id="cb431-5"><a href="kiến-thức-r-nâng-cao.html#cb431-5" tabindex="-1"></a><span class="fu">print</span>(s1) <span class="co"># hiển thị s1</span></span></code></pre></div>
<pre><code>##          country             year  life_expectancy        continent 
##       0.00000000       0.00000000       0.00000000       0.00000000 
##           region       population        fertility infant_mortality 
##       0.00000000       0.01754386       0.01773352       0.13779042 
##              gdp 
##       0.28183973</code></pre>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="kiến-thức-r-nâng-cao.html#cb433-1" tabindex="-1"></a><span class="fu">barplot</span>(s1,<span class="at">color =</span> <span class="st">&quot;#4553A3&quot;</span>, </span>
<span id="cb433-2"><a href="kiến-thức-r-nâng-cao.html#cb433-2" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Tỷ lệ&quot;</span>,</span>
<span id="cb433-3"><a href="kiến-thức-r-nâng-cao.html#cb433-3" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Tên biến/cột&quot;</span>,</span>
<span id="cb433-4"><a href="kiến-thức-r-nâng-cao.html#cb433-4" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Tỷ lệ missing value của các cột dữ liệu Gapminder&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-192-1.png" width="672" /></p>
</div>
</div>
<div id="phụ-lục-1" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Phụ lục<a href="kiến-thức-r-nâng-cao.html#phụ-lục-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="advrappen1" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Kiến thức nâng cao liên quan đến ma trận<a href="kiến-thức-r-nâng-cao.html#advrappen1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Các kiến thức liên quan đến ma trận trong phần này đòi hỏi bạn đọc cần có kiến thức nâng cao hơn. Nếu bạn đọc cảm thấy không cần thiết có thể bỏ qua vì các kiến thức được sử dụng trong phần này sẽ được nhắc lại khi có ứng dụng cụ thể.</p>
<div id="giá-trị-riêng-và-véc-tơ-riêng-của-ma-trận" class="section level4 hasAnchor" number="3.5.1.1">
<h4><span class="header-section-number">3.5.1.1</span> Giá trị riêng và véc-tơ riêng của ma trận<a href="kiến-thức-r-nâng-cao.html#giá-trị-riêng-và-véc-tơ-riêng-của-ma-trận" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cho A là một ma trận kích thước <span class="math inline">\(n \times n\)</span>. Nếu <span class="math inline">\(\lambda\)</span> và véc-tơ <span class="math inline">\(\textbf{v}\)</span> thỏa mãn
<span class="math display">\[\begin{align}
A \ \textbf{v} = \lambda \ \textbf{v}
\end{align}\]</span>
thì <span class="math inline">\(\lambda\)</span> là một giá trị riêng và <span class="math inline">\(\textbf{v}\)</span> là một véc-tơ riêng của ma trận vuông A. Giá trị riêng <span class="math inline">\(\lambda\)</span> là nghiệm của phương trình
<span class="math display">\[\begin{align}
det(A - \lambda I_n) = 0
\end{align}\]</span>
trong đó <span class="math inline">\(det\)</span> là định thức của ma trận và <span class="math inline">\(I_n\)</span> là ma trận đơn vị kích thước <span class="math inline">\(n \times n\)</span>. Vế bên trái của phương trình ở trên là một đa thức bậc <span class="math inline">\(n\)</span> và giá trị riêng <span class="math inline">\(\lambda\)</span> là nghiệm của đa thức đó. Véc-tơ <span class="math inline">\(\textbf{v}\)</span> là véc-tơ riêng tương ứng với giá trị riêng <span class="math inline">\(\lambda\)</span>.</p>
<p>Nếu ma trận <span class="math inline">\(A\)</span> là một ma trận đối xứng thì tất cả các giá trị riêng của ma trận đều là số thực và ma trận đó có <span class="math inline">\(n\)</span> véc-tơ riêng tương ứng với <span class="math inline">\(n\)</span> giá trị riêng. Giả sử <span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(\lambda_n\)</span> là <span class="math inline">\(n\)</span> giá trị riêng của ma trận A. Các véc-tơ riêng tương ứng là <span class="math inline">\(\textbf{v}_1\)</span>, <span class="math inline">\(\textbf{v}_2\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(\textbf{v}_n\)</span> và chúng ta giả sử rằng các véc-tơ <span class="math inline">\(\textbf{v}_i\)</span> đều đã được chuẩn hóa sao cho
<span class="math display">\[\begin{align}
&amp; \textbf{v}_i^T \textbf{v}_j = 0 \ \ \forall i \neq j, 1 \leq i,j \leq n \\
&amp; \textbf{v}_i^T \textbf{v}_i = 1 \ \ \forall i, 1 \leq i \leq n
\end{align}\]</span>
Khi đó, ma trận A có thể được khai triển dưới dạng
<span class="math display">\[\begin{align}
A = V \Gamma V^T
\end{align}\]</span>
trong đó V là ma trận có các cột là các véc-tơ riêng của ma trận A và <span class="math inline">\(\Gamma\)</span> là ma trận đường chéo có các phần tử nằm trên đường chéo chính là các giá trị riêng của ma trận A
<span class="math display">\[\begin{align}
&amp; V[,i] = \textbf{v}_i \forall i, 1 \leq i \leq n \\
&amp; \Gamma = diag(\lambda_1, \lambda_2, \cdots, \lambda_n)
\end{align}\]</span>
Khai triển trên của ma trận vuông A được gọi là spectral decomposition. Hàm <code>eigen()</code> được sử dụng để tính toán các giá trị riêng và véc-tơ riêng của ma trận. Bạn đọc quan sát ví dụ dưới đây: hàm <code>eigen()</code> được sử dụng để tính toán các giá trị riêng và véc-tơ riêng của ma trận tương quan của ba biến <span class="math inline">\(\textit{medv}\)</span>, <span class="math inline">\(lstat\)</span>, và <span class="math inline">\(rm\)</span> (ma trận <span class="math inline">\(3 \times 3\)</span>) trong dữ liệu <span class="math inline">\(\textbf{Boston}\)</span> của thư viện <span class="math inline">\(\textbf{MASS}\)</span>.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="kiến-thức-r-nâng-cao.html#cb434-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb434-2"><a href="kiến-thức-r-nâng-cao.html#cb434-2" tabindex="-1"></a>dat<span class="ot">&lt;-</span>dplyr<span class="sc">::</span><span class="fu">select</span>(Boston, medv, lstat, rm) <span class="co"># Lựa chọn 3 cột</span></span>
<span id="cb434-3"><a href="kiến-thức-r-nâng-cao.html#cb434-3" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="fu">cor</span>(dat) <span class="co"># Tính ma trận tương quan</span></span>
<span id="cb434-4"><a href="kiến-thức-r-nâng-cao.html#cb434-4" tabindex="-1"></a>result<span class="ot">&lt;-</span><span class="fu">eigen</span>(M) <span class="co"># Hàm eigen tính giá trị riêng và véc-tơ riêng</span></span>
<span id="cb434-5"><a href="kiến-thức-r-nâng-cao.html#cb434-5" tabindex="-1"></a>result<span class="sc">$</span>values <span class="co"># Giá trị riêng</span></span></code></pre></div>
<pre><code>## [1] 2.3658220 0.3900962 0.2440818</code></pre>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="kiến-thức-r-nâng-cao.html#cb436-1" tabindex="-1"></a>result<span class="sc">$</span>vectors <span class="co"># Véc-tơ riêng theo cột</span></span></code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]
## [1,]  0.5959303 -0.1286943 -0.7926568
## [2,] -0.5741638  0.6218127 -0.5326207
## [3,]  0.5614294  0.7725197  0.2966654</code></pre>
</div>
<div id="khai-triển-trực-giao-của-ma-trận" class="section level4 hasAnchor" number="3.5.1.2">
<h4><span class="header-section-number">3.5.1.2</span> Khai triển trực giao của ma trận<a href="kiến-thức-r-nâng-cao.html#khai-triển-trực-giao-của-ma-trận" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Mọi ma trận A kích thước <span class="math inline">\(m \times n\)</span> đều có thể viết dưới dạng
<span class="math display">\[\begin{align}
A = Q U
\end{align}\]</span>
trong đó <span class="math inline">\(Q\)</span> là một ma trận trực giao kích thước, nghĩa là <span class="math inline">\(Q^T Q = I\)</span> và <span class="math inline">\(U\)</span> là một ma trận đường tam giác trên. Nếu <span class="math inline">\(m \geq n\)</span> thì có hai cách để chọn kích thước cho các ma trận</p>
<ul>
<li><p>Cách thứ nhất: <span class="math inline">\(Q\)</span> là một ma trận kích thước <span class="math inline">\(m \times n\)</span> và <span class="math inline">\(R\)</span> là một ma trận kích thước <span class="math inline">\(n \times n\)</span>.</p></li>
<li><p>Cách thứ hai: <span class="math inline">\(Q\)</span> là một ma trận kích thước <span class="math inline">\(m \times m\)</span> và <span class="math inline">\(R\)</span> là một ma trận kích thước <span class="math inline">\(n \times n\)</span>.</p></li>
</ul>
</div>
<div id="ma-trận-xác-định-dương" class="section level4 hasAnchor" number="3.5.1.3">
<h4><span class="header-section-number">3.5.1.3</span> Ma trận xác định dương<a href="kiến-thức-r-nâng-cao.html#ma-trận-xác-định-dương" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ma trận đối xứng A được gọi là xác định dương khi và chỉ khi
<span class="math display">\[\begin{align}
\textbf{x}^T \ A \ \textbf{x} &gt; 0
\end{align}\]</span>
với mọi véc-tơ <span class="math inline">\(\textbf{x}\)</span> khác véc-tơ <span class="math inline">\(\textbf{0}\)</span>. Định nghĩa này của ma trận xác định dương rất khó được xác thực, do đó có các định nghĩa tương đương khác sẽ có ý nghĩa thực tiễn hơn. Chẳng hạn như nếu một ma trận đối xứng có tất cả các giá trị riêng là số dương thì đó là một ma trận xác định dương.</p>
<p>Tương tự như khai niệm ma trận xác định dương, ta có các khái niệm</p>
<ul>
<li><p>Ma trận xác định không âm là ma trận đối xứng thỏa mãn <span class="math inline">\(\textbf{x}^T \ A \ \textbf{x} \geq 0\)</span> với mọi véc-tơ <span class="math inline">\(\textbf{x}\)</span> khác véc-tơ <span class="math inline">\(\textbf{0}\)</span>. Ma trận xác định không âm là ma trận có tất cả các giá trị riêng không âm.</p></li>
<li><p>Ma trận xác định âm là ma trận đối xứng thỏa mãn <span class="math inline">\(\textbf{x}^T \ A \ \textbf{x} &lt; 0\)</span> với mọi véc-tơ <span class="math inline">\(\textbf{x}\)</span> khác véc-tơ <span class="math inline">\(\textbf{0}\)</span>. Ma trận xác định âm là ma trận có tất cả các giá trị riêng là số âm.</p></li>
<li><p>Ma trận xác định không dương là ma trận đối xứng thỏa mãn <span class="math inline">\(\textbf{x}^T \ A \ \textbf{x} \leq 0\)</span> với mọi véc-tơ <span class="math inline">\(\textbf{x}\)</span> khác véc-tơ <span class="math inline">\(\textbf{0}\)</span>. Ma trận xác định không dương là ma trận có tất cả các giá trị riêng không dương.</p></li>
</ul>
<p>Ma trận xác định dương A kích thước <span class="math inline">\(n \times n\)</span> có thể được viết dưới dạng
<span class="math display">\[\begin{align}
A = L D L^T
\end{align}\]</span>
với <span class="math inline">\(L\)</span> là ma trận tam giác dưới có tất cả các phần tử nằm trên đường chéo chính bằng 1, ma trận <span class="math inline">\(D\)</span> là ma trận đường chéo có tất cả các phần tử nằm trên đường chéo chính là số dương.</p>
<p>Do <span class="math inline">\(D\)</span> là ma trận có tất cả các phần tử nằm trên đường chéo chính là số dương nên <span class="math inline">\(D\)</span> có thể được viết dưới dạng
<span class="math display">\[\begin{align}
D = \hat{D} \ \hat{D}
\end{align}\]</span>
trong đó <span class="math inline">\(\hat{D}\)</span> là ma trận đường chéo có phần tử thứ <span class="math inline">\(i\)</span> trên đường chéo chính bằng căn bậc 2 của phần <span class="math inline">\(D_{i,i}\)</span>.</p>
<p>Khi đó, ma trận <span class="math inline">\(A\)</span> có thể được viết dưới dạng
<span class="math display">\[\begin{align}
A = L D L^T = L \hat{D} \ \hat{D} L^T = \hat{L} \ \hat{L}^T
\end{align}\]</span>
trong đó <span class="math inline">\(\hat{L}\)</span> là ma trận tam giác dưới. Khai triển này thường được gọi là Cholesky decomposion của một ma trận xác định dương.</p>
</div>
</div>
<div id="advrappen2" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Gradient, Hessian và Jacobian<a href="kiến-thức-r-nâng-cao.html#advrappen2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Trong tính toán và tối ưu hàm nhiều biến, grandient, hessian và jacobian là các khái niệm vô cùng quan trọng.</p>
<div id="định-nghĩa" class="section level4 hasAnchor" number="3.5.2.1">
<h4><span class="header-section-number">3.5.2.1</span> Định nghĩa<a href="kiến-thức-r-nâng-cao.html#định-nghĩa" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cho hàm số <span class="math inline">\(f: \mathbb{R}^n \rightarrow \mathbb{R}\)</span>
<span class="math display">\[\begin{align}
f(\textbf{x}) = f(x_1, x_2, \cdots, x_n)
\end{align}\]</span></p>
<p>Véc-tơ của các đạo hàm bậc nhất của hàm <span class="math inline">\(f\)</span> theo các thành phần của véc-tơ <span class="math inline">\(\textbf{x}\)</span> được gọi là <span class="math inline">\(gradien\)</span> của hàm số <span class="math inline">\(f\)</span> tại điểm <span class="math inline">\(\textbf{x}\)</span>. Gradient của hàm <span class="math inline">\(f\)</span> được ký hiệu như sau
<span class="math display">\[\begin{align}
\nabla f(\textbf{x}) = \left(\cfrac{\partial f(\textbf{x})}{\partial x_1}, \cfrac{\partial f(\textbf{x})}{\partial x_2}, \cdots, \cfrac{\partial f(\textbf{x})}{\partial x_n})
\end{align}\]</span></p>
<p>Ma trận chứa đạo hàm bậc hai của hàm <span class="math inline">\(f\)</span> theo các thành phần của véc-tơ <span class="math inline">\(\textbf{x}\)</span>, mà phần tử ở hàng thứ <span class="math inline">\(i\)</span> cột <span class="math inline">\(j\)</span> là đạo hàm của hàm <span class="math inline">\(f\)</span> lần lượt theo <span class="math inline">\(x_i\)</span>, <span class="math inline">\(x_j\)</span>, được gọi là ma trận <span class="math inline">\(hessian\)</span> của hàm <span class="math inline">\(f\)</span> tại điểm <span class="math inline">\(\textbf{x}\)</span>. Ma trận hessian thường được ký hiệu là <span class="math inline">\(\nabla^2 f(\textbf{x})\)</span>. Phần tử ở hàng thứ <span class="math inline">\(i\)</span> và cột <span class="math inline">\(j\)</span> của ma trận hessian được xác định như sau
<span class="math display">\[\begin{align}
\left[\nabla^2 f(\textbf{x})\right]_{i,j} = \cfrac{\partial^2 f(\textbf{x})}{\partial x_i \partial x_j}
\end{align}\]</span></p>
<p>Lưu ý rằng hessian là ma trận đối xứng bởi vì
<span class="math display">\[\begin{align}
\cfrac{\partial^2 f(\textbf{x})}{\partial x_i \partial x_j} = \cfrac{\partial^2 f(\textbf{x})}{\partial x_j \partial x_i}
\end{align}\]</span></p>
<p>Khái niệm Jacobian được dùng thay thế cho gradient khi hàm số <span class="math inline">\(f\)</span> nhận giá trị trong không gian <span class="math inline">\(\mathbb{R}^m\)</span>, với
<span class="math display">\[\begin{align}
f(\textbf{x}) = f(x_1, x_2, \cdots, x_n) =
\begin{bmatrix}
f_1(x_1, x_2, \cdots, x_n) \\
f_2(x_1, x_2, \cdots, x_n) \\
\cdots \\
f_m(x_1, x_2, \cdots, x_n) \\
\end{bmatrix}
\end{align}\]</span>
ta có ma trận Jacobian của hàm <span class="math inline">\(f\)</span> tại điểm <span class="math inline">\(x\)</span> là ma trận kích thước <span class="math inline">\(n \times m\)</span>, ký hiệu <span class="math inline">\([\nabla f(\textbf{x})]^T\)</span> trong đó cột thứ <span class="math inline">\(j\)</span> của ma trận Jacobian là gradient của hàm <span class="math inline">\(f_j\)</span> tại điểm <span class="math inline">\(\textbf{x}\)</span>. Trong nhiều trường hợp, khái niệm <span class="math inline">\(grandient\)</span> và <span class="math inline">\(Jacobian\)</span> có thể được sử dụng thay thế cho nhau.</p>
<p>Ví dụ, với <span class="math inline">\(\textbf{x}\)</span> là véc-tơ có độ dài <span class="math inline">\(n\)</span>. Nếu <span class="math inline">\(\textbf{a}\)</span> là véc-tơ độ dài <span class="math inline">\(n\)</span> và <span class="math inline">\(A\)</span> là ma trận kích thước <span class="math inline">\(m \times n\)</span> thì chúng ta có
<span class="math display">\[\begin{align}
\nabla \textbf{a}^T \textbf{x}) = \textbf{a} \\
\nabla A \textbf{x} = A^T
\end{align}\]</span></p>
</div>
<div id="gradient-và-hessian-của-dạng-toàn-phương" class="section level4 hasAnchor" number="3.5.2.2">
<h4><span class="header-section-number">3.5.2.2</span> Gradient và hessian của dạng toàn phương<a href="kiến-thức-r-nâng-cao.html#gradient-và-hessian-của-dạng-toàn-phương" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cho
<span class="math display">\[\begin{align}
f(\textbf{x}) = \cfrac{1}{2} \ \textbf{x}^T A \textbf{x} + \textbf{a}^T \textbf{x}
\end{align}\]</span>
với <span class="math inline">\(A\)</span> là một ma trận đối xứng và <span class="math inline">\(\textbf{a}\)</span> là véc-tơ độ dài <span class="math inline">\(n\)</span> thì ta có
<span class="math display">\[\begin{align}
&amp; \nabla f(\textbf{x}) = A \textbf{x} + \textbf{a} \\
&amp; \nabla^2 f(\textbf{x}) = A
\end{align}\]</span></p>
</div>
<div id="gradient-và-hessian-của-tích-các-hàm-số" class="section level4 hasAnchor" number="3.5.2.3">
<h4><span class="header-section-number">3.5.2.3</span> Gradient và hessian của tích các hàm số<a href="kiến-thức-r-nâng-cao.html#gradient-và-hessian-của-tích-các-hàm-số" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cho hàm <span class="math inline">\(f\)</span> là tích của hai hàm <span class="math inline">\(g\)</span> và <span class="math inline">\(h\)</span> đều là các hàm số có đạo hàm có tập xác định trên tập <span class="math inline">\(\mathbb{R}^n\)</span> và nhận giá trị trên tập các số thực
<span class="math display">\[\begin{align}
f(\textbf{x}) = h(\textbf{x}) g(\textbf{x})
\end{align}\]</span></p>
<p>Gradient và hessian của hàm số <span class="math inline">\(f\)</span> được tính toán thông qua gradient và hessian của các hàm <span class="math inline">\(g\)</span> và <span class="math inline">\(h\)</span> như sau
<span class="math display">\[\begin{align}
&amp; \nabla f(\textbf{x}) = \nabla h(\textbf{x}) \ g(\textbf{x}) + h(\textbf{x}) \  \nabla g(\textbf{x}) \\
&amp; \nabla^2 f(\textbf{x}) = \left[\nabla^2 h(\textbf{x})\right] g(\textbf{x}) + \left[\nabla^2 g(\textbf{x})\right] h(\textbf{x}) + \nabla h(\textbf{x}) \nabla g(\textbf{x})^T + \nabla g(\textbf{x}) \nabla h(\textbf{x})^T
\end{align}\]</span></p>
</div>
<div id="quy-tắc-chain-rule" class="section level4 hasAnchor" number="3.5.2.4">
<h4><span class="header-section-number">3.5.2.4</span> Quy tắc Chain rule<a href="kiến-thức-r-nâng-cao.html#quy-tắc-chain-rule" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The chain rule là quy tắc tính toán đạo hàm của một hàm số trên một hàm số khác. Cho <span class="math inline">\(g\)</span> là hàm số <span class="math inline">\(\mathbb{R}^m \rightarrow \mathbb{R}\)</span> và với mỗi <span class="math inline">\(i\)</span>, <span class="math inline">\(1 \leq i \leq m\)</span>, ta có hàm <span class="math inline">\(f_i\)</span> nhận có tập xác định trên <span class="math inline">\(\mathbb{R}^n\)</span> và nhận giá trị trên tập các số thực:
<span class="math display">\[\begin{align}
f_i(\textbf{x}) = f_i(x_1, x_2, \cdots, x_n)
\end{align}\]</span></p>
<p>Hàm số <span class="math inline">\(f\)</span> được xác định bởi
<span class="math display">\[\begin{align}
f(\textbf{x}) = g(f_1(\textbf{x}), f_2(\textbf{x}), \cdots, f_m(\textbf{x}))
\end{align}\]</span>
sẽ có gradient được xác định theo the chain rule như sau
<span class="math display">\[\begin{align}
\nabla f(\textbf{x}) = \left[ \nabla f_1, \nabla f_2, \cdots, \nabla f_m \right] \cdot \nabla g(f_1(\textbf{x}), f_2(\textbf{x}), \cdots, f_m(\textbf{x}))
\end{align}\]</span></p>
<p>Trong công thức tính gradient ở trên, thành phần thứ nhất là một ma trận kích thước <span class="math inline">\(n \times m\)</span> trong đó cột thứ <span class="math inline">\(j\)</span> là gradient của hàm <span class="math inline">\(f_j\)</span> theo <span class="math inline">\(\textbf{x}\)</span>, thành phần thứ hai là gradient (véc-tơ) của hàm <span class="math inline">\(g\)</span> tính tại điểm <span class="math inline">\(\left(f_1(\textbf{x}), f_2(\textbf{x}), \cdots, f_m(\textbf{x})\right)\)</span>.</p>
</div>
</div>
<div id="thuật-toán-gradient-descent" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Thuật toán gradient descent<a href="kiến-thức-r-nâng-cao.html#thuật-toán-gradient-descent" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Gradient descent là một phương pháp giải số các bài toán tối ưu không bị ràng buộc. Đây là thuật toán sử dụng vòng lặp để tìm kiếm điểm cực tiểu địa phương của một hàm nhiều biến khả vi. Ý tưởng của thuật toán là từ một điểm ban đầu chúng ta sẽ thực hiện các vòng lặp để thay đổi giá trị đó theo hướng ngược lại với độ dốc (gradient) của hàm số tính tại điểm hiện tại. Gradient descent là phương pháp chủ yếu trong quá trình ước lượng tham số của các mô hình học máy phức tạp.</p>
<p>Giả sử hàm số chúng ta muốn tối thiểu hóa là hàm <span class="math inline">\(f\)</span> và điểm khởi đầu là điểm <span class="math inline">\(x_0\)</span>, chúng ta sẽ di chuyển đến điểm <span class="math inline">\(x_1\)</span> được tính toán bởi công thức sau
<span class="math display">\[\begin{align}
x_1 = x_0 - \lambda \cdot \nabla f(x_0)
\end{align}\]</span></p>
<p>Một cách tổng quát, chúng ta có thể viết công thức để di chuyển từ điểm <span class="math inline">\(x_n\)</span> đến <span class="math inline">\(x_{n+1}\)</span> như sau
<span class="math display">\[\begin{align}
x_{n+1} = x_n - \lambda \cdot \nabla f(x_n)
\end{align}\]</span>
với <span class="math inline">\(\lambda\)</span> là một số dương nhỏ. Thuật toán gradient descent sẽ dừng lại cho đến khi đạt được tiêu chí là hàm <span class="math inline">\(f\)</span> không còn giảm một cách đáng kể sau mỗi lần thay đổi <span class="math inline">\(x\)</span>. Một vài lưu ý khi thực hiện thuật toán này là</p>
<ul>
<li><p>Thuật toán gradient descent luôn hiểu với mục tiêu là tìm cực tiểu của hàm <span class="math inline">\(f\)</span>, do đó trong bài toán tìm cực đại, chúng ta áp dụng gradient descent trên hàm <span class="math inline">\(-f\)</span>.</p></li>
<li><p>Gradient descent chỉ hội tụ đến một điểm cực tiểu địa phương chứ không hội tụ đến điểm cực tiểu tổng thể, do đó lựa chọn điểm <span class="math inline">\(x_0\)</span> bạn đầu là khá quan trọng nếu hàm <span class="math inline">\(f\)</span> có một (vài) điểm cực tiểu địa phương khác với điểm cực tiểu tổng thể.</p></li>
<li><p>Lựa chọn giá trị của <span class="math inline">\(\lambda\)</span> cũng là rất quan trọng. Nếu <span class="math inline">\(\lambda\)</span> quá nhỏ, thuật toán sẽ hội tụ chậm, nghĩa là cần rất nhiều bước để tìm được điểm tối ưu. Nếu <span class="math inline">\(\lambda\)</span> lớn, thuật toán sẽ không tìm được điểm cực tiểu. Lưu ý rằng, tại mỗi bước lựa chọn giá trị của <span class="math inline">\(\lambda\)</span> không nhất thiết phải là hằng số. Kinh nghiệm lựa chọn <span class="math inline">\(\lambda\)</span> là cho <span class="math inline">\(\lambda\)</span> giảm dần sau một số bước.</p></li>
</ul>
<p>Ví dụ 1: Hàm số <span class="math inline">\(f(x) = (x-2)^2\)</span> có điểm cực tiểu là 2. Chúng ta có thể kiểm tra sự hội tụ của thuật toán gradient descent như sau: có thể dễ dàng thấy rằng đạo hàm của hàm <span class="math inline">\(f\)</span> là <span class="math inline">\(2 \times (x-2)\)</span>; giá trị <span class="math inline">\(x_0\)</span> được lựa chọn ngẫu nhiên trong khoảng từ -100 đến 100; <span class="math inline">\(\lambda\)</span> được cho cố định là 0.1; thuật toán sẽ dừng lại khi giá trị hàm <span class="math inline">\(f\)</span> tại 2 bước kế tiếp nhau nhỏ hơn <span class="math inline">\(10^{-8}\)</span>.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="kiến-thức-r-nâng-cao.html#cb438-1" tabindex="-1"></a>lambda<span class="ot">&lt;-</span><span class="fl">0.1</span></span>
<span id="cb438-2"><a href="kiến-thức-r-nâng-cao.html#cb438-2" tabindex="-1"></a>vong_lap_toi_da <span class="ot">=</span> <span class="dv">40</span></span>
<span id="cb438-3"><a href="kiến-thức-r-nâng-cao.html#cb438-3" tabindex="-1"></a>sai_so_nho_nhat<span class="ot">&lt;-</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)</span>
<span id="cb438-4"><a href="kiến-thức-r-nâng-cao.html#cb438-4" tabindex="-1"></a></span>
<span id="cb438-5"><a href="kiến-thức-r-nâng-cao.html#cb438-5" tabindex="-1"></a><span class="co"># Hàm số cần tìm cực tiểu</span></span>
<span id="cb438-6"><a href="kiến-thức-r-nâng-cao.html#cb438-6" tabindex="-1"></a>f<span class="ot">&lt;-</span><span class="cf">function</span>(x) (x<span class="dv">-2</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb438-7"><a href="kiến-thức-r-nâng-cao.html#cb438-7" tabindex="-1"></a></span>
<span id="cb438-8"><a href="kiến-thức-r-nâng-cao.html#cb438-8" tabindex="-1"></a><span class="co"># Gradient tại điểm x</span></span>
<span id="cb438-9"><a href="kiến-thức-r-nâng-cao.html#cb438-9" tabindex="-1"></a>grad.f<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="dv">2</span><span class="sc">*</span>(x<span class="dv">-2</span>)</span>
<span id="cb438-10"><a href="kiến-thức-r-nâng-cao.html#cb438-10" tabindex="-1"></a></span>
<span id="cb438-11"><a href="kiến-thức-r-nâng-cao.html#cb438-11" tabindex="-1"></a><span class="co"># Cho x0 bat ky</span></span>
<span id="cb438-12"><a href="kiến-thức-r-nâng-cao.html#cb438-12" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb438-13"><a href="kiến-thức-r-nâng-cao.html#cb438-13" tabindex="-1"></a>v_x0<span class="ot">&lt;-</span><span class="fu">runif</span>(<span class="dv">20</span>,<span class="sc">-</span><span class="dv">100</span>,<span class="dv">100</span>)</span>
<span id="cb438-14"><a href="kiến-thức-r-nâng-cao.html#cb438-14" tabindex="-1"></a></span>
<span id="cb438-15"><a href="kiến-thức-r-nâng-cao.html#cb438-15" tabindex="-1"></a><span class="co"># dat: du lieu luu ket qua</span></span>
<span id="cb438-16"><a href="kiến-thức-r-nâng-cao.html#cb438-16" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">so_vong_lap =</span> <span class="dv">1</span><span class="sc">:</span>vong_lap_toi_da)</span>
<span id="cb438-17"><a href="kiến-thức-r-nâng-cao.html#cb438-17" tabindex="-1"></a></span>
<span id="cb438-18"><a href="kiến-thức-r-nâng-cao.html#cb438-18" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(v_x0)){</span>
<span id="cb438-19"><a href="kiến-thức-r-nâng-cao.html#cb438-19" tabindex="-1"></a>  x0<span class="ot">&lt;-</span>v_x0[j]</span>
<span id="cb438-20"><a href="kiến-thức-r-nâng-cao.html#cb438-20" tabindex="-1"></a>  <span class="co"># Bước 1</span></span>
<span id="cb438-21"><a href="kiến-thức-r-nâng-cao.html#cb438-21" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,vong_lap_toi_da)</span>
<span id="cb438-22"><a href="kiến-thức-r-nâng-cao.html#cb438-22" tabindex="-1"></a>  x[<span class="dv">1</span>]<span class="ot">&lt;-</span> x0 <span class="sc">-</span> lambda <span class="sc">*</span> <span class="fu">grad.f</span>(x0)</span>
<span id="cb438-23"><a href="kiến-thức-r-nâng-cao.html#cb438-23" tabindex="-1"></a>  sai_so<span class="ot">&lt;-</span><span class="fu">abs</span>(<span class="fu">f</span>(x[i])<span class="sc">-</span><span class="fu">f</span>(x0))</span>
<span id="cb438-24"><a href="kiến-thức-r-nâng-cao.html#cb438-24" tabindex="-1"></a>            </span>
<span id="cb438-25"><a href="kiến-thức-r-nâng-cao.html#cb438-25" tabindex="-1"></a>  <span class="co"># Từ bước 2 trở đi</span></span>
<span id="cb438-26"><a href="kiến-thức-r-nâng-cao.html#cb438-26" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb438-27"><a href="kiến-thức-r-nâng-cao.html#cb438-27" tabindex="-1"></a>  <span class="cf">while</span> (i<span class="sc">&lt;</span> vong_lap_toi_da <span class="sc">&amp;</span> sai_so <span class="sc">&gt;</span> sai_so_nho_nhat){</span>
<span id="cb438-28"><a href="kiến-thức-r-nâng-cao.html#cb438-28" tabindex="-1"></a>    x[i]<span class="ot">&lt;-</span>x[i<span class="dv">-1</span>] <span class="sc">-</span> lambda <span class="sc">*</span> <span class="fu">grad.f</span>(x[i<span class="dv">-1</span>])</span>
<span id="cb438-29"><a href="kiến-thức-r-nâng-cao.html#cb438-29" tabindex="-1"></a>    sai_so <span class="ot">=</span> <span class="fu">abs</span>(<span class="fu">f</span>(x[i])<span class="sc">-</span><span class="fu">f</span>(x[i<span class="dv">-1</span>]))</span>
<span id="cb438-30"><a href="kiến-thức-r-nâng-cao.html#cb438-30" tabindex="-1"></a>    i<span class="ot">&lt;-</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb438-31"><a href="kiến-thức-r-nâng-cao.html#cb438-31" tabindex="-1"></a>  }</span>
<span id="cb438-32"><a href="kiến-thức-r-nâng-cao.html#cb438-32" tabindex="-1"></a>  x[i<span class="sc">:</span>vong_lap_toi_da]<span class="ot">&lt;-</span>x[i<span class="dv">-1</span>]</span>
<span id="cb438-33"><a href="kiến-thức-r-nâng-cao.html#cb438-33" tabindex="-1"></a>  dat<span class="ot">&lt;-</span><span class="fu">mutate</span>(dat,x)</span>
<span id="cb438-34"><a href="kiến-thức-r-nâng-cao.html#cb438-34" tabindex="-1"></a>  <span class="fu">names</span>(dat)[j<span class="sc">+</span><span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">&quot;Vong_lap&quot;</span>,j)</span>
<span id="cb438-35"><a href="kiến-thức-r-nâng-cao.html#cb438-35" tabindex="-1"></a>}</span>
<span id="cb438-36"><a href="kiến-thức-r-nâng-cao.html#cb438-36" tabindex="-1"></a></span>
<span id="cb438-37"><a href="kiến-thức-r-nâng-cao.html#cb438-37" tabindex="-1"></a>dat<span class="sc">%&gt;%</span><span class="fu">gather</span>(<span class="st">&quot;loop&quot;</span>, <span class="st">&quot;value&quot;</span>, <span class="sc">-</span>so_vong_lap)<span class="sc">%&gt;%</span></span>
<span id="cb438-38"><a href="kiến-thức-r-nâng-cao.html#cb438-38" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(so_vong_lap, value, <span class="at">col =</span> loop))<span class="sc">+</span></span>
<span id="cb438-39"><a href="kiến-thức-r-nâng-cao.html#cb438-39" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span><span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb438-40"><a href="kiến-thức-r-nâng-cao.html#cb438-40" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Giá trị hàm f&quot;</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Số vòng lặp&quot;</span>)<span class="sc">+</span></span>
<span id="cb438-41"><a href="kiến-thức-r-nâng-cao.html#cb438-41" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb438-42"><a href="kiến-thức-r-nâng-cao.html#cb438-42" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>Bạn đọc có thể thấy rằng sau khoảng 20 đến 30 vòng lặp thuật toán đã hội tụ. Hình <a href="kiến-thức-r-nâng-cao.html#fig:gradientdescent02">3.1</a> mô tả quá trình hội tụ của 50 điểm ngẫu nhiên trong hình vuông <span class="math inline">\([-50,50] \times [-50,50]\)</span> hội tụ về điểm tối ưu <span class="math inline">\((x_1 = 5, x_2 = 10)\)</span> của hàm <span class="math inline">\(f(x_1, x_2) = (x_1 - 5)^2 + (x_2 - 10)^2\)</span>.</p>
<div class="figure"><span style="display:block;" id="fig:gradientdescent02"></span>
<img src="bookdown-demo_files/figure-html/gradientdescent02-1.png" alt="Quá trình hội tụ các điểm ngẫu nhiên đến điểm cực tiểu của hàm f sử dụng thuật toán gradient descent" width="672" />
<p class="caption">
Figure 3.1: Quá trình hội tụ các điểm ngẫu nhiên đến điểm cực tiểu của hàm f sử dụng thuật toán gradient descent
</p>
</div>
</div>
<div id="advrappen3" class="section level3 hasAnchor" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> Các giá trị đặc trưng của một dòng tiền tương lai<a href="kiến-thức-r-nâng-cao.html#advrappen3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="giá-trị-hiện-tại-và-tỷ-suất-sinh-lời-nội-bộ" class="section level4 hasAnchor" number="3.5.4.1">
<h4><span class="header-section-number">3.5.4.1</span> Giá trị hiện tại và tỷ suất sinh lời nội bộ<a href="kiến-thức-r-nâng-cao.html#giá-trị-hiện-tại-và-tỷ-suất-sinh-lời-nội-bộ" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Một dòng tiền <span class="math inline">\(CF_{t_1}\)</span>, <span class="math inline">\(CF_{t_2}\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(CF_{t_n}\)</span> xảy ra tại các thời điểm <span class="math inline">\(t_k\)</span> với <span class="math inline">\(1 \leq k \leq n\)</span>. Giá trị hiện tại của dòng tiền với lãi suất <span class="math inline">\(i\)</span> được tính theo phương pháp lãi gộp như sau:
<span class="math display">\[\begin{align}
PV = \sum\limits_{k=1}^n \cfrac{CF_{t_k}}{(1+i)^{t_k}}
\end{align}\]</span>
Giá trị hiện tại của một dòng tiền là một thước đo cho giá trị của tài sản tạo ra dòng tiền đó. Nhìn chung, tài sản nào có giá trị hiện tại lớn hơn thì có giá trị cao hơn.</p>
<p>Tỷ suất sinh lời nội bộ (Internal rate of return hay IRR) là mức lãi suất <span class="math inline">\(i_0\)</span> mà tính theo mức lãi suất này giá trị hiện tại của một dòng tiền bằng 0. Tỷ suất sinh lời nội bộ không tồn tại nếu dòng tiền tương lai của một tài sản chỉ có giá trị dương (hoặc âm).</p>
</div>
<div id="durations" class="section level4 hasAnchor" number="3.5.4.2">
<h4><span class="header-section-number">3.5.4.2</span> Durations<a href="kiến-thức-r-nâng-cao.html#durations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Duration không phải là thước đo thời gian từ lúc bắt đầu đến lúc đáo hạn của dòng tiền mà là một thước đo cho sự nhạy cảm của giá trị hiện tại của dòng tiền theo sự thay đổi của lãi suất.</p>
<ul>
<li><p>Macaulay Duration là thước đo, tính bằng đơn vị thời gian, là giá trị trung bình có trọng số của khoảng thời gian tính từ lúc bắt đầu đến thời điểm mà các dòng tiền xuất hiện. Macaulay Duration được ký hiệu là <span class="math inline">\(Mac\_D\)</span> được tính bằng công thức sau:
<span class="math display">\[\begin{align}
Mac_D = w_1 \times t_1 + w_2 \times t_2 + \cdots + w_n \times t_n
\end{align}\]</span>
với tỷ trọng <span class="math inline">\(w_k\)</span> được tính bằng tỷ trọng của giá trị hiện tại của <span class="math inline">\(CF_{t_k}\)</span> trong giá trị hiện tại của toàn bộ dòng tiền
<span class="math display">\[\begin{align}
w_k = \cfrac{1}{PV} \times \cfrac{CF_{t_k}}{(1+i)^{t_k}}
\end{align}\]</span></p></li>
<li><p>Modified duration đo lường sự thay đổi (theo %) sự thay đổi của giá trị hiện tại của dòng tiền khi có sự thay đổi nhỏ trong lãi suất:
<span class="math display">\[\begin{align}
Mod_D &amp; = - \lim\limits_{i \rightarrow 0} \cfrac{1}{PV} \ \cfrac{\Delta PV}{\Delta i} \\
&amp; = \cfrac{1}{PV} \ \sum\limits_{k=1}^n \cfrac{t_k CF_{t_k}}{(1+i)^{t_k+1}} \\
&amp; = \cfrac{1}{1+i} \ \cfrac{1}{PV} \ \cfrac{t_k CF_{t_k}}{(1+i)^{t_k}}
\end{align}\]</span>
Bạn đọc có thể thấy rằng mặc dù ý nghĩa khác nhau, nhưng <span class="math inline">\(Mod_D\)</span> có thể được tính từ <span class="math inline">\(Mac_D\)</span> như sau
<span class="math display">\[\begin{align}
Mod_D = \cfrac{1}{1+i} \times Mac_D
\end{align}\]</span></p></li>
<li><p>Dollar duration là khoản tăng lên (theo số tiền tuyệt đối) của giá trị hiện tại của một dòng tiền khi lãi suất giảm 1% trong lãi suất
<span class="math display">\[\begin{align}
Dollar_D = Mod_D \times PV \times 0.01
\end{align}\]</span></p></li>
</ul>
</div>
</div>
</div>
<div id="bài-tập-1" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Bài tập<a href="kiến-thức-r-nâng-cao.html#bài-tập-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="math inline">\(\textbf{Câu hỏi }\)</span> Bạn cố gắng xấp xỉ hàm <span class="math inline">\(sin(x)\)</span> trên khoảng <span class="math inline">\([0,2*\pi]\)</span> bằng một đa thức bậc 5
<span class="math display">\[\begin{align}
P(x) = a_0 + a_1 \cdot x + a_2 \cdot x^2 + a_3 \cdot x^3 + a_4 \cdot x^4 + a_5 \cdot x^5
\end{align}\]</span>
bằng cách tìm các hệ số <span class="math inline">\(\textbf{a} = (a_0, a_1, a_2, a_3, a_4, a_5)\)</span> sao cho hàm số <span class="math inline">\(g(\textbf{a})\)</span> được xác định bằng
<span class="math display">\[\begin{align}
g(\textbf{a}) = \int\limits_0^{2 \pi} (P(x) - sin(x))^2 \ dx
\end{align}\]</span>
đạt giá trị nhỏ nhất. Hãy sử dụng thuật toán gradient descent để tìm <span class="math inline">\(\textbf{a}\)</span>.</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="kiến-thức-r-nâng-cao.html#cb439-1" tabindex="-1"></a><span class="co"># Simple formula to success</span></span>
<span id="cb439-2"><a href="kiến-thức-r-nâng-cao.html#cb439-2" tabindex="-1"></a><span class="cf">while</span> (outcome <span class="sc">!=</span> success) {</span>
<span id="cb439-3"><a href="kiến-thức-r-nâng-cao.html#cb439-3" tabindex="-1"></a>  try <span class="ot">&lt;-</span> try <span class="sc">*</span> <span class="dv">10</span> }  </span></code></pre></div>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="kiến-thức-r-nâng-cao.html#cb440-1" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Hello&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb440-2"><a href="kiến-thức-r-nâng-cao.html#cb440-2" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;We are actuaries&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb440-3"><a href="kiến-thức-r-nâng-cao.html#cb440-3" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;What is your talent ?&quot;</span>)</span></code></pre></div>
<!-- # REFERENCE -->
<!-- ### Source from thesis -->
<!-- **1.** Chen, Chun-houh, Wolfgang Karl Härdle, and Antony Unwin, eds (2007). *Handbook of data visualization.* \ -->
<!-- **2.** Aparicio, Manuela, and Carlos J. Costa. (2015). *Data visualization - Communication design quarterly review.* \ -->
<!-- **3.** Hadley Wickham. (2010). *A Layered Grammar of Graphics.* \ -->
<!-- ### Souce from website -->
<!-- **4.** [https://www.tableau.com/learn/articles/data-visualization](https://www.tableau.com/learn/articles/data-visualization) \ -->
<!-- **5.** [https://www.r-graph-gallery.com/ggplot2-package.html](https://www.r-graph-gallery.com/ggplot2-package.html) \ -->
<!-- **6.** [http://r-statistics.co/ggplot2-Tutorial-With-R.html](http://r-statistics.co/ggplot2-Tutorial-With-R.html) \ -->
<!-- **7.** [https://www.maths.usyd.edu.au/u/UG/SM/STAT3022/r/current/Misc/data-visualization-2.1.pdf](https://www.maths.usyd.edu.au/u/UG/SM/STAT3022/r/current/Misc/data-visualization-2.1.pdf) \ -->
<!-- **8.** [https://www.kaggle.com/](https://www.kaggle.com/) \ -->

<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre><code>## 
## Attaching package: &#39;tidyr&#39;</code></pre>
<pre><code>## The following objects are masked _by_ &#39;.GlobalEnv&#39;:
## 
##     table1, table2, table3, table5</code></pre>
<pre><code>## The following object is masked from &#39;package:imager&#39;:
## 
##     fill</code></pre>
<pre><code>## The following object is masked from &#39;package:magrittr&#39;:
## 
##     extract</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="kiến-thức-r-cơ-bản.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="nhập-dữ-liệu-vào-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
